
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Releases and Deployment &mdash; NSLS-II Controls Docs 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bnl-styles.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="NSLS-II Controls Docs 0.0.1 documentation" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          NSLS-II Controls Docs</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="ophyd/cli_api.html">Command line interface to Ophyd</a></li>
<li class="toctree-l1"><a class="reference internal" href="ophyd/scan_api.html">Step Scan Interface to Ophyd</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyolog/pyolog.html">Simple Python Interface to The Olog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="broker/basics.html">DataBroker Basics</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="filestore/index.html">Introduction to File Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch/arch.html">NSLS-II Beamline Controls Architecture</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Releases and Deployment</a><ul>
<li><a class="reference internal" href="#creating-a-release-version">Creating a Release Version</a><ul>
<li><a class="reference internal" href="#decide-on-version-number">Decide on version number</a></li>
<li><a class="reference internal" href="#release-notes-api-changes">Release notes/ API changes</a></li>
<li><a class="reference internal" href="#version-bump-release-commit">Version bump / Release commit</a></li>
<li><a class="reference internal" href="#create-tag">Create Tag</a></li>
<li><a class="reference internal" href="#version-bump-back-to-dev-versions">Version bump back to dev versions</a></li>
<li><a class="reference internal" href="#check-your-work">Check your work</a></li>
<li><a class="reference internal" href="#push-everything">Push everything</a></li>
<li><a class="reference internal" href="#create-conda-recipe-for-release">Create conda recipe for release</a></li>
<li><a class="reference internal" href="#build-and-upload-new-binaries">Build and upload new binaries</a></li>
<li><a class="reference internal" href="#rebuild-all-of-the-documentation">Rebuild all of the documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-an-untagged-commit">Building an Untagged Commit</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/deployment.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="releases-and-deployment">
<h1>Releases and Deployment<a class="headerlink" href="#releases-and-deployment" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-a-release-version">
<h2>Creating a Release Version<a class="headerlink" href="#creating-a-release-version" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Decide what the new new version number will be</li>
<li>Write release notes / collapse whats_new and api_changes folders</li>
<li>Create a new commit, version bumping as needed. Commit
message should be truncated release notes.</li>
<li>create annotated tag on release commit, text should be truncated release
notes.  Tag format is <cite>vX.Y.Z</cite></li>
<li>create new commit version bumping back to dev version pattern as needed</li>
<li>check to make sure everything looks right</li>
<li>push to master branch</li>
<li>push tag</li>
<li>create new conda recipe in conda-prescriptions/releases, updating
as needed</li>
<li>use build server or beamline computer to build conda package</li>
<li>upload to proper internal binstar organization(s)</li>
<li>rebuild (all) the docs</li>
</ol>
<div class="section" id="decide-on-version-number">
<h3>Decide on version number<a class="headerlink" href="#decide-on-version-number" title="Permalink to this headline">¶</a></h3>
<p>We are using <a class="reference external" href="http://semver.org/">semantic versioning</a> guidelines and <span class="target" id="index-0"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0440"><strong>PEP 440</strong></a>.  Each
tagged version number is of the form <tt class="docutils literal"><span class="pre">vMajor.Minor.Patch</span></tt>.  Roughly,
versions bumping the <tt class="docutils literal"><span class="pre">Major</span></tt> version can make backwards incompatible
API changes, versions bumping <tt class="docutils literal"><span class="pre">Minor</span></tt> can add backwards-compatible
new features and versions bumping <tt class="docutils literal"><span class="pre">Patch</span></tt> can make
backwards-compatible bug fixes.  Bumping a version component re-sets
everything to the right to 0.  So long as the <tt class="docutils literal"><span class="pre">Major</span></tt> version is 0, the
rules do not apply.</p>
<p>PEP440 defines a way of adding qualifiers to a version string to
ensure proper sorting of development releases.  The rules are quite
general and specify how to sort multiply stacked pre- and post-
releases.  We will only be using a very simple case and all of our
development releases should look like <tt class="docutils literal"><span class="pre">vX.Y.Z.postN+gHEXVAL</span></tt> which
say that this the <tt class="docutils literal"><span class="pre">N</span></tt> commit after release <tt class="docutils literal"><span class="pre">vX.Y.Z</span></tt> and with the
git SHA1 <tt class="docutils literal"><span class="pre">HEXVAL</span></tt>.  This should mostly be dealt with automatically
by the build tools.</p>
<p>In the future we may have the need to do release candidates.</p>
</div>
<div class="section" id="release-notes-api-changes">
<h3>Release notes/ API changes<a class="headerlink" href="#release-notes-api-changes" title="Permalink to this headline">¶</a></h3>
<p>The release notes should be a succinct document which
summarizes the accumulated changes sense the last version.
It is particularly important to document <strong>all</strong> API changes.</p>
<p>Each repository should have a folder in the docs directory for new
features (<tt class="file docutils literal"><span class="pre">whats_new</span></tt>) and for api changes (<tt class="file docutils literal"><span class="pre">api_changes</span></tt>).
Collect all of the files into this folder into the top-level
<tt class="file docutils literal"><span class="pre">*.rst</span></tt>.</p>
<p>An abbreviated version of the release notes will go in the release
commit message + the tag annotation.</p>
</div>
<div class="section" id="version-bump-release-commit">
<h3>Version bump / Release commit<a class="headerlink" href="#version-bump-release-commit" title="Permalink to this headline">¶</a></h3>
<p>On the branch you plan to cut the release off do the version bumping
as needed.  Currently this require changing</p>
<ul class="simple">
<li>version number in <tt class="docutils literal"><span class="pre">setup.py</span></tt></li>
<li><tt class="docutils literal"><span class="pre">__version__</span></tt> in <tt class="docutils literal"><span class="pre">__init__.py</span></tt></li>
</ul>
<p>This will be simplified if/when we adopt <tt class="docutils literal"><span class="pre">versioneer</span></tt>.</p>
<p>The commit message should look something like:</p>
<div class="highlight-bash"><div class="highlight"><pre>REL : v0.1.0

This releases fixes a number of bugs in the Aardvark
and adds new features to whizbang class.

Bugs fixed:
  - Aardvarks can eat ants again
  - tunnels no longer list to the left

Features added:
  - Color of <span class="sb">``</span>whizbang<span class="sb">``</span> explosion is now tunable
</pre></div>
</div>
</div>
<div class="section" id="create-tag">
<h3>Create Tag<a class="headerlink" href="#create-tag" title="Permalink to this headline">¶</a></h3>
<p>Create an annotated tag on the release commit. The annotation should
match that of the commit you are tagging.</p>
</div>
<div class="section" id="version-bump-back-to-dev-versions">
<h3>Version bump back to dev versions<a class="headerlink" href="#version-bump-back-to-dev-versions" title="Permalink to this headline">¶</a></h3>
<p>Bump the version in <tt class="file docutils literal"><span class="pre">setup.py</span></tt> and <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> to
<tt class="docutils literal"><span class="pre">v.X.Y.Z.post0</span></tt>.  This step can be eliminated if/when we adopt
<tt class="docutils literal"><span class="pre">versioneer</span></tt>.</p>
</div>
<div class="section" id="check-your-work">
<h3>Check your work<a class="headerlink" href="#check-your-work" title="Permalink to this headline">¶</a></h3>
<p>Take some time to consider what you have just done and make sure
everything looks right.  Run some local tests, install off the tagged
commit to make sure the versions are ok.  Run the tests locally.  Make
sure that the dev version of the conda package still builds.</p>
<p>Once a tag is made public it can not be taken back!</p>
</div>
<div class="section" id="push-everything">
<h3>Push everything<a class="headerlink" href="#push-everything" title="Permalink to this headline">¶</a></h3>
<p>Push the branch with your new commits + the tag up to the canonical
repository.</p>
</div>
<div class="section" id="create-conda-recipe-for-release">
<h3>Create conda recipe for release<a class="headerlink" href="#create-conda-recipe-for-release" title="Permalink to this headline">¶</a></h3>
<p>In <a class="reference external" href="https://github.com/NSLS-II/conda-prescriptions">conda-prescriptions</a> create a new recipe
in <tt class="file docutils literal"><span class="pre">releases/project/vX.Y.Z</span></tt>.  This is most easily done by
copying and updating the recipe from the previous version.  You will
need to update at least the <tt class="docutils literal"><span class="pre">version</span></tt> string ande the <tt class="docutils literal"><span class="pre">git_rev</span></tt>.
In addition you may need to update the imports that are tested and the
dependencies if they have changed between versions.</p>
</div>
<div class="section" id="build-and-upload-new-binaries">
<h3>Build and upload new binaries<a class="headerlink" href="#build-and-upload-new-binaries" title="Permalink to this headline">¶</a></h3>
<p>Use either the <a class="reference internal" href="binstar.html#binstar-build"><em>binstar build server</em></a> or by using
<tt class="docutils literal"><span class="pre">conda</span> <span class="pre">build</span></tt> on one of the beam line computers to build the conda
package off of your newly created recipe.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>conda-prescriptions
conda build releases/project/vX.Y.Z
</pre></div>
</div>
<p>Before uploading this file to the internal binstar you should make
sure it installs locally.  Once you are satisfied that everything
is working correctly, upload it to the internal binstar</p>
<div class="highlight-bash"><div class="highlight"><pre>binstar upload <span class="sb">`</span>conda build releases/project/vX.Y.Z --output<span class="sb">`</span> -u USER
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">USER</span></tt> is the user or organization you want to upload the
binary to.  To upload to more than one beamline either simply run
the above command more than once, or use <a href="#id1"><span class="problematic" id="id2">:prog:`binstar`</span></a> to move
the files between organizations</p>
<div class="highlight-bash"><div class="highlight"><pre>binstar copy --to-owner USER2 USER1/project/vX.Y.Z
</pre></div>
</div>
</div>
<div class="section" id="rebuild-all-of-the-documentation">
<h3>Rebuild all of the documentation<a class="headerlink" href="#rebuild-all-of-the-documentation" title="Permalink to this headline">¶</a></h3>
<p>Rebuild both the project specific documentation and the over-all
NSLS-II documentation and push to the correct github.io locations.</p>
</div>
</div>
<div class="section" id="building-an-untagged-commit">
<h2>Building an Untagged Commit<a class="headerlink" href="#building-an-untagged-commit" title="Permalink to this headline">¶</a></h2>
<p>It is possible to build and upload a conda package from an untagged
commit.  The recipes in the project repositories are set up so that
the version reported to conda will be the last tag with
<cite>.postN+gHEXVAL</cite> appended to the end.  This will allow conda to
correctly sort versions so long as all of the builds are off of the same
branch.  However, these binaries should only be deployed to beamlines
in exceptional circumstances.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Stuart B. Wilkins.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; databroker 0.9.3.post40+g7bf2c6f documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="databroker 0.9.3.post40+g7bf2c6f documentation" href="index.html"/>
        <link rel="next" title="API Documentation" href="api.html"/>
        <link rel="prev" title="Data Broker" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> databroker
          

          
          </a>

          
            
            
              <div class="version">
                0.9.3.post40+g7bf2c6f
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-walkthrough">Basic Walkthrough</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-a-broker">Get a Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-data-as-a-table">Load Data as a Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#do-analysis-or-export">Do Analysis or Export</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-data-lazily-good-for-image-data">Load Data Lazily (Good for Image Data)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explore-metadata">Explore Metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#searching">Searching</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="whats_new.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">databroker</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The databroker is tool for access data from many sources through a unified
interface. It emphasizes rich searching capabilities and handling multiple
concurrent “streams” of data in an organized way.</p>
<div class="section" id="basic-walkthrough">
<h2>Basic Walkthrough<a class="headerlink" href="#basic-walkthrough" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-a-broker">
<h3>Get a Broker<a class="headerlink" href="#get-a-broker" title="Permalink to this headline">¶</a></h3>
<p>List the names of available configurations.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">list_configs</span>

<span class="gp">In [2]: </span><span class="n">list_configs</span><span class="p">()</span>
<span class="gh">Out[2]: </span><span class="go">[&#39;example&#39;]</span>
</pre></div>
</div>
<p>If this list is empty, no one has created any configuration files yet. See the
section on <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a>.</p>
<p>Make a databroker using one of the configurations.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">Broker</span>

<span class="gp">In [4]: </span><span class="n">db</span> <span class="o">=</span> <span class="n">Broker</span><span class="o">.</span><span class="n">named</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="load-data-as-a-table">
<h3>Load Data as a Table<a class="headerlink" href="#load-data-as-a-table" title="Permalink to this headline">¶</a></h3>
<p>Load the most recently saved run.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">StopIteration</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">~/virtualenv/python3.6.3/lib/python3.6/site-packages/databroker/_core.py</span> in <span class="ni">_</span><span class="nt">(key, db)</span>
<span class="g g-Whitespace">    </span><span class="mi">787</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">788</span>                 <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span>             <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>

<span class="ne">StopIteration</span>: 

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-5-1942259e68e5&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="nn">~/virtualenv/python3.6.3/lib/python3.6/site-packages/databroker/_core.py</span> in <span class="ni">__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">   </span><span class="mi">1233</span>                       <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepare_hook</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="n">stop</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1234</span>                       <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1235</span>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">search</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">)]</span>
<span class="g g-Whitespace">   </span><span class="mi">1236</span>         <span class="n">squeeze</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="nb">slice</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1237</span>         <span class="k">if</span> <span class="n">squeeze</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

<span class="nn">~/virtualenv/python3.6.3/lib/python3.6/functools.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">801</span> 
<span class="g g-Whitespace">    </span><span class="mi">802</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">803</span>         <span class="k">return</span> <span class="n">dispatch</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">804</span> 
<span class="g g-Whitespace">    </span><span class="mi">805</span>     <span class="n">registry</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

<span class="nn">~/virtualenv/python3.6.3/lib/python3.6/site-packages/databroker/_core.py</span> in <span class="ni">_</span><span class="nt">(key, db)</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span>             <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">790</span>                 <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">791</span>                     <span class="s2">&quot;There are only {0} runs.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">792</span>     <span class="k">return</span> <span class="p">[(</span><span class="n">result</span><span class="p">,</span> <span class="n">safe_get_stop</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">hs</span><span class="p">,</span> <span class="n">result</span><span class="p">))]</span>
<span class="g g-Whitespace">    </span><span class="mi">793</span> 

<span class="ne">IndexError</span>: There are only 0 runs.
</pre></div>
</div>
<p>The result, a <a class="reference internal" href="_as_gen/databroker.Header.html#databroker.Header" title="databroker.Header"><code class="xref py py-class docutils literal"><span class="pre">Header</span></code></a>, encapsulates the metadata from this run. Loading
the data itself can be a longer process, so it’s a separate step. For scalar
data, the most convenient method is:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">header</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-6-d048e35fa841&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>This object is DataFrame, a spreadsheet-like object provided by the library
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/">pandas</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For Python novies we point out that <code class="docutils literal"><span class="pre">header</span></code> above is an arbitrary
variable name. It could have been:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">h</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
</pre></div>
</div>
<p>or even in one line:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="do-analysis-or-export">
<h3>Do Analysis or Export<a class="headerlink" href="#do-analysis-or-export" title="Permalink to this headline">¶</a></h3>
<p>DataFrames can be used to perform fast computations on labeled data, such as</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-7-cde6a8882a8e&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">t</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined

<span class="gp">In [8]: </span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-8-0ea3c813c93a&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 t.mean()</span>

<span class="go">NameError: name &#39;t&#39; is not defined</span>

<span class="gp">In [9]: </span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;det&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">]</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-9-8d6631075f49&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 t[&#39;det&#39;] / t[&#39;motor&#39;]</span>

<span class="go">NameError: name &#39;t&#39; is not defined</span>
</pre></div>
</div>
<p>or export to a file.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">t</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-10-9b0a0f9ac48f&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">t</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;t&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="load-data-lazily-good-for-image-data">
<h3>Load Data Lazily (Good for Image Data)<a class="headerlink" href="#load-data-lazily-good-for-image-data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="_as_gen/databroker.Header.table.html#databroker.Header.table" title="databroker.Header.table"><code class="xref py py-class docutils literal"><span class="pre">Header.table</span></code></a> method is just one way to load the data. Another is
<a class="reference internal" href="_as_gen/databroker.Header.data.html#databroker.Header.data" title="databroker.Header.data"><code class="xref py py-class docutils literal"><span class="pre">Header.data</span></code></a>, which loads data for one specific field (i.e., one column
of the table) in a “lazy”, streaming fashion.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-11-edf4816dadee&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">data</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined

<span class="gp">In [12]: </span><span class="n">data</span>  <span class="c1"># This a &#39;generator&#39; that will load data when we loop through it.</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-12-cb2161ccc0c2&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 data  # This a &#39;generator&#39; that will load data when we loop through it.</span>

<span class="go">NameError: name &#39;data&#39; is not defined</span>

<span class="gp">In [13]: </span><span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-13-c6eef5dd8c20&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 for point in data:</span>
<span class="go">      2     print(point)</span>
<span class="go">      3 </span>

<span class="go">NameError: name &#39;data&#39; is not defined</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="_as_gen/databroker.Header.data.html#databroker.Header.data" title="databroker.Header.data"><code class="xref py py-class docutils literal"><span class="pre">Header.data</span></code></a> method is suitable for loading image data. See
the <a class="reference internal" href="api.html"><span class="doc">API Documentation</span></a> for more methods.</p>
</div>
<div class="section" id="explore-metadata">
<h3>Explore Metadata<a class="headerlink" href="#explore-metadata" title="Permalink to this headline">¶</a></h3>
<p>Everything recorded at the start of the run is in <code class="docutils literal"><span class="pre">header.start</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">header</span><span class="o">.</span><span class="n">start</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-14-b2b200ec16e4&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">start</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>Information only knowable at the end, like the exit status (success, abort,
fail) is stored in <code class="docutils literal"><span class="pre">header.stop</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">header</span><span class="o">.</span><span class="n">stop</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-15-05b39acccd88&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">stop</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>Metadata about the devices involved and their configuration is stored in
<code class="docutils literal"><span class="pre">header.descriptors</span></code>, but that is quite a lot to dig through, so it’s useful
to start with some convenience methods that extract the list of devices or the
fields that they reported:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">header</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-16-cbc134ba4df1&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">devices</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined

<span class="gp">In [17]: </span><span class="n">header</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-17-90b4af481d30&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 header.fields()</span>

<span class="go">NameError: name &#39;header&#39; is not defined</span>
</pre></div>
</div>
<p>To extract configuration data recorded by a device:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">header</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="s1">&#39;motor&#39;</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-18-2e6a9cc414f2&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">header</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="s1">&#39;motor&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;header&#39; is not defined
</pre></div>
</div>
<p>(A realistic example might report, for example, exposure_time or zero point.)</p>
</div>
</div>
<div class="section" id="searching">
<h2>Searching<a class="headerlink" href="#searching" title="Permalink to this headline">¶</a></h2>
<p>The “slicing” (square bracket) syntax is a quick way to search based on
recently, unique ID, or counting number scan_id. Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Get the most recent run.</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Get the fifth most recent run.</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>

<span class="c1"># Get a list of all five most recent runs, using Python slicing syntax.</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>

<span class="c1"># Get a run whose unique ID (&quot;RunStart uid&quot;) begins with &#39;x39do5&#39;.</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;x39do5&#39;</span><span class="p">]</span>

<span class="c1"># Get a run whose integer scan_id is 42. Note that this might not be</span>
<span class="c1"># unique. In the event of duplicates, the most recent match is returned.</span>
<span class="n">header</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span>
</pre></div>
</div>
<p>Calling a Broker like a function (with parentheses) access richer search.
Common search parameters include <code class="docutils literal"><span class="pre">plan_name</span></code>, <code class="docutils literal"><span class="pre">motor</span></code>, and <code class="docutils literal"><span class="pre">detectors</span></code>.
Any user-provided metadata can be used in a search. Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Search by plan name.</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">plan_name</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span><span class="p">)</span>

<span class="c1"># Search for runs involving a motor with the name &#39;eta&#39;.</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">motor</span><span class="o">=</span><span class="s1">&#39;eta&#39;</span><span class="p">)</span>

<span class="c1"># Search for runs operated by a given user---assuming this metadata was</span>
<span class="c1"># recorded in the first place!</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">operator</span><span class="o">=</span><span class="s1">&#39;Dan&#39;</span><span class="p">)</span>

<span class="c1"># Search by time range. (These keywords have a special meaning.)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="s1">&#39;2015-03-05&#39;</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="s1">&#39;2015-03-10&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Full-text search is also supported, for MongoDB-backed deployments. (Other
deploymeents will raise <code class="xref py py-class docutils literal"><span class="pre">NotImplementedError</span></code> if you try this.)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Perform text search on all values in the Run Start document.</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that partial words are not matched, but partial phrases are. For example,
‘good’ will match to ‘good sample’ but ‘goo’ will not.</p>
<p>Unlike the “slicing” (square bracket) queries, rich searches can return an
unbounded number of results. To avoid slowness, the results are loaded
“lazily,” only as needed. Here’s an example of what works and what doesn’t.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">headers</span> <span class="o">=</span> <span class="n">db</span><span class="p">(</span><span class="n">plan_name</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">headers</span>
<span class="gh">Out[20]: </span><span class="go">&lt;databroker._core.Results at 0x2b67cc630e80&gt;</span>

<span class="gp">In [21]: </span><span class="n">headers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Fails! The results are not a list.</span>
<span class="go">                                                      ---------------------------------------------------------------------------</span>
<span class="go">TypeError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-21-6a220047f4ab&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 headers[2]  # Fails! The results are not a list.</span>

<span class="go">TypeError: &#39;Results&#39; object does not support indexing</span>

<span class="gp">In [22]: </span><span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># This works, but might be slow if the results are large.</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ---------------------------------------------------------------------------</span>
<span class="go">IndexError                                Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-22-5067c0ab9d60&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 list(headers)[2]  # This works, but might be slow if the results are large.</span>

<span class="go">IndexError: list index out of range</span>
</pre></div>
</div>
<p>Loop through them loads one at a time, conserving memory.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="k">print</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">table</span><span class="p">()[</span><span class="s1">&#39;det&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Data Broker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Brookhaven National Lab.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9.3.post40+g7bf2c6f',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Documentation &mdash; databroker 1.0.6 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Administrator Documentation" href="../administrator/index.html" />
    <link rel="prev" title="Version 2 Interface" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> databroker
          

          
          </a>

          
            
            
              <div class="version">
                1.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../data-access-overview.html">Data Access Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Version 2 Interface</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">User Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#walkthrough">Walkthrough</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#find-a-catalog">Find a Catalog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#look-up-a-run-by-id">Look up a Run by ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#search-for-runs">Search for Runs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-data">Access Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#replay-document-stream">Replay Document Stream</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../administrator/index.html">Administrator Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developer/index.html">Developer Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../v1/index.html">Version 1 Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DBEP/index.html">Databroker Enhancement Proposals</a></li>
</ul>
<p class="caption"><span class="caption-text">Bluesky Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://blueskyproject.io">Homepage</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/bluesky">GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://gitter.im/NSLS-II/DAMA">Gitter</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">databroker</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Version 2 Interface</a> &raquo;</li>
        
      <li>User Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/v2/user/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-documentation">
<h1>User Documentation<a class="headerlink" href="#user-documentation" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>DataBroker release 1.0 includes support for old-style “v1” usage and
new-style “v2” usage.  This section addresses databroker’s new “v2” usage.
It is still under development and subject to change in response to user
feedback.</p>
<p>For the stable usage “v1” usage, see <a class="reference internal" href="../../v1/index.html#v1-index"><span class="std std-ref">Version 1 Interface</span></a>. See
<a class="reference internal" href="../../overview.html#transition-plan"><span class="std std-ref">Transition Plan</span></a> for more information.</p>
</div>
<div class="section" id="walkthrough">
<h2>Walkthrough<a class="headerlink" href="#walkthrough" title="Permalink to this headline">¶</a></h2>
<div class="section" id="find-a-catalog">
<h3>Find a Catalog<a class="headerlink" href="#find-a-catalog" title="Permalink to this headline">¶</a></h3>
<p>When databroker is first imported, it searches for Catalogs on your system,
typically provided by a Python package or configuration file that you or an
administrator installed.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">databroker</span> <span class="kn">import</span> <span class="n">catalog</span>

<span class="gp">In [2]: </span><span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span>
<span class="gh">Out[2]: </span><span class="go">[&#39;csx&#39;, &#39;chx&#39;, &#39;isr&#39;, &#39;xpd&#39;, &#39;sst&#39;, &#39;bmm&#39;, &#39;lix&#39;]</span>
</pre></div>
</div>
<p>Each entry is a Catalog that databroker discovered on our system. In this
example, we find Catalogs corresponding to different instruments/beamlines. We
can access a subcatalog with square brackets, like accessing an item in a
dictionary.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;csx&#39;</span><span class="p">]</span>
<span class="gh">Out[3]: </span><span class="go">csx:</span>
<span class="go">  args:</span>
<span class="go">    path: source/_catalogs/csx.yml</span>
<span class="go">  description: &#39;&#39;</span>
<span class="go">  driver: intake.catalog.local.YAMLFileCatalog</span>
<span class="go">  metadata: {}</span>
</pre></div>
</div>
<p>List the entries in the ‘csx’ Catalog.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="nb">list</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;csx&#39;</span><span class="p">])</span>
<span class="gh">Out[4]: </span><span class="go">[&#39;raw&#39;]</span>
</pre></div>
</div>
<p>We see Catalogs for raw data and processed data. Let’s access the raw one
and assign it to a variable for convenience.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">raw</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;csx&#39;</span><span class="p">][</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This Catalog contains all the raw data taken at CSX. It contains many entries,
as we can see by checking <code class="docutils literal notranslate"><span class="pre">len(raw)</span></code> so listing it would take awhile.
Instead, we’ll look up entries by name or by search.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As an alternative to <code class="docutils literal notranslate"><span class="pre">list(...)</span></code>, try using tab-completion to view your
options. Typing <code class="docutils literal notranslate"><span class="pre">catalog['</span></code> and then hitting the TAB key will list the
available entries.</p>
<p>Also, these shortcuts can save a little typing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># These three lines are equivalent.</span>
<span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;csx&#39;</span><span class="p">][</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span>
<span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;csx&#39;</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">]</span>
<span class="n">catalog</span><span class="o">.</span><span class="n">csx</span><span class="o">.</span><span class="n">raw</span>  <span class="c1"># only works if the entry names are valid Python identifiers</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="look-up-a-run-by-id">
<h3>Look up a Run by ID<a class="headerlink" href="#look-up-a-run-by-id" title="Permalink to this headline">¶</a></h3>
<p>Suppose you know the unique ID of a run (a.k.a “scan”) that we want to access. Note
that the first several characters will do; usually 6-8 are enough to uniquely
identify a given run.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">run</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>  <span class="c1"># where uid is some string like &#39;17531ace&#39;</span>
</pre></div>
</div>
<p>Each run also has a <code class="docutils literal notranslate"><span class="pre">scan_id</span></code>. The <code class="docutils literal notranslate"><span class="pre">scan_id</span></code> is usually easier to remember
(it’s a counting number, not a random string) but it may not be globally
unique. If there are collisions, you’ll get the most recent match, so the
unique ID is better as a long-term reference.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">run</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="search-for-runs">
<h3>Search for Runs<a class="headerlink" href="#search-for-runs" title="Permalink to this headline">¶</a></h3>
<p>Suppose you want to sift through multiple runs to examine a range of datasets.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proposal_id&#39;</span><span class="p">:</span> <span class="mi">12345</span><span class="p">}</span>  <span class="c1"># or, equivalently, dict(proposal_id=12345)</span>

<span class="gp">In [9]: </span><span class="n">search_results</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
<p>The result, <code class="docutils literal notranslate"><span class="pre">search_results</span></code>, is itself a Catalog.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">search_results</span>
<span class="gh">Out[10]: </span><span class="go">search results:</span>
<span class="go">  args:</span>
<span class="go">    auth: !!python/object:intake.auth.base.BaseClientAuth</span>
<span class="go">      args: !!python/tuple []</span>
<span class="go">    getenv: true</span>
<span class="go">    getshell: true</span>
<span class="go">    handler_registry:</span>
<span class="go">      NPY_SEQ: !!python/name:ophyd.sim.NumpySeqHandler &#39;&#39;</span>
<span class="go">    name: search results</span>
<span class="go">    paths:</span>
<span class="go">    - data/*.jsonl</span>
<span class="go">    query:</span>
<span class="go">      proposal_id: 12345</span>
<span class="go">    root_map: {}</span>
<span class="go">    storage_options: null</span>
<span class="go">    transforms:</span>
<span class="go">      descriptor: &amp;id001 !!python/name:databroker.core._no_op &#39;&#39;</span>
<span class="go">      resource: *id001</span>
<span class="go">      start: *id001</span>
<span class="go">      stop: *id001</span>
<span class="go">  description: &#39;&#39;</span>
<span class="go">  driver: databroker._drivers.jsonl.BlueskyJSONLCatalog</span>
<span class="go">  metadata:</span>
<span class="go">    catalog_dir: /home/travis/build/bluesky/databroker/doc/source/_catalogs/</span>
</pre></div>
</div>
<p>We can quickly check how many results it contains</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="nb">len</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>
<span class="gh">Out[11]: </span><span class="go">5</span>
</pre></div>
</div>
<p>and, if we want, list them.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="nb">list</span><span class="p">(</span><span class="n">search_results</span><span class="p">)</span>
<span class="gh">Out[12]: </span><span class="go"></span>
<span class="go">[&#39;f6d68fdc-77dc-4877-a7ee-47bec9971228&#39;,</span>
<span class="go"> &#39;bd0b0dbf-2843-4b60-9aae-03ceed54adca&#39;,</span>
<span class="go"> &#39;df92a283-a283-423b-9b6d-180d99019ceb&#39;,</span>
<span class="go"> &#39;a254674e-e73e-46c4-9cb3-da4d00896d57&#39;,</span>
<span class="go"> &#39;20eb15f2-3c61-4a2f-a0c8-cbb1f141b982&#39;]</span>
</pre></div>
</div>
<p>Because searching on a Catalog returns another Catalog, we refine our search
by searching <code class="docutils literal notranslate"><span class="pre">search_results</span></code>. In this example we’ll use a helper,
<code class="xref py py-class docutils literal notranslate"><span class="pre">TimeRange</span></code>, to build our query.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="kn">from</span> <span class="nn">databroker.queries</span> <span class="kn">import</span> <span class="n">TimeRange</span>

<span class="gp">In [14]: </span><span class="n">query</span> <span class="o">=</span> <span class="n">TimeRange</span><span class="p">(</span><span class="n">since</span><span class="o">=</span><span class="s1">&#39;2019-09-01&#39;</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="s1">&#39;2040&#39;</span><span class="p">)</span>

<span class="gp">In [15]: </span><span class="n">search_results</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="gh">Out[15]: </span><span class="go">search results:</span>
<span class="go">  args:</span>
<span class="go">    auth: !!python/object:intake.auth.base.BaseClientAuth</span>
<span class="go">      args: !!python/tuple []</span>
<span class="go">    getenv: true</span>
<span class="go">    getshell: true</span>
<span class="go">    handler_registry:</span>
<span class="go">      NPY_SEQ: !!python/name:ophyd.sim.NumpySeqHandler &#39;&#39;</span>
<span class="go">    name: search results</span>
<span class="go">    paths:</span>
<span class="go">    - data/*.jsonl</span>
<span class="go">    query:</span>
<span class="go">      $and:</span>
<span class="go">      - proposal_id: 12345</span>
<span class="go">      - time:</span>
<span class="go">          $gte: 1567310400.0</span>
<span class="go">          $lt: 2209006800.0</span>
<span class="go">    root_map: {}</span>
<span class="go">    storage_options: null</span>
<span class="go">    transforms:</span>
<span class="go">      descriptor: &amp;id001 !!python/name:databroker.core._no_op &#39;&#39;</span>
<span class="go">      resource: *id001</span>
<span class="go">      start: *id001</span>
<span class="go">      stop: *id001</span>
<span class="go">  description: &#39;&#39;</span>
<span class="go">  driver: databroker._drivers.jsonl.BlueskyJSONLCatalog</span>
<span class="go">  metadata:</span>
<span class="go">    catalog_dir: /home/travis/build/bluesky/databroker/doc/source/_catalogs/</span>
</pre></div>
</div>
<p>Other sophisticated queries are possible, such as filtering for scans that
include <em>greater than</em> 50 points.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">search_results</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s1">&#39;num_points&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$gt&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}})</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://docs.mongodb.com/v3.2/reference/operator/query/#query-selectors">MongoQuerySelectors</a> for more.</p>
<p>Once we have a result catalog that we are happy with we can list the entries
via <code class="docutils literal notranslate"><span class="pre">list(search_results)</span></code>, access them individually by names as in
<code class="docutils literal notranslate"><span class="pre">search_results[SOME_UID]</span></code> or loop through them:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">search_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">   ....: </span>    <span class="o">...</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
</div>
<div class="section" id="access-data">
<h3>Access Data<a class="headerlink" href="#access-data" title="Permalink to this headline">¶</a></h3>
<p>Suppose we have a run of interest.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">run</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
</pre></div>
</div>
<p>A given run contains multiple logical tables. The number of these tables and
their names varies by the particular experiment, but two common ones are</p>
<ul class="simple">
<li><p>‘primary’, the main data of interest, such as a time series of images</p></li>
<li><p>‘baseline’, readings taken at the beginning and end of the run for alignment
and sanity-check purposes</p></li>
</ul>
<p>To explore a run, we can open its entry by calling it like a function with no
arguments:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">run</span><span class="p">()</span>  <span class="c1"># or, equivalently, run.get()</span>
<span class="gh">Out[18]: </span><span class="go">20eb15f2-3c61-4a2f-a0c8-cbb1f141b982:</span>
<span class="go">  args:</span>
<span class="go">    entry: !!python/object:databroker.core.Entry</span>
<span class="go">      args: []</span>
<span class="go">      cls: databroker.core.Entry</span>
<span class="go">      kwargs:</span>
<span class="go">        name: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">        description: {}</span>
<span class="go">        driver: databroker.core.BlueskyRunFromGenerator</span>
<span class="go">        direct_access: forbid</span>
<span class="go">        args:</span>
<span class="go">          gen_args: !!python/tuple</span>
<span class="go">          - data/20eb15f2-3c61-4a2f-a0c8-cbb1f141b982.jsonl</span>
<span class="go">          gen_func: &amp;id003 !!python/name:databroker._drivers.jsonl.gen &#39;&#39;</span>
<span class="go">          gen_kwargs: {}</span>
<span class="go">          get_filler: &amp;id004 !!python/object/apply:functools.partial</span>
<span class="go">            args:</span>
<span class="go">            - &amp;id001 !!python/name:event_model.Filler &#39;&#39;</span>
<span class="go">            state: !!python/tuple</span>
<span class="go">            - *id001</span>
<span class="go">            - !!python/tuple []</span>
<span class="go">            - handler_registry: !!python/object:event_model.HandlerRegistryView</span>
<span class="go">                _handler_registry:</span>
<span class="go">                  NPY_SEQ: !!python/name:ophyd.sim.NumpySeqHandler &#39;&#39;</span>
<span class="go">              inplace: false</span>
<span class="go">              root_map: {}</span>
<span class="go">            - null</span>
<span class="go">          transforms:</span>
<span class="go">            descriptor: &amp;id002 !!python/name:databroker.core._no_op &#39;&#39;</span>
<span class="go">            resource: *id002</span>
<span class="go">            start: *id002</span>
<span class="go">            stop: *id002</span>
<span class="go">        cache: null</span>
<span class="go">        parameters: []</span>
<span class="go">        metadata:</span>
<span class="go">          start:</span>
<span class="go">            detectors:</span>
<span class="go">            - img</span>
<span class="go">            hints:</span>
<span class="go">              dimensions:</span>
<span class="go">              - - - motor</span>
<span class="go">                - primary</span>
<span class="go">            motors:</span>
<span class="go">            - motor</span>
<span class="go">            num_intervals: 2</span>
<span class="go">            num_points: 3</span>
<span class="go">            plan_args:</span>
<span class="go">              args:</span>
<span class="go">              - SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;],</span>
<span class="go">                configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])</span>
<span class="go">              - -1</span>
<span class="go">              - 1</span>
<span class="go">              detectors:</span>
<span class="go">              - &quot;SynSignalWithRegistry(name=&#39;img&#39;, value=array([[1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1.,\</span>
<span class="go">                \ 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1.,\</span>
<span class="go">                \ 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1.,\</span>
<span class="go">                \ 1.]]), timestamp=1592341580.8917034)&quot;</span>
<span class="go">              num: 3</span>
<span class="go">              per_step: None</span>
<span class="go">            plan_name: scan</span>
<span class="go">            plan_pattern: inner_product</span>
<span class="go">            plan_pattern_args:</span>
<span class="go">              args:</span>
<span class="go">              - SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;],</span>
<span class="go">                configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])</span>
<span class="go">              - -1</span>
<span class="go">              - 1</span>
<span class="go">              num: 3</span>
<span class="go">            plan_pattern_module: bluesky.plan_patterns</span>
<span class="go">            plan_type: generator</span>
<span class="go">            proposal_id: 12345</span>
<span class="go">            scan_id: 1</span>
<span class="go">            time: 1592341582.703044</span>
<span class="go">            uid: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">            versions:</span>
<span class="go">              bluesky: 1.6.2</span>
<span class="go">              ophyd: 1.5.1</span>
<span class="go">          stop:</span>
<span class="go">            exit_status: success</span>
<span class="go">            num_events:</span>
<span class="go">              baseline: 2</span>
<span class="go">              primary: 3</span>
<span class="go">            reason: &#39;&#39;</span>
<span class="go">            run_start: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">            time: 1592341582.7206836</span>
<span class="go">            uid: 1a48983d-15a8-41ec-be69-29365ffd457f</span>
<span class="go">        catalog_dir: null</span>
<span class="go">        getenv: true</span>
<span class="go">        getshell: true</span>
<span class="go">        catalog:</span>
<span class="go">          cls: databroker._drivers.jsonl.BlueskyJSONLCatalog</span>
<span class="go">          args: []</span>
<span class="go">          kwargs:</span>
<span class="go">            metadata:</span>
<span class="go">              catalog_dir: /home/travis/build/bluesky/databroker/doc/source/_catalogs/</span>
<span class="go">            paths: data/*.jsonl</span>
<span class="go">            handler_registry:</span>
<span class="go">              NPY_SEQ: ophyd.sim.NumpySeqHandler</span>
<span class="go">    gen_args: !!python/tuple</span>
<span class="go">    - data/20eb15f2-3c61-4a2f-a0c8-cbb1f141b982.jsonl</span>
<span class="go">    gen_func: *id003</span>
<span class="go">    gen_kwargs: {}</span>
<span class="go">    get_filler: *id004</span>
<span class="go">    transforms:</span>
<span class="go">      descriptor: *id002</span>
<span class="go">      resource: *id002</span>
<span class="go">      start: *id002</span>
<span class="go">      stop: *id002</span>
<span class="go">  description: &#39;&#39;</span>
<span class="go">  driver: databroker.core.BlueskyRunFromGenerator</span>
<span class="go">  metadata:</span>
<span class="go">    catalog_dir: null</span>
<span class="go">    start: !!python/object/new:databroker.core.Start</span>
<span class="go">      dictitems:</span>
<span class="go">        detectors: &amp;id005</span>
<span class="go">        - img</span>
<span class="go">        hints: &amp;id006</span>
<span class="go">          dimensions:</span>
<span class="go">          - - - motor</span>
<span class="go">            - primary</span>
<span class="go">        motors: &amp;id007</span>
<span class="go">        - motor</span>
<span class="go">        num_intervals: 2</span>
<span class="go">        num_points: 3</span>
<span class="go">        plan_args: &amp;id008</span>
<span class="go">          args:</span>
<span class="go">          - SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;],</span>
<span class="go">            configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])</span>
<span class="go">          - -1</span>
<span class="go">          - 1</span>
<span class="go">          detectors:</span>
<span class="go">          - &quot;SynSignalWithRegistry(name=&#39;img&#39;, value=array([[1., 1., 1., 1., 1., 1.,\</span>
<span class="go">            \ 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n\</span>
<span class="go">            \       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1., 1., 1.,\</span>
<span class="go">            \ 1., 1., 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1.,\</span>
<span class="go">            \ 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1.,\</span>
<span class="go">            \ 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1.,\</span>
<span class="go">            \ 1., 1., 1., 1.],\n       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],\n\</span>
<span class="go">            \       [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]), timestamp=1592341580.8917034)&quot;</span>
<span class="go">          num: 3</span>
<span class="go">          per_step: None</span>
<span class="go">        plan_name: scan</span>
<span class="go">        plan_pattern: inner_product</span>
<span class="go">        plan_pattern_args: &amp;id009</span>
<span class="go">          args:</span>
<span class="go">          - SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;],</span>
<span class="go">            configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])</span>
<span class="go">          - -1</span>
<span class="go">          - 1</span>
<span class="go">          num: 3</span>
<span class="go">        plan_pattern_module: bluesky.plan_patterns</span>
<span class="go">        plan_type: generator</span>
<span class="go">        proposal_id: 12345</span>
<span class="go">        scan_id: 1</span>
<span class="go">        time: 1592341582.703044</span>
<span class="go">        uid: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">        versions: &amp;id010</span>
<span class="go">          bluesky: 1.6.2</span>
<span class="go">          ophyd: 1.5.1</span>
<span class="go">      state:</span>
<span class="go">        detectors: *id005</span>
<span class="go">        hints: *id006</span>
<span class="go">        motors: *id007</span>
<span class="go">        num_intervals: 2</span>
<span class="go">        num_points: 3</span>
<span class="go">        plan_args: *id008</span>
<span class="go">        plan_name: scan</span>
<span class="go">        plan_pattern: inner_product</span>
<span class="go">        plan_pattern_args: *id009</span>
<span class="go">        plan_pattern_module: bluesky.plan_patterns</span>
<span class="go">        plan_type: generator</span>
<span class="go">        proposal_id: 12345</span>
<span class="go">        scan_id: 1</span>
<span class="go">        time: 1592341582.703044</span>
<span class="go">        uid: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">        versions: *id010</span>
<span class="go">    stop: !!python/object/new:databroker.core.Stop</span>
<span class="go">      dictitems:</span>
<span class="go">        exit_status: success</span>
<span class="go">        num_events: &amp;id011</span>
<span class="go">          baseline: 2</span>
<span class="go">          primary: 3</span>
<span class="go">        reason: &#39;&#39;</span>
<span class="go">        run_start: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">        time: 1592341582.7206836</span>
<span class="go">        uid: 1a48983d-15a8-41ec-be69-29365ffd457f</span>
<span class="go">      state:</span>
<span class="go">        exit_status: success</span>
<span class="go">        num_events: *id011</span>
<span class="go">        reason: &#39;&#39;</span>
<span class="go">        run_start: 20eb15f2-3c61-4a2f-a0c8-cbb1f141b982</span>
<span class="go">        time: 1592341582.7206836</span>
<span class="go">        uid: 1a48983d-15a8-41ec-be69-29365ffd457f</span>
</pre></div>
</div>
<p>We can also use tab-completion, as in <code class="docutils literal notranslate"><span class="pre">entry['</span></code> TAB, to see the contents.
That is, the Run is yet another Catalog, and its contents are the logical
tables of data. Finally, let’s get one of these tables.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">ds</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="gp">In [20]: </span><span class="n">ds</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   (dim_0: 10, dim_1: 10, dim_2: 1, dim_3: 1, time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time                      (time) float64 1.592e+09 1.592e+09 1.592e+09</span>
<span class="go">Dimensions without coordinates: dim_0, dim_1, dim_2, dim_3</span>
<span class="go">Data variables:</span>
<span class="go">    img                       (time, dim_0, dim_1) float64 1.0 1.0 ... 1.0 1.0</span>
<span class="go">    motor                     (time) float64 -1.0 0.0 1.0</span>
<span class="go">    motor_setpoint            (time) float64 -1.0 0.0 1.0</span>
<span class="go">    img:img                   (time, dim_2, dim_3) &lt;U38 &#39;75364b8b-0e51-4d39-8058-6e1012e05978/0&#39; ... &#39;75364b8b-0e51-4d39-8058-6e1012e05978/0&#39;</span>
<span class="go">    motor:motor_velocity      (time) int64 1 1 1</span>
<span class="go">    motor:motor_acceleration  (time) int64 1 1 1</span>
<span class="go">    seq_num                   (time) int64 1 2 3</span>
<span class="go">    uid                       (time) &lt;U36 &#39;95b66e3b-e0fd-46cb-af57-6c23cf3ddd78&#39; ... &#39;bbefc54d-2a73-4151-a3e6-a428e8672e9d&#39;</span>
</pre></div>
</div>
<p>This is an xarray.Dataset. You can access specific columns</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">]</span>
<span class="gh">Out[21]: </span><span class="go"></span>
<span class="go">&lt;xarray.DataArray &#39;img&#39; (time: 3, dim_0: 10, dim_1: 10)&gt;</span>
<span class="go">array([[[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]],</span>

<span class="go">       [[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]],</span>

<span class="go">       [[1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],</span>
<span class="go">        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1.]]])</span>
<span class="go">Coordinates:</span>
<span class="go">  * time     (time) float64 1.592e+09 1.592e+09 1.592e+09</span>
<span class="go">Dimensions without coordinates: dim_0, dim_1</span>
</pre></div>
</div>
<p>do mathematical operations</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[22]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   ()</span>
<span class="go">Data variables:</span>
<span class="go">    img                       float64 1.0</span>
<span class="go">    motor                     float64 0.0</span>
<span class="go">    motor_setpoint            float64 0.0</span>
<span class="go">    motor:motor_velocity      float64 1.0</span>
<span class="go">    motor:motor_acceleration  float64 1.0</span>
<span class="go">    seq_num                   float64 2.0</span>
</pre></div>
</div>
<p>make quick plots</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;motor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gh">Out[23]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x7fde340d3f60&gt;]</span>
</pre></div>
</div>
<img alt="../../_images/ds_motor_plot.png" src="../../_images/ds_motor_plot.png" />
<p>and much more. See the documentation on <a class="reference external" href="https://xarray.pydata.org/en/stable/">xarray</a>.</p>
<p>If the data is large, it can be convenient to access it lazily, deferring the
actual loading network or disk I/O. To do this, replace <code class="docutils literal notranslate"><span class="pre">read()</span></code> with
<code class="docutils literal notranslate"><span class="pre">to_dask()</span></code>. You still get back an xarray.Dataset, but it contains
placeholders that will fetch the data in chunks and only as needed, rather than
greedily pulling all the data into memory from the start.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">ds</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>

<span class="gp">In [25]: </span><span class="n">ds</span>
<span class="gh">Out[25]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   (dim_0: 10, dim_1: 10, dim_2: 1, dim_3: 1, time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time                      (time) float64 1.592e+09 1.592e+09 1.592e+09</span>
<span class="go">Dimensions without coordinates: dim_0, dim_1, dim_2, dim_3</span>
<span class="go">Data variables:</span>
<span class="go">    img                       (time, dim_0, dim_1) float64 1.0 1.0 ... 1.0 1.0</span>
<span class="go">    motor                     (time) float64 -1.0 0.0 1.0</span>
<span class="go">    motor_setpoint            (time) float64 -1.0 0.0 1.0</span>
<span class="go">    img:img                   (time, dim_2, dim_3) &lt;U38 &#39;75364b8b-0e51-4d39-8058-6e1012e05978/0&#39; ... &#39;75364b8b-0e51-4d39-8058-6e1012e05978/0&#39;</span>
<span class="go">    motor:motor_velocity      (time) int64 1 1 1</span>
<span class="go">    motor:motor_acceleration  (time) int64 1 1 1</span>
<span class="go">    seq_num                   (time) int64 1 2 3</span>
<span class="go">    uid                       (time) &lt;U36 &#39;95b66e3b-e0fd-46cb-af57-6c23cf3ddd78&#39; ... &#39;bbefc54d-2a73-4151-a3e6-a428e8672e9d&#39;</span>
</pre></div>
</div>
<p>See the documentation on <a class="reference external" href="https://docs.dask.org/en/latest/">dask</a>.</p>
<p>TODO: This is displaying numpy arrays, not dask. Illustrating dask here might
require standing up a server.</p>
</div>
<div class="section" id="replay-document-stream">
<h3>Replay Document Stream<a class="headerlink" href="#replay-document-stream" title="Permalink to this headline">¶</a></h3>
<p>Bluesky is built around a streaming-friendly representation of data and
metadata. (See <a class="reference external" href="https://blueskyproject.io/event-model/">event-model</a>.) To access the run—effectively replaying the
chronological stream of documents that were emitted during data
acquisition—use the <code class="docutils literal notranslate"><span class="pre">canonical()</span></code> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">run</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go">&lt;generator object BlueskyRun.canonical at 0x7fde34435cf0&gt;</span>
</pre></div>
</div>
<p>This generator yields <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">doc)</span></code> pairs and can be fed into streaming
visualization, processing, and serialization tools that consume this
representation, such as those provided by bluesky.</p>
<p>The keyword argument <code class="docutils literal notranslate"><span class="pre">fill</span></code> is required. Its allowed values are <code class="docutils literal notranslate"><span class="pre">'yes'</span></code>
(numpy arrays)`, <code class="docutils literal notranslate"><span class="pre">'no'</span></code> (Datum IDs), and <code class="docutils literal notranslate"><span class="pre">'delayed'</span></code> (dask arrays, still
under development).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../administrator/index.html" class="btn btn-neutral float-right" title="Administrator Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="Version 2 Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 Brookhaven National Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
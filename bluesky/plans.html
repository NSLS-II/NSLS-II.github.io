

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Plans &mdash; bluesky 1.0.0.post4+ga3f23fa documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="bluesky 1.0.0.post4+ga3f23fa documentation" href="index.html"/>
        <link rel="next" title="bluesky.plans.count" href="generated/bluesky.plans.count.html"/>
        <link rel="prev" title="Recording Metadata" href="metadata.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> bluesky
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0.post4+ga3f23fa
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="plans_intro.html">Basic Usage &amp; Intro to Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="documents.html">Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Recording Metadata</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Plans</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#built-in-plans">Built-in Plans</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pre-assembled-plans">Pre-assembled Plans</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-series-count">Time series (“count”)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scans-over-one-dimension">Scans over one dimension</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-dimensional-scans">Multi-dimensional scans</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spiral-trajectories">Spiral trajectories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adaptive-scans">Adaptive scans</a></li>
<li class="toctree-l4"><a class="reference internal" href="#misc">Misc.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stub-plans">Stub Plans</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.abs_set.html">bluesky.plan_stubs.abs_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.rel_set.html">bluesky.plan_stubs.rel_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.mv.html">bluesky.plan_stubs.mv</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.mvr.html">bluesky.plan_stubs.mvr</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.trigger.html">bluesky.plan_stubs.trigger</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.read.html">bluesky.plan_stubs.read</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.stage.html">bluesky.plan_stubs.stage</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.unstage.html">bluesky.plan_stubs.unstage</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.configure.html">bluesky.plan_stubs.configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.stop.html">bluesky.plan_stubs.stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.monitor.html">bluesky.plan_stubs.monitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.unmonitor.html">bluesky.plan_stubs.unmonitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.kickoff.html">bluesky.plan_stubs.kickoff</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.complete.html">bluesky.plan_stubs.complete</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.collect.html">bluesky.plan_stubs.collect</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.open_run.html">bluesky.plan_stubs.open_run</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.close_run.html">bluesky.plan_stubs.close_run</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.create.html">bluesky.plan_stubs.create</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.save.html">bluesky.plan_stubs.save</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.pause.html">bluesky.plan_stubs.pause</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.deferred_pause.html">bluesky.plan_stubs.deferred_pause</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.checkpoint.html">bluesky.plan_stubs.checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.clear_checkpoint.html">bluesky.plan_stubs.clear_checkpoint</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.sleep.html">bluesky.plan_stubs.sleep</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.input_plan.html">bluesky.plan_stubs.input_plan</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.subscribe.html">bluesky.plan_stubs.subscribe</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.unsubscribe.html">bluesky.plan_stubs.unsubscribe</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.wait.html">bluesky.plan_stubs.wait</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.wait_for.html">bluesky.plan_stubs.wait_for</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.plan_stubs.null.html">bluesky.plan_stubs.null</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#changing-a-parameter-between-runs">Changing a Parameter Between Runs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-devices-to-a-set-point">Setting Devices to a Set Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sleeping">Sleeping</a></li>
<li class="toctree-l3"><a class="reference internal" href="#planned-pauses">Planned Pauses</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-metadata">Customizing metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plan-preprocessors">Plan Preprocessors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supplemental-data">Supplemental Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preprocessor-wrappers-and-decorators">Preprocessor Wrappers and Decorators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#built-in-preprocessors">Built-in Preprocessors</a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.baseline_decorator.html">bluesky.preprocessors.baseline_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.baseline_wrapper.html">bluesky.preprocessors.baseline_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.finalize_decorator.html">bluesky.preprocessors.finalize_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.finalize_wrapper.html">bluesky.preprocessors.finalize_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.fly_during_decorator.html">bluesky.preprocessors.fly_during_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.fly_during_wrapper.html">bluesky.preprocessors.fly_during_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.inject_md_decorator.html">bluesky.preprocessors.inject_md_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.inject_md_wrapper.html">bluesky.preprocessors.inject_md_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.lazily_stage_decorator.html">bluesky.preprocessors.lazily_stage_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.lazily_stage_wrapper.html">bluesky.preprocessors.lazily_stage_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.monitor_during_decorator.html">bluesky.preprocessors.monitor_during_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.monitor_during_wrapper.html">bluesky.preprocessors.monitor_during_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.relative_set_decorator.html">bluesky.preprocessors.relative_set_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.relative_set_wrapper.html">bluesky.preprocessors.relative_set_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.reset_positions_decorator.html">bluesky.preprocessors.reset_positions_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.reset_positions_wrapper.html">bluesky.preprocessors.reset_positions_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.run_decorator.html">bluesky.preprocessors.run_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.run_wrapper.html">bluesky.preprocessors.run_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.stage_decorator.html">bluesky.preprocessors.stage_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.stage_wrapper.html">bluesky.preprocessors.stage_wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.subs_decorator.html">bluesky.preprocessors.subs_decorator</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/bluesky.preprocessors.subs_wrapper.html">bluesky.preprocessors.subs_wrapper</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-preprocessors">Custom Preprocessors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-plans-handle-exceptions">How Plans Handle Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customize-step-scans-with-per-step">Customize Step Scans with <code class="docutils literal"><span class="pre">per_step</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-the-scope-of-a-run">Controlling the Scope of a “Run”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plans-with-adaptive-logic">Plans with Adaptive Logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#asynchronous-plans-fly-scans-and-monitoring">Asynchronous Plans: “Fly Scans” and “Monitoring”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plan-utilities">Plan Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.preprocessors.pchain.html">bluesky.preprocessors.pchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.preprocessors.msg_mutator.html">bluesky.preprocessors.msg_mutator</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.preprocessors.plan_mutator.html">bluesky.preprocessors.plan_mutator</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.preprocessors.single_gen.html">bluesky.preprocessors.single_gen</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.preprocessors.make_decorator.html">bluesky.preprocessors.make_decorator</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.plan_stubs.broadcast_msg.html">bluesky.plan_stubs.broadcast_msg</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.plan_stubs.repeater.html">bluesky.plan_stubs.repeater</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/bluesky.plan_stubs.caching_repeater.html">bluesky.plan_stubs.caching_repeater</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="callbacks.html">Live Visualization and Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="state-machine.html">Interruptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation.html">Simulation and Error Checking</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress-bar.html">Progress Bar</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_descriptors.html">Event Descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="async.html">Asynchronous Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging and Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine_api.html">RunEngine API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="magics.html">IPython ‘Magics’ [Experimental]</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison-with-spec.html">Comparison with SPEC</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">How Bluesky Interfaces with Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="msg.html">Message Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_engine.html">The RunEngine run loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_changes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bluesky</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Plans</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/plans.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plans">
<h1>Plans<a class="headerlink" href="#plans" title="Permalink to this headline">¶</a></h1>
<p>A <em>plan</em> is bluesky’s concept of an experimental procedure. A
<a class="reference internal" href="plans_intro.html"><span class="doc">previous section</span></a> introduced some built-in plans like
<a class="reference internal" href="generated/bluesky.plans.count.html#bluesky.plans.count" title="bluesky.plans.count"><code class="xref py py-func docutils literal"><span class="pre">count()</span></code></a>, <a class="reference internal" href="generated/bluesky.plans.scan.html#bluesky.plans.scan" title="bluesky.plans.scan"><code class="xref py py-func docutils literal"><span class="pre">scan()</span></code></a>, and <a class="reference internal" href="generated/bluesky.plans.rel_scan.html#bluesky.plans.rel_scan" title="bluesky.plans.rel_scan"><code class="xref py py-func docutils literal"><span class="pre">rel_scan()</span></code></a>. This section covers all
of the plans and plan-related tools in bluesky with examples showing how to
combine and customize them.</p>
<p>A variety of pre-assembled plans are provided. Like sandwiches on a deli menu,
you can use our pre-assembled plans or assemble your own from the same
ingredients, catalogued under the heading <a class="reference internal" href="#stub-plans"><span class="std std-ref">Stub Plans</span></a> below.</p>
<div class="section" id="built-in-plans">
<h2>Built-in Plans<a class="headerlink" href="#built-in-plans" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pre-assembled-plans">
<span id="preassembled-plans"></span><h3>Pre-assembled Plans<a class="headerlink" href="#pre-assembled-plans" title="Permalink to this headline">¶</a></h3>
<p>Below this summary table, we break the down the plans by category and show
examples with figures.</p>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>Notice that the names in the left column are links to detailed API
documentation.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.count.html#bluesky.plans.count" title="bluesky.plans.count"><code class="xref py py-obj docutils literal"><span class="pre">count</span></code></a></td>
<td>Take one or more readings from detectors.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.scan.html#bluesky.plans.scan" title="bluesky.plans.scan"><code class="xref py py-obj docutils literal"><span class="pre">scan</span></code></a></td>
<td>Scan over one variable in equally spaced steps.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_scan.html#bluesky.plans.rel_scan" title="bluesky.plans.rel_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_scan</span></code></a></td>
<td>Scan over one variable in equally spaced steps relative to current positon.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.list_scan.html#bluesky.plans.list_scan" title="bluesky.plans.list_scan"><code class="xref py py-obj docutils literal"><span class="pre">list_scan</span></code></a></td>
<td>Scan over one variable in steps.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_list_scan.html#bluesky.plans.rel_list_scan" title="bluesky.plans.rel_list_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_list_scan</span></code></a></td>
<td>Scan over one variable in steps relative to current position.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.log_scan.html#bluesky.plans.log_scan" title="bluesky.plans.log_scan"><code class="xref py py-obj docutils literal"><span class="pre">log_scan</span></code></a></td>
<td>Scan over one variable in log-spaced steps.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_log_scan.html#bluesky.plans.rel_log_scan" title="bluesky.plans.rel_log_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_log_scan</span></code></a></td>
<td>Scan over one variable in log-spaced steps relative to current position.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.inner_product_scan.html#bluesky.plans.inner_product_scan" title="bluesky.plans.inner_product_scan"><code class="xref py py-obj docutils literal"><span class="pre">inner_product_scan</span></code></a></td>
<td>Scan over one multi-motor trajectory.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.grid_scan.html#bluesky.plans.grid_scan" title="bluesky.plans.grid_scan"><code class="xref py py-obj docutils literal"><span class="pre">grid_scan</span></code></a></td>
<td>Scan over a mesh; each motor is on an independent trajectory.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.relative_inner_product_scan.html#bluesky.plans.relative_inner_product_scan" title="bluesky.plans.relative_inner_product_scan"><code class="xref py py-obj docutils literal"><span class="pre">relative_inner_product_scan</span></code></a></td>
<td>Scan over one multi-motor trajectory relative to current position.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_grid_scan.html#bluesky.plans.rel_grid_scan" title="bluesky.plans.rel_grid_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_grid_scan</span></code></a></td>
<td>Scan over a mesh relative to current position.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.scan_nd.html#bluesky.plans.scan_nd" title="bluesky.plans.scan_nd"><code class="xref py py-obj docutils literal"><span class="pre">scan_nd</span></code></a></td>
<td>Scan over an arbitrary N-dimensional trajectory.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.spiral.html#bluesky.plans.spiral" title="bluesky.plans.spiral"><code class="xref py py-obj docutils literal"><span class="pre">spiral</span></code></a></td>
<td>Spiral scan, centered around (x_start, y_start)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.spiral_fermat.html#bluesky.plans.spiral_fermat" title="bluesky.plans.spiral_fermat"><code class="xref py py-obj docutils literal"><span class="pre">spiral_fermat</span></code></a></td>
<td>Absolute fermat spiral scan, centered around (x_start, y_start)</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_spiral.html#bluesky.plans.rel_spiral" title="bluesky.plans.rel_spiral"><code class="xref py py-obj docutils literal"><span class="pre">rel_spiral</span></code></a></td>
<td>Relative spiral scan</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_spiral_fermat.html#bluesky.plans.rel_spiral_fermat" title="bluesky.plans.rel_spiral_fermat"><code class="xref py py-obj docutils literal"><span class="pre">rel_spiral_fermat</span></code></a></td>
<td>Relative fermat spiral scan</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.adaptive_scan.html#bluesky.plans.adaptive_scan" title="bluesky.plans.adaptive_scan"><code class="xref py py-obj docutils literal"><span class="pre">adaptive_scan</span></code></a></td>
<td>Scan over one variable with adaptively tuned step size.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_adaptive_scan.html#bluesky.plans.rel_adaptive_scan" title="bluesky.plans.rel_adaptive_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_adaptive_scan</span></code></a></td>
<td>Relative scan over one variable with adaptively tuned step size.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.tune_centroid.html#bluesky.plans.tune_centroid" title="bluesky.plans.tune_centroid"><code class="xref py py-obj docutils literal"><span class="pre">tune_centroid</span></code></a></td>
<td>plan: tune a motor to the centroid of signal(motor)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.tweak.html#bluesky.plans.tweak" title="bluesky.plans.tweak"><code class="xref py py-obj docutils literal"><span class="pre">tweak</span></code></a></td>
<td>Move and motor and read a detector with an interactive prompt.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.fly.html#bluesky.plans.fly" title="bluesky.plans.fly"><code class="xref py py-obj docutils literal"><span class="pre">fly</span></code></a></td>
<td>Perform a fly scan with one or more ‘flyers’.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="time-series-count">
<h4>Time series (“count”)<a class="headerlink" href="#time-series-count" title="Permalink to this headline">¶</a></h4>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>

<span class="c1"># a single reading of the detector &#39;det&#39;</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">]))</span>

<span class="c1"># five consecutive readings</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># five sequential readings separated by a 1-second delay</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># a variable delay</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>

<span class="c1"># Take readings forever, until interrupted (e.g., with Ctrl+C)</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
</pre></div>
</div>
<p>We can use <code class="docutils literal"><span class="pre">LivePlot</span></code> to visualize this data. It is documented in the
<a class="reference internal" href="callbacks.html#liveplot"><span class="std std-ref">next section</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LivePlot</span>

<span class="c1"># We&#39;ll use the &#39;noisy_det&#39; example detector for a more interesting plot.</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">noisy_det</span>

<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">noisy_det</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;noisy_det&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-1.png" src="_images/plans-1.png" />
</div>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.count.html#bluesky.plans.count" title="bluesky.plans.count"><code class="xref py py-obj docutils literal"><span class="pre">count</span></code></a></td>
<td>Take one or more readings from detectors.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scans-over-one-dimension">
<h4>Scans over one dimension<a class="headerlink" href="#scans-over-one-dimension" title="Permalink to this headline">¶</a></h4>
<p>The “dimension” might be a physical motor position, a temperature, or a
pseudo-axis. It’s all the same to the plans. Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span><span class="p">,</span> <span class="n">rel_scan</span><span class="p">,</span> <span class="n">list_scan</span>

<span class="c1"># scan a motor from 1 to 5, taking 5 equally-spaced readings of &#39;det&#39;</span>
<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># scan a motor from 1 to 5 *relative to its current position*</span>
<span class="n">RE</span><span class="p">(</span><span class="n">rel_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># scan a motor through a list of user-specified positions</span>
<span class="n">RE</span><span class="p">(</span><span class="n">list_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]))</span>
</pre></div>
</div>
<p>Again, we can use <code class="docutils literal"><span class="pre">LivePlot</span></code> to visualize this data. It is documented in the
<a class="reference internal" href="callbacks.html#liveplot"><span class="std std-ref">next section</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LivePlot</span>

<span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Or, again, to save some typing for repeated use,
<a class="reference internal" href="callbacks.html#subs-decorator"><span class="std std-ref">define a custom plan with the plot incorporated</span></a>.
(LivePlot itself is documented <a class="reference internal" href="callbacks.html#liveplot"><span class="std std-ref">here</span></a>.)</p>
<div class="figure">
<img alt="_images/plans-2.png" src="_images/plans-2.png" />
</div>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.scan.html#bluesky.plans.scan" title="bluesky.plans.scan"><code class="xref py py-obj docutils literal"><span class="pre">scan</span></code></a></td>
<td>Scan over one variable in equally spaced steps.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_scan.html#bluesky.plans.rel_scan" title="bluesky.plans.rel_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_scan</span></code></a></td>
<td>Scan over one variable in equally spaced steps relative to current positon.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.list_scan.html#bluesky.plans.list_scan" title="bluesky.plans.list_scan"><code class="xref py py-obj docutils literal"><span class="pre">list_scan</span></code></a></td>
<td>Scan over one variable in steps.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_list_scan.html#bluesky.plans.rel_list_scan" title="bluesky.plans.rel_list_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_list_scan</span></code></a></td>
<td>Scan over one variable in steps relative to current position.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.log_scan.html#bluesky.plans.log_scan" title="bluesky.plans.log_scan"><code class="xref py py-obj docutils literal"><span class="pre">log_scan</span></code></a></td>
<td>Scan over one variable in log-spaced steps.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_log_scan.html#bluesky.plans.rel_log_scan" title="bluesky.plans.rel_log_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_log_scan</span></code></a></td>
<td>Scan over one variable in log-spaced steps relative to current position.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="multi-dimensional-scans">
<span id="id1"></span><h4>Multi-dimensional scans<a class="headerlink" href="#multi-dimensional-scans" title="Permalink to this headline">¶</a></h4>
<p>Here, “dimensions” are things independently scanned. They may be physical
position (stepping motor), temperature, etc.</p>
<p>We introduce jargon for two different kinds of a multi-dimensional
(multi-“motor”) scan. Moving motors together in a joint trajectory is an “inner
product scan.” This is like moving an object along a diagonal by moving the x
and y motors simultaneously.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">inner_product_scan</span>

<span class="c1"># Inner product: move motors together.</span>
<span class="c1"># Move motor1 from 1-5 while moving motor2 from 10-50 -- both in 5 steps.</span>
<span class="n">RE</span><span class="p">(</span><span class="n">inner_product_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="n">motor1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>Demo:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">RE</span><span class="p">(</span><span class="n">inner_product_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="mi">5</span><span class="p">,</span> <span class="n">motor1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
<span class="gp">   ...: </span>   <span class="n">LiveTable</span><span class="p">([</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;motor2&#39;</span><span class="p">]))</span>
<span class="gp">   ...: </span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |        det |     motor1 |     motor2 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|         1 | 20:29:18.2 |      0.000 |      1.000 |     10.000 |</span>
<span class="go">|         2 | 20:29:18.2 |      0.000 |      2.000 |     20.000 |</span>
<span class="go">|         3 | 20:29:18.2 |      0.000 |      3.000 |     30.000 |</span>
<span class="go">|         4 | 20:29:18.2 |      0.000 |      4.000 |     40.000 |</span>
<span class="go">|         5 | 20:29:18.2 |      0.000 |      5.000 |     50.000 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">generator inner_product_scan [&#39;fe7142fa&#39;] (scan num: 1)</span>
<span class="gh">Out[1]: </span><span class="go">(&#39;fe7142fa-2d22-48a9-9a06-f0bd35a9abb1&#39;,)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-3.png" src="_images/plans-3.png" />
</div>
<p>Notice that, in an inner product scan, each motor moves the same number
of steps (in the example above, 5).</p>
<p>Moving motors separately, exploring every combination, is an “outer product
scan”. This is like moving x and y to draw a mesh. The mesh does not have to be
square: each motor can move a different number of steps.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">grid_scan</span>

<span class="c1"># Outer product: move motors in a mesh.</span>
<span class="c1"># Move motor1 from 1-3 in 3 steps and motor2 from 10-50 in 5 steps.</span>
<span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
</pre></div>
</div>
<p>Demo:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
<span class="gp">   ...: </span>   <span class="n">LiveTable</span><span class="p">([</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;motor2&#39;</span><span class="p">]))</span>
<span class="gp">   ...: </span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|   seq_num |       time |        det |     motor1 |     motor2 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">|         1 | 20:29:18.9 |      0.000 |      1.000 |     10.000 |</span>
<span class="go">|         2 | 20:29:19.0 |      0.000 |      1.000 |     20.000 |</span>
<span class="go">|         3 | 20:29:19.0 |      0.000 |      1.000 |     30.000 |</span>
<span class="go">|         4 | 20:29:19.0 |      0.000 |      1.000 |     40.000 |</span>
<span class="go">|         5 | 20:29:19.0 |      0.000 |      1.000 |     50.000 |</span>
<span class="go">|         6 | 20:29:19.0 |      0.000 |      2.000 |     10.000 |</span>
<span class="go">|         7 | 20:29:19.0 |      0.000 |      2.000 |     20.000 |</span>
<span class="go">|         8 | 20:29:19.0 |      0.000 |      2.000 |     30.000 |</span>
<span class="go">|         9 | 20:29:19.0 |      0.000 |      2.000 |     40.000 |</span>
<span class="go">|        10 | 20:29:19.0 |      0.000 |      2.000 |     50.000 |</span>
<span class="go">|        11 | 20:29:19.0 |      0.000 |      3.000 |     10.000 |</span>
<span class="go">|        12 | 20:29:19.0 |      0.000 |      3.000 |     20.000 |</span>
<span class="go">|        13 | 20:29:19.0 |      0.000 |      3.000 |     30.000 |</span>
<span class="go">|        14 | 20:29:19.0 |      0.000 |      3.000 |     40.000 |</span>
<span class="go">|        15 | 20:29:19.0 |      0.000 |      3.000 |     50.000 |</span>
<span class="go">+-----------+------------+------------+------------+------------+</span>
<span class="go">generator grid_scan [&#39;f4afe57c&#39;] (scan num: 2)</span>
<span class="gh">Out[2]: </span><span class="go">(&#39;f4afe57c-42f5-4d70-89ba-2a61fd7040f7&#39;,)</span>
</pre></div>
</div>
<p>The final parameter designates whether motor2 should “snake” back and forth
along motor1’s trajectory (<code class="docutils literal"><span class="pre">True</span></code>) or retread its positions in the same
direction each time (<code class="docutils literal"><span class="pre">False</span></code>), as illustrated.</p>
<div class="figure">
<img alt="_images/plans-4.png" src="_images/plans-4.png" />
</div>
<p>Both <a class="reference internal" href="generated/bluesky.plans.inner_product_scan.html#bluesky.plans.inner_product_scan" title="bluesky.plans.inner_product_scan"><code class="xref py py-func docutils literal"><span class="pre">inner_product_scan()</span></code></a> and <a class="reference internal" href="generated/bluesky.plans.grid_scan.html#bluesky.plans.grid_scan" title="bluesky.plans.grid_scan"><code class="xref py py-func docutils literal"><span class="pre">grid_scan()</span></code></a> support an
unlimited number of motors/dimensions.</p>
<p>To visualize 2-dimensional data, we can use <code class="docutils literal"><span class="pre">LiveGrid</span></code>, which is documented
in <a class="reference internal" href="callbacks.html#liveraster"><span class="std std-ref">in the next section</span></a>. In previous examples we used
<code class="docutils literal"><span class="pre">LivePlot</span></code> to visualize readings as a function of one variable;
<code class="docutils literal"><span class="pre">LiveGrid</span></code> is appropriate for functions of two variables.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LiveGrid</span>

<span class="c1"># The &#39;det4&#39; example detector a 2D Gaussian function of motor1, motor2.</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det4</span>

<span class="n">RE</span><span class="p">(</span><span class="n">grid_scan</span><span class="p">([</span><span class="n">det4</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
   <span class="n">LiveGrid</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;det4&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-5.png" src="_images/plans-5.png" />
</div>
<p>The general case, moving some motors together in an “inner product” against
another (or motors) in an “outer product,” can be addressed using a <code class="docutils literal"><span class="pre">cycler</span></code>.
Notice what happens when we add or multiply <code class="docutils literal"><span class="pre">cycler</span></code> objects.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">cycler</span> <span class="kn">import</span> <span class="n">cycler</span>

<span class="gp">In [4]: </span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">motor3</span>

<span class="gp">In [5]: </span><span class="n">traj1</span> <span class="o">=</span> <span class="n">cycler</span><span class="p">(</span><span class="n">motor1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="gp">In [6]: </span><span class="n">traj2</span> <span class="o">=</span> <span class="n">cycler</span><span class="p">(</span><span class="n">motor2</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>

<span class="gp">In [7]: </span><span class="nb">list</span><span class="p">(</span><span class="n">traj1</span><span class="p">)</span>  <span class="c1"># a trajectory for motor1</span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">[{SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3}]</span>

<span class="gp">In [8]: </span><span class="nb">list</span><span class="p">(</span><span class="n">traj1</span> <span class="o">+</span> <span class="n">traj2</span><span class="p">)</span>  <span class="c1"># an &quot;inner product&quot; trajectory</span>
<span class="go">                                                                                                                                                                                                                                                                                                                           Out[8]: </span>
<span class="go">[{SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30}]</span>

<span class="gp">In [9]: </span><span class="nb">list</span><span class="p">(</span><span class="n">traj1</span> <span class="o">*</span> <span class="n">traj2</span><span class="p">)</span>  <span class="c1"># an &quot;outer product&quot; trajectory</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Out[9]: </span>
<span class="go">[{SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30}]</span>
</pre></div>
</div>
<p>We have reproduced inner product and outer product. The real power comes in
when we combine them, like so. Here, motor1 and motor2 together in a mesh
against motor3.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">traj3</span> <span class="o">=</span> <span class="n">cycler</span><span class="p">(</span><span class="n">motor3</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>

<span class="gp">In [11]: </span><span class="nb">list</span><span class="p">((</span><span class="n">traj1</span> <span class="o">+</span> <span class="n">traj2</span><span class="p">)</span> <span class="o">*</span> <span class="n">traj3</span><span class="p">)</span>
<span class="gh">Out[11]: </span><span class="go"></span>
<span class="go">[{SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 100},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 200},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 1,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 10,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 300},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 100},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 200},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 2,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 20,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 300},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 100},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 200},</span>
<span class="go"> {SynAxis(prefix=&#39;&#39;, name=&#39;motor1&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 3,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor2&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 30,</span>
<span class="go">  SynAxis(prefix=&#39;&#39;, name=&#39;motor3&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[]): 300}]</span>
</pre></div>
</div>
<p>For more on cycler, we refer you to the
<a class="reference external" href="http://matplotlib.org/cycler/">cycler documentation</a>. To build a plan
incorporating these trajectories, use our general N-dimensional scan plan,
<a class="reference internal" href="generated/bluesky.plans.scan_nd.html#bluesky.plans.scan_nd" title="bluesky.plans.scan_nd"><code class="xref py py-func docutils literal"><span class="pre">scan_nd()</span></code></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">scan_nd</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="p">(</span><span class="n">traj1</span> <span class="o">+</span> <span class="n">traj2</span><span class="p">)</span> <span class="o">*</span> <span class="n">traj3</span><span class="p">))</span>
</pre></div>
</div>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.inner_product_scan.html#bluesky.plans.inner_product_scan" title="bluesky.plans.inner_product_scan"><code class="xref py py-obj docutils literal"><span class="pre">inner_product_scan</span></code></a></td>
<td>Scan over one multi-motor trajectory.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.grid_scan.html#bluesky.plans.grid_scan" title="bluesky.plans.grid_scan"><code class="xref py py-obj docutils literal"><span class="pre">grid_scan</span></code></a></td>
<td>Scan over a mesh; each motor is on an independent trajectory.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.relative_inner_product_scan.html#bluesky.plans.relative_inner_product_scan" title="bluesky.plans.relative_inner_product_scan"><code class="xref py py-obj docutils literal"><span class="pre">relative_inner_product_scan</span></code></a></td>
<td>Scan over one multi-motor trajectory relative to current position.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_grid_scan.html#bluesky.plans.rel_grid_scan" title="bluesky.plans.rel_grid_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_grid_scan</span></code></a></td>
<td>Scan over a mesh relative to current position.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.scan_nd.html#bluesky.plans.scan_nd" title="bluesky.plans.scan_nd"><code class="xref py py-obj docutils literal"><span class="pre">scan_nd</span></code></a></td>
<td>Scan over an arbitrary N-dimensional trajectory.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="spiral-trajectories">
<h4>Spiral trajectories<a class="headerlink" href="#spiral-trajectories" title="Permalink to this headline">¶</a></h4>
<p>We provide two-dimensional scans that trace out spiral trajectories.</p>
<p>A simple spiral:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.simulators</span> <span class="kn">import</span> <span class="n">plot_raster_path</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">det</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">spiral</span>

<span class="n">plan</span> <span class="o">=</span> <span class="n">spiral</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">x_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
              <span class="n">y_range</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">nth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plot_raster_path</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="s1">&#39;motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;motor2&#39;</span><span class="p">,</span> <span class="n">probe_size</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-6.png" src="_images/plans-6.png" />
</div>
<p>A fermat spiral:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.simulators</span> <span class="kn">import</span> <span class="n">plot_raster_path</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">det</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">spiral_fermat</span>

<span class="n">plan</span> <span class="o">=</span> <span class="n">spiral_fermat</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span><span class="p">,</span> <span class="n">x_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y_start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                     <span class="n">x_range</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">tilt</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plot_raster_path</span><span class="p">(</span><span class="n">plan</span><span class="p">,</span> <span class="s1">&#39;motor1&#39;</span><span class="p">,</span> <span class="s1">&#39;motor2&#39;</span><span class="p">,</span> <span class="n">probe_size</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-7.png" src="_images/plans-7.png" />
</div>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.spiral.html#bluesky.plans.spiral" title="bluesky.plans.spiral"><code class="xref py py-obj docutils literal"><span class="pre">spiral</span></code></a></td>
<td>Spiral scan, centered around (x_start, y_start)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.spiral_fermat.html#bluesky.plans.spiral_fermat" title="bluesky.plans.spiral_fermat"><code class="xref py py-obj docutils literal"><span class="pre">spiral_fermat</span></code></a></td>
<td>Absolute fermat spiral scan, centered around (x_start, y_start)</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.rel_spiral.html#bluesky.plans.rel_spiral" title="bluesky.plans.rel_spiral"><code class="xref py py-obj docutils literal"><span class="pre">rel_spiral</span></code></a></td>
<td>Relative spiral scan</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_spiral_fermat.html#bluesky.plans.rel_spiral_fermat" title="bluesky.plans.rel_spiral_fermat"><code class="xref py py-obj docutils literal"><span class="pre">rel_spiral_fermat</span></code></a></td>
<td>Relative fermat spiral scan</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adaptive-scans">
<h4>Adaptive scans<a class="headerlink" href="#adaptive-scans" title="Permalink to this headline">¶</a></h4>
<p>These are one-dimension scans with an adaptive step size tuned to move quickly
over flat regions can concentrate readings in areas of high variation by
computing the local slope aiming for a target delta y between consecutive
points.</p>
<p>This is a basic example of the power of adaptive plan logic.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">adaptive_scan</span>
<span class="kn">from</span> <span class="nn">bluesky.callbacks</span> <span class="kn">import</span> <span class="n">LivePlot</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span><span class="p">,</span> <span class="n">det</span>

<span class="n">RE</span><span class="p">(</span><span class="n">adaptive_scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span>
                 <span class="n">start</span><span class="o">=-</span><span class="mi">15</span><span class="p">,</span>
                 <span class="n">stop</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">min_step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">max_step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                 <span class="n">target_delta</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                 <span class="n">backstep</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
   <span class="n">LivePlot</span><span class="p">(</span><span class="s1">&#39;det&#39;</span><span class="p">,</span> <span class="s1">&#39;motor&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="figure">
<img alt="_images/plans-8.png" src="_images/plans-8.png" />
</div>
<p>From left to right, the scan lengthens its stride through the flat region. At
first, it steps past the peak. The large jump causes it to double back and then
sample more densely through the peak. As the peak flattens, it lengthens its
stride again.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.adaptive_scan.html#bluesky.plans.adaptive_scan" title="bluesky.plans.adaptive_scan"><code class="xref py py-obj docutils literal"><span class="pre">adaptive_scan</span></code></a></td>
<td>Scan over one variable with adaptively tuned step size.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.rel_adaptive_scan.html#bluesky.plans.rel_adaptive_scan" title="bluesky.plans.rel_adaptive_scan"><code class="xref py py-obj docutils literal"><span class="pre">rel_adaptive_scan</span></code></a></td>
<td>Relative scan over one variable with adaptively tuned step size.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="misc">
<h4>Misc.<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h4>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plans.tweak.html#bluesky.plans.tweak" title="bluesky.plans.tweak"><code class="xref py py-obj docutils literal"><span class="pre">tweak</span></code></a></td>
<td>Move and motor and read a detector with an interactive prompt.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plans.fly.html#bluesky.plans.fly" title="bluesky.plans.fly"><code class="xref py py-obj docutils literal"><span class="pre">fly</span></code></a></td>
<td>Perform a fly scan with one or more ‘flyers’.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="stub-plans">
<span id="id2"></span><h3>Stub Plans<a class="headerlink" href="#stub-plans" title="Permalink to this headline">¶</a></h3>
<p>These are the aforementioned “ingredients” for remixing, the pieces from which
the pre-assembled plans above were made. The next section provides many
examples.</p>
<p>Plans for interacting with hardware:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.abs_set.html#bluesky.plan_stubs.abs_set" title="bluesky.plan_stubs.abs_set"><code class="xref py py-obj docutils literal"><span class="pre">abs_set</span></code></a></td>
<td>Set a value.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.rel_set.html#bluesky.plan_stubs.rel_set" title="bluesky.plan_stubs.rel_set"><code class="xref py py-obj docutils literal"><span class="pre">rel_set</span></code></a></td>
<td>Set a value relative to current value.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.mv.html#bluesky.plan_stubs.mv" title="bluesky.plan_stubs.mv"><code class="xref py py-obj docutils literal"><span class="pre">mv</span></code></a></td>
<td>Move one or more devices to a setpoint.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.mvr.html#bluesky.plan_stubs.mvr" title="bluesky.plan_stubs.mvr"><code class="xref py py-obj docutils literal"><span class="pre">mvr</span></code></a></td>
<td>Move one or more devices to a relative setpoint.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.trigger.html#bluesky.plan_stubs.trigger" title="bluesky.plan_stubs.trigger"><code class="xref py py-obj docutils literal"><span class="pre">trigger</span></code></a></td>
<td>Trigger and acquisition.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.read.html#bluesky.plan_stubs.read" title="bluesky.plan_stubs.read"><code class="xref py py-obj docutils literal"><span class="pre">read</span></code></a></td>
<td>Take a reading and add it to the current bundle of readings.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.stage.html#bluesky.plan_stubs.stage" title="bluesky.plan_stubs.stage"><code class="xref py py-obj docutils literal"><span class="pre">stage</span></code></a></td>
<td>‘Stage’ a device (i.e., prepare it for use, ‘arm’ it).</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.unstage.html#bluesky.plan_stubs.unstage" title="bluesky.plan_stubs.unstage"><code class="xref py py-obj docutils literal"><span class="pre">unstage</span></code></a></td>
<td>‘Unstage’ a device (i.e., put it in standby, ‘disarm’ it).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.configure.html#bluesky.plan_stubs.configure" title="bluesky.plan_stubs.configure"><code class="xref py py-obj docutils literal"><span class="pre">configure</span></code></a></td>
<td>Change Device configuration and emit an updated Event Descriptor document.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.stop.html#bluesky.plan_stubs.stop" title="bluesky.plan_stubs.stop"><code class="xref py py-obj docutils literal"><span class="pre">stop</span></code></a></td>
<td>Stop a device.</td>
</tr>
</tbody>
</table>
<p>Plans for asynchronous acquisition:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.monitor.html#bluesky.plan_stubs.monitor" title="bluesky.plan_stubs.monitor"><code class="xref py py-obj docutils literal"><span class="pre">monitor</span></code></a></td>
<td>Asynchronously monitor for new values and emit Event documents.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.unmonitor.html#bluesky.plan_stubs.unmonitor" title="bluesky.plan_stubs.unmonitor"><code class="xref py py-obj docutils literal"><span class="pre">unmonitor</span></code></a></td>
<td>Stop monitoring.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.kickoff.html#bluesky.plan_stubs.kickoff" title="bluesky.plan_stubs.kickoff"><code class="xref py py-obj docutils literal"><span class="pre">kickoff</span></code></a></td>
<td>Kickoff a fly-scanning device.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.complete.html#bluesky.plan_stubs.complete" title="bluesky.plan_stubs.complete"><code class="xref py py-obj docutils literal"><span class="pre">complete</span></code></a></td>
<td>Tell a flyer, ‘stop collecting, whenver you are ready’.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.collect.html#bluesky.plan_stubs.collect" title="bluesky.plan_stubs.collect"><code class="xref py py-obj docutils literal"><span class="pre">collect</span></code></a></td>
<td>Collect data cached by a fly-scanning device and emit documents.</td>
</tr>
</tbody>
</table>
<p>Plans that control the RunEngine:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.open_run.html#bluesky.plan_stubs.open_run" title="bluesky.plan_stubs.open_run"><code class="xref py py-obj docutils literal"><span class="pre">open_run</span></code></a></td>
<td>Mark the beginning of a new ‘run’.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.close_run.html#bluesky.plan_stubs.close_run" title="bluesky.plan_stubs.close_run"><code class="xref py py-obj docutils literal"><span class="pre">close_run</span></code></a></td>
<td>Mark the end of the current ‘run’.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.create.html#bluesky.plan_stubs.create" title="bluesky.plan_stubs.create"><code class="xref py py-obj docutils literal"><span class="pre">create</span></code></a></td>
<td>Bundle future readings into a new Event document.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.save.html#bluesky.plan_stubs.save" title="bluesky.plan_stubs.save"><code class="xref py py-obj docutils literal"><span class="pre">save</span></code></a></td>
<td>Close a bundle of readings and emit a completed Event document.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.pause.html#bluesky.plan_stubs.pause" title="bluesky.plan_stubs.pause"><code class="xref py py-obj docutils literal"><span class="pre">pause</span></code></a></td>
<td>Pause and wait for the user to resume.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.deferred_pause.html#bluesky.plan_stubs.deferred_pause" title="bluesky.plan_stubs.deferred_pause"><code class="xref py py-obj docutils literal"><span class="pre">deferred_pause</span></code></a></td>
<td>Pause at the next checkpoint.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.checkpoint.html#bluesky.plan_stubs.checkpoint" title="bluesky.plan_stubs.checkpoint"><code class="xref py py-obj docutils literal"><span class="pre">checkpoint</span></code></a></td>
<td>If interrupted, rewind to this point.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.clear_checkpoint.html#bluesky.plan_stubs.clear_checkpoint" title="bluesky.plan_stubs.clear_checkpoint"><code class="xref py py-obj docutils literal"><span class="pre">clear_checkpoint</span></code></a></td>
<td>Designate that it is not safe to resume.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.sleep.html#bluesky.plan_stubs.sleep" title="bluesky.plan_stubs.sleep"><code class="xref py py-obj docutils literal"><span class="pre">sleep</span></code></a></td>
<td>Tell the RunEngine to sleep, while asynchronously doing other processing.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.input_plan.html#bluesky.plan_stubs.input_plan" title="bluesky.plan_stubs.input_plan"><code class="xref py py-obj docutils literal"><span class="pre">input_plan</span></code></a></td>
<td>Prompt the user for text input.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.subscribe.html#bluesky.plan_stubs.subscribe" title="bluesky.plan_stubs.subscribe"><code class="xref py py-obj docutils literal"><span class="pre">subscribe</span></code></a></td>
<td>Subscribe the stream of emitted documents.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.unsubscribe.html#bluesky.plan_stubs.unsubscribe" title="bluesky.plan_stubs.unsubscribe"><code class="xref py py-obj docutils literal"><span class="pre">unsubscribe</span></code></a></td>
<td>Remove a subscription.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.wait.html#bluesky.plan_stubs.wait" title="bluesky.plan_stubs.wait"><code class="xref py py-obj docutils literal"><span class="pre">wait</span></code></a></td>
<td>Wait for all statuses in a group to report being finished.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.wait_for.html#bluesky.plan_stubs.wait_for" title="bluesky.plan_stubs.wait_for"><code class="xref py py-obj docutils literal"><span class="pre">wait_for</span></code></a></td>
<td>Low-level: wait for a list of <code class="docutils literal"><span class="pre">asyncio.Future</span></code> objects to set (complete).</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.null.html#bluesky.plan_stubs.null" title="bluesky.plan_stubs.null"><code class="xref py py-obj docutils literal"><span class="pre">null</span></code></a></td>
<td>Yield a no-op Message.</td>
</tr>
</tbody>
</table>
<p>Combinations of the above that are often convenient:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">trigger_and_read</span></code>(devices[,&nbsp;name])</td>
<td>Trigger and read a list of detectors and bundle readings into one Event.</td>
</tr>
<tr class="row-even"><td><code class="xref py py-obj docutils literal"><span class="pre">one_1d_step</span></code>(detectors,&nbsp;motor,&nbsp;step)</td>
<td>Inner loop of a 1D step scan</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-obj docutils literal"><span class="pre">one_nd_step</span></code>(detectors,&nbsp;step,&nbsp;pos_cache)</td>
<td>Inner loop of an N-dimensional step scan</td>
</tr>
</tbody>
</table>
<p>We also provide <a class="reference internal" href="#preprocessors"><span class="std std-ref">wrapper and decorator functions</span></a> and
<a class="reference internal" href="#plan-utils"><span class="std std-ref">utility functions</span></a>, documented below, that make building
these easier.</p>
</div>
</div>
<div class="section" id="examples">
<span id="plan-examples1"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="changing-a-parameter-between-runs">
<h3>Changing a Parameter Between Runs<a class="headerlink" href="#changing-a-parameter-between-runs" title="Permalink to this headline">¶</a></h3>
<p>Produce several runs, changing a parameter each time.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>

<span class="k">def</span> <span class="nf">scan_varying_density</span><span class="p">():</span>
    <span class="s2">&quot;Run a scan several times, changing the step size each time.&quot;</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="c1"># Scan motor from -1 to 1, sampling more densely in each</span>
        <span class="c1"># iteration.</span>
        <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-devices-to-a-set-point">
<h3>Setting Devices to a Set Point<a class="headerlink" href="#setting-devices-to-a-set-point" title="Permalink to this headline">¶</a></h3>
<p>Next, we introduce <a class="reference internal" href="generated/bluesky.plan_stubs.abs_set.html#bluesky.plan_stubs.abs_set" title="bluesky.plan_stubs.abs_set"><code class="xref py py-func docutils literal"><span class="pre">abs_set()</span></code></a>, which sets a motor to a position (or a
temperature controller to a temperature, etc.). See also <a class="reference internal" href="generated/bluesky.plan_stubs.rel_set.html#bluesky.plan_stubs.rel_set" title="bluesky.plan_stubs.rel_set"><code class="xref py py-func docutils literal"><span class="pre">rel_set()</span></code></a>, which
sets <em>relative</em> to the current value.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">abs_set</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>

<span class="k">def</span> <span class="nf">move_and_count</span><span class="p">():</span>
    <span class="s2">&quot;Move a motor into place, then take a reading from detectors.&quot;</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">])</span>
</pre></div>
</div>
<p>The argument <code class="docutils literal"><span class="pre">wait=True</span></code> blocks progress until the device reports that it is
ready (e.g., done moving or done triggering). Alternatively, use a <a class="reference internal" href="generated/bluesky.plan_stubs.wait.html#bluesky.plan_stubs.wait" title="bluesky.plan_stubs.wait"><code class="xref py py-func docutils literal"><span class="pre">wait()</span></code></a>
plan, which is more flexible. Here, we move two motors at once and wait for
them both to finish.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">abs_set</span><span class="p">,</span> <span class="n">wait</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor1</span><span class="p">,</span> <span class="n">motor2</span>

<span class="k">def</span> <span class="nf">set_two_motors</span><span class="p">():</span>
    <span class="s2">&quot;Set, trigger, read&quot;</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>  <span class="c1"># Start moving motor1.</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>  <span class="c1"># Start moving motor2.</span>
    <span class="k">yield from</span> <span class="n">wait</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>  <span class="c1"># Now wait for both to finish.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">group</span></code> is just temporary label that we can use to refer to groups of
devices that we want to move or trigger simulataneously and then wait for them
as a group.  This plan will continue once both motors have reported that they
have finished moving successfully.</p>
<p>We could have written this some logic with a loop:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_multiple_motors</span><span class="p">(</span><span class="n">motors</span><span class="p">):</span>
    <span class="s2">&quot;Set all motors moving; then wait for all motors to finish.&quot;</span>
    <span class="k">for</span> <span class="n">motor</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">wait</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Two convenient shortcuts are available for common cases. As shown at the
beginning of this section, if you are setting one motor at a time, use the
<code class="docutils literal"><span class="pre">wait</span></code> keyword argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_one_motor</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor1</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># `wait=True` implicitly adds a group and `wait` plan to match.</span>
</pre></div>
</div>
<p>The same works for <a class="reference internal" href="generated/bluesky.plan_stubs.rel_set.html#bluesky.plan_stubs.rel_set" title="bluesky.plan_stubs.rel_set"><code class="xref py py-func docutils literal"><span class="pre">rel_set()</span></code></a> and <a class="reference internal" href="generated/bluesky.plan_stubs.trigger.html#bluesky.plan_stubs.trigger" title="bluesky.plan_stubs.trigger"><code class="xref py py-func docutils literal"><span class="pre">trigger()</span></code></a>. Also, if you are only
dealing with one group at a time, you do not actually need to label the group:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_multiple_motors</span><span class="p">(</span><span class="n">motors</span><span class="p">):</span>
    <span class="s2">&quot;Set all motors moving; then wait for all motors to finish.&quot;</span>
    <span class="k">for</span> <span class="n">motor</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>But by using labels you can express complex logic, waiting for different groups
at different points in the plan:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">staggered_wait</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">fast_motors</span><span class="p">,</span> <span class="n">slow_motor</span><span class="p">):</span>
    <span class="c1"># Start all the motors, fast and slow, moving at once.</span>
    <span class="c1"># Put all the fast_motors in one group...</span>
    <span class="k">for</span> <span class="n">motor</span> <span class="ow">in</span> <span class="n">fast_motors</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
    <span class="c1"># ...but put the slow motor is separate group.</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">slow_motor</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>

    <span class="c1"># Wait for all the fast motors.</span>
    <span class="k">yield from</span> <span class="n">wait</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>

    <span class="c1"># Do some stuff that doesn&#39;t require the slow motor to be finished.</span>

    <span class="c1"># Then wait for the slow motor.</span>
    <span class="k">yield from</span> <span class="n">wait</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Before writing a custom plan to coordinate the motion of multiple devices,
consider whether your use case could be addressed with one of the built-in
<a class="reference internal" href="#multi-dimensional-scans"><span class="std std-ref">Multi-dimensional scans</span></a>.</p>
</div>
<div class="section" id="sleeping">
<h3>Sleeping<a class="headerlink" href="#sleeping" title="Permalink to this headline">¶</a></h3>
<p>A “sleep” is a timed delay.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">abs_set</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">motor</span>

<span class="k">def</span> <span class="nf">sleepy</span><span class="p">():</span>
    <span class="s2">&quot;Set motor; sleep for a fixed time; set it to a new position.&quot;</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># units: seconds</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="generated/bluesky.plan_stubs.sleep.html#bluesky.plan_stubs.sleep" title="bluesky.plan_stubs.sleep"><code class="xref py py-func docutils literal"><span class="pre">sleep()</span></code></a> plan is not the same as Python’s built-in sleep function,
<code class="docutils literal"><span class="pre">time.sleep(...)</span></code>. Never use <code class="docutils literal"><span class="pre">time.sleep(...)</span></code> in a plan; use <code class="docutils literal"><span class="pre">yield</span> <span class="pre">from</span>
<span class="pre">sleep(...)</span></code> instead. It allows other tasks — such as watching for Ctrl+C,
updating plots — to be executed while the clock runs.</p>
</div>
<div class="section" id="planned-pauses">
<span id="id3"></span><h3>Planned Pauses<a class="headerlink" href="#planned-pauses" title="Permalink to this headline">¶</a></h3>
<p>Pausing is typically done <a class="reference internal" href="state-machine.html#pausing-interactively"><span class="std std-ref">interactively</span></a> (Ctrl+C)
but it can also be incorporated into a plan. The plan can pause the RunEngine,
requiring the user to type <code class="docutils literal"><span class="pre">RE.resume()</span></code> to continue or <code class="docutils literal"><span class="pre">RE.stop()</span></code> to
clean up and stop.</p>
<p>Pauses can be incorporated in a plan like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">pause</span><span class="p">,</span> <span class="n">checkpoint</span>

<span class="k">def</span> <span class="nf">pausing_plan</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">some_plan</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Type RE.resume() to go again or RE.stop() to stop.&quot;</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">checkpoint</span><span class="p">()</span>  <span class="c1"># marking where to resume from</span>
        <span class="k">yield from</span> <span class="n">pause</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="customizing-metadata">
<span id="id4"></span><h2>Customizing metadata<a class="headerlink" href="#customizing-metadata" title="Permalink to this headline">¶</a></h2>
<p>Metadata can be loaded from a persistent file, specified by the user
interactively at execution time, or incorporated in a plan.</p>
<p>All of the pre-assembled plans also accept an <code class="docutils literal"><span class="pre">md</span></code> (“metadata”) argument,
which makes it easy for a user-defined plan to pass in extra metadata.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span>

<span class="k">def</span> <span class="nf">master_plan</span><span class="p">():</span>
    <span class="s2">&quot;Read a detector with the shutter closed and then open.&quot;</span>
    <span class="c1"># ... insert code here to close shutter ...</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;is_dark_frame&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
    <span class="c1"># ... insert code here to open shutter ...</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;is_dark_frame&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
</pre></div>
</div>
<p>By default, the <code class="xref py py-func docutils literal"><span class="pre">count()</span></code> plan records <code class="docutils literal"><span class="pre">{'plan_name':</span> <span class="pre">'count'}</span></code>. To
customize the <code class="docutils literal"><span class="pre">plan_name</span></code> — say, to differentiate separate <em>reasons</em> for
running a count — you can override this behavior.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calib_count</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="s2">&quot;A count whose data will be designated &#39;calibration&#39;.&quot;</span>
    <span class="n">md</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plan_name&#39;</span><span class="p">:</span> <span class="s1">&#39;calib_count&#39;</span><span class="p">}</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>
</pre></div>
</div>
<p>The above records the <code class="docutils literal"><span class="pre">{'plan_name':</span> <span class="pre">'calib_count'}</span></code>.  To enable users to
pass in metadata that combines with and potentially overrides the hard-coded
metadata, use the following pattern:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calib_count</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s2">&quot;A count whose data will be designated &#39;calibration&#39;.&quot;</span>
    <span class="n">_md</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plan_name&#39;</span><span class="p">:</span> <span class="s1">&#39;calib_count&#39;</span><span class="p">}</span>  <span class="c1"># default</span>
    <span class="n">_md</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">md</span> <span class="ow">or</span> <span class="p">{})</span>  <span class="c1"># supplemented/overridden by argument passed in</span>
    <span class="k">yield from</span> <span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">_md</span><span class="p">)</span>
</pre></div>
</div>
<p>For example, if the plan is called with the arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">calib_count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;plan_name&#39;</span><span class="p">:</span> <span class="s1">&#39;watermelon&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>then <code class="docutils literal"><span class="pre">'watermelon'</span></code> will override <code class="docutils literal"><span class="pre">'calib_count'</span></code> as the recorded plan
name.</p>
</div>
<div class="section" id="plan-preprocessors">
<span id="preprocessors"></span><h2>Plan Preprocessors<a class="headerlink" href="#plan-preprocessors" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supplemental-data">
<span id="id5"></span><h3>Supplemental Data<a class="headerlink" href="#supplemental-data" title="Permalink to this headline">¶</a></h3>
<p>Plan preprocessors modify a plans contents on the fly. One common use of a
preprocessor is to take “baseline” readings of a group of devices at the
beginning and end of each run. It is convenient to apply this to <em>all</em> plans
executed by a RunEngine using the <a class="reference internal" href="#bluesky.preprocessors.SupplementalData" title="bluesky.preprocessors.SupplementalData"><code class="xref py py-class docutils literal"><span class="pre">SupplementalData</span></code></a>.</p>
<dl class="class">
<dt id="bluesky.preprocessors.SupplementalData">
<em class="property">class </em><code class="descclassname">bluesky.preprocessors.</code><code class="descname">SupplementalData</code><span class="sig-paren">(</span><em>*</em>, <em>baseline=None</em>, <em>monitors=None</em>, <em>flyers=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bluesky/preprocessors.html#SupplementalData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bluesky.preprocessors.SupplementalData" title="Permalink to this definition">¶</a></dt>
<dd><p>A configurable preprocessor for supplemental measurements</p>
<p>This is a plan preprocessor. It inserts messages into plans to:</p>
<ul class="simple">
<li>take “baseline” readings at the beginning and end of each run for the
devices listed in its <code class="docutils literal"><span class="pre">baseline</span></code> atrribute</li>
<li>kick off “flyable” devices listed in its <code class="docutils literal"><span class="pre">flyers</span></code> attribute at the
beginning of each run and collect their data at the end</li>
<li>monitor signals in its <code class="docutils literal"><span class="pre">monitors</span></code> attribute for asynchronous
updates during each run.</li>
</ul>
<p>Internally, it uses the plan preprocessors:</p>
<ul class="simple">
<li><a class="reference internal" href="generated/bluesky.preprocessors.baseline_wrapper.html#bluesky.preprocessors.baseline_wrapper" title="bluesky.preprocessors.baseline_wrapper"><code class="xref py py-func docutils literal"><span class="pre">baseline_wrapper()</span></code></a></li>
<li><a class="reference internal" href="generated/bluesky.preprocessors.monitor_during_wrapper.html#bluesky.preprocessors.monitor_during_wrapper" title="bluesky.preprocessors.monitor_during_wrapper"><code class="xref py py-func docutils literal"><span class="pre">monitor_during_wrapper()</span></code></a></li>
<li><code class="xref py py-func docutils literal"><span class="pre">flyer_during_wrapper()</span></code></li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>baseline</strong> : list</p>
<blockquote>
<div><p>Devices to be read at the beginning and end of each run</p>
</div></blockquote>
<p><strong>monitors</strong> : list</p>
<blockquote>
<div><p>Signals (not multi-signal Devices) to be monitored during each run,
generating readings asynchronously</p>
</div></blockquote>
<p><strong>flyers</strong> : list</p>
<blockquote class="last">
<div><p>“Flyable” Devices to be kicked off before each run and collected
at the end of each run</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Create an instance of SupplementalData and apply it to a RunEngine.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span> <span class="o">=</span> <span class="n">SupplementalData</span><span class="p">(</span><span class="n">baseline</span><span class="o">=</span><span class="p">[</span><span class="n">some_motor</span><span class="p">,</span> <span class="n">some_detector</span><span class="p">]),</span>
<span class="gp">... </span>                      <span class="n">monitors</span><span class="o">=</span><span class="p">[</span><span class="n">some_signal</span><span class="p">],</span>
<span class="gp">... </span>                      <span class="n">flyers</span><span class="o">=</span><span class="p">[</span><span class="n">some_flyer</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span><span class="o">.</span><span class="n">preprocessors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
</pre></div>
</div>
<p>Now all plans executed by RE will be modified to add baseline readings
(before and after each run), monitors (during each run), and flyers
(kicked off before each run and collected afterward).</p>
<p>Inspect or update the lists of devices interactively.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span>
<span class="go">[some_motor, some_detector]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">some_motor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span>
<span class="go">[some_detector]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">another_detector</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span>
<span class="go">[some_detector, another_detector]</span>
</pre></div>
</div>
<p>Each attribute (<code class="docutils literal"><span class="pre">baseline</span></code>, <code class="docutils literal"><span class="pre">monitors</span></code>, <code class="docutils literal"><span class="pre">flyers</span></code>) is an ordinary
Python list, support all the standard list methods, such as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>The arguments to SupplementalData are optional. All the lists
will empty by default.  As shown above, they can be populated
interactively.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span> <span class="o">=</span> <span class="n">SupplementalData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">({})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RE</span><span class="o">.</span><span class="n">preprocessors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd</span><span class="o">.</span><span class="n">baseline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">some_detector</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="preprocessor-wrappers-and-decorators">
<h3>Preprocessor Wrappers and Decorators<a class="headerlink" href="#preprocessor-wrappers-and-decorators" title="Permalink to this headline">¶</a></h3>
<p>Preprocessors can make arbirary modifcations to a plan, and can get quite
devious. For example, the <a class="reference internal" href="generated/bluesky.preprocessors.relative_set_wrapper.html#bluesky.preprocessors.relative_set_wrapper" title="bluesky.preprocessors.relative_set_wrapper"><code class="xref py py-func docutils literal"><span class="pre">relative_set_wrapper()</span></code></a> rewrites all positions
to be relative to the initial position.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rel_scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
    <span class="n">absolute</span> <span class="o">=</span> <span class="n">scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="n">relative</span> <span class="o">=</span> <span class="n">relative_set_wrapper</span><span class="p">(</span><span class="n">absolute</span><span class="p">,</span> <span class="p">[</span><span class="n">motor</span><span class="p">])</span>
    <span class="k">yield from</span> <span class="n">relative</span>
</pre></div>
</div>
<p>This is a subtle but remarkably powerful feature.</p>
<p>Wrappers like <a class="reference internal" href="generated/bluesky.preprocessors.relative_set_wrapper.html#bluesky.preprocessors.relative_set_wrapper" title="bluesky.preprocessors.relative_set_wrapper"><code class="xref py py-func docutils literal"><span class="pre">relative_set_wrapper()</span></code></a> operate on a generator <em>instance</em>,
like <code class="docutils literal"><span class="pre">scan(...)</span></code>. There are corresponding decorator functions like
<code class="docutils literal"><span class="pre">relative_set_decorator</span></code> that operate on a generator
<em>function</em> itself, like <code class="xref py py-func docutils literal"><span class="pre">scan()</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Using a decorator to modify a generator function</span>
<span class="k">def</span> <span class="nf">rel_scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>

    <span class="nd">@relative_set_decorator</span><span class="p">([</span><span class="n">motor</span><span class="p">])</span>  <span class="c1"># unfamiliar syntax? -- see box below</span>
    <span class="k">def</span> <span class="nf">inner_relative_scan</span><span class="p">():</span>
        <span class="k">yield from</span> <span class="n">scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

    <span class="k">yield from</span> <span class="n">inner_relative_scan</span><span class="p">()</span>
</pre></div>
</div>
<p>Incidentally, the name <code class="docutils literal"><span class="pre">inner_relative_scan</span></code> is just an internal variable,
so why did we choose such a verbose name? Why not just name it <code class="docutils literal"><span class="pre">f</span></code>? That
would work, of course, but using a descriptive name can make debugging easier.
When navigating gnarly, deeply nested tracebacks, it helps if internal variables
have clear names.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The decorator syntax — the <code class="docutils literal"><span class="pre">&#64;</span></code> — is a succinct way of passing a
function to another function.</p>
<p>This:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@g</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">f</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">g</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="built-in-preprocessors">
<h3>Built-in Preprocessors<a class="headerlink" href="#built-in-preprocessors" title="Permalink to this headline">¶</a></h3>
<p>Each of the following functions named <code class="docutils literal"><span class="pre">&lt;something&gt;_wrapper</span></code> operates on
a generator instance. The corresponding functions named
<code class="docutils literal"><span class="pre">&lt;something_decorator&gt;</span></code> operate on a generator function.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.baseline_decorator.html#bluesky.preprocessors.baseline_decorator" title="bluesky.preprocessors.baseline_decorator"><code class="xref py py-obj docutils literal"><span class="pre">baseline_decorator</span></code></a></td>
<td>Preprocessor that records a baseline of all <cite>devices</cite> after <cite>open_run</cite></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.baseline_wrapper.html#bluesky.preprocessors.baseline_wrapper" title="bluesky.preprocessors.baseline_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">baseline_wrapper</span></code></a></td>
<td>Preprocessor that records a baseline of all <cite>devices</cite> after <cite>open_run</cite></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.finalize_decorator.html#bluesky.preprocessors.finalize_decorator" title="bluesky.preprocessors.finalize_decorator"><code class="xref py py-obj docutils literal"><span class="pre">finalize_decorator</span></code></a></td>
<td>try…finally helper</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.finalize_wrapper.html#bluesky.preprocessors.finalize_wrapper" title="bluesky.preprocessors.finalize_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">finalize_wrapper</span></code></a></td>
<td>try…finally helper</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.fly_during_decorator.html#bluesky.preprocessors.fly_during_decorator" title="bluesky.preprocessors.fly_during_decorator"><code class="xref py py-obj docutils literal"><span class="pre">fly_during_decorator</span></code></a></td>
<td>Kickoff and collect “flyer” (asynchronously collect) objects during runs.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.fly_during_wrapper.html#bluesky.preprocessors.fly_during_wrapper" title="bluesky.preprocessors.fly_during_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">fly_during_wrapper</span></code></a></td>
<td>Kickoff and collect “flyer” (asynchronously collect) objects during runs.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.inject_md_decorator.html#bluesky.preprocessors.inject_md_decorator" title="bluesky.preprocessors.inject_md_decorator"><code class="xref py py-obj docutils literal"><span class="pre">inject_md_decorator</span></code></a></td>
<td>Inject additional metadata into a run.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.inject_md_wrapper.html#bluesky.preprocessors.inject_md_wrapper" title="bluesky.preprocessors.inject_md_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">inject_md_wrapper</span></code></a></td>
<td>Inject additional metadata into a run.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.lazily_stage_decorator.html#bluesky.preprocessors.lazily_stage_decorator" title="bluesky.preprocessors.lazily_stage_decorator"><code class="xref py py-obj docutils literal"><span class="pre">lazily_stage_decorator</span></code></a></td>
<td>This is a preprocessor that inserts ‘stage’ messages and appends ‘unstage’.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.lazily_stage_wrapper.html#bluesky.preprocessors.lazily_stage_wrapper" title="bluesky.preprocessors.lazily_stage_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">lazily_stage_wrapper</span></code></a></td>
<td>This is a preprocessor that inserts ‘stage’ messages and appends ‘unstage’.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.monitor_during_decorator.html#bluesky.preprocessors.monitor_during_decorator" title="bluesky.preprocessors.monitor_during_decorator"><code class="xref py py-obj docutils literal"><span class="pre">monitor_during_decorator</span></code></a></td>
<td>Monitor (asynchronously read) devices during runs.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.monitor_during_wrapper.html#bluesky.preprocessors.monitor_during_wrapper" title="bluesky.preprocessors.monitor_during_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">monitor_during_wrapper</span></code></a></td>
<td>Monitor (asynchronously read) devices during runs.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.relative_set_decorator.html#bluesky.preprocessors.relative_set_decorator" title="bluesky.preprocessors.relative_set_decorator"><code class="xref py py-obj docutils literal"><span class="pre">relative_set_decorator</span></code></a></td>
<td>Interpret ‘set’ messages on devices as relative to initial position.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.relative_set_wrapper.html#bluesky.preprocessors.relative_set_wrapper" title="bluesky.preprocessors.relative_set_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">relative_set_wrapper</span></code></a></td>
<td>Interpret ‘set’ messages on devices as relative to initial position.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.reset_positions_decorator.html#bluesky.preprocessors.reset_positions_decorator" title="bluesky.preprocessors.reset_positions_decorator"><code class="xref py py-obj docutils literal"><span class="pre">reset_positions_decorator</span></code></a></td>
<td>Return movable devices to their initial positions at the end.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.reset_positions_wrapper.html#bluesky.preprocessors.reset_positions_wrapper" title="bluesky.preprocessors.reset_positions_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">reset_positions_wrapper</span></code></a></td>
<td>Return movable devices to their initial positions at the end.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.run_decorator.html#bluesky.preprocessors.run_decorator" title="bluesky.preprocessors.run_decorator"><code class="xref py py-obj docutils literal"><span class="pre">run_decorator</span></code></a></td>
<td>Enclose in ‘open_run’ and ‘close_run’ messages.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.run_wrapper.html#bluesky.preprocessors.run_wrapper" title="bluesky.preprocessors.run_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">run_wrapper</span></code></a></td>
<td>Enclose in ‘open_run’ and ‘close_run’ messages.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.stage_decorator.html#bluesky.preprocessors.stage_decorator" title="bluesky.preprocessors.stage_decorator"><code class="xref py py-obj docutils literal"><span class="pre">stage_decorator</span></code></a></td>
<td>‘Stage’ devices (i.e., prepare them for use, ‘arm’ them) and then unstage.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.stage_wrapper.html#bluesky.preprocessors.stage_wrapper" title="bluesky.preprocessors.stage_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">stage_wrapper</span></code></a></td>
<td>‘Stage’ devices (i.e., prepare them for use, ‘arm’ them) and then unstage.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.subs_decorator.html#bluesky.preprocessors.subs_decorator" title="bluesky.preprocessors.subs_decorator"><code class="xref py py-obj docutils literal"><span class="pre">subs_decorator</span></code></a></td>
<td>Subscribe callbacks to the document stream; finally, unsubscribe.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.subs_wrapper.html#bluesky.preprocessors.subs_wrapper" title="bluesky.preprocessors.subs_wrapper"><code class="xref py py-obj docutils literal"><span class="pre">subs_wrapper</span></code></a></td>
<td>Subscribe callbacks to the document stream; finally, unsubscribe.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="custom-preprocessors">
<h3>Custom Preprocessors<a class="headerlink" href="#custom-preprocessors" title="Permalink to this headline">¶</a></h3>
<p>The preprocessors are implemented using <a class="reference internal" href="generated/bluesky.preprocessors.msg_mutator.html#bluesky.preprocessors.msg_mutator" title="bluesky.preprocessors.msg_mutator"><code class="xref py py-func docutils literal"><span class="pre">msg_mutator()</span></code></a> (for altering
messages in place) and <a class="reference internal" href="generated/bluesky.preprocessors.plan_mutator.html#bluesky.preprocessors.plan_mutator" title="bluesky.preprocessors.plan_mutator"><code class="xref py py-func docutils literal"><span class="pre">plan_mutator()</span></code></a> (for inserting
messages into the plan or removing messages).</p>
<p>It’s easiest to learn this by example, studying the implementations of the built-in
processors (catalogued above) in the
<a class="reference external" href="https://github.com/NSLS-II/bluesky/blob/master/bluesky/plans.py">the source of the plans module</a>.</p>
</div>
</div>
<div class="section" id="how-plans-handle-exceptions">
<span id="exception-handling"></span><h2>How Plans Handle Exceptions<a class="headerlink" href="#how-plans-handle-exceptions" title="Permalink to this headline">¶</a></h2>
<p>If an exception is raised, the RunEngine gives the plan the opportunity to
catch the exception and either handle it or merely yield some “clean up”
messsages before re-raising the exception and killing plan execution.</p>
<p>The exception in question may originate from the plan itself or from the
RunEngine when it attempts to execute a given command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># This example is illustrative, but it is not completely correct.</span>
<span class="c1"># Use `finalize_wrapper` instead (or read its source code).</span>

<span class="k">def</span> <span class="nf">plan_with_cleanup</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">main_plan</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Catch the exception long enough to clean up.</span>
        <span class="k">yield from</span> <span class="n">cleanup_plan</span><span class="p">()</span>
        <span class="k">raise</span>  <span class="c1"># Re-raise the exception.</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="generated/bluesky.preprocessors.finalize_wrapper.html#bluesky.preprocessors.finalize_wrapper" title="bluesky.preprocessors.finalize_wrapper"><code class="xref py py-func docutils literal"><span class="pre">finalize_wrapper()</span></code></a> preprocessor provides a succinct and fully correct
way of applying this general pattern.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.preprocessors</span> <span class="kn">import</span> <span class="n">finalize_wrapper</span>

<span class="k">def</span> <span class="nf">plan_with_cleanup</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">finalize_wrapper</span><span class="p">(</span><span class="n">main_plan</span><span class="p">(),</span> <span class="n">cleanup_plan</span><span class="p">())</span>
</pre></div>
</div>
<p>Or, at your preference, the same logic is available as a decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.preprocessors</span> <span class="kn">import</span> <span class="n">finalize_decorator</span>

<span class="n">plan_with_cleanup</span> <span class="o">=</span> <span class="n">finalize_decorator</span><span class="p">(</span><span class="n">cleanup_plan</span><span class="p">)(</span><span class="n">main_plan</span><span class="p">)</span>

<span class="c1"># or, equivalently:</span>

<span class="nd">@finalize_decorator</span><span class="p">(</span><span class="n">cleanup_plan</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plan_with_cleanup</span><span class="p">():</span>
    <span class="k">yield from</span> <span class="n">main_plan</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="customize-step-scans-with-per-step">
<h2>Customize Step Scans with <code class="docutils literal"><span class="pre">per_step</span></code><a class="headerlink" href="#customize-step-scans-with-per-step" title="Permalink to this headline">¶</a></h2>
<p>The one-dimensional and multi-dimensional plans are composed (1) setup,
(2) a loop over a plan to perform at each position, (3) cleanup.</p>
<p>We provide a hook for customizing step (2). This enables you to write a
variation of an existing plan without starting from scratch.</p>
<p>For one-dimensional plans, the default inner loop is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="n">abs_set</span><span class="p">,</span> <span class="n">trigger_and_read</span>

<span class="k">def</span> <span class="nf">one_1d_step</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inner loop of a 1D step scan</span>

<span class="sd">    This is the default function for ``per_step`` param in 1D plans.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="n">checkpoint</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">yield from</span> <span class="n">trigger_and_read</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">detectors</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">motor</span><span class="p">]))</span>
</pre></div>
</div>
<p>Some user-defined function, <code class="docutils literal"><span class="pre">custom_step</span></code>, with the same signature can be
used in its place:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">per_step</span><span class="o">=</span><span class="n">custom_step</span><span class="p">)</span>
</pre></div>
</div>
<p>For convenience, this could be wrapped into the definition of a new plan:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">custom_scan</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">md</span>
                    <span class="n">per_step</span><span class="o">=</span><span class="n">custom_step</span><span class="p">)</span>
</pre></div>
</div>
<p>For multi-dimensional plans, the default inner loop is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.utils</span> <span class="kn">import</span> <span class="n">short_uid</span>
<span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="n">abs_set</span><span class="p">,</span> <span class="n">wait</span><span class="p">,</span> <span class="n">trigger_and_read</span>

<span class="k">def</span> <span class="nf">one_nd_step</span><span class="p">(</span><span class="n">detectors</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">pos_cache</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inner loop of an N-dimensional step scan</span>

<span class="sd">    This is the default function for ``per_step`` param in ND plans.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    detectors : iterable</span>
<span class="sd">        devices to read</span>
<span class="sd">    step : dict</span>
<span class="sd">        mapping motors to positions in this step</span>
<span class="sd">    pos_cache : dict</span>
<span class="sd">        mapping motors to their last-set positions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">move</span><span class="p">():</span>
        <span class="k">yield from</span> <span class="n">checkpoint</span><span class="p">()</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">short_uid</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">motor</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">pos_cache</span><span class="p">[</span><span class="n">motor</span><span class="p">]:</span>
                <span class="c1"># This step does not move this motor.</span>
                <span class="k">continue</span>
            <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">grp</span><span class="p">)</span>
            <span class="n">pos_cache</span><span class="p">[</span><span class="n">motor</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">yield from</span> <span class="n">wait</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">grp</span><span class="p">)</span>

    <span class="n">motors</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">move</span><span class="p">()</span>
    <span class="k">yield from</span> <span class="n">trigger_and_read</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">detectors</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">motors</span><span class="p">))</span>
</pre></div>
</div>
<p>Likewise, a custom function with the same signature may be passed into the
<code class="docutils literal"><span class="pre">per_step</span></code> argument of any of the multi-dimensional plans.</p>
</div>
<div class="section" id="controlling-the-scope-of-a-run">
<span id="reimplementing-count"></span><h2>Controlling the Scope of a “Run”<a class="headerlink" href="#controlling-the-scope-of-a-run" title="Permalink to this headline">¶</a></h2>
<p>By default, the <code class="xref py py-func docutils literal"><span class="pre">count()</span></code> plan generates one “run” (i.e., dataset)
with one “event” (i.e., one bundle of readings from the detectors, one row in
a table of the data).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det1</span><span class="p">,</span> <span class="n">det2</span>
<span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">count</span>

<span class="n">dets</span> <span class="o">=</span> <span class="p">[</span><span class="n">det1</span><span class="p">,</span> <span class="n">det2</span><span class="p">]</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">num</span></code> argument enables multiple events (rows) in one run.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># one &#39;run&#39; with three &#39;events&#39;</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>If we didn’t provide a num option, how could you make one yourself?</p>
<p>A tempting — but wrong! — possibility is to loop over calls to
<code class="docutils literal"><span class="pre">RE(count(dets))</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t do this!</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">))</span>
</pre></div>
</div>
<p>As stated earlier, this ruins error-recovery and interruption recovery. It’s
much better to do the loop inside a custom plan, which we’ll dub
<code class="docutils literal"><span class="pre">multicount</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multicount</span><span class="p">(</span><span class="n">dets</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>

<span class="n">RE</span><span class="p">(</span><span class="n">multicount</span><span class="p">(</span><span class="n">dets</span><span class="p">))</span>
</pre></div>
</div>
<p>In fact, instead of hard-coding 3, we could make it an argument configurable
by the user. We can make the configuration optional by providing 3 as a
default.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multicount</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">count</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>
</pre></div>
</div>
<p>But this still creates three runs — three datasets — for what we’d rather
think of as three events (rows) in one run. To fix that, we’ll have to dive
deeper, re-implementing <code class="xref py py-func docutils literal"><span class="pre">count()</span></code> from scratch.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.preprocessors</span> <span class="kn">import</span> <span class="n">run_decorator</span><span class="p">,</span> <span class="n">stage_decorator</span>
<span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">trigger_and_read</span>

<span class="k">def</span> <span class="nf">multicount</span><span class="p">(</span><span class="n">dets</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="nd">@stage_decorator</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>
    <span class="nd">@run_decorator</span><span class="p">(</span><span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner_multicount</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">trigger_and_read</span><span class="p">(</span><span class="n">dets</span><span class="p">)</span>

    <span class="k">yield from</span> <span class="n">inner_multicount</span><span class="p">()</span>
</pre></div>
</div>
<p>Starting from the middle and explaining outward:</p>
<ul class="simple">
<li>The <code class="xref py py-func docutils literal"><span class="pre">trigger_and_read()</span></code> plan generates an “event” (a row of data) from
reading <code class="docutils literal"><span class="pre">dets</span></code>. This happens inside of a loop, <code class="docutils literal"><span class="pre">num</span></code> times.</li>
<li>The <a class="reference internal" href="generated/bluesky.preprocessors.run_decorator.html#bluesky.preprocessors.run_decorator" title="bluesky.preprocessors.run_decorator"><code class="xref py py-func docutils literal"><span class="pre">run_decorator()</span></code></a> preprocessor designates the scope of one run.</li>
<li>The <a class="reference internal" href="generated/bluesky.preprocessors.stage_decorator.html#bluesky.preprocessors.stage_decorator" title="bluesky.preprocessors.stage_decorator"><code class="xref py py-func docutils literal"><span class="pre">stage_decorator()</span></code></a> preprocessor addresses some hardware details. It
primes the hardware for data collection.  For some devices, this has no
effect at all. But for others, it ensures that the device is put into a
ready, triggerable state and then restored to standby at the end of the plan.</li>
</ul>
</div>
<div class="section" id="plans-with-adaptive-logic">
<h2>Plans with Adaptive Logic<a class="headerlink" href="#plans-with-adaptive-logic" title="Permalink to this headline">¶</a></h2>
<p>Two-way communication is possible between the generator and the RunEngine.
For example, the ‘read’ command responds with its reading. We can use it to
make an on-the-fly decision about whether to continue or stop.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bluesky.plan_stubs</span> <span class="kn">import</span> <span class="n">abs_set</span><span class="p">,</span> <span class="n">trigger</span><span class="p">,</span> <span class="n">read</span>
<span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>

<span class="k">def</span> <span class="nf">conditional_break</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set, trigger, read until the detector reads intensity &lt; threshold&quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;LOOP </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">abs_set</span><span class="p">(</span><span class="n">motor</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">trigger</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">reading</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reading</span><span class="p">[</span><span class="s1">&#39;det&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Demo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">RE</span><span class="p">(</span><span class="n">conditional_break</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">LOOP</span> <span class="mi">0</span>
<span class="n">LOOP</span> <span class="mi">1</span>
<span class="n">LOOP</span> <span class="mi">2</span>
<span class="n">DONE</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>The important line in this example is</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">reading</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">read</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
</pre></div>
</div>
<p>The action proceeds like this:</p>
<ol class="arabic simple">
<li>The plan yields a ‘read’ message to the RunEngine.</li>
<li>The RunEngine reads the detector.</li>
<li>The RunEngine sends that reading <em>back to the plan</em>, and that response is
assigned to the variable <code class="docutils literal"><span class="pre">reading</span></code>.</li>
</ol>
<p>The response, <code class="docutils literal"><span class="pre">reading</span></code>, is formatted like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">timestamp</span><span class="o">&gt;</span><span class="p">},</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>For a detailed technical description of the messages and their responses,
see <a class="reference internal" href="msg.html#msg"><span class="std std-ref">Message Protocol</span></a>.</p>
</div>
<div class="section" id="asynchronous-plans-fly-scans-and-monitoring">
<h2>Asynchronous Plans: “Fly Scans” and “Monitoring”<a class="headerlink" href="#asynchronous-plans-fly-scans-and-monitoring" title="Permalink to this headline">¶</a></h2>
<p>See the section on <a class="reference internal" href="async.html"><span class="doc">Asynchronous Acquisition</span></a> for some context on these terms and, near the
end of the section, some example plans.</p>
</div>
<div class="section" id="plan-utilities">
<span id="plan-utils"></span><h2>Plan Utilities<a class="headerlink" href="#plan-utilities" title="Permalink to this headline">¶</a></h2>
<p>These are useful utilities for defining custom plans and plan preprocessors.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.pchain.html#bluesky.preprocessors.pchain" title="bluesky.preprocessors.pchain"><code class="xref py py-obj docutils literal"><span class="pre">pchain</span></code></a></td>
<td>Like <cite>itertools.chain</cite> but using <cite>yield from</cite></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.msg_mutator.html#bluesky.preprocessors.msg_mutator" title="bluesky.preprocessors.msg_mutator"><code class="xref py py-obj docutils literal"><span class="pre">msg_mutator</span></code></a></td>
<td>A simple preprocessor that mutates or deletes single messages in a plan</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.plan_mutator.html#bluesky.preprocessors.plan_mutator" title="bluesky.preprocessors.plan_mutator"><code class="xref py py-obj docutils literal"><span class="pre">plan_mutator</span></code></a></td>
<td>Alter the contents of a plan on the fly by changing or inserting messages.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.preprocessors.single_gen.html#bluesky.preprocessors.single_gen" title="bluesky.preprocessors.single_gen"><code class="xref py py-obj docutils literal"><span class="pre">single_gen</span></code></a></td>
<td>Turn a single message into a plan</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.preprocessors.make_decorator.html#bluesky.preprocessors.make_decorator" title="bluesky.preprocessors.make_decorator"><code class="xref py py-obj docutils literal"><span class="pre">make_decorator</span></code></a></td>
<td>Turn a generator instance wrapper into a generator function decorator.</td>
</tr>
</tbody>
</table>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.broadcast_msg.html#bluesky.plan_stubs.broadcast_msg" title="bluesky.plan_stubs.broadcast_msg"><code class="xref py py-obj docutils literal"><span class="pre">broadcast_msg</span></code></a></td>
<td>Generate many copies of a mesasge, applying it to a list of devices.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/bluesky.plan_stubs.repeater.html#bluesky.plan_stubs.repeater" title="bluesky.plan_stubs.repeater"><code class="xref py py-obj docutils literal"><span class="pre">repeater</span></code></a></td>
<td>Generate n chained copies of the messages from gen_func</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/bluesky.plan_stubs.caching_repeater.html#bluesky.plan_stubs.caching_repeater" title="bluesky.plan_stubs.caching_repeater"><code class="xref py py-obj docutils literal"><span class="pre">caching_repeater</span></code></a></td>
<td>Generate n chained copies of the messages in a plan.</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/bluesky.plans.count.html" class="btn btn-neutral float-right" title="bluesky.plans.count" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="metadata.html" class="btn btn-neutral" title="Recording Metadata" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Brookhaven National Lab.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0.post4+ga3f23fa',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
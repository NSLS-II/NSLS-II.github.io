

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker setup &mdash; ophyd  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="OEP 1 : AD refactor/unification" href="OEP/OEP_001.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ophyd
          

          
          </a>

          
            
            
              <div class="version">
                1.3.0.post404+g949efc0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Standard Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="builtin-devices.html">Ready-to-Use Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Signals and Devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="device-overview.html">Device and Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="positioners.html">Positioners</a></li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="area-detector.html">Area Detectors</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="OEP/index.html">Ophyd Enhancement Proposals</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Docker setup</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Collection</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/bluesky">bluesky</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/ophyd">ophyd</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/caproto">caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Access and Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/databroker">databroker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/suitcase">suitcase</a></li>
</ul>
<p class="caption"><span class="caption-text">GitHub Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NSLS-II/">NSLS-II Repositories</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/NSLS-II/Bug-Reports/issues">Bug Reports</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ophyd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Docker setup</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/docker.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="docker-setup">
<h1>Docker setup<a class="headerlink" href="#docker-setup" title="Permalink to this headline">Â¶</a></h1>
<p>You can use Docker to run test IOCs that are convenient for testing without
having to locally build and install EPICS IOCs. Please use the following
Docker links to install and configure Docker:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/">Installing Docker on Ubuntu</a></li>
<li><a class="reference external" href="https://docs.docker.com/engine/installation/linux/linux-postinstall/">Configuring Docker</a>
(allowing to run as non-root, running at startup, etc.)</li>
</ul>
</div></blockquote>
<p>To communicate with the Docker you have set up some environmental variables:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">export</span> <span class="nv">DOCKER0_IP</span><span class="o">=</span><span class="s2">&quot;172.17.0.1&quot;</span>
<span class="nb">export</span> <span class="nv">EPICS_CA_ADDR_LIST</span><span class="o">=</span><span class="k">$(</span> <span class="nb">echo</span> <span class="nv">$DOCKER0_IP</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/^\([0-9]\+\)\.\([0-9]\+\)\..*$/\1.\2.255.255/&#39;</span> <span class="k">)</span>
<span class="nb">export</span> <span class="nv">EPICS_CA_AUTO_ADDR_LIST</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
<span class="nb">export</span> <span class="nv">EPICS_CA_MAX_ARRAY_BYTES</span><span class="o">=</span><span class="m">10000000</span>
</pre></div>
</div>
<p>and to run docker with the correct images (assuming the preceding code block is
saved in <code class="file docutils literal"><span class="pre">epics_exports.sh</span></code>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

systemctl status docker.service &gt; /dev/null
<span class="k">if</span> ! <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="nv">$?</span>
    systemctl restart docker.service
<span class="k">fi</span>

<span class="nb">source</span> epics_exports.sh

<span class="nv">DOCKERIMAGE</span><span class="o">=</span><span class="s2">&quot;klauer/epics-docker&quot;</span>
<span class="nv">PE_DOCKERIMAGE</span><span class="o">=</span><span class="s2">&quot;klauer/simioc-docker&quot;</span>
<span class="nv">PE_DOCKERTAG</span><span class="o">=</span><span class="s2">&quot;pyepics-docker&quot;</span>

docker pull <span class="si">${</span><span class="nv">DOCKERIMAGE</span><span class="si">}</span>
docker pull <span class="si">${</span><span class="nv">PE_DOCKERIMAGE</span><span class="si">}</span>:<span class="si">${</span><span class="nv">PE_DOCKERTAG</span><span class="si">}</span>
mkdir -p /tmp/data
<span class="c1"># this is required because the images use a version of AD which</span>
<span class="c1"># does not create missing directories.</span>
python -c <span class="s2">&quot;import ophyd.utils.paths as oup; import datetime; now = datetime.datetime.now(); [oup.make_dir_tree(now.year + j, base_path=&#39;/tmp/data&#39;) for j in [-1, 0, 1]]&quot;</span>
docker run -d -p <span class="nv">$DOCKER0_IP</span>:7000-9000:5064/tcp -v /tmp/data:/data <span class="si">${</span><span class="nv">DOCKERIMAGE</span><span class="si">}</span>
docker run -d -p <span class="nv">$DOCKER0_IP</span>:7000-9000:5064/tcp <span class="si">${</span><span class="nv">PE_DOCKERIMAGE</span><span class="si">}</span>:<span class="si">${</span><span class="nv">PE_DOCKERTAG</span><span class="si">}</span>
</pre></div>
</div>
<p>Running this multiple times will lead to multiple instances of the
images running.</p>
<p>For EPICS to know where to search for the IOCs you will need to do</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">source</span> epics_exports.sh
</pre></div>
</div>
<p>to setup the EPICS environmental variables. To check that it is setup
correctly</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ env <span class="p">|</span> grep -i epics
<span class="nv">EPICS_CA_ADDR_LIST</span><span class="o">=</span><span class="m">172</span>.17.255.255
<span class="nv">EPICS_CA_AUTO_ADDR_LIST</span><span class="o">=</span>no
<span class="nv">EPICS_CA_MAX_ARRAY_BYTES</span><span class="o">=</span><span class="m">10000000</span>
</pre></div>
</div>
<p>To check if it is working, try</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ caget XF:31IDA-OP<span class="o">{</span>Tbl-Ax:X1<span class="o">}</span>Mtr
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>You may need to install <code class="docutils literal"><span class="pre">pyepics</span></code>, which installs <code class="docutils literal"><span class="pre">epics-base</span></code>
and the corresponding <code class="docutils literal"><span class="pre">caget</span></code> executable:</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>conda install -c lightsource2-tag pyepics
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="OEP/OEP_001.html" class="btn btn-neutral float-left" title="OEP 1 : AD refactor/unification" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Brookhaven National Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Device and Component &mdash; ophyd  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ophyd.device.Device" href="generated/ophyd.device.Device.html" />
    <link rel="prev" title="ophyd.ophydobj.OphydObject._reset_sub" href="generated/ophyd.ophydobj.OphydObject._reset_sub.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ophyd
          

          
          </a>

          
            
            
              <div class="version">
                1.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Ophyd's Core Functionality</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Device and Component</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.html">ophyd.device.Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-robot">A Robot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#device"><code class="docutils literal"><span class="pre">Device</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hints"><code class="docutils literal"><span class="pre">hints</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hints-fields"><code class="docutils literal"><span class="pre">hints[&quot;fields&quot;]</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#hints-dimensions"><code class="docutils literal"><span class="pre">hints[&quot;dimensions&quot;]</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#hints-gridding"><code class="docutils literal"><span class="pre">hints[&quot;gridding&quot;]</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component"><code class="docutils literal"><span class="pre">Component</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="generated/ophyd.device.Component.html">ophyd.device.Component</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/ophyd.device.FormattedComponent.html">ophyd.device.FormattedComponent</a></li>
<li class="toctree-l4"><a class="reference internal" href="generated/ophyd.device.DynamicDeviceComponent.html">ophyd.device.DynamicDeviceComponent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trigger-read-and-describe">Trigger, Read and Describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-and-friends">Configuration and Friends</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stage-and-unstage">Stage and Unstage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implicit-triggering">Implicit Triggering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#count-time">Count Time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#low-level-api">Low level API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.connected.html">ophyd.device.Device.connected</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.wait_for_connection.html">ophyd.device.Device.wait_for_connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.get_instantiated_signals.html">ophyd.device.Device.get_instantiated_signals</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.get.html">ophyd.device.Device.get</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.put.html">ophyd.device.Device.put</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/ophyd.device.Device.get_device_tuple.html">ophyd.device.Device.get_device_tuple</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="signals.html">Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status objects (Futures)</a></li>
<li class="toctree-l1"><a class="reference internal" href="positioners.html">Positioners</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging and Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Built-in Device Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="area-detector.html">Area Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="builtin-devices.html">Ready-to-Use Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="OEP/index.html">Ophyd Enhancement Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker setup</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ophyd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Device and Component</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/device-overview.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="device-and-component">
<h1>Device and Component<a class="headerlink" href="#device-and-component" title="Permalink to this headline">¶</a></h1>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The core class of <a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a> is <code class="xref py py-class docutils literal"><span class="pre">Device</span></code> which encodes the
nodes of the hierarchical structure of the device and provides much of
core API.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.Device.html#ophyd.device.Device" title="ophyd.device.Device"><code class="xref py py-obj docutils literal"><span class="pre">Device</span></code></a>([prefix,&nbsp;kind,&nbsp;read_attrs,&nbsp;…])</td>
<td>Base class for device objects</td>
</tr>
</tbody>
</table>
<p>The base <code class="xref py py-class docutils literal"><span class="pre">Device</span></code> is not particularly useful on it’s own, it
must be sub-classed to provide it with components to do something
with.</p>
<p>Creating a custom device is as simple as</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">EpicsMotor</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span>

<span class="k">class</span> <span class="nc">StageXY</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s1">&#39;:X&#39;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">,</span> <span class="s1">&#39;:Y&#39;</span><span class="p">)</span>

<span class="n">stage</span> <span class="o">=</span> <span class="n">StageXY</span><span class="p">(</span><span class="s1">&#39;STAGE_PV&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stage&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then use <code class="docutils literal"><span class="pre">stage</span></code> as an input to any plan as a detector and
<code class="docutils literal"><span class="pre">stage.x</span></code> and <code class="docutils literal"><span class="pre">stage.y</span></code> as independent motors.</p>
<div class="section" id="a-robot">
<h3>A Robot<a class="headerlink" href="#a-robot" title="Permalink to this headline">¶</a></h3>
<p>A slightly more complex example is to control a simple sample loading
robot.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">EpicsSignal</span><span class="p">,</span> <span class="n">EpicsSignalRO</span>
<span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Component</span> <span class="k">as</span> <span class="n">Cpt</span>
<span class="kn">from</span> <span class="nn">ophyd.utils</span> <span class="kn">import</span> <span class="n">set_and_wait</span>

<span class="k">class</span> <span class="nc">Robot</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">sample_number</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s1">&#39;ID:Tgt-SP&#39;</span><span class="p">)</span>
    <span class="n">load_cmd</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s1">&#39;Cmd:Load-Cmd.PROC&#39;</span><span class="p">)</span>
    <span class="n">unload_cmd</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s1">&#39;Cmd:Unload-Cmd.PROC&#39;</span><span class="p">)</span>
    <span class="n">execute_cmd</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s1">&#39;Cmd:Exec-Cmd&#39;</span><span class="p">)</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">Cpt</span><span class="p">(</span><span class="n">EpicsSignalRO</span><span class="p">,</span> <span class="s1">&#39;Sts-Sts&#39;</span><span class="p">)</span>

<span class="n">my_robot</span> <span class="o">=</span> <span class="n">Robot</span><span class="p">(</span><span class="s1">&#39;PV_PREFIX:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;my_robot&#39;</span><span class="p">,</span>
                 <span class="n">read_attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sample_number&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Which creates an instance <code class="docutils literal"><span class="pre">my_robot</span></code> with 5 children</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="42%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">python attribute</th>
<th class="head">PV name</th>
<th class="head">in <code class="docutils literal"><span class="pre">read()</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>my_robot.sample_number</td>
<td>‘PV_PREFIX:ID:Tgt-SP’</td>
<td>Y</td>
</tr>
<tr class="row-odd"><td>my_robot.load_cmd</td>
<td>‘PV_PREFIX:CMD:Load-Cmd.PROC’</td>
<td>N</td>
</tr>
<tr class="row-even"><td>my_robot.unload_cmd</td>
<td>‘PV_PREFIX:CMD:Unload-Cmd.PROC’</td>
<td>N</td>
</tr>
<tr class="row-odd"><td>my_robot.execute_cmd</td>
<td>‘PV_PREFIX:CMD:Exec-Cmd’</td>
<td>N</td>
</tr>
<tr class="row-even"><td>my_robot.status</td>
<td>‘PV_PREFIX:Sts-Sts’</td>
<td>Y</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>only 2 of which will be included when reading from the robot.</p>
<p>You could now use this device in a scan like</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>

<span class="k">def</span> <span class="nf">load_sample</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">sample_number</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">load_cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">unload_sample</span><span class="p">(</span><span class="n">robot</span><span class="p">):</span>
    <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">unload_cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">robot_plan</span><span class="p">(</span><span class="n">list_of_samples</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">list_of_samples</span><span class="p">:</span>
        <span class="c1"># load the sample</span>
        <span class="k">yield from</span> <span class="n">load_sample</span><span class="p">(</span><span class="n">my_robot</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span>
        <span class="c1"># take a measurement</span>
        <span class="k">yield from</span> <span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">md</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="n">sample</span><span class="p">})</span>
        <span class="c1"># unload the sample</span>
        <span class="k">yield from</span> <span class="n">unload_sample</span><span class="p">(</span><span class="n">my_robot</span><span class="p">)</span>
</pre></div>
</div>
<p>and from the command line</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">robot_plan</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span> <span class="mi">6</span><span class="p">]))</span>
</pre></div>
</div>
<p>These classes were co-developed with <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> and are the
reference implementation of a hardware abstraction layer for
<code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code>.  However, these are closely tied to EPICS and make
some assumptions about the PV naming based on NSLS-II’s naming scheme.
Despite attempting generality, it is likely that as <a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a> and
<code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> are used at other facilities (and when <a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a> is
adapted for a different control system) we will discover some latent
NSLS-II-isms that should be corrected (or at least acknowledged and
documented).</p>
</div>
</div>
<div class="section" id="device">
<h2><code class="xref py py-class docutils literal"><span class="pre">Device</span></code><a class="headerlink" href="#device" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-class docutils literal"><span class="pre">Device</span></code> adds a number of additional attributes beyond the
required <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> API and what is inherited from <code class="xref py py-class docutils literal"><span class="pre">OphydObj</span></code>
for run-time configuration</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-attr docutils literal"><span class="pre">read_attrs</span></code></td>
<td>Names of components for <code class="docutils literal"><span class="pre">read()</span></code> See <a class="reference internal" href="#trd"><span class="std std-ref">Trigger, Read and Describe</span></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal"><span class="pre">configuration_attrs</span></code></td>
<td>Names of components for <code class="docutils literal"><span class="pre">read_configuration()</span></code>.
See <a class="reference internal" href="#cfg-and-f"><span class="std std-ref">Configuration and Friends</span></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal"><span class="pre">stage_sigs</span></code></td>
<td>Signals to be set during <a class="reference internal" href="#stage-and-unstage">Stage and Unstage</a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal"><span class="pre">hints</span></code></td>
<td>Names of components as suggestions for handling in bluesky callbacks.</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>and static information about the object</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-attr docutils literal"><span class="pre">prefix</span></code></td>
<td>‘base’ of PV name, used when building components</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal"><span class="pre">component_names</span></code></td>
<td>List of the names components on this device.
Direct children only</td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal"><span class="pre">trigger_signals</span></code></td>
<td>Signals for use in <a class="reference internal" href="#implicit-triggering">Implicit Triggering</a>
(provisional)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><code class="xref py py-class docutils literal"><span class="pre">Device</span></code> also has two class-level attributes to control the default contents of
<code class="xref py py-attr docutils literal"><span class="pre">read_attrs</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">configuration_attrs</span></code>.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-attr docutils literal"><span class="pre">_default_read_attrs</span></code></td>
<td><p class="first">The default contents of <code class="xref py py-attr docutils literal"><span class="pre">read_attrs</span></code> if a subset
of all available children.</p>
<p>An iterable or <cite>None</cite>.  If <cite>None</cite> defaults to
all children</p>
<p class="last">A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal"><span class="pre">tuple</span></code></a> is recommended.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal"><span class="pre">_default_configuration_attrs</span></code></td>
<td><p class="first">The default contents of <code class="xref py py-attr docutils literal"><span class="pre">configuration_attrs</span></code></p>
<p>An iterable or <cite>None</cite>.  If <cite>None</cite> defaults to <code class="docutils literal"><span class="pre">[]</span></code></p>
<p class="last">A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal"><span class="pre">tuple</span></code></a> is recommended.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="hints">
<span id="index-0"></span><span id="id1"></span><h3><code class="xref py py-attr docutils literal"><span class="pre">hints</span></code><a class="headerlink" href="#hints" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-attr docutils literal"><span class="pre">hints</span></code> attribute is a dictionary that provides information about an
<a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a> device to <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> callbacks that advise how that device
should be handled by the callback.  While it could be used for many purposes,
its first use has been to direct the selection of the relevant axes and signals
to use when plotting data from an event stream.</p>
<p>There are two different locations where the <code class="docutils literal"><span class="pre">hints</span></code> dictionary is created.</p>
<p>1. During the specification of an ophyd <code class="xref py py-class docutils literal"><span class="pre">Device</span></code>
1. Configuration of the <code class="docutils literal"><span class="pre">start</span></code> document by a <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> plan</p>
<p>The <code class="docutils literal"><span class="pre">hints</span></code> dictionary has well-known keys.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key</th>
<th class="head">Description of value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fields</span></code></td>
<td>signal names to be used for a plot as dependent axes</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">dimensions</span></code></td>
<td>signal names to be used for a plot as independent axes</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">gridding</span></code></td>
<td>advises when to prefer <code class="docutils literal"><span class="pre">LiveGrid</span></code> instead of <code class="docutils literal"><span class="pre">LivePlot</span></code></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">hints</span></code> dictionary may also have custom keys used by the custom support.</p>
<ul>
<li><p class="first">example using the <em>ad hoc</em> <code class="docutils literal"><span class="pre">vis</span></code> key in the creation of an <a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a>
detector Device:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vis&#39;</span><span class="p">:</span> <span class="s1">&#39;placeholder&#39;</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">then look for this key in the custom <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> callback:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;hints&#39;</span><span class="p">][</span><span class="s1">&#39;det&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;vis&#39;</span><span class="p">:</span> <span class="s1">&#39;placeholder&#39;</span><span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="hints-fields">
<span id="id2"></span><h4><code class="docutils literal"><span class="pre">hints[&quot;fields&quot;]</span></code><a class="headerlink" href="#hints-fields" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">fields</span></code> is a list of ophyd object name(s) to be used as dependent axes for
visualization callbacks.  The object name(s) must appear in the dictionary
returned by the device’s <code class="docutils literal"><span class="pre">read()</span></code> method.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">quadem</span><span class="o">.</span><span class="n">hints</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;quadem_current1_mean_value&#39;</span><span class="p">]}</span>
<span class="n">sca</span><span class="o">.</span><span class="n">hints</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sca</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">name</span><span class="p">]}</span>
</pre></div>
</div>
<p>To ensure internal consistency, the <code class="docutils literal"><span class="pre">hints</span></code> attribute of any
<code class="xref py py-class docutils literal"><span class="pre">Signal</span></code> or <code class="xref py py-class docutils literal"><span class="pre">Device</span></code> cannot be set directly.
<a class="footnote-reference" href="#use-kind-not-fit" id="id3">[1]</a> Instead of:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">camera</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">camera</span><span class="o">.</span><span class="n">stats1</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                       <span class="n">camera</span><span class="o">.</span><span class="n">stats2</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">name</span><span class="p">]}</span>
</pre></div>
</div>
<p>use the <code class="xref py py-attr docutils literal"><span class="pre">kind</span></code> <span class="target" id="index-1"></span>kind attribute.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ophyd</span> <span class="kn">import</span> <span class="n">Kind</span>

<span class="n">camera</span><span class="o">.</span><span class="n">stats1</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">Kind</span><span class="o">.</span><span class="n">hinted</span>
<span class="n">camera</span><span class="o">.</span><span class="n">stats2</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">Kind</span><span class="o">.</span><span class="n">hinted</span>
</pre></div>
</div>
<p>or, as a convenient shortcut</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">camera</span><span class="o">.</span><span class="n">stats1</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;hinted&#39;</span>
<span class="n">camera</span><span class="o">.</span><span class="n">stats2</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;hinted&#39;</span>
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="use-kind-not-fit" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>starting with ophyd v1.2.0</td></tr>
</tbody>
</table>
</div>
<div class="section" id="hints-dimensions">
<span id="id4"></span><h4><code class="docutils literal"><span class="pre">hints[&quot;dimensions&quot;]</span></code><a class="headerlink" href="#hints-dimensions" title="Permalink to this headline">¶</a></h4>
<p>Defines the ophyd signal names to be used as independent axes for visualization.
The syntax is (list of field names, stream name) where the list of field
names is as above and the stream name is usually <code class="docutils literal"><span class="pre">primary</span></code>.
All the signals must be available in the named stream.</p>
<p><code class="docutils literal"><span class="pre">hints[&quot;dimensions&quot;]</span></code> is used by a <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> plan
to prepare a <code class="xref py py-attr docutils literal"><span class="pre">dimensions</span></code> attribute that is placed
in the <cite>start</cite> document.  It is this <code class="xref py py-attr docutils literal"><span class="pre">dimensions</span></code> attribute
that identifies the independent axes for visualization callbacks.
The plan can use or override what it finds in <code class="docutils literal"><span class="pre">hints[&quot;dimensions&quot;]</span></code>.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">motor</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">],</span> <span class="s1">&#39;primary&#39;</span><span class="p">)]</span>
<span class="n">dimensions</span> <span class="o">=</span> <span class="p">[((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="s1">&#39;primary&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>For now, <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code> can only handle when all the dimensions belong
to the same stream.  To generalize, we would need to resample
and we are not going to handle that yet.</p>
</div>
<div class="section" id="hints-gridding">
<span id="id5"></span><h4><code class="docutils literal"><span class="pre">hints[&quot;gridding&quot;]</span></code><a class="headerlink" href="#hints-gridding" title="Permalink to this headline">¶</a></h4>
<p>This key is used for mesh and grid scans.  When present, it can take these values:
<code class="docutils literal"><span class="pre">rectilinear</span></code> or <code class="docutils literal"><span class="pre">rectilinear_nonsequential</span></code>.</p>
<p>In the <em>Best Effort Callback</em> from <code class="xref py py-mod docutils literal"><span class="pre">bluesky</span></code>, if <code class="docutils literal"><span class="pre">hints[&quot;gridding&quot;]</span></code> exists and
is <code class="docutils literal"><span class="pre">&quot;rectilinear&quot;</span></code>, then use LiveGrid, otherwise use LivePlot.</p>
</div>
</div>
<div class="section" id="component">
<h3><code class="xref py py-class docutils literal"><span class="pre">Component</span></code><a class="headerlink" href="#component" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-class docutils literal"><span class="pre">Component</span></code> class is a python <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#implementing-descriptors">descriptor</a> which overrides
the behavior on attribute access.  This allows us to use a declarative style to
define the software representation of the hardware.  The best way to
understand is through an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span><span class="n">EpicsSignal</span><span class="p">,</span> <span class="s1">&#39;:bar&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>which means “When a <code class="docutils literal"><span class="pre">Foo</span></code> instance is created give it a <code class="docutils literal"><span class="pre">bar</span></code> attribute
which is an instance of <code class="xref py py-class docutils literal"><span class="pre">EpicsSignal</span></code> and use the extra args
and kwargs when creating it”.  It is a declaration of what you want
and it is the responsibility of <a class="reference internal" href="generated/ophyd.html#module-ophyd" title="ophyd"><code class="xref py py-mod docutils literal"><span class="pre">ophyd</span></code></a> to make it happen.</p>
<p>There are three classes</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.Component.html#ophyd.device.Component" title="ophyd.device.Component"><code class="xref py py-obj docutils literal"><span class="pre">Component</span></code></a>(cls[,&nbsp;suffix,&nbsp;lazy,&nbsp;…])</td>
<td>A descriptor representing a device component (or signal)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/ophyd.device.FormattedComponent.html#ophyd.device.FormattedComponent" title="ophyd.device.FormattedComponent"><code class="xref py py-obj docutils literal"><span class="pre">FormattedComponent</span></code></a>(cls[,&nbsp;suffix,&nbsp;lazy,&nbsp;…])</td>
<td>A Component which takes a dynamic format string</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.DynamicDeviceComponent.html#ophyd.device.DynamicDeviceComponent" title="ophyd.device.DynamicDeviceComponent"><code class="xref py py-obj docutils literal"><span class="pre">DynamicDeviceComponent</span></code></a>(defn,&nbsp;*[,&nbsp;clsname,&nbsp;…])</td>
<td>An Device component that dynamically creates an ophyd Device</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="trigger-read-and-describe">
<span id="trd"></span><h3>Trigger, Read and Describe<a class="headerlink" href="#trigger-read-and-describe" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/ophyd.device.BlueskyInterface.trigger.html#ophyd.device.BlueskyInterface.trigger" title="ophyd.device.BlueskyInterface.trigger"><code class="xref py py-meth docutils literal"><span class="pre">trigger()</span></code></a> method is responsible for
implementing ‘trigger’ or ‘acquire’ functionality of the Device.</p>
<p>The <a class="reference internal" href="generated/ophyd.device.BlueskyInterface.read.html#ophyd.device.BlueskyInterface.read" title="ophyd.device.BlueskyInterface.read"><code class="xref py py-meth docutils literal"><span class="pre">read()</span></code></a> method is responsible for
for returning the data from the Device.</p>
<p>The <a class="reference internal" href="generated/ophyd.device.BlueskyInterface.describe.html#ophyd.device.BlueskyInterface.describe" title="ophyd.device.BlueskyInterface.describe"><code class="xref py py-meth docutils literal"><span class="pre">describe()</span></code></a> method is responsible for
providing schema and meta-data for the <cite>read()</cite> method.</p>
</div>
<div class="section" id="configuration-and-friends">
<span id="cfg-and-f"></span><h3>Configuration and Friends<a class="headerlink" href="#configuration-and-friends" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="stage-and-unstage">
<h3>Stage and Unstage<a class="headerlink" href="#stage-and-unstage" title="Permalink to this headline">¶</a></h3>
<p>When a Device <code class="docutils literal"><span class="pre">d</span></code> is used in scan, it is “staged” and “unstaged.” Think of
this as “setup” and “cleanup”. That is, before a device is triggered, read, or
moved, the scan is expected to call <code class="docutils literal"><span class="pre">d.stage()</span></code>. And, at the end of scan,
<code class="docutils literal"><span class="pre">d.unstage()</span></code> is called. (Whenever possible, unstaging is performed even if
the scan is aborted or fails due to an error.)</p>
<p>The staging process is a “hook” for preparing a device for use. To add
custom staging logic to a Device, subclass it and override <code class="docutils literal"><span class="pre">stage</span></code> and/or
<code class="docutils literal"><span class="pre">unstage</span></code> like so.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMotor</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">stage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am staging.&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stage</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">unstage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I am unstaging.&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">unstage</span><span class="p">()</span>
</pre></div>
</div>
<p>It is crucial to call <code class="docutils literal"><span class="pre">super()</span></code>, as above, so that any built-in staging
behavior is not overridden.</p>
<p>A common use for staging is to set certain signals to certain values for
a scan and then set them back at the end. For example, a detector device
might turn on “capture mode” at the beginning of the scan and then flip it
back off (or back to its original setting, whatever that was) at the end.
For this, ophyd provides a convenience, <code class="docutils literal"><span class="pre">stage_sigs</span></code> — a dictionary
mapping signals to desired values. The device reads the initial values
of these signals, stashes them, changes them to the desired value, and then
restore the initial value when the device is unstaged. It is best to
customize <code class="docutils literal"><span class="pre">stage_sigs</span></code> in the device’s <code class="docutils literal"><span class="pre">__init__</span></code> method, like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMotor</span><span class="p">(</span><span class="n">EpicsMotor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage_sigs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">user_offset</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>When a <code class="docutils literal"><span class="pre">MyMotor</span></code> device is staged, its <code class="docutils literal"><span class="pre">user_offset</span></code> value will be set
to 5. When it is unstaged, it will be set back to whatever value it had
right before it was staged.</p>
</div>
<div class="section" id="implicit-triggering">
<h3>Implicit Triggering<a class="headerlink" href="#implicit-triggering" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="count-time">
<h3>Count Time<a class="headerlink" href="#count-time" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="low-level-api">
<h2>Low level API<a class="headerlink" href="#low-level-api" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.Device.connected.html#ophyd.device.Device.connected" title="ophyd.device.Device.connected"><code class="xref py py-obj docutils literal"><span class="pre">Device.connected</span></code></a></td>
<td></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/ophyd.device.Device.wait_for_connection.html#ophyd.device.Device.wait_for_connection" title="ophyd.device.Device.wait_for_connection"><code class="xref py py-obj docutils literal"><span class="pre">Device.wait_for_connection</span></code></a></td>
<td>Wait for signals to connect</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.Device.get_instantiated_signals.html#ophyd.device.Device.get_instantiated_signals" title="ophyd.device.Device.get_instantiated_signals"><code class="xref py py-obj docutils literal"><span class="pre">Device.get_instantiated_signals</span></code></a></td>
<td>Yields all of the instantiated signals in a device hierarchy</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/ophyd.device.Device.get.html#ophyd.device.Device.get" title="ophyd.device.Device.get"><code class="xref py py-obj docutils literal"><span class="pre">Device.get</span></code></a></td>
<td>Get the value of all components in the device</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/ophyd.device.Device.put.html#ophyd.device.Device.put" title="ophyd.device.Device.put"><code class="xref py py-obj docutils literal"><span class="pre">Device.put</span></code></a></td>
<td>Put a value to all components of the device</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/ophyd.device.Device.get_device_tuple.html#ophyd.device.Device.get_device_tuple" title="ophyd.device.Device.get_device_tuple"><code class="xref py py-obj docutils literal"><span class="pre">Device.get_device_tuple</span></code></a></td>
<td>The device tuple type associated with an Device class</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/ophyd.device.Device.html" class="btn btn-neutral float-right" title="ophyd.device.Device" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generated/ophyd.ophydobj.OphydObject._reset_sub.html" class="btn btn-neutral float-left" title="ophyd.ophydobj.OphydObject._reset_sub" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2014, Brookhaven National Lab

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
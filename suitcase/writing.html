

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Write Your Own Suitcase &mdash; suitcase v0.8.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Supported Formats and Layouts" href="formats.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> suitcase
          

          
          </a>

          
            
            
              <div class="version">
                v0.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Supported Formats and Layouts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Write Your Own Suitcase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#scope-of-a-suitcase">Scope of a Suitcase</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suitcases-are-highly-specific">Suitcases are Highly Specific</a></li>
<li class="toctree-l3"><a class="reference internal" href="#categories-of-suitcases">Categories of Suitcases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-new-suitcase-package">Creating a New Suitcase Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-the-package-with-cookiecutter">Create the package with cookiecutter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-the-serializer">Write the Serializer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-an-export-function">Add an export function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-the-serializer">Test the Serializer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">suitcase</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Write Your Own Suitcase</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/writing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="write-your-own-suitcase">
<h1>Write Your Own Suitcase<a class="headerlink" href="#write-your-own-suitcase" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scope-of-a-suitcase">
<h2>Scope of a Suitcase<a class="headerlink" href="#scope-of-a-suitcase" title="Permalink to this headline">¶</a></h2>
<div class="section" id="suitcases-are-highly-specific">
<h3>Suitcases are Highly Specific<a class="headerlink" href="#suitcases-are-highly-specific" title="Permalink to this headline">¶</a></h3>
<p>Suitcase translates documents generated by bluesky (or anything that follows
its “event model” schema) into file formats.</p>
<p>Suitcase’s design philosophy is to make many well-tailored suitcases rather
than try to fit a large range of functionality into one suitcase.</p>
<p>Each file format is implemented in a separate Python package, named
<code class="docutils literal notranslate"><span class="pre">suitcase-&lt;format&gt;</span></code>. As support for new formats is added over time, there may
someday be hundreds of suitcase packages. This modular approach will keep the
number of dependencies manageable (no need to install heavy I/O libraries that
you don’t plan to use). It will also allow each suitcase to be updated and
released on its own schedule and maintained by the specific communities,
facilities, or users who care about a particular format.</p>
<p>Even “one suitcase per file format” is too broad. Some formats, such as HDF5,
enable a huge variety of layouts—too many configure via a reasonable number
of parameters. Therefore, there will never be a “suitcase-hdf5” package, but
rather multiple suitcases, each tuned a specific HDF5 layout such as NeXuS or
Data Exchange.</p>
</div>
<div class="section" id="categories-of-suitcases">
<h3>Categories of Suitcases<a class="headerlink" href="#categories-of-suitcases" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="formats.html"><span class="doc">list of existing and planned suitcases</span></a> groups them into
three categories.</p>
<ul class="simple">
<li><p>“One-offs” — These are tailed to one specific application, writing files to
the requirements of a particular software program or user.</p></li>
<li><p>“Generics” — These write commonly-requested formats such as TIFF or CSV.
There is often room for interpretation in how exactly to lay out the data
into a given file format. (One TIFF file per detector? Per Event? Per
exposure?) The design process can devolve into tricky judgment calls or
a confusing array of options for the user. When it doubt, we encourage you to
steer toward writing one or more “one-offs”.</p></li>
<li><p>“Backends” — These are less user-facing that the other two categories. They
write into a file meant to be read back be a programmatic interface. For
example, suitcase-mongo insert documents into MongoDB.</p></li>
</ul>
</div>
</div>
<div class="section" id="creating-a-new-suitcase-package">
<h2>Creating a New Suitcase Package<a class="headerlink" href="#creating-a-new-suitcase-package" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-the-package-with-cookiecutter">
<h3>Create the package with cookiecutter<a class="headerlink" href="#create-the-package-with-cookiecutter" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Install cookiecutter. This is a tool for generating a new Python package
from a template.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install --upgrade cookiecutter
</pre></div>
</div>
</li>
<li><p>Use cookiecutter to create a new suitcase package. Just follow the prompts.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cookiecutter https://github.com/NSLS-II/suitcase-cookiecutter

subproject_name <span class="o">[</span>ex: tiff, spec, pizza-box<span class="o">]</span>: my-special-format
subpackage_name <span class="o">[</span>my_special_format<span class="o">]</span>:
</pre></div>
</div>
<p>This will have created a new directory named <code class="docutils literal notranslate"><span class="pre">suitcase-my-special-format</span></code>
with all the “scaffolding” of a working Python package for suitcase.</p>
</li>
<li><p>Initialize the directory as a git repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> suitcase-my-special-format
git init
git add .
git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>
</li>
<li><p>Install the package and its development requirements.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -e .
pip install -r requirements-dev.txt
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="write-the-serializer">
<h3>Write the Serializer<a class="headerlink" href="#write-the-serializer" title="Permalink to this headline">¶</a></h3>
<p>Before reading this section, read to the end of <a class="reference internal" href="usage.html"><span class="doc">Usage</span></a>.</p>
<p>All suitcase packages must contain a <code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code> class with the
interface outlined below. It should also contain an <code class="xref py py-func docutils literal notranslate"><span class="pre">export()</span></code> function.
These should be in <code class="docutils literal notranslate"><span class="pre">suitcase/my-special-format/__init__.py</span></code>.</p>
<p>Here is a sketch of a <code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">event_model</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">suitcase.utils</span>

<span class="k">class</span> <span class="nc">Serializer</span><span class="p">(</span><span class="n">event_model</span><span class="o">.</span><span class="n">DocumentRouter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">file_prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{uid}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file_prefix</span> <span class="o">=</span> <span class="n">file_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templated_file_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># set when we get a &#39;start&#39; document</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="c1"># The user has given us a filepath; they want files.</span>
            <span class="c1"># Set up a MultiFileManager for them.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="n">suitcase</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">MultiFileManager</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The user has given us their own Manager instance. Use that.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="n">directory</span>

        <span class="c1"># Finally, we usually need some state related to stashing file</span>
        <span class="c1"># handles/buffers. For a Serializer that only needs *one* file</span>
        <span class="c1"># this may be:</span>
        <span class="c1">#</span>
        <span class="c1"># self._output_file = None</span>
        <span class="c1">#</span>
        <span class="c1"># For a Serializer that writes a separate file per stream:</span>
        <span class="c1">#</span>
        <span class="c1"># self._files = {}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">artifacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The &#39;artifacts&#39; are the manager&#39;s way to exposing to the user a</span>
        <span class="c1"># way to get at the resources that were created. For</span>
        <span class="c1"># `MultiFileManager`, the artifacts are filenames.  For</span>
        <span class="c1"># `MemoryBuffersManager`, the artifacts are the buffer objects</span>
        <span class="c1"># themselves. The Serializer, in turn, exposes that to the user here.</span>
        <span class="c1">#</span>
        <span class="c1"># This must be a property, not a plain attribute, because the</span>
        <span class="c1"># manager&#39;s `artifacts` attribute is also a property, and we must</span>
        <span class="c1"># access it anew each time to be sure to get the latest contents.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">artifacts</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># These methods enable the Serializer to be used as a context manager:</span>
    <span class="c1">#</span>
    <span class="c1"># with Serializer(...) as serializer:</span>
    <span class="c1">#     ...</span>
    <span class="c1">#</span>
    <span class="c1"># which always calls close() on exit from the with block.</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exception_details</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Each of the methods below corresponds to a document type. As</span>
    <span class="c1"># documents flow in through Serializer.__call__, the DocumentRouter base</span>
    <span class="c1"># class will forward them to the method with the name corresponding to</span>
    <span class="c1"># the document&#39;s type: RunStart documents go to the &#39;start&#39; method,</span>
    <span class="c1"># etc.</span>
    <span class="c1">#</span>
    <span class="c1"># In each of these methods:</span>
    <span class="c1">#</span>
    <span class="c1"># - If needed, obtain a new file/buffer from the manager and stash it</span>
    <span class="c1">#   on instance state (self._files, etc.) if you will need it again</span>
    <span class="c1">#   later. Example:</span>
    <span class="c1">#</span>
    <span class="c1">#   filename = f&#39;{self._templated_file_prefix}-primary.csv&#39;</span>
    <span class="c1">#   file = self._manager.open(&#39;stream_data&#39;, filename, &#39;xt&#39;)</span>
    <span class="c1">#   self._files[&#39;primary&#39;] = file</span>
    <span class="c1">#</span>
    <span class="c1">#   See the manager documentation below for more about the arguments to open().</span>
    <span class="c1">#</span>
    <span class="c1"># - Write data into the file, usually something like:</span>
    <span class="c1">#</span>
    <span class="c1">#   content = my_function(doc)</span>
    <span class="c1">#   file.write(content)</span>
    <span class="c1">#</span>
    <span class="c1">#   or</span>
    <span class="c1">#</span>
    <span class="c1">#   my_function(doc, file)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="c1"># Fill in the file_prefix with the contents of the RunStart document.</span>
        <span class="c1"># As in, &#39;{uid}&#39; -&gt; &#39;c1790369-e4b2-46c7-a294-7abfa239691a&#39;</span>
        <span class="c1"># or &#39;my-data-from-{plan-name}&#39; -&gt; &#39;my-data-from-scan&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_templated_file_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_prefix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">)</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">event_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="c1"># There are other representations of Event data -- &#39;event&#39; and</span>
        <span class="c1"># &#39;bulk_events&#39; (deprecated). But that does not concern us because</span>
        <span class="c1"># DocumentRouter will convert this representations to &#39;event_page&#39;</span>
        <span class="c1"># then route them through here.</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>See the API Documentation below for more information about
<a class="reference internal" href="#event_model.DocumentRouter" title="event_model.DocumentRouter"><code class="xref py py-class docutils literal notranslate"><span class="pre">DocumentRouter</span></code></a> and
<a class="reference internal" href="#suitcase.utils.MultiFileManager" title="suitcase.utils.MultiFileManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiFileManager</span></code></a>.</p>
<p>Any of the existing suitcases may be useful as a reference. We recommend these
in particular:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/NSLS-II/suitcase-csv/blob/master/suitcase/csv/__init__.py">suitcase-csv</a> is a good introductory example.</p></li>
<li><p><a class="reference external" href="https://github.com/NSLS-II/suitcase-jsonl/blob/master/suitcase/jsonl/__init__.py">suitcase-jsonl</a> generates a straightforward, single-file format.</p></li>
<li><p><a class="reference external" href="https://github.com/NSLS-II/suitcase-tiff/blob/master/suitcase/tiff/__init__.py">suitcase-tiff</a> generates many separate binary files.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Why not put the boilerplate code above into a base class, like
<code class="docutils literal notranslate"><span class="pre">BaseSerializer</span></code> and use inheritance?</p>
<p>The amount of boilerplate is not large, and it may be easier to simply copy
it than to cross-reference between a subclass and a base class.
Additionally, the details can vary enough from one <code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code> that
inheritence tends to get messy.</p>
</div>
</div>
<div class="section" id="add-an-export-function">
<h3>Add an export function<a class="headerlink" href="#add-an-export-function" title="Permalink to this headline">¶</a></h3>
<p>This is just a simple wrapper around the <code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code>. It takes a
generator of <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">doc)</span></code> pairs and pushes them through the
<code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">file_prefix</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{uid}</span><span class="s1">-&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Serializer</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">file_prefix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">serializer</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
            <span class="n">serializer</span><span class="p">(</span><span class="o">*</span><span class="n">item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">serializer</span><span class="o">.</span><span class="n">artifacts</span>
</pre></div>
</div>
</div>
<div class="section" id="test-the-serializer">
<h3>Test the Serializer<a class="headerlink" href="#test-the-serializer" title="Permalink to this headline">¶</a></h3>
<p>The suitcase-utils package provides a parametrized pytest fixture,
<code class="docutils literal notranslate"><span class="pre">example_data</span></code> for generating test data. Tests should go in
<code class="docutils literal notranslate"><span class="pre">suitcase/my-special-format/tests/tests.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">suitcase.my_special_format</span> <span class="kn">import</span> <span class="n">export</span><span class="p">,</span> <span class="n">NumpyEncoder</span>


<span class="k">def</span> <span class="nf">test_export</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">example_data</span><span class="p">):</span>
    <span class="c1"># Exercise the exporter on the myriad cases parametrized in example_data.</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>
    <span class="n">artifacts</span> <span class="o">=</span> <span class="n">export</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">)</span>
    <span class="c1"># For extra credit, read back the data</span>
    <span class="c1"># and check that it looks right.</span>
</pre></div>
</div>
<p>Run the tests with pytest:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
</div>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DocumentRouter</span></code> is typically useful as base class for a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code>.</p>
<dl class="py class">
<dt id="event_model.DocumentRouter">
<em class="property">class </em><code class="sig-prename descclassname">event_model.</code><code class="sig-name descname">DocumentRouter</code><a class="reference internal" href="_modules/event_model.html#DocumentRouter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#event_model.DocumentRouter" title="Permalink to this definition">¶</a></dt>
<dd><p>Route each document by type to a corresponding method.</p>
<p>When an instance is called with a document type and a document like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">router</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>the document is passed to the method of the corresponding name, as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">getattr</span><span class="p">(</span><span class="n">router</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>The method is expected to return <code class="docutils literal notranslate"><span class="pre">None</span></code> or a valid document of the same
type. It may be the original instance (passed through), a copy, or a
different dict altogether.</p>
<p>Finally, the call to <code class="docutils literal notranslate"><span class="pre">router(name,</span> <span class="pre">doc)</span></code> returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">router</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span><span class="n">doc</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<p>There are “manager” classes for files and memory buffers. The user may provide
their own manager class implementing a different transport mechanism. It need
only implement these same methods.</p>
<dl class="py class">
<dt id="suitcase.utils.MultiFileManager">
<em class="property">class </em><code class="sig-prename descclassname">suitcase.utils.</code><code class="sig-name descname">MultiFileManager</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">directory</span></em>, <em class="sig-param"><span class="n">allowed_modes</span><span class="o">=</span><span class="default_value">'x', 'xt', 'xb'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MultiFileManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MultiFileManager" title="Permalink to this definition">¶</a></dt>
<dd><p>A class that manages multiple files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>directory</strong><span class="classifier">str or Path</span></dt><dd><p>The directory (as a string or as a Path) to create teh files inside.</p>
</dd>
<dt><strong>allowed_modes</strong><span class="classifier">Iterable</span></dt><dd><p>Modes accepted by <code class="docutils literal notranslate"><span class="pre">MultiFileManager.open</span></code>. By default this is
retricted to “exclusive creation” modes (‘x’, ‘xt’, ‘xb’) which raise
an error if the file already exists. This choice of defaults is meant
to protect the user for unintentionally overwriting old files. In
situations where overwrite (‘w’, ‘wb’) or append (‘a’, ‘r+b’) are
needed, they can be added here.</p>
</dd>
<dt><strong>This design is inspired by Python’s zipfile and tarfile libraries.</strong></dt><dd></dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt id="suitcase.utils.MultiFileManager.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MultiFileManager.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MultiFileManager.close" title="Permalink to this definition">¶</a></dt>
<dd><p>close all files opened by the manager</p>
</dd></dl>

<dl class="py method">
<dt id="suitcase.utils.MultiFileManager.open">
<code class="sig-name descname">open</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">postfix</span></em>, <em class="sig-param"><span class="n">mode</span></em>, <em class="sig-param"><span class="n">encoding</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">errors</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MultiFileManager.open"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MultiFileManager.open" title="Permalink to this definition">¶</a></dt>
<dd><p>Request a file handle.</p>
<p>Like the built-in open function, this may be used as a context manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>label</strong><span class="classifier">string</span></dt><dd><p>A label for the sort of content being stored, such as
‘stream_data’ or ‘metadata’.</p>
</dd>
<dt><strong>postfix</strong><span class="classifier">string</span></dt><dd><p>Postfix for the file name. Must be unique for this Manager.</p>
</dd>
<dt><strong>mode</strong><span class="classifier">string</span></dt><dd><p>One of the <code class="docutils literal notranslate"><span class="pre">allowed_modes</span></code> set in __init__``. Default set of
options is <code class="docutils literal notranslate"><span class="pre">{'x',</span> <span class="pre">'xt',</span> <span class="pre">xb'}</span></code> — ‘x’ or ‘xt’ for text, ‘xb’ for
binary.</p>
</dd>
<dt><strong>encoding</strong><span class="classifier">string or None</span></dt><dd><p>Passed through open. See Python open documentation for allowed
values. Only applicable to text mode.</p>
</dd>
<dt><strong>errors</strong><span class="classifier">string or None</span></dt><dd><p>Passed through to open. See Python open documentation for allowed
values.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>file</strong><span class="classifier">handle</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="suitcase.utils.MultiFileManager.reserve_name">
<code class="sig-name descname">reserve_name</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">postfix</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MultiFileManager.reserve_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MultiFileManager.reserve_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Ask the wrapper for a filepath.</p>
<p>An external library that needs a filepath (not a handle)
may use this instead of the <code class="docutils literal notranslate"><span class="pre">open</span></code> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>label</strong><span class="classifier">string</span></dt><dd><p>A label for the sort of content being stored, such as
‘stream_data’ or ‘metadata’.</p>
</dd>
<dt><strong>postfix</strong><span class="classifier">string</span></dt><dd><p>Postfix for the file name. Must be unique for this Manager.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>name</strong><span class="classifier">Path</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="suitcase.utils.MemoryBuffersManager">
<em class="property">class </em><code class="sig-prename descclassname">suitcase.utils.</code><code class="sig-name descname">MemoryBuffersManager</code><a class="reference internal" href="_modules/suitcase/utils.html#MemoryBuffersManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MemoryBuffersManager" title="Permalink to this definition">¶</a></dt>
<dd><p>A class that manages multiple StringIO and/or BytesIO instances.</p>
<p>This design is inspired by Python’s zipfile and tarfile libraries.</p>
<p>This has a special buffers attribute which can be used to retrieve
buffers created.</p>
<dl class="py method">
<dt id="suitcase.utils.MemoryBuffersManager.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MemoryBuffersManager.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MemoryBuffersManager.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close all buffers opened by the manager.</p>
</dd></dl>

<dl class="py method">
<dt id="suitcase.utils.MemoryBuffersManager.open">
<code class="sig-name descname">open</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">postfix</span></em>, <em class="sig-param"><span class="n">mode</span></em>, <em class="sig-param"><span class="n">encoding</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">errors</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MemoryBuffersManager.open"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MemoryBuffersManager.open" title="Permalink to this definition">¶</a></dt>
<dd><p>Request a file handle.</p>
<p>Like the built-in open function, this may be used as a context manager.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>label</strong><span class="classifier">string</span></dt><dd><p>A label for the sort of content being stored, such as
‘stream_data’ or ‘metadata’.</p>
</dd>
<dt><strong>postfix</strong><span class="classifier">string</span></dt><dd><p>Relative file path (simply used as an identifer in this case, as
there is no actual file). Must be unique for this Manager.</p>
</dd>
<dt><strong>mode</strong><span class="classifier">{‘x’, ‘xt’, xb’}</span></dt><dd><p>‘x’ or ‘xt’ for text, ‘xb’ for binary</p>
</dd>
<dt><strong>encoding</strong><span class="classifier">string or None</span></dt><dd><p>Not used. Accepted for compatibility with built-in open().</p>
</dd>
<dt><strong>errors</strong><span class="classifier">string or None</span></dt><dd><p>Not used. Accepted for compatibility with built-in open().</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>file</strong><span class="classifier">handle</span></dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="suitcase.utils.MemoryBuffersManager.reserve_name">
<code class="sig-name descname">reserve_name</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">label</span></em>, <em class="sig-param"><span class="n">postfix</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#MemoryBuffersManager.reserve_name"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.MemoryBuffersManager.reserve_name" title="Permalink to this definition">¶</a></dt>
<dd><p>This action is not valid on this manager. It will always raise.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>label</strong><span class="classifier">string</span></dt><dd><p>A label for the sort of content being stored, such as
‘stream_data’ or ‘metadata’.</p>
</dd>
<dt><strong>postfix</strong><span class="classifier">string</span></dt><dd><p>Relative file path. Must be unique for this Manager.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><dl class="simple">
<dt>SuitcaseUtilsTypeError</dt><dd></dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>These classes are used by the <a class="reference internal" href="#suitcase.utils.MemoryBuffersManager" title="suitcase.utils.MemoryBuffersManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemoryBuffersManager</span></code></a>.</p>
<dl class="py class">
<dt id="suitcase.utils.PersistentStringIO">
<em class="property">class </em><code class="sig-prename descclassname">suitcase.utils.</code><code class="sig-name descname">PersistentStringIO</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">initial_value</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">newline</span><span class="o">=</span><span class="default_value">'\n'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#PersistentStringIO"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.PersistentStringIO" title="Permalink to this definition">¶</a></dt>
<dd><p>A StringIO that does not clear the buffer when closed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This StringIO subclass behaves like StringIO except that its
close() method, which would normally clear the buffer, has no
effect. The clear() method, however, may still be used.</p>
</div>
<dl class="py method">
<dt id="suitcase.utils.PersistentStringIO.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#PersistentStringIO.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.PersistentStringIO.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the IO object.</p>
<p>Attempting any further operation after the object is closed
will raise a ValueError.</p>
<p>This method has no effect if the file is already closed.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="suitcase.utils.PersistentBytesIO">
<em class="property">class </em><code class="sig-prename descclassname">suitcase.utils.</code><code class="sig-name descname">PersistentBytesIO</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">initial_bytes</span><span class="o">=</span><span class="default_value">b''</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#PersistentBytesIO"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.PersistentBytesIO" title="Permalink to this definition">¶</a></dt>
<dd><p>A BytesIO that does not clear the buffer when closed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This BytesIO subclass behaves like BytesIO except that its
close() method, which would normally clear the buffer, has no
effect. The clear() method, however, may still be used.</p>
</div>
<dl class="py method">
<dt id="suitcase.utils.PersistentBytesIO.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/suitcase/utils.html#PersistentBytesIO.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#suitcase.utils.PersistentBytesIO.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable all I/O operations.</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="formats.html" class="btn btn-neutral float-left" title="Supported Formats and Layouts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Brookhaven National Lab

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Release History &mdash; caproto 0.4.2+31.ga604bf2.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="References" href="references.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> caproto
          

          
          </a>

          
            
            
              <div class="version">
                0.4.2+31.ga604bf2.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">EPICS Clients and Servers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="clients.html">Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mock-records.html">Mock Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/caproto/bench/#/">Performance Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#unreleased">Unreleased</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-4-2-2019-11-13">v0.4.2 (2019-11-13)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bug-fixes">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-4-1-2019-10-06">v0.4.1 (2019-10-06)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-4-0-2019-06-06">v0.4.0 (2019-06-06)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-4-2019-05-02">v0.3.4 (2019-05-02)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fixes">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-3-2019-04-11">v0.3.3 (2019-04-11)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-2-2019-03-06">v0.3.2 (2019-03-06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-1-2019-03-05">v0.3.1 (2019-03-05)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-3-0-2019-02-20">v0.3.0 (2019-02-20)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Bug Fixes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-2-3-2019-01-02">v0.2.3 (2019-01-02)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usability-improvements">Usability Improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updated-pyepics-compatibility">Updated Pyepics Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deprecations">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-changes">Internal Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-2-2-2018-11-15">v0.2.2 (2018-11-15)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#more-control-over-search">More Control Over Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improved-alarm-support">Improved Alarm Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bug-fixes-and-performance-improvements">Bug Fixes and Performance Improvements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-2-1-2018-10-29">v0.2.1 (2018-10-29)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-performance-tuning">Server Performance Tuning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-2-0-2018-10-17">v0.2.0 (2018-10-17)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#breaking-changes">Breaking Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Bug Fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improved-protocol-compliance">Improved Protocol Compliance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#v0-1-2-2018-08-31">v0.1.2 (2018-08-31)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-1-1-2018-06-17">v0.1.1 (2018-06-17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#v0-1-0-2018-06-14">v0.1.0 (2018-06-14)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Release History</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/release-notes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="release-history">
<h1>Release History<a class="headerlink" href="#release-history" title="Permalink to this headline">¶</a></h1>
<div class="section" id="unreleased">
<h2>Unreleased<a class="headerlink" href="#unreleased" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">In the threading client, the expected signature of Subscription callbacks has
changed from <code class="docutils literal notranslate"><span class="pre">f(response)</span></code> to <code class="docutils literal notranslate"><span class="pre">f(sub,</span> <span class="pre">response)</span></code> where <code class="docutils literal notranslate"><span class="pre">sub</span></code> is the
pertinent <a class="reference internal" href="threading-client.html#caproto.threading.client.Subscription" title="caproto.threading.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">caproto.threading.client.Subscription</span></code></a>.
This change has been made in a backward-compatible way. Callbacks with the
old signature, <code class="docutils literal notranslate"><span class="pre">f(response)</span></code>, will still work but caproto will issue a
warning. Support for the old signature may be removed in the future.
By giving the callback <code class="docutils literal notranslate"><span class="pre">f</span></code> access to <code class="docutils literal notranslate"><span class="pre">sub</span></code>, we enable usages like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="c1"># Print the name of the pertinent PV.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received response from&#39;</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="o">...</span><span class="p">:</span>
        <span class="n">sub</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">The detail and formatting of the log messages has been improved.</p>
</li>
</ul>
</div>
<div class="section" id="v0-4-2-2019-11-13">
<h2>v0.4.2 (2019-11-13)<a class="headerlink" href="#v0-4-2-2019-11-13" title="Permalink to this headline">¶</a></h2>
<p>This release contains some important bug fixes and some minor new features.</p>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the default timeout for the threading client configurable via the
environment variable <code class="docutils literal notranslate"><span class="pre">CAPROTO_DEFAULT_TIMEOUT</span></code>. It was previously
hard-coded to <code class="docutils literal notranslate"><span class="pre">2</span></code> (seconds).</li>
<li>Add <code class="docutils literal notranslate"><span class="pre">--file</span></code> argument to <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code>, which obtains the value to be put
from reading a file.</li>
<li>Link ZNAM and ONAM fields to the parent enum_strings.</li>
<li>Automatically populate <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code> DESC using doc keyword argument.</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h3>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix a critical race condition wherein data could be written into a buffer as
it was being sent.</li>
<li>Propagate timeout specific to pyepics-compatible client to the next layer
down.</li>
<li>Correctly handle reconnection if the server dies.</li>
<li>Allow asyncio server to do cleanup in all cases. (Previously,
<code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code> was erroneously exempted from cleanup.)</li>
<li>Let the server’s <code class="docutils literal notranslate"><span class="pre">write</span></code> method provide the timestamp. This is significant
if the putter takes significant time to process or does any internal writes.</li>
</ul>
</div>
</div>
<div class="section" id="v0-4-1-2019-10-06">
<h2>v0.4.1 (2019-10-06)<a class="headerlink" href="#v0-4-1-2019-10-06" title="Permalink to this headline">¶</a></h2>
<p>This release adds some small improvements and updates to address deprecations
in Python and caproto’s optional dependencies.</p>
<div class="section" id="id1">
<h3>Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Added support for <code class="docutils literal notranslate"><span class="pre">-S</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code> commandline tool.</li>
<li>Added support for using <code class="docutils literal notranslate"><span class="pre">Event</span></code> synchronization primitives in servers, used
in the new example <code class="docutils literal notranslate"><span class="pre">caproto.ioc_examples.worker_thread_pc</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="v0-4-0-2019-06-06">
<h2>v0.4.0 (2019-06-06)<a class="headerlink" href="#v0-4-0-2019-06-06" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Rewrite approach to logging. See <a class="reference internal" href="loggers.html"><span class="doc">Logging</span></a> for details.</li>
<li>Add precision to motor_ph in mini_beamline example IOC.</li>
</ul>
</div>
<div class="section" id="id3">
<h3>Bug Fixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix bug in <cite>scan_rate</cite> that raised errors when it was written to</li>
<li>Respond correctly when channel filter is set but empty.</li>
</ul>
</div>
</div>
<div class="section" id="v0-3-4-2019-05-02">
<h2>v0.3.4 (2019-05-02)<a class="headerlink" href="#v0-3-4-2019-05-02" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fixes">
<h3>Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Several fixes and documentation for the commandline utilities’ formatting
parameters added in v0.3.3.</li>
<li>Put an upper limit on how quickly a given search result may be reissued.</li>
<li>Documentation fix in server help string.</li>
</ul>
</div>
</div>
<div class="section" id="v0-3-3-2019-04-11">
<h2>v0.3.3 (2019-04-11)<a class="headerlink" href="#v0-3-3-2019-04-11" title="Permalink to this headline">¶</a></h2>
<p>This release improves the commandline utilities’ parity to their counterparts
in the reference implementation by supporting formatting parameters for
integers and floats. It also includes some important fixes.</p>
<div class="section" id="id4">
<h3>Fixes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When optional dependency <code class="docutils literal notranslate"><span class="pre">netifaces</span></code> is installed, clients search on all
broadcast interfaces, not just <code class="docutils literal notranslate"><span class="pre">255.255.255.255</span></code>. This reverts an erroneous
change made in v0.2.3.</li>
<li><code class="docutils literal notranslate"><span class="pre">caproto-shark</span></code> does a better job ignoring non-CA packets (instead of
erroring out).</li>
</ul>
</div>
</div>
<div class="section" id="v0-3-2-2019-03-06">
<h2>v0.3.2 (2019-03-06)<a class="headerlink" href="#v0-3-2-2019-03-06" title="Permalink to this headline">¶</a></h2>
<p>This release inclues just one minor fix to <a class="reference internal" href="shark.html"><span class="doc">caproto-shark</span></a>,
enabling it to more reliably skip over irrelevant network traffic (i.e. traffic
that is not Channel Access messages).</p>
</div>
<div class="section" id="v0-3-1-2019-03-05">
<h2>v0.3.1 (2019-03-05)<a class="headerlink" href="#v0-3-1-2019-03-05" title="Permalink to this headline">¶</a></h2>
<p>This is a bug-fix release addressing issues related to empty (zero-length)
channel data.</p>
<div class="section" id="id5">
<h3>Fixes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix servers’ support for empty (zero-length) data.</li>
<li>Assume the <em>maximum</em> length of a channel initialized with empty data is one
(i.e. assume it is scalar).</li>
<li>Address an ambiguity in the Channel Access protocol: a subscription update
(<code class="docutils literal notranslate"><span class="pre">EventAddResponse</span></code>) indicating empty data and a confirmation of a request
to cancel the subscription (<code class="docutils literal notranslate"><span class="pre">EventCancelResponse</span></code>) serialize identically,
and so the client must make a best effort to interpret based on context which
of the two is intended.</li>
</ul>
</div>
</div>
<div class="section" id="v0-3-0-2019-02-20">
<h2>v0.3.0 (2019-02-20)<a class="headerlink" href="#v0-3-0-2019-02-20" title="Permalink to this headline">¶</a></h2>
<p>This release introduces <a class="reference internal" href="shark.html"><span class="doc">caproto-shark</span></a> and other convenient
improvements. It also contains many bug-fixes, some critical.</p>
<div class="section" id="id6">
<h3>Features<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <a class="reference internal" href="shark.html"><span class="doc">Shark (pcap/tcpdump parsing)</span></a>.</li>
<li>Add server “healthcheck” methods to the threading client, which expose
information collected about how recently each server has communicated with
the client. See <a class="reference internal" href="threading-client.html#server-health-check"><span class="std std-ref">Server Health Check</span></a>.</li>
<li>Add a new example IOC who PVs are dynamic (change during runtime). Include a
“waveform” (array) PV in the simple example.</li>
<li>Make the default timeout configurable per Context and per PV, in addition to
per a given operation. This makes it possible to adjust all the timeouts in
one place during debugging.</li>
<li>Use a random starting ID for message identifiers as an extra layer of
protections against collisions, especially in the context of CI testing where
many clients and servers are started up in rapid succession.</li>
</ul>
</div>
<div class="section" id="id7">
<h3>Bug Fixes<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only attempt to use <code class="docutils literal notranslate"><span class="pre">SO_REUSEPORT</span></code> socket option if support for it has been
compiled into Python.</li>
<li>A critical bug only affecting Windows had broken asyncio servers on Windows
in a previous release.</li>
<li>The threading client was wrongly issuing warnings if it received multiple
responses to a search for a PV from <em>the same server</em>.</li>
<li>Add missing user_offset pvproperty to MotorFields.</li>
<li>Fix several race conditions in the threading client.</li>
<li>Improve cleanup of resources: ensure sockets are explicitly closed and
threads explicitly joined. (More work is needed, but progress was made.)</li>
<li>Fix “leak” of ioids (IO message identifiers).</li>
<li>Handle setting empty lists as values through the pyepics-compat client.</li>
<li>In the trio-backed server, remove usage of deprecated <code class="docutils literal notranslate"><span class="pre">trio.Queue</span></code>.</li>
<li>Many other small fixes and safeguards.</li>
</ul>
</div>
</div>
<div class="section" id="v0-2-3-2019-01-02">
<h2>v0.2.3 (2019-01-02)<a class="headerlink" href="#v0-2-3-2019-01-02" title="Permalink to this headline">¶</a></h2>
<div class="section" id="usability-improvements">
<h3>Usability Improvements<a class="headerlink" href="#usability-improvements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A new function <code class="xref py py-func docutils literal notranslate"><span class="pre">set_handler()</span></code> provides a convenient way to make
common customizations to caproto’s default logging handler, such as writing
to a file instead of the stdout.</li>
<li>In the threading client, store the current access rights level on the PV
object as <code class="docutils literal notranslate"><span class="pre">pv.access_rights</span></code>. It was previously only accessible when it
<em>changed</em>, via a callback, and had to be stashed/tracked by user code.</li>
<li>Display the version of caproto in the output of <code class="docutils literal notranslate"><span class="pre">--help</span></code>/<code class="docutils literal notranslate"><span class="pre">-h</span></code> in the
commandline utilities. Add a new commandline argument <code class="docutils literal notranslate"><span class="pre">--version</span></code>/<code class="docutils literal notranslate"><span class="pre">-V</span></code>
that outputs the version and exits.</li>
<li>In the threading client, DEBUG-log <em>all</em> read/write requests and
read/write/event responses. (When these log messages were first introduced in
v0.2.1, batched requests and their responses were not logged, and write
responses were not logged when <code class="docutils literal notranslate"><span class="pre">notify=True</span></code> but <code class="docutils literal notranslate"><span class="pre">wait=False</span></code>.)</li>
</ul>
</div>
<div class="section" id="id8">
<h3>Bug Fixes<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix critical bug in synchronous client that broke monitoring of multiple PVs.</li>
<li>Fix default (“AUTO”) broadcast address list (should always be
<code class="docutils literal notranslate"><span class="pre">255.255.255.255</span></code>). Removed internal utility function
<code class="xref py py-func docutils literal notranslate"><span class="pre">broadcast_address_list_from_interfaces()</span></code>.</li>
<li>In pyepics-compatible client, set default mask to
<code class="docutils literal notranslate"><span class="pre">SubscriptionType.DBE_VALUE</span> <span class="pre">|</span> <span class="pre">SubscriptionType.DBE_ALARM</span></code>, consistent with
pyepics.</li>
<li>Prevent subscriptions for being processed for all channels that share an
alarm if the alarm state has not actually changed.</li>
</ul>
</div>
<div class="section" id="updated-pyepics-compatibility">
<h3>Updated Pyepics Compatibility<a class="headerlink" href="#updated-pyepics-compatibility" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Added new method <code class="docutils literal notranslate"><span class="pre">PV.get_with_metadata</span></code>, which was added in pyepics 3.3.1.</li>
</ul>
</div>
<div class="section" id="deprecations">
<h3>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The <code class="xref py py-func docutils literal notranslate"><span class="pre">color_logs()</span></code> convenience function has been deprecated in
favor of <code class="xref py py-func docutils literal notranslate"><span class="pre">set_handler()</span></code>.</li>
</ul>
</div>
<div class="section" id="internal-changes">
<h3>Internal Changes<a class="headerlink" href="#internal-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Enable <code class="docutils literal notranslate"><span class="pre">-vvv</span></code> (“very verbose”) option when running example IOCs in test
suite.</li>
</ul>
</div>
</div>
<div class="section" id="v0-2-2-2018-11-15">
<h2>v0.2.2 (2018-11-15)<a class="headerlink" href="#v0-2-2-2018-11-15" title="Permalink to this headline">¶</a></h2>
<p>The release improves the performance of the threading client and adds support
for value-based alarms. Additionally, it provides more control over search and
implements back-off in a way more consistent with (but not yet fully consistent
with) EPICS’ reference implementation.</p>
<div class="section" id="more-control-over-search">
<h3>More Control Over Search<a class="headerlink" href="#more-control-over-search" title="Permalink to this headline">¶</a></h3>
<p>The threading client—and, thereby, the pyepics-compatible shim—have
greater feature parity with epics-base.</p>
<ul class="simple">
<li>In previous releases, the client resent any unanswered <code class="docutils literal notranslate"><span class="pre">SearchRequests</span></code> at
a fast regular rate forever. Now, it backs off from that initial rate and
rests at a slow interval to avoid creating too much wasteful network traffic.
There is a new method,
<a class="reference internal" href="threading-client.html#caproto.threading.client.SharedBroadcaster.cancel" title="caproto.threading.client.SharedBroadcaster.cancel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cancel()</span></code></a>, for manually
canceling some requests altogether if a response is never expected (e.g. a
typo). There is also a new method for manually resending all unanswered
search requests,
<a class="reference internal" href="threading-client.html#caproto.threading.client.SharedBroadcaster.search_now" title="caproto.threading.client.SharedBroadcaster.search_now"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search_now()</span></code></a>,
primarily for debugging. All unanswered search requests are automatically
resent when the user searches for a new PV or when a new server appears on
the network (see next point).</li>
<li>The client monitors server beacons to notice changes in the CA servers on the
network. When a new server appears, all standing unanswered search requests
are given a fresh start and immediately resent. If a server does not send a
beacon within the expected interval and has also not sent any TCP packets
related to user activity during that interval, the client silently initiates
an Echo. If the server still does not respond, it is deemed unresponsive. The
client logs a warning and disconnects all circuits from that server so that
their PVs can begin attempting to reconnect to a responsive server.</li>
</ul>
</div>
<div class="section" id="improved-alarm-support">
<h3>Improved Alarm Support<a class="headerlink" href="#improved-alarm-support" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Value-based alarms are supported by all servers.</li>
<li>LOLO, LO, HI, and HIHI alarm status fields of mocked records are respected.</li>
<li>Channel limit metadata (upper_alarm_limit, upper_warning_limit, etc.) is now
integrated with alarms.</li>
</ul>
</div>
<div class="section" id="bug-fixes-and-performance-improvements">
<h3>Bug Fixes and Performance Improvements<a class="headerlink" href="#bug-fixes-and-performance-improvements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The socket settings <code class="docutils literal notranslate"><span class="pre">SO_KEEPALIVE</span></code> and <code class="docutils literal notranslate"><span class="pre">TCP_NODELAY</span></code> are used in the
threading client TCP sockets, making it consistent with epics-base and removing a 40ms
overhead that can occur when sending small packets.</li>
<li>Some unnecessary locking was removed from the threading client, resolving
a deadlock observed in ophyd and improving performance.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">spoof_beamline</span></code> IOC is aware of more components of Area Detector and
defaults to float-type channels instead of integer-type.</li>
<li>A rare but possible race condition that caused a subscription to be activated
twice (thus getting two responses for each update) has been resolved.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">ChannelData</span></code> objects are serializable with pickle.</li>
<li>A bug in length-checking that affected zero-length data has been fixed.</li>
</ul>
<p>The detail and consistency of the exceptions raised by the clients has also
been improved.</p>
</div>
</div>
<div class="section" id="v0-2-1-2018-10-29">
<h2>v0.2.1 (2018-10-29)<a class="headerlink" href="#v0-2-1-2018-10-29" title="Permalink to this headline">¶</a></h2>
<p>This release tunes server performance under high load and fixes several subtle
bugs in the server identified via
<a class="reference external" href="https://epics.anl.gov/base/R3-16/2-docs/CAref.html#acctst">acctst</a>,
the server acceptance test that ships with <code class="docutils literal notranslate"><span class="pre">epics-base</span></code>.</p>
<div class="section" id="id9">
<h3>Bug Fixes<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>When a new Subscription is added, send the most recent value immediately but
only to the <em>new</em> Subscription. Previous releases sent redundant messages
to <em>all</em> Subscriptions that had similar parameters.</li>
<li>Reduce the maximum size of a datagram of search requests to match the typical
Maximum Transmission Unit seen in the wild.</li>
<li>Fix a bug in the pyepics-compatibility layer that caused the connection
callbacks never to be called when underlying <code class="docutils literal notranslate"><span class="pre">caproto.threading.client.PV</span></code>’s were reused.</li>
<li>Fix a typo in the PV names in the <code class="docutils literal notranslate"><span class="pre">spoof_beamline</span></code> IOC.</li>
<li>Never send an <code class="docutils literal notranslate"><span class="pre">EventAddResponse</span></code> after a matching <code class="docutils literal notranslate"><span class="pre">EventCancelResponse</span></code>
has been sent.</li>
<li>Always send a response to a failed write, and include the correct error code.</li>
<li>If a circuit has an oversized backlog of received commands to process, log a
WARNING before disconnecting.</li>
</ul>
</div>
<div class="section" id="server-performance-tuning">
<h3>Server Performance Tuning<a class="headerlink" href="#server-performance-tuning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Increase the max backlog of subscription updates queued up to send (both
updates per specific Subscription and total updates per circuit) by a factor
of 10. Likewise for the max backlog of received commands queued up to
process.</li>
<li>When under sustained high load of subscription updates to send, iteratively
double the latency between packets up to at most 1 second to achieve higher
overall throughput (more commands per packet, less overhead).</li>
<li>When a <code class="docutils literal notranslate"><span class="pre">Read[Notify]Request</span></code> arrives on the heels of a
<code class="docutils literal notranslate"><span class="pre">Write[Notify]Request</span></code>, wait for up to 0.001 seconds for the write to
process before reading the current value. If the write happens to complete
in less than 0.001 seconds, the read will reflect the new value. This
behavior is in the spirit of, but distinct from, EPICS’ “synchronous writes.”
EPICS allows a device to block while writing if it promises to finish quickly
(&lt; 0.1 milliseconds). We take a different approach, making all writes
asynchronous. This ensures that an accidentally-slow write cannot lock up the
server. It adds latency to some reads, up to a hard maximum of 1 millisecond,
giving the effect of synchronous write whenever the write finishes fast.</li>
</ul>
<p>The release also includes one small new feature: in the threading client,
DEBUG-level logging of channels/PVs <code class="docutils literal notranslate"><span class="pre">caproto.ch</span></code> now logs (non-batch)
read/write requests and read/write/event responses. [Update: In v0.2.3,
this feature was extended to include batched requests and their responses.]
Related — there is expanded documentation on <a class="reference internal" href="loggers.html"><span class="doc">Logging</span></a>.</p>
</div>
</div>
<div class="section" id="v0-2-0-2018-10-17">
<h2>v0.2.0 (2018-10-17)<a class="headerlink" href="#v0-2-0-2018-10-17" title="Permalink to this headline">¶</a></h2>
<p>This release improves compliance with the protocol and server performance under
high load.</p>
<div class="section" id="id10">
<h3>Features<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Under high load (with many subscription updates queued up to send) servers
batch subscriptions into blocks, trading a little latency for efficiency.
Under low load, servers prioritize low latency.</li>
<li>The servers’ medium-verbose setting (<code class="docutils literal notranslate"><span class="pre">-v</span></code>) displays current load and
latency.</li>
<li>In the threading client, process user callbacks using one threadpool <em>per
circuit</em> instead of one threadpool for the entire context. Make the size of
the threadpool configurable via a new
<a class="reference internal" href="threading-client.html#caproto.threading.client.Context" title="caproto.threading.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> parameter, <code class="docutils literal notranslate"><span class="pre">max_workers</span></code>.</li>
<li>We now test the servers against a
<a class="reference external" href="https://github.com/klauer/catvs/tree/py3k">Python 3-compatible fork</a> of
Michael Davidsaver’s utility for testing Channel Access servers,
<a class="reference external" href="https://github.com/mdavidsaver/catvs">catvs</a>. This has generated several
fixes improving protocol compliance, list a section below. There are a small
number of known failures wherein the best/correct behavior is arguable; see
<a class="reference external" href="https://github.com/caproto/caproto/pull/327">caproto#327 on GitHub</a> for
discussion. There may be more progress on these in future releases of
caproto.</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">pvproperty.scan</span></code>. See
the <a class="reference external" href="https://github.com/caproto/caproto/blob/master/caproto/ioc_examples/mini_beamline.py">mini_beamline example IOC</a>
for a usage example.</li>
<li>Add a server-side data source for <code class="docutils literal notranslate"><span class="pre">ChannelType.INT</span></code> (a.k.a SHORT) data.</li>
<li>The default printed output of the <code class="docutils literal notranslate"><span class="pre">caproto-monitor</span></code> CLI utility now
includes microseconds.</li>
<li>There are several new <a class="reference external" href="https://github.com/caproto/caproto/tree/master/caproto/ioc_examples">IOC examples</a>.</li>
</ul>
</div>
<div class="section" id="breaking-changes">
<h3>Breaking Changes<a class="headerlink" href="#breaking-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The expected signature of the <code class="docutils literal notranslate"><span class="pre">access_rights_callback</span></code> passed to
<a class="reference internal" href="threading-client.html#caproto.threading.client.Context" title="caproto.threading.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> has been changed from
<code class="docutils literal notranslate"><span class="pre">f(access_rights)</span></code> to <code class="docutils literal notranslate"><span class="pre">f(pv,</span> <span class="pre">access_rights)</span></code>. This makes it consistent
with the <code class="docutils literal notranslate"><span class="pre">connection_callback</span></code>.</li>
<li>If a beacon fails to send, do not kill the server; just log the failure,
along with a suggestion on how to fix the environment to omit the failed
address, and continue to run.</li>
<li>In the high-level server, implemented with <code class="docutils literal notranslate"><span class="pre">pvproperty</span></code>, PV values can be
defined as scalars. The accessor <code class="docutils literal notranslate"><span class="pre">pvproperty.value</span></code> now returns a scalar
instead of a length-1 list (API break), while <code class="docutils literal notranslate"><span class="pre">write()</span></code> accepts either list
or scalar.</li>
</ul>
</div>
<div class="section" id="id11">
<h3>Bug Fixes<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>A critical bug CHAR-type payload serialization which made caproto clients
unusable with CHAR-type channels has been fixed.</li>
<li>The asyncio server now executes its cleanup code when interrupted with SIGINT
(Ctrl+C).</li>
<li>All three servers were relying on the operating system to clean up their
sockets when the process exited. They now close their sockets explicitly when
the server task exits. This fixes the runaway usage of file descriptors when
the tests are run.</li>
</ul>
</div>
<div class="section" id="improved-protocol-compliance">
<h3>Improved Protocol Compliance<a class="headerlink" href="#improved-protocol-compliance" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The servers send <a class="reference internal" href="api.html#caproto.CreateChFailResponse" title="caproto.CreateChFailResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">CreateChFailResponse</span></code></a> when the client
requests a channel name that does not exist on the server. They previously
did not respond.</li>
<li>The servers reply to <a class="reference internal" href="api.html#caproto.SearchRequest" title="caproto.SearchRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">SearchRequest</span></code></a> messages sent over TCP.
(UDP is more common, but TCP is allowed.) They previously did not respond.</li>
<li>The <a class="reference internal" href="api.html#caproto.EventCancelResponse" title="caproto.EventCancelResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventCancelResponse</span></code></a> message includes a <code class="docutils literal notranslate"><span class="pre">data_count</span></code>.</li>
<li>The servers respect the <code class="docutils literal notranslate"><span class="pre">data_count</span></code> requested by the client.</li>
<li>Servers enforce quota per subscription to avoid one prolific subscription (or
slow client) from drowning out others.</li>
<li>Servers respect <code class="docutils literal notranslate"><span class="pre">EventsOn</span></code> and <code class="docutils literal notranslate"><span class="pre">EventsOff</span></code> requests.</li>
<li>Servers differentiate between <em>current</em> length and <em>maximum</em> length of an
array, and they properly declare the <em>maximum</em> length in
<code class="xref py py-class docutils literal notranslate"><span class="pre">CreateChanResponse</span></code>. They formerly declared the <em>current</em>
length, which was not correct.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code> commandline utility now supports <code class="docutils literal notranslate"><span class="pre">-a</span></code> for arrays.</li>
</ul>
</div>
</div>
<div class="section" id="v0-1-2-2018-08-31">
<h2>v0.1.2 (2018-08-31)<a class="headerlink" href="#v0-1-2-2018-08-31" title="Permalink to this headline">¶</a></h2>
<p>This is a bug-fix release fixing some critical bugs. We recommend that all
users upgrade.</p>
<ul class="simple">
<li>Fix critical typo in threading client’s search functionality that could cause
it to conflate addresses from different search responses and then attempt to
connect to the wrong server.</li>
<li>Fix handshake with servers and clients speaking Version 11 (or older) of the
protocol.</li>
</ul>
</div>
<div class="section" id="v0-1-1-2018-06-17">
<h2>v0.1.1 (2018-06-17)<a class="headerlink" href="#v0-1-1-2018-06-17" title="Permalink to this headline">¶</a></h2>
<p>This is a bug-fix release following closely on the initial release. We
recommend that all users update.</p>
<ul class="simple">
<li>Fix straightforward but important bug in the synchronous client that broke
monitoring of multiple channels concurrently.</li>
<li>In servers, abide by the spec’s recommendation that beacons should be issued
quickly at startup before backing off to a slower, steady rate.</li>
<li>Fix a bug that broke the array (“arr”) channel filter if numpy was not
installed.</li>
<li>Add a new section to the documentation detailing caproto’s compliance with
the Channel Access protocol and the feature parity of caproto’s clients and
servers with respect to the reference implementations in epics-base.</li>
</ul>
</div>
<div class="section" id="v0-1-0-2018-06-14">
<h2>v0.1.0 (2018-06-14)<a class="headerlink" href="#v0-1-0-2018-06-14" title="Permalink to this headline">¶</a></h2>
<p>This initial release contains some fairly stable components and some very
experimental ones.</p>
<ul class="simple">
<li>The core protocol code, the synchronous client, the threading client, and the
pyepics-compatible client are fairly stable.</li>
<li>The high-level interface to IOCs has no known issues but could in a future
release of caproto, as we gain experience from its use.</li>
<li>The three server implementations are thoroughly tested, but their low level
API is likely to change in a future release.</li>
<li>The asynchronous client implementations (trio client and curio client) are
highly experimental. They lack feature-parity with the other clients and have
some known bugs. They may be heavily revised or removed in a future release
of caproto.</li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="references.html" class="btn btn-neutral float-left" title="References" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Daniel Allan

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Input-Output Controllers (IOCs) &mdash; caproto 0.5.2+68.g79425a8.dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Records" href="records.html" />
    <link rel="prev" title="Asynchronous Clients" href="async-clients.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> caproto
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2+68.g79425a8.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">EPICS Clients and Servers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="clients.html">Clients</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Input-Output Controllers (IOCs)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-write-an-ioc-using-caproto">Why Write an IOC Using Caproto?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-ioc-examples">Using the IOC Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-ioc">Simple IOC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-to-a-file-when-a-pv-is-written-to">Write to a File When a PV is Written To</a></li>
<li class="toctree-l3"><a class="reference internal" href="#random-walk">Random Walk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#i-o-interrupt">I/O Interrupt</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macros-for-pv-names">Macros for PV names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subgroups">Subgroups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#records">Records</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rpc-server-from-python-function">RPC Server from Python Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inline-style-read-and-write-customization">“Inline” Style Read and Write Customization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more">More…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/caproto/bench/#/">Performance Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Caproto-in-a-box</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Input-Output Controllers (IOCs)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/iocs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="input-output-controllers-iocs">
<h1>Input-Output Controllers (IOCs)<a class="headerlink" href="#input-output-controllers-iocs" title="Permalink to this headline">¶</a></h1>
<p>EPICS Input-Output Controllers (IOCs) expose an EPICS server. Behind the
server, they may connect to a device driver, data-processing code, and/or
an EPICS client for chaining with other servers.</p>
<p>In this section, we will review some of the example IOCs that are included with
caproto, intended as demonstrations of what is possible.</p>
<div class="section" id="why-write-an-ioc-using-caproto">
<h2>Why Write an IOC Using Caproto?<a class="headerlink" href="#why-write-an-ioc-using-caproto" title="Permalink to this headline">¶</a></h2>
<p>Caproto makes it is easy to launch a protocol-compliant Channel Access server
in just a couple lines of Python. This opens up some interesting possibilities:</p>
<ul class="simple">
<li><p>In Python, it is easy to invoke standard web protocols. For example, writing
an EPICS server around a device that speaks JSON may be easier with caproto
than with any previously-existing tools.</p></li>
<li><p>Many scientists who rely on EPICS but may not understand the details of
EPICS already know some Python for the data analysis work. Caproto may make
it easier for scientists and controls engineers to collaborate.</p></li>
<li><p>As with its clients, caproto’s servers handle a human-friendly encapsulation
of every message sent and received, which can be valuable for development,
logging, and debugging.</p></li>
</ul>
</div>
<div class="section" id="using-the-ioc-examples">
<h2>Using the IOC Examples<a class="headerlink" href="#using-the-ioc-examples" title="Permalink to this headline">¶</a></h2>
<p>They can be started like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.simple
<span class="o">[</span>I <span class="m">16</span>:51:09.751 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">16</span>:51:09.752 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:54966
<span class="o">[</span>I <span class="m">16</span>:51:09.753 server:121<span class="o">]</span> Server startup complete.
</pre></div>
</div>
<p>and stopped using Ctrl+C:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>^C
<span class="o">[</span>I <span class="m">16</span>:51:10.828 server:129<span class="o">]</span> Server task cancelled. Must shut down.
<span class="o">[</span>I <span class="m">16</span>:51:10.828 server:132<span class="o">]</span> Server exiting....
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--list-pvs</span></code> to display which PVs they serve:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.simple --list-pvs
<span class="o">[</span>I <span class="m">16</span>:52:36.087 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">16</span>:52:36.089 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:62005
<span class="o">[</span>I <span class="m">16</span>:52:36.089 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">16</span>:52:36.089 server:123<span class="o">]</span> PVs available:
    simple:A
    simple:B
    simple:C
</pre></div>
</div>
<p>and use <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> to conveniently customize the PV prefix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.simple --list-pvs --prefix my_custom_prefix:
<span class="o">[</span>I <span class="m">16</span>:54:14.528 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">16</span>:54:14.530 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:55810
<span class="o">[</span>I <span class="m">16</span>:54:14.530 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">16</span>:54:14.530 server:123<span class="o">]</span> PVs available:
    my_custom_prefix:A
    my_custom_prefix:B
    my_custom_prefix:C
</pre></div>
</div>
<p>Type <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">caproto.ioc_examples.simple</span> <span class="pre">-h</span></code> for more options.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Below, we will use caproto’s threading client to interact with caproto IOC.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">caproto.threading.client</span> <span class="kn">import</span> <span class="n">Context</span>

<span class="gp">In [2]: </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>  <span class="c1"># a client Context used to explore the servers below</span>
</pre></div>
</div>
<p>Of course, standard epics-base clients or other caproto clients may also be
used.</p>
<div class="section" id="simple-ioc">
<h3>Simple IOC<a class="headerlink" href="#simple-ioc" title="Permalink to this headline">¶</a></h3>
<p>This IOC has two PVs that simply store a value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>


<span class="k">class</span> <span class="nc">SimpleIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An IOC with three uncoupled read/writable PVs</span>

<span class="sd">    Scalar PVs</span>
<span class="sd">    ----------</span>
<span class="sd">    A (int)</span>
<span class="sd">    B (float)</span>

<span class="sd">    Vectors PVs</span>
<span class="sd">    -----------</span>
<span class="sd">    C (vector of int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;simple:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">dedent</span><span class="p">(</span><span class="n">SimpleIOC</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">SimpleIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.simple --list-pvs
<span class="o">[</span>I <span class="m">18</span>:08:47.628 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">18</span>:08:47.630 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:56840
<span class="o">[</span>I <span class="m">18</span>:08:47.630 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">18</span>:08:47.630 server:123<span class="o">]</span> PVs available:
    simple:A
    simple:B
    simple:C
</pre></div>
</div>
<p>Using the threading client context we created above, we can read these values
and write to them.</p>
<pre class="literal-block">In [3]: a, b, c = ctx.get_pvs('simple:A', 'simple:B', 'simple:C')

In [4]: a.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-4-8fcffd8463eb&gt; in &lt;module&gt;()
----&gt; 1 a.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:A' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [5]: b.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-5-e094164e6e67&gt; in &lt;module&gt;()
----&gt; 1 b.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:B' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [6]: c.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-6-aaae037ddc31&gt; in &lt;module&gt;()
----&gt; 1 c.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:C' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [7]: b.write(5)
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-7-02f6b2d0d380&gt; in &lt;module&gt;()
----&gt; 1 b.write(5)

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:B' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [8]: b.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-8-e094164e6e67&gt; in &lt;module&gt;()
----&gt; 1 b.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:B' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [9]: c.write([4, 5, 6])
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-9-8a06dbf338e1&gt; in &lt;module&gt;()
----&gt; 1 c.write([4, 5, 6])

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:C' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [10]: c.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-10-aaae037ddc31&gt; in &lt;module&gt;()
----&gt; 1 c.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='simple:C' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.</pre>
</div>
<div class="section" id="write-to-a-file-when-a-pv-is-written-to">
<h3>Write to a File When a PV is Written To<a class="headerlink" href="#write-to-a-file-when-a-pv-is-written-to" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">pathlib</span>


<span class="n">temp_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/tmp&#39;</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s1">&#39;win32&#39;</span>
                         <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TEMP&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">CustomWrite</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When a PV is written to, write the new value into a file as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DIRECTORY</span> <span class="o">=</span> <span class="n">temp_path</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">my_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># Compose the filename based on whichever PV this is.</span>
        <span class="n">pv_name</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">pvspec</span><span class="o">.</span><span class="n">attr</span>  <span class="c1"># &#39;A&#39; or &#39;B&#39;, for this IOC</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIRECTORY</span> <span class="o">/</span> <span class="n">pv_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">DIRECTORY</span> <span class="o">/</span> <span class="n">pv_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">my_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">my_write</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;custom_write:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with PVs that, when written to, update a file.&#39;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">CustomWrite</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.custom_write --list-pvs
<span class="o">[</span>I <span class="m">18</span>:12:07.282 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">18</span>:12:07.284 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:57539
<span class="o">[</span>I <span class="m">18</span>:12:07.284 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">18</span>:12:07.284 server:123<span class="o">]</span> PVs available:
    custom_write:A
    custom_write:B
</pre></div>
</div>
<p>On the machine where the server resides, we will see files update whenever any
client writes.</p>
<pre class="literal-block">In [11]: a, b = ctx.get_pvs('custom_write:A', 'custom_write:B')

In [12]: a.write(5)
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-12-2d39f1b5865c&gt; in &lt;module&gt;()
----&gt; 1 a.write(5)

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='custom_write:A' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [13]: print(open('/tmp/A').read())
1

In [14]: a.write(10)
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-14-5983833a2c71&gt; in &lt;module&gt;()
----&gt; 1 a.write(10)

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='custom_write:A' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [15]: print(open('/tmp/A').read())
1</pre>
<p>It is easy to imagine extending this example to write a socket or a serial
device rather than a file.</p>
</div>
<div class="section" id="random-walk">
<h3>Random Walk<a class="headerlink" href="#random-walk" title="Permalink to this headline">¶</a></h3>
<p>This example contains a PV <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> that takes random steps at an
update rate controlled by a second PV, <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">RandomWalkIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="nd">@x</span><span class="o">.</span><span class="n">startup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="s1">&#39;Periodically update the value&#39;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># compute next value</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># update the ChannelData instance and notify any subscribers</span>
            <span class="k">await</span> <span class="n">instance</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Let the async library wait for the next iteration</span>
            <span class="k">await</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">library</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;random_walk:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with a random-walking value.&#39;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">RandomWalkIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>What is async_lib.library.sleep?</strong></p>
<p>As caproto supports three different async libraries, we have an “async
layer” class that gives compatible async versions of commonly-used
synchronization primitives. The attribute <code class="docutils literal notranslate"><span class="pre">async_lib.library</span></code> would be either
the Python module <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> (default), <code class="docutils literal notranslate"><span class="pre">trio</span></code>, or <code class="docutils literal notranslate"><span class="pre">curio</span></code>, depending on how
the server is run.  It happens that all three of these modules have a <code class="docutils literal notranslate"><span class="pre">sleep</span></code>
function at the top level, so <code class="docutils literal notranslate"><span class="pre">async_lib.library.sleep</span></code> accesses the
appropriate sleep function for each library.</p>
<p><strong>Why not use time.sleep?</strong></p>
<p>The gist is that <code class="docutils literal notranslate"><span class="pre">asyncio.sleep</span></code> doesn’t hold up your entire thread /
event loop, but gives back control to the event loop to run other tasks while
sleeping. The function <code class="docutils literal notranslate"><span class="pre">time.sleep</span></code>, on the other hand, would cause
noticeable delays and problems.</p>
<p>This is a fundamental consideration in concurrent programming generally,
not specific to caproto. See for example
<a class="reference external" href="https://stackoverflow.com/questions/46207991/what-does-yield-from-asyncio-sleepdelay-do">this StackOverflow post</a>
for more information.</p>
</div>
</div>
<div class="section" id="i-o-interrupt">
<h3>I/O Interrupt<a class="headerlink" href="#i-o-interrupt" title="Permalink to this headline">¶</a></h3>
<p>This example listens for key presses.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">termios</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">atexit</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>


<span class="k">def</span> <span class="nf">start_io_interrupt_monitor</span><span class="p">(</span><span class="n">new_value_callback</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function monitors the terminal it was run in for keystrokes.</span>
<span class="sd">    On each keystroke, it calls new_value_callback with the given keystroke.</span>

<span class="sd">    This is used to simulate the concept of an I/O Interrupt-style signal from</span>
<span class="sd">    the EPICS world. Those signals depend on hardware to tell EPICS when new</span>
<span class="sd">    values are available to be read by way of interrupts - whereas we use</span>
<span class="sd">    callbacks here.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Thanks stackoverflow and Python 2 FAQ!</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdin__</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[IO Interrupt] stdin is not a TTY, exiting&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">fd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>

    <span class="n">oldterm</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">newattr</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="n">newattr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">termios</span><span class="o">.</span><span class="n">ICANON</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">termios</span><span class="o">.</span><span class="n">ECHO</span>
    <span class="n">oldflags</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_GETFL</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Started monitoring the keyboard outside of the async library&#39;</span><span class="p">)</span>

    <span class="c1"># When the process exits, be sure to reset the terminal settings</span>
    <span class="nd">@atexit</span><span class="o">.</span><span class="n">register</span>
    <span class="k">def</span> <span class="nf">reset_terminal</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resetting the terminal settings&#39;</span><span class="p">)</span>
        <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSAFLUSH</span><span class="p">,</span> <span class="n">oldterm</span><span class="p">)</span>
        <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">oldflags</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>

    <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSANOW</span><span class="p">,</span> <span class="n">newattr</span><span class="p">)</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">oldflags</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_NONBLOCK</span><span class="p">)</span>

    <span class="c1"># Loop forever, sending back keypresses to the callback</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New keypress: </span><span class="si">{</span><span class="n">char</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">new_value_callback</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IOInterruptIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="n">keypress</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># NOTE the decorator used here:</span>
    <span class="nd">@keypress</span><span class="o">.</span><span class="n">startup</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">keypress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">async_lib</span><span class="p">):</span>
        <span class="c1"># This method will be called when the server starts up.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* keypress method called at server startup&#39;</span><span class="p">)</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">async_lib</span><span class="o">.</span><span class="n">ThreadsafeQueue</span><span class="p">()</span>

        <span class="c1"># Start a separate thread that monitors keyboard input, telling it to</span>
        <span class="c1"># put new values into our async-friendly queue</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">start_io_interrupt_monitor</span><span class="p">,</span>
                                  <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">new_value_callback</span><span class="o">=</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">))</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Loop and grab items from the queue one at a time</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">async_get</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saw new value on async side: </span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Propagate the keypress to the EPICS PV, triggering any monitors</span>
            <span class="c1"># along the way</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">keypress</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;io:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC that updates via I/O interrupt on key-press events.&#39;</span><span class="p">)</span>

    <span class="n">ioc</span> <span class="o">=</span> <span class="n">IOInterruptIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m caproto.ioc_examples.io_interrupt --list-pvs
<span class="o">[</span>I <span class="m">10</span>:18:57.643 server:132<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">10</span>:18:57.644 server:145<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:54583
<span class="o">[</span>I <span class="m">10</span>:18:57.646 server:218<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">10</span>:18:57.646 server:220<span class="o">]</span> PVs available:
    io:keypress
* keypress method called at server startup
Started monitoring the keyboard outside of the async library
</pre></div>
</div>
<p>Typing causes updates to be sent to any client subscribed to <code class="docutils literal notranslate"><span class="pre">io:keypress</span></code>.
If we monitoring using the commandline-client like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ caproto-monitor io:keypress
</pre></div>
</div>
<p>and go back to the server and type some keys:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>New keypress: <span class="s1">&#39;a&#39;</span>
Saw new value on async side: <span class="s1">&#39;a&#39;</span>
New keypress: <span class="s1">&#39;b&#39;</span>
Saw new value on async side: <span class="s1">&#39;b&#39;</span>
New keypress: <span class="s1">&#39;c&#39;</span>
Saw new value on async side: <span class="s1">&#39;c&#39;</span>
New keypress: <span class="s1">&#39;d&#39;</span>
Saw new value on async side: <span class="s1">&#39;d&#39;</span>
</pre></div>
</div>
<p>the client will receive the updates:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>io:keypress                               <span class="m">2018</span>-06-14 <span class="m">10</span>:19:04 <span class="o">[</span>b<span class="s1">&#39;d&#39;</span><span class="o">]</span>
io:keypress                               <span class="m">2018</span>-06-14 <span class="m">10</span>:20:26 <span class="o">[</span>b<span class="s1">&#39;a&#39;</span><span class="o">]</span>
io:keypress                               <span class="m">2018</span>-06-14 <span class="m">10</span>:20:26 <span class="o">[</span>b<span class="s1">&#39;s&#39;</span><span class="o">]</span>
io:keypress                               <span class="m">2018</span>-06-14 <span class="m">10</span>:20:26 <span class="o">[</span>b<span class="s1">&#39;d&#39;</span><span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="macros-for-pv-names">
<h3>Macros for PV names<a class="headerlink" href="#macros-for-pv-names" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">MacroifiedNames</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">placeholder1</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{beamline}</span><span class="s1">:</span><span class="si">{thing}</span><span class="s1">.VAL&#39;</span><span class="p">)</span>
    <span class="n">placeholder2</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{beamline}</span><span class="s1">:</span><span class="si">{thing}</span><span class="s1">.RBV&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;macros:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with PVs that have macro-ified names.&#39;</span><span class="p">,</span>
        <span class="c1"># Provide default values for macros.</span>
        <span class="c1"># Passing None as a default value makes a parameter required.</span>
        <span class="n">macros</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">beamline</span><span class="o">=</span><span class="s1">&#39;my_beamline&#39;</span><span class="p">,</span> <span class="n">thing</span><span class="o">=</span><span class="s1">&#39;thing&#39;</span><span class="p">))</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MacroifiedNames</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<p>The help string for this IOC contains two extra entries at the bottom:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.macros -h
usage: macros.py <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--prefix PREFIX<span class="o">]</span> <span class="o">[</span>-q <span class="p">|</span> -v<span class="o">]</span> <span class="o">[</span>--list-pvs<span class="o">]</span>
                <span class="o">[</span>--async-lib <span class="o">{</span>asyncio,curio,trio<span class="o">}]</span>
                <span class="o">[</span>--interfaces INTERFACES <span class="o">[</span>INTERFACES ...<span class="o">]]</span>
                <span class="o">[</span>--beamline BEAMLINE<span class="o">]</span> <span class="o">[</span>--thing THING<span class="o">]</span>

Run an IOC with PVs that have macro-ified names.

optional arguments:

&lt;...snipped...&gt;

--beamline BEAMLINE   Macro substitution, optional
--thing THING         Macro substitution, optional
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.macros --beamline XF31ID --thing detector --list-pvs
<span class="o">[</span>I <span class="m">18</span>:44:39.528 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">18</span>:44:39.530 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:56365
<span class="o">[</span>I <span class="m">18</span>:44:39.531 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">18</span>:44:39.531 server:123<span class="o">]</span> PVs available:
    macros:XF31ID:detector.VAL
    macros:XF31ID:detector.RBV
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">pv</span><span class="p">,</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;macros:XF31ID:detector.VAL&#39;</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CaprotoTimeoutError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-17-73e3e6ef4448&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nn">~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py</span> in <span class="ni">inner</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span>                 <span class="k">if</span> <span class="ow">not</span> <span class="n">ready</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span>                     <span class="k">raise</span> <span class="n">CaprotoTimeoutError</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">105</span>                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pv</span><span class="si">}</span><span class="s2"> could not connect within &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span>                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">raw_timeout</span><span class="p">)</span><span class="si">:</span><span class="s2">.3</span><span class="si">}</span><span class="s2">-second timeout.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span>                 <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">CaprotoTimeoutError</span>: &lt;PV name=&#39;macros:XF31ID:detector.VAL&#39; priority=0 (searching....)&gt; could not connect within 2.0-second timeout.
</pre></div>
</div>
<p>Observe that the command line arguments fill in the PV names.</p>
</div>
<div class="section" id="subgroups">
<h3>Subgroups<a class="headerlink" href="#subgroups" title="Permalink to this headline">¶</a></h3>
<p>The PVGroup is designed to be nested, which provides a nice path toward future
capability: IOCs that are natively “V7”, encoding semantic structure for PV
Access clients and decomposing into flat PVs for Channel Access clients.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="p">(</span><span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">SubGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;caproto&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RecordLike</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s1">&#39;Example group, mirroring a V3 record&#39;</span>

    <span class="c1"># stop : from being added to the prefix</span>
    <span class="n">attr_separator</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># PV #1: {prefix}.RTYP</span>
    <span class="n">record_type</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;.RTYP&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">)</span>
    <span class="c1"># PV #2: {prefix}.VAL</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;.VAL&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># PV #3: {prefix}.DESC</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;.DESC&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;Description&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MySubGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s1">&#39;Example group of PVs, where the prefix is defined on instantiation&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>

    <span class="c1"># PV: {prefix}random - defaults to dtype of int</span>
    <span class="nd">@pvproperty</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Picking a random value from 1 to&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s1">&#39;Example group of PVs, a mix of pvproperties and subgroups&#39;</span>

    <span class="c1"># PV: {prefix}random</span>
    <span class="nd">@pvproperty</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;read random from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># PVs: {prefix}RECORD_LIKE1.RTYP, .VAL, and .DESC</span>
    <span class="n">recordlike1</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">RecordLike</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;RECORD_LIKE1&#39;</span><span class="p">)</span>
    <span class="c1"># PVs: {prefix}recordlike2.RTYP, .VAL, and .DESC</span>
    <span class="n">recordlike2</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">RecordLike</span><span class="p">)</span>

    <span class="c1"># PV: {prefix}group1:random</span>
    <span class="n">group1</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">MySubGroup</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># PV: {prefix}group2-random</span>
    <span class="n">group2</span> <span class="o">=</span> <span class="n">SubGroup</span><span class="p">(</span><span class="n">MySubGroup</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;group2-&#39;</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># PV: {prefix}group3_prefix:random</span>
    <span class="nd">@SubGroup</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;group3_prefix:&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">group3</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
        <span class="nd">@pvproperty</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;read random from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># PV: {prefix}group4:subgroup4:random</span>
    <span class="c1"># (TODO BUG) {prefix}subgroup4:random</span>
    <span class="nd">@SubGroup</span>
    <span class="k">class</span> <span class="nc">group4</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
        <span class="nd">@SubGroup</span>
        <span class="k">class</span> <span class="nc">subgroup4</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
            <span class="nd">@pvproperty</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;read random from </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;subgroups:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with groups of groups of PVs.&#39;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MyPVGroup</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>

    <span class="c1"># here&#39;s what accessing a pvproperty descriptor looks like:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;random using the descriptor getter is:&#39;</span><span class="p">,</span> <span class="n">ioc</span><span class="o">.</span><span class="n">random</span><span class="p">)</span>

    <span class="c1"># and for subgroups:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;subgroup4 is:&#39;</span><span class="p">,</span> <span class="n">ioc</span><span class="o">.</span><span class="n">group4</span><span class="o">.</span><span class="n">subgroup4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;subgroup4.random is:&#39;</span><span class="p">,</span> <span class="n">ioc</span><span class="o">.</span><span class="n">group4</span><span class="o">.</span><span class="n">subgroup4</span><span class="o">.</span><span class="n">random</span><span class="p">)</span>

    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m caproto.ioc_examples.subgroups --list-pvs
random using the descriptor getter is: &lt;caproto.server.server.PvpropertyInteger object at 0x10928ffd0&gt;
subgroup4 is: &lt;__main__.MyPVGroup.group4.subgroup4 object at 0x10928fe10&gt;
subgroup4.random is: &lt;caproto.server.server.PvpropertyInteger object at 0x10928fef0&gt;
<span class="o">[</span>I <span class="m">11</span>:08:35.074 server:132<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">11</span>:08:35.074 server:145<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:63336
<span class="o">[</span>I <span class="m">11</span>:08:35.076 server:218<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">11</span>:08:35.077 server:220<span class="o">]</span> PVs available:
    subgroups:random
    subgroups:RECORD_LIKE1.RTYP
    subgroups:RECORD_LIKE1.VAL
    subgroups:RECORD_LIKE1.DESC
    subgroups:recordlike2.RTYP
    subgroups:recordlike2.VAL
    subgroups:recordlike2.DESC
    subgroups:group1:random
    subgroups:group2-random
    subgroups:group3_prefix:random
    subgroups:group4:subgroup4:random
</pre></div>
</div>
</div>
<div class="section" id="records">
<span id="records-example"></span><h3>Records<a class="headerlink" href="#records" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="records.html"><span class="doc">Records</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">caproto</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>


<span class="k">class</span> <span class="nc">RecordMockingIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="c1"># Define three records, an analog input (ai) record:</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">)</span>
    <span class="c1"># And an analog output (ao) record:</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span>
                   <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># and an ai with all the bells and whistles</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                   <span class="n">record</span><span class="o">=</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span>
                   <span class="n">upper_alarm_limit</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                   <span class="n">lower_alarm_limit</span><span class="o">=-</span><span class="mf">2.0</span><span class="p">,</span>
                   <span class="n">upper_warning_limit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                   <span class="n">lower_warning_limit</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span>
                   <span class="n">upper_ctrl_limit</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                   <span class="n">lower_ctrl_limit</span><span class="o">=-</span><span class="mf">3.0</span><span class="p">,</span>
                   <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                   <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;The C pvproperty&#39;</span><span class="p">)</span>

    <span class="nd">@B</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">B</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Mocked record will pick up the alarm status simply by us raising</span>
            <span class="c1"># an exception in the putter:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid value!&#39;</span><span class="p">)</span>

    <span class="c1"># It&#39;s also possible to modify some of the behavior of fields on a per-</span>
    <span class="c1"># record basis. The following function is called whenever A.RVAL is put to:</span>
    <span class="nd">@A</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">current_raw_value</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># However, somewhat confusingly, &#39;self&#39; in this case is the fields</span>
        <span class="c1"># associated with &#39;A&#39;. To access the IOC (i.e., the main PV group)</span>
        <span class="c1"># use the following:</span>
        <span class="n">ioc</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">group</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A.RVAL: Writing values to A and B: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># Similarly, you can refer to the fields by their usual PV name:</span>
    <span class="nd">@B</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">RVAL</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">B</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">ioc</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">group</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B.RVAL: Writing modified values to A, B&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">ioc</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Now that the field specification has been set on B, it can be reused:</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                   <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                   <span class="n">field_spec</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">field_spec</span><span class="p">)</span>
    <span class="c1"># D will also be reported as an &#39;ao&#39; record like B, as it uses the same</span>
    <span class="c1"># field specification.</span>

    <span class="n">E</span> <span class="o">=</span> <span class="n">pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;this is a test&#39;</span><span class="p">,</span>
                   <span class="n">record</span><span class="o">=</span><span class="s1">&#39;stringin&#39;</span><span class="p">,</span>
                   <span class="n">dtype</span><span class="o">=</span><span class="n">caproto</span><span class="o">.</span><span class="n">ChannelType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                   <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;mock:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC that mocks an ai (analog input) record.&#39;</span><span class="p">)</span>

    <span class="c1"># Instantiate the IOC, assigning a prefix for the PV names.</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">RecordMockingIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PVs:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">))</span>

    <span class="c1"># ... but what you don&#39;t see are all of the analog input record fields</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fields of B:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of A:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Custom field specifications of B:&#39;</span><span class="p">,</span> <span class="n">RecordMockingIOC</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

    <span class="c1"># Run IOC.</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m caproto.ioc_examples.records --list-pvs
PVs: <span class="o">[</span><span class="s1">&#39;mock:A&#39;</span>, <span class="s1">&#39;mock:B&#39;</span><span class="o">]</span>
Fields of B: <span class="o">[</span><span class="s1">&#39;ACKS&#39;</span>, <span class="s1">&#39;ACKT&#39;</span>, <span class="s1">&#39;ASG&#39;</span>, <span class="s1">&#39;DESC&#39;</span>, <span class="s1">&#39;DISA&#39;</span>, <span class="s1">&#39;DISP&#39;</span>, <span class="s1">&#39;DISS&#39;</span>, <span class="s1">&#39;DISV&#39;</span>, <span class="s1">&#39;DTYP&#39;</span>, <span class="s1">&#39;EVNT&#39;</span>, <span class="s1">&#39;FLNK&#39;</span>, <span class="s1">&#39;LCNT&#39;</span>, <span class="s1">&#39;NAME&#39;</span>, <span class="s1">&#39;NSEV&#39;</span>, <span class="s1">&#39;NSTA&#39;</span>, <span class="s1">&#39;PACT&#39;</span>, <span class="s1">&#39;PHAS&#39;</span>, <span class="s1">&#39;PINI&#39;</span>, <span class="s1">&#39;PRIO&#39;</span>, <span class="s1">&#39;PROC&#39;</span>, <span class="s1">&#39;PUTF&#39;</span>, <span class="s1">&#39;RPRO&#39;</span>, <span class="s1">&#39;SCAN&#39;</span>, <span class="s1">&#39;SDIS&#39;</span>, <span class="s1">&#39;SEVR&#39;</span>, <span class="s1">&#39;TPRO&#39;</span>, <span class="s1">&#39;TSE&#39;</span>, <span class="s1">&#39;TSEL&#39;</span>, <span class="s1">&#39;UDF&#39;</span>, <span class="s1">&#39;RTYP&#39;</span>, <span class="s1">&#39;STAT&#39;</span>, <span class="s1">&#39;RVAL&#39;</span>, <span class="s1">&#39;INIT&#39;</span>, <span class="s1">&#39;MLST&#39;</span>, <span class="s1">&#39;LALM&#39;</span>, <span class="s1">&#39;ALST&#39;</span>, <span class="s1">&#39;LBRK&#39;</span>, <span class="s1">&#39;ORAW&#39;</span>, <span class="s1">&#39;ROFF&#39;</span>, <span class="s1">&#39;SIMM&#39;</span>, <span class="s1">&#39;SVAL&#39;</span>, <span class="s1">&#39;HYST&#39;</span>, <span class="s1">&#39;HIGH&#39;</span>, <span class="s1">&#39;HSV&#39;</span>, <span class="s1">&#39;HIHI&#39;</span>, <span class="s1">&#39;HHSV&#39;</span>, <span class="s1">&#39;LOLO&#39;</span>, <span class="s1">&#39;LLSV&#39;</span>, <span class="s1">&#39;LOW&#39;</span>, <span class="s1">&#39;LSV&#39;</span>, <span class="s1">&#39;AOFF&#39;</span>, <span class="s1">&#39;ASLO&#39;</span>, <span class="s1">&#39;EGUF&#39;</span>, <span class="s1">&#39;EGUL&#39;</span>, <span class="s1">&#39;LINR&#39;</span>, <span class="s1">&#39;EOFF&#39;</span>, <span class="s1">&#39;ESLO&#39;</span>, <span class="s1">&#39;SMOO&#39;</span>, <span class="s1">&#39;ADEL&#39;</span>, <span class="s1">&#39;PREC&#39;</span>, <span class="s1">&#39;EGU&#39;</span>, <span class="s1">&#39;HOPR&#39;</span>, <span class="s1">&#39;LOPR&#39;</span>, <span class="s1">&#39;MDEL&#39;</span>, <span class="s1">&#39;INP&#39;</span>, <span class="s1">&#39;SIOL&#39;</span>, <span class="s1">&#39;SIML&#39;</span>, <span class="s1">&#39;SIMS&#39;</span><span class="o">]</span>
<span class="o">[</span>I <span class="m">11</span>:07:48.635 server:132<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">11</span>:07:48.636 server:145<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:49637
<span class="o">[</span>I <span class="m">11</span>:07:48.638 server:218<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">11</span>:07:48.638 server:220<span class="o">]</span> PVs available:
    mock:A
    mock:B
</pre></div>
</div>
</div>
<div class="section" id="rpc-server-from-python-function">
<h3>RPC Server from Python Function<a class="headerlink" href="#rpc-server-from-python-function" title="Permalink to this headline">¶</a></h3>
<p>This automatically generates a SubGroup. In the future, this could be used to
spin up a PVA RPC service. As is, for Channel Access, this provides an RPC
function for single-user access.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="p">(</span><span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">pvfunction</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span>
                            <span class="n">run</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyPVGroup</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s1">&#39;Example group of PVs, where the prefix is defined on instantiation&#39;</span>
    <span class="c1"># PV #1: {prefix}random - defaults to dtype of int</span>
    <span class="nd">@pvproperty</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">fixed_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="s1">&#39;Random integer between 1 and 100&#39;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="nd">@pvfunction</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">low</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                         <span class="n">high</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="s1">&#39;A configurable random number&#39;</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;rpc:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC with an RPC function.&#39;</span><span class="p">)</span>

    <span class="n">ioc</span> <span class="o">=</span> <span class="n">MyPVGroup</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>

    <span class="c1"># here&#39;s what accessing a pvproperty descriptor looks like:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;fixed_random using the descriptor getter is: </span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">fixed_random</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;get_random using the descriptor getter is: </span><span class="si">{</span><span class="n">ioc</span><span class="o">.</span><span class="n">get_random</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get_random is an autogenerated subgroup with PVs:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pvspec</span> <span class="ow">in</span> <span class="n">ioc</span><span class="o">.</span><span class="n">get_random</span><span class="o">.</span><span class="n">pvdb</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">pvspec</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># here is the auto-generated pvdb:</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m caproto.ioc_examples.rpc_function --list-pvs

   fixed_random using the descriptor getter is: &lt;caproto.server.server.PvpropertyInteger object at 0x1041672b0&gt;
   get_random using the descriptor getter is: &lt;caproto.server.server.get_random object at 0x1041675f8&gt;
   get_random is an autogenerated subgroup with PVs:
       <span class="o">(</span><span class="s1">&#39;rpc:get_random:low&#39;</span>, &lt;caproto.server.server.PvpropertyInteger object at 0x104167358&gt;<span class="o">)</span>
       <span class="o">(</span><span class="s1">&#39;rpc:get_random:high&#39;</span>, &lt;caproto.server.server.PvpropertyInteger object at 0x104167588&gt;<span class="o">)</span>
       <span class="o">(</span><span class="s1">&#39;rpc:get_random:Status&#39;</span>, &lt;caproto.server.server.PvpropertyStringRO object at 0x104167320&gt;<span class="o">)</span>
       <span class="o">(</span><span class="s1">&#39;rpc:get_random:Retval&#39;</span>, &lt;caproto.server.server.PvpropertyIntegerRO object at 0x104167550&gt;<span class="o">)</span>
       <span class="o">(</span><span class="s1">&#39;rpc:get_random:Process&#39;</span>, &lt;caproto.server.server.PvpropertyInteger object at 0x1041672e8&gt;<span class="o">)</span>
   OrderedDict<span class="o">([(</span><span class="s1">&#39;rpc:fixed_random&#39;</span>,
               &lt;caproto.server.server.PvpropertyInteger object at 0x1041672b0&gt;<span class="o">)</span>,
               <span class="o">(</span><span class="s1">&#39;rpc:get_random:low&#39;</span>,
               &lt;caproto.server.server.PvpropertyInteger object at 0x104167358&gt;<span class="o">)</span>,
               <span class="o">(</span><span class="s1">&#39;rpc:get_random:high&#39;</span>,
               &lt;caproto.server.server.PvpropertyInteger object at 0x104167588&gt;<span class="o">)</span>,
               <span class="o">(</span><span class="s1">&#39;rpc:get_random:Status&#39;</span>,
               &lt;caproto.server.server.PvpropertyStringRO object at 0x104167320&gt;<span class="o">)</span>,
               <span class="o">(</span><span class="s1">&#39;rpc:get_random:Retval&#39;</span>,
               &lt;caproto.server.server.PvpropertyIntegerRO object at 0x104167550&gt;<span class="o">)</span>,
               <span class="o">(</span><span class="s1">&#39;rpc:get_random:Process&#39;</span>,
               &lt;caproto.server.server.PvpropertyInteger object at 0x1041672e8&gt;<span class="o">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="inline-style-read-and-write-customization">
<h3>“Inline” Style Read and Write Customization<a class="headerlink" href="#inline-style-read-and-write-customization" title="Permalink to this headline">¶</a></h3>
<p>This example shows custom write and read behavior similar to what we have seen
before, but implemented “inline” rather than siloed into a separate method.
This may be useful, from a readability point of view, for implementing one-off
behavior.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">caproto.server</span> <span class="kn">import</span> <span class="n">pvproperty</span><span class="p">,</span> <span class="n">PVGroup</span><span class="p">,</span> <span class="n">ioc_arg_parser</span><span class="p">,</span> <span class="n">run</span>
<span class="kn">import</span> <span class="nn">random</span>


<span class="k">class</span> <span class="nc">InlineStyleIOC</span><span class="p">(</span><span class="n">PVGroup</span><span class="p">):</span>
    <span class="s2">&quot;An IOC with a read-only PV and a read-write PV with inline customization&quot;</span>
    <span class="nd">@pvproperty</span>  <span class="c1"># default dtype is int</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">random_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="nd">@pvproperty</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">random_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>

    <span class="nd">@pvproperty</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>  <span class="c1"># initializes value and, implicitly, dtype</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading A&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@A</span><span class="o">.</span><span class="n">putter</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writing to A the value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ioc_options</span><span class="p">,</span> <span class="n">run_options</span> <span class="o">=</span> <span class="n">ioc_arg_parser</span><span class="p">(</span>
        <span class="n">default_prefix</span><span class="o">=</span><span class="s1">&#39;inline_style:&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Run an IOC PVs having custom update behavior, defined &quot;inline&quot;.&#39;</span><span class="p">)</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="n">InlineStyleIOC</span><span class="p">(</span><span class="o">**</span><span class="n">ioc_options</span><span class="p">)</span>
    <span class="n">run</span><span class="p">(</span><span class="n">ioc</span><span class="o">.</span><span class="n">pvdb</span><span class="p">,</span> <span class="o">**</span><span class="n">run_options</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.inline_style --list-pvs
<span class="o">[</span>I <span class="m">18</span>:47:05.344 server:93<span class="o">]</span> Server starting up...
<span class="o">[</span>I <span class="m">18</span>:47:05.346 server:109<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:64443
<span class="o">[</span>I <span class="m">18</span>:47:05.346 server:121<span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">18</span>:47:05.346 server:123<span class="o">]</span> PVs available:
    inline_style:random_int
    inline_style:random_str
    inline_style:A
</pre></div>
</div>
<pre class="literal-block">In [18]: randint, randstr = ctx.get_pvs('inline_style:random_int', 'inline_style:random_str')

In [19]: randint.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-19-3302ac2c7868&gt; in &lt;module&gt;()
----&gt; 1 randint.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_int' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [20]: randint.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-20-3302ac2c7868&gt; in &lt;module&gt;()
----&gt; 1 randint.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_int' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [21]: randint.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-21-3302ac2c7868&gt; in &lt;module&gt;()
----&gt; 1 randint.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_int' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [22]: randstr.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-22-ecdd52c5123d&gt; in &lt;module&gt;()
----&gt; 1 randstr.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_str' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [23]: randstr.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-23-ecdd52c5123d&gt; in &lt;module&gt;()
----&gt; 1 randstr.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_str' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.

In [24]: randstr.read()
---------------------------------------------------------------------------
CaprotoTimeoutError                       Traceback (most recent call last)
&lt;ipython-input-24-ecdd52c5123d&gt; in &lt;module&gt;()
----&gt; 1 randstr.read()

~/virtualenv/python3.6.7/lib/python3.6/site-packages/caproto/threading/client.py in inner(self, *args, **kwargs)
    103                 if not ready:
    104                     raise CaprotoTimeoutError(
--&gt; 105                         f&quot;{pv} could not connect within &quot;
    106                         f&quot;{float(raw_timeout):.3}-second timeout.&quot;)
    107                 if timeout is not None:

CaprotoTimeoutError: &lt;PV name='inline_style:random_str' priority=0 (searching....)&gt; could not connect within 2.0-second timeout.</pre>
</div>
<div class="section" id="more">
<h3>More…<a class="headerlink" href="#more" title="Permalink to this headline">¶</a></h3>
<p>Take a look around
<a class="reference external" href="https://github.com/caproto/caproto/tree/master/caproto/ioc_examples">the ioc_examples subpackage</a> for more examples not covered here.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="records.html" class="btn btn-neutral float-right" title="Records" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="async-clients.html" class="btn btn-neutral float-left" title="Asynchronous Clients" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017, Daniel Allan

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
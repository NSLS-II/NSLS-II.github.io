

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>caproto.pva._messages &mdash; caproto 0.6.0+133.g67516c6b documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/doctr-versions-menu.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> caproto
          

          
          </a>

          
            
            
              <div class="version">
                0.6.0+133.g67516c6b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Install Caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">EPICS Clients and Servers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../clients.html">Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../loggers.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cookiecutter.html">IOC Template Cookiecutter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../own_docs.html">Writing Your Own Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">Core API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">pvAccess</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pva/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pva/clients.html">Synchronous Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pva/iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pva/api.html">PVAccess API</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../containers.html">Caproto-in-a-box</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">caproto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>caproto.pva._messages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for caproto.pva._messages</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_annotations</span> <span class="k">as</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_core</span> <span class="k">as</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">._core</span> <span class="kn">import</span> <span class="p">(</span><span class="n">BIG_ENDIAN</span><span class="p">,</span> <span class="n">LITTLE_ENDIAN</span><span class="p">,</span> <span class="n">AddressTuple</span><span class="p">,</span> <span class="n">CoreSerializable</span><span class="p">,</span>
                    <span class="n">CoreStatelessSerializable</span><span class="p">,</span> <span class="n">Deserialized</span><span class="p">,</span> <span class="n">Endian</span><span class="p">,</span>
                    <span class="n">FieldArrayType</span><span class="p">,</span> <span class="n">FieldType</span><span class="p">,</span> <span class="n">SegmentDeserialized</span><span class="p">,</span> <span class="n">StatusType</span><span class="p">,</span>
                    <span class="n">UserFacingEndian</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._data</span> <span class="kn">import</span> <span class="p">(</span><span class="n">DataSerializer</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">,</span> <span class="n">FieldDescAndData</span><span class="p">,</span>
                    <span class="n">PVRequest</span><span class="p">,</span> <span class="n">from_wire</span><span class="p">,</span> <span class="n">to_wire</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._dataclass</span> <span class="kn">import</span> <span class="p">(</span><span class="n">array_of</span><span class="p">,</span> <span class="n">get_pv_structure</span><span class="p">,</span> <span class="n">is_pva_dataclass</span><span class="p">,</span>
                         <span class="n">pva_dataclass</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._fields</span> <span class="kn">import</span> <span class="n">BitSet</span><span class="p">,</span> <span class="n">CacheContext</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">,</span> <span class="n">SimpleField</span><span class="p">,</span> <span class="n">Status</span>
<span class="kn">from</span> <span class="nn">._utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">SERVER</span><span class="p">,</span> <span class="n">ChannelLifeCycle</span><span class="p">,</span> <span class="n">Role</span><span class="p">,</span> <span class="n">ip_to_ubyte_array</span><span class="p">,</span>
                     <span class="n">ubyte_array_to_ip</span><span class="p">)</span>

<span class="n">CommandType</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;ControlCommand&#39;</span><span class="p">,</span> <span class="s1">&#39;ApplicationCommand&#39;</span><span class="p">]</span>
<span class="n">SubcommandType</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;Subcommand&#39;</span><span class="p">,</span> <span class="s1">&#39;MonitorSubcommand&#39;</span><span class="p">]</span>
<span class="n">CtypesFields</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span>

<span class="n">_FieldType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;RequiredField&#39;</span><span class="p">,</span> <span class="s1">&#39;OptionalField&#39;</span><span class="p">,</span> <span class="s1">&#39;NonstandardArrayField&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;SuccessField&#39;</span><span class="p">]</span>
<span class="n">AdditionalFields</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">_FieldType</span><span class="p">]</span>
<span class="n">SubcommandFields</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SubcommandType</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">_FieldType</span><span class="p">]]</span>

<span class="n">_MessagesDict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">UserFacingEndian</span><span class="p">,</span> <span class="s1">&#39;MessageFlags&#39;</span><span class="p">],</span>
                     <span class="n">Dict</span><span class="p">[</span><span class="n">CommandType</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="s1">&#39;Message&#39;</span><span class="p">]]]</span>


<span class="nd">@pva_dataclass</span>
<span class="k">class</span> <span class="nc">ChannelWithID</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A channel and ID pair, used for searching and channel creation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">annotations</span><span class="o">.</span><span class="n">Int32</span>
    <span class="n">channel_name</span><span class="p">:</span> <span class="n">annotations</span><span class="o">.</span><span class="n">String</span>


<span class="nd">@pva_dataclass</span>
<span class="k">class</span> <span class="nc">ChannelAccessAuthentication</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A channel and ID pair, used for searching and channel creation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span><span class="p">:</span> <span class="n">annotations</span><span class="o">.</span><span class="n">String</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">annotations</span><span class="o">.</span><span class="n">String</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="si">}</span><span class="s1">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="n">serialization_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;caproto.pva.serialization&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_MessageField</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">FieldType</span><span class="p">):</span>
            <span class="c1"># Can use a basic FieldType such as FieldType.string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SimpleField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                    <span class="n">field_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                                    <span class="n">array_type</span><span class="o">=</span><span class="n">FieldArrayType</span><span class="o">.</span><span class="n">scalar</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_pva_dataclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
            <span class="c1"># Can use a pva_struct-wrapped dataclass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">get_pv_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

        <span class="c1"># With the end result of `type` being a SimpleField or StructuredField</span>


<span class="k">class</span> <span class="nc">OptionalStopMarker</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Marker for message fields.</span>

<span class="sd">    Indicates whether to stop or continue processing messages when the</span>
<span class="sd">    condition is not met.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">continue_</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">MessageFieldType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">FieldType</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">Type</span><span class="p">[</span><span class="n">DataSerializer</span><span class="p">],</span>
                         <span class="n">Type</span><span class="p">[</span><span class="n">CoreSerializable</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">CoreStatelessSerializable</span><span class="p">]]</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">RequiredField</span><span class="p">(</span><span class="n">_MessageField</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">MessageFieldType</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">NonstandardArrayField</span><span class="p">(</span><span class="n">RequiredField</span><span class="p">):</span>
    <span class="n">count_attr</span><span class="p">:</span> <span class="nb">str</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OptionalField</span><span class="p">(</span><span class="n">_MessageField</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">MessageFieldType</span>
    <span class="n">stop</span><span class="p">:</span> <span class="n">OptionalStopMarker</span> <span class="o">=</span> <span class="n">OptionalStopMarker</span><span class="o">.</span><span class="n">stop</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_success_condition</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Continuation condition: only if the status reported success.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">msg</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">is_successful</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">SuccessField</span><span class="p">(</span><span class="n">OptionalField</span><span class="p">):</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">_success_condition</span>


<span class="k">class</span> <span class="nc">QOSFlags</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="s1">&#39;First 7 bits of QOS settings are the priority (see QOS_PRIORITY_MASK)&#39;</span>
    <span class="n">unused_7</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span>
    <span class="n">low_latency</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
    <span class="n">throughput_priority</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span>
    <span class="n">enable_compression</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span>
    <span class="n">unused_11</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span>
    <span class="n">unused_12</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span>
    <span class="n">unused_13</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span>
    <span class="n">unused_14</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span>
    <span class="n">unused_15</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">QOS_PRIORITY_MASK</span> <span class="o">&amp;</span> <span class="n">priority</span><span class="p">)</span> <span class="o">|</span> <span class="n">flags</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">priority_word</span><span class="p">):</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="p">(</span><span class="n">priority_word</span> <span class="o">&amp;</span> <span class="n">core</span><span class="o">.</span><span class="n">QOS_PRIORITY_MASK</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">QOSFlags</span><span class="p">(</span><span class="n">priority_word</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">core</span><span class="o">.</span><span class="n">QOS_PRIORITY_MASK</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ApplicationCommand</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Application messages. These are the requests and their responses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BEACON</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CONNECTION_VALIDATION</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ECHO</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SEARCH_REQUEST</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">SEARCH_RESPONSE</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">AUTHNZ</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">ACL_CHANGE</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">CREATE_CHANNEL</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">DESTROY_CHANNEL</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">CONNECTION_VALIDATED</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">GET</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">PUT</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">PUT_GET</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">MONITOR</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">ARRAY</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">DESTROY_REQUEST</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">PROCESS</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">GET_FIELD</span> <span class="o">=</span> <span class="mi">17</span>
    <span class="n">MESSAGE</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">RPC</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">CANCEL_REQUEST</span> <span class="o">=</span> <span class="mi">21</span>
    <span class="n">ORIGIN_TAG</span> <span class="o">=</span> <span class="mi">22</span>

    <span class="c1"># These message codes are never used, and considered deprecated.</span>
    <span class="n">MULTIPLE_DATA</span> <span class="o">=</span> <span class="mi">19</span>


<span class="k">class</span> <span class="nc">ControlCommand</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control messages. These include flow control and have no payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: this is not set as an IntEnum to avoid clashing with</span>
    <span class="c1"># ApplicationCommand in dictionaries.</span>
    <span class="n">SET_MARKER</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ACK_MARKER</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SET_ENDIANESS</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ECHO_REQUEST</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ECHO_RESPONSE</span> <span class="o">=</span> <span class="mi">4</span>


<span class="k">class</span> <span class="nc">SearchFlags</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="c1"># 0-bit for replyRequired, 7-th bit for &quot;sent as unicast&quot; (1)/&quot;sent as</span>
    <span class="c1"># broadcast/multicast&quot; (0)</span>
    <span class="n">reply_required</span> <span class="o">=</span> <span class="mb">0b00000001</span>
    <span class="n">unicast</span> <span class="o">=</span> <span class="mb">0b10000000</span>
    <span class="n">broadcast</span> <span class="o">=</span> <span class="mb">0b00000000</span>


<span class="k">class</span> <span class="nc">EndianSetting</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">use_server_byte_order</span> <span class="o">=</span> <span class="mh">0x00000000</span>
    <span class="n">use_message_byte_order</span> <span class="o">=</span> <span class="mh">0xffffffff</span>


<span class="k">class</span> <span class="nc">MessageFlags</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">APP_MESSAGE</span> <span class="o">=</span> <span class="mb">0b0000_0000_0000</span>
    <span class="n">CONTROL_MESSAGE</span> <span class="o">=</span> <span class="mb">0b0000_0000_0001</span>

    <span class="n">UNSEGMENTED</span> <span class="o">=</span> <span class="mb">0b0000_0000_0000</span>
    <span class="n">FIRST</span> <span class="o">=</span> <span class="mb">0b0000_0001_0000</span>
    <span class="n">LAST</span> <span class="o">=</span> <span class="mb">0b0000_0010_0000</span>
    <span class="n">MIDDLE</span> <span class="o">=</span> <span class="mb">0b0000_0011_0000</span>

    <span class="n">FROM_CLIENT</span> <span class="o">=</span> <span class="mb">0b0000_0000_0000</span>
    <span class="n">FROM_SERVER</span> <span class="o">=</span> <span class="mb">0b0000_0100_0000</span>

    <span class="n">LITTLE_ENDIAN</span> <span class="o">=</span> <span class="mb">0b0000_0000_0000</span>
    <span class="n">BIG_ENDIAN</span> <span class="o">=</span> <span class="mb">0b0000_1000_0000</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_segmented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span>
                   <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FIRST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LAST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MIDDLE</span><span class="p">)</span>
                   <span class="p">)</span>


<span class="k">class</span> <span class="nc">Subcommand</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="c1"># Default behavior</span>
    <span class="n">DEFAULT</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="c1"># Require reply (acknowledgment for reliable operation)</span>
    <span class="n">REPLY_REQUIRED</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="c1"># Best-effort option (no reply)</span>
    <span class="n">BEST_EFFORT</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">PROCESS</span> <span class="o">=</span> <span class="mh">0x04</span>
    <span class="n">INIT</span> <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">DESTROY</span> <span class="o">=</span> <span class="mh">0x10</span>
    <span class="c1"># Share data option</span>
    <span class="n">SHARE</span> <span class="o">=</span> <span class="mh">0x20</span>
    <span class="n">GET</span> <span class="o">=</span> <span class="mh">0x40</span>
    <span class="n">GET_PUT</span> <span class="o">=</span> <span class="mh">0x80</span>


<span class="k">class</span> <span class="nc">MonitorSubcommand</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntFlag</span><span class="p">):</span>
    <span class="n">PIPELINE</span> <span class="o">=</span> <span class="mh">0x80</span>  <span class="c1"># (GET_PUT)</span>
    <span class="n">START</span> <span class="o">=</span> <span class="mh">0x44</span>
    <span class="n">STOP</span> <span class="o">=</span> <span class="mh">0x04</span>

    <span class="c1"># Duplicated from :class:`Subcommand`:</span>
    <span class="n">DEFAULT</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">INIT</span> <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">DESTROY</span> <span class="o">=</span> <span class="mh">0x10</span>


<span class="k">def</span> <span class="nf">_array_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="s1">&#39;Array property to make handling ctypes arrays a bit easier&#39;</span>
    <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">item</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="p">,</span> <span class="n">fset</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">)</span>


<span class="n">_StatusOK</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="n">StatusType</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_handles</span><span class="p">(</span><span class="n">subcommand</span><span class="p">:</span> <span class="n">SubcommandType</span><span class="p">,</span>
             <span class="n">fields</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AdditionalFields</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A decorator that marks a handler method for initializing a Subcommand.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subcommand : SubcommandType</span>
<span class="sd">        The subcommand.</span>

<span class="sd">    fields : list of RequiredField, OptionalField, etc.</span>
<span class="sd">        The fields associated with the subcommand.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">_subcommand_handler_</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s1">&#39;subcommands&#39;</span><span class="p">):</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">subcommands</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">handler</span><span class="o">.</span><span class="n">subcommands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">handler</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">Message</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for all Messages.&quot;&quot;&quot;</span>
    <span class="n">_pack_</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_fields_</span><span class="p">:</span> <span class="n">CtypesFields</span>
    <span class="c1"># The following is set in endian subclasses for the varieties of messages:</span>
    <span class="n">_ENDIAN</span><span class="p">:</span> <span class="n">UserFacingEndian</span>

    <span class="k">def</span> <span class="nf">_get_repr_for_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="n">prop_name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">prop_name</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">prop_name</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">_get_repr_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_repr_for_attr</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_repr_items</span><span class="p">())</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">info</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_additional_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">endian</span><span class="p">:</span> <span class="n">Endian</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># ignored, here for consistency</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">subcommand</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">additional_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_additional_fields</span><span class="p">(</span><span class="n">subcommand</span><span class="o">=</span><span class="n">subcommand</span><span class="p">)</span>

        <span class="n">ctypes_struct_serialized</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">additional_fields</span><span class="p">:</span>
            <span class="c1"># Without additional fields, this is just a ctypes.Structure</span>
            <span class="k">return</span> <span class="n">ctypes_struct_serialized</span>

        <span class="n">endian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ENDIAN</span>

        <span class="c1"># (1) serialize the ctypes.Structure _fields_ first</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes_struct_serialized</span><span class="p">]</span>

        <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;to_wire: </span><span class="si">%s</span><span class="s1"> subcommand=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">subcommand</span><span class="p">)</span>

        <span class="c1"># (2) move onto the &quot;additional fields&quot; which are not as easily</span>
        <span class="c1"># serializable:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">additional_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">OptionalField</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
                        <span class="k">break</span>

            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">NonstandardArrayField</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">count_attr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span>

            <span class="n">serialize</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
                <span class="n">to_wire</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="n">endian</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                <span class="n">bitset</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span>

            <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&gt; Field </span><span class="si">%r</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">buf</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">))</span>

        <span class="c1"># (3) end result is the sum of all buffers</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;(to_wire done: </span><span class="si">%s</span><span class="s1"> subcommand=</span><span class="si">%s</span><span class="s1"> -&gt; </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">subcommand</span><span class="p">,</span> <span class="n">serialized</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">serialized</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">buf</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                    <span class="n">endian</span><span class="p">:</span> <span class="n">Endian</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># ignored, here for consistency</span>
                    <span class="n">cache</span><span class="p">:</span> <span class="n">CacheContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">base_size</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">buflen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">base_size</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buf</span><span class="p">[:</span><span class="n">base_size</span><span class="p">])</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="n">base_size</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>

        <span class="n">subcommand</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">additional_fields</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_additional_fields</span><span class="p">(</span><span class="n">subcommand</span><span class="o">=</span><span class="n">subcommand</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">additional_fields</span><span class="p">:</span>
            <span class="c1"># Without additional fields, this is just a ctypes.Structure</span>
            <span class="k">return</span> <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>

        <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;from_wire: </span><span class="si">%s</span><span class="s1"> base_size=</span><span class="si">%s</span><span class="s1"> subcommand=</span><span class="si">%s</span><span class="s1"> payload=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">base_size</span><span class="p">,</span> <span class="n">subcommand</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">additional_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">OptionalField</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">buflen</span><span class="p">:</span>
                    <span class="c1"># No bytes remaining, and any additional fields are</span>
                    <span class="c1"># optional.</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="n">OptionalStopMarker</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>

            <span class="n">field_interface</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span>

            <span class="k">if</span> <span class="n">field_interface</span> <span class="ow">is</span> <span class="n">DataWithBitSet</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">field_interface</span> <span class="o">=</span> <span class="n">DataWithBitSet</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">cache</span><span class="o">.</span><span class="n">ioid_interfaces</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">ioid</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Field description unavailable for Data in &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s1"> (ioid=</span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">ioid</span><span class="si">}</span><span class="s1">)&#39;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

            <span class="n">is_nonstandard_array</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span>
                                              <span class="n">NonstandardArrayField</span><span class="p">)</span>

            <span class="n">deserialize</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
                <span class="n">from_wire</span><span class="p">,</span> <span class="n">field_interface</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ENDIAN</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
                <span class="n">bitset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">is_nonstandard_array</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">count_attr</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                    <span class="n">value</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">off</span>
                    <span class="n">buflen</span> <span class="o">-=</span> <span class="n">off</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&gt; Field </span><span class="si">%r</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">off</span>
                <span class="n">buflen</span> <span class="o">-=</span> <span class="n">off</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&gt; Field </span><span class="si">%r</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">serialization_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;(from_wire done: </span><span class="si">%d</span><span class="s1"> B -&gt; </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">,</span>
            <span class="n">offset</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AdditionalFieldsMessage</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Message base class that supports messages with fields beyond ``_fields_``</span>
<span class="sd">    from ctypes.Structure.</span>

<span class="sd">    These are listed in ``_additional_fields_``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span>

    <span class="k">def</span> <span class="nf">_get_repr_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_repr_items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_fields_</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_repr_for_attr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_additional_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_additional_fields_</span>


<span class="k">class</span> <span class="nc">SubcommandMessage</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Message base class that supports messages with sub-command level state.</span>

<span class="sd">    These are listed in ``_subcommand_fields_``, keyed on ``Subcommand``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span>
    <span class="n">subcommand</span><span class="p">:</span> <span class="n">SubcommandType</span>

    <span class="k">def</span> <span class="nf">_get_repr_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_repr_items</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subcommand_fields_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_repr_for_attr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_additional_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_additional_fields_</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">subcommand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fields</span>

        <span class="c1"># eget/pvget can mix in DESTROY with the commands:</span>
        <span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span> <span class="ow">in</span> <span class="n">subcommand</span><span class="p">:</span>
            <span class="n">subcommand</span> <span class="o">=</span> <span class="n">subcommand</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fields</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_subcommand_fields_</span><span class="p">[</span><span class="n">subcommand</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid (or currently unhandled) subcommand&#39;</span>
                             <span class="sa">f</span><span class="s1">&#39; for class </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">subcommand</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">(</span><span class="n">_LE</span><span class="p">,</span> <span class="n">_BE</span><span class="p">)):</span>
            <span class="c1"># Don&#39;t do this for the mixins</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_additional_fields_&#39;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_additional_fields_</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_subcommand_fields_&#39;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_subcommand_fields_</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">subcommand</span><span class="p">:</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">subcommand</span> <span class="ow">in</span> <span class="n">Subcommand</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_subcommand_handler_&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">subcommands</span><span class="p">:</span>
                    <span class="n">old</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_subcommand_fields_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;Specified subcommand </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1"> twice: </span><span class="si">{</span><span class="n">old</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="bp">cls</span><span class="o">.</span><span class="n">_subcommand_fields_</span><span class="p">[</span><span class="n">cmd</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fields</span>

    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">_LE</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">LittleEndianStructure</span><span class="p">):</span>
    <span class="n">_ENDIAN</span> <span class="o">=</span> <span class="n">LITTLE_ENDIAN</span>


<span class="k">class</span> <span class="nc">_BE</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">BigEndianStructure</span><span class="p">):</span>
    <span class="n">_ENDIAN</span> <span class="o">=</span> <span class="n">BIG_ENDIAN</span>


<div class="viewcode-block" id="MessageHeader"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.MessageHeader">[docs]</a><span class="k">class</span> <span class="nc">MessageHeader</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
    <span class="n">magic</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_flags</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">message_command</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">CommandType</span><span class="p">]</span>
    <span class="n">payload_size</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;magic&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;_flags&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;message_command&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;payload_size&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">MessageFlags</span><span class="p">,</span>
                 <span class="n">command</span><span class="p">:</span> <span class="n">CommandType</span><span class="p">,</span>
                 <span class="n">payload_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magic</span> <span class="o">=</span> <span class="mh">0xca</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload_size</span> <span class="o">=</span> <span class="n">payload_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MessageFlags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>

    <span class="nd">@flags</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">magic</span> <span class="o">==</span> <span class="mh">0xca</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">byte_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Byte order/endianness of message&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">BIG_ENDIAN</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">&amp;</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">BIG_ENDIAN</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">LITTLE_ENDIAN</span><span class="p">)</span>

<div class="viewcode-block" id="MessageHeader.get_message"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.MessageHeader.get_message">[docs]</a>    <span class="k">def</span> <span class="nf">get_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">MessageFlags</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                    <span class="n">use_fixed_byte_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">byte_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">use_fixed_byte_order</span>
                      <span class="k">if</span> <span class="n">use_fixed_byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                      <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_order</span><span class="p">)</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>

        <span class="k">if</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">CONTROL_MESSAGE</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_command</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">message_group</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[(</span><span class="n">byte_order</span><span class="p">,</span> <span class="n">direction</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">message_group</span><span class="p">[</span><span class="n">command</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s1"> where flags=</span><span class="si">{</span><span class="n">flags</span><span class="si">}</span><span class="s1"> and command=</span><span class="si">{</span><span class="n">command</span><span class="si">!r}</span><span class="s1">&#39;</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="BeaconMessage"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.BeaconMessage">[docs]</a><span class="k">class</span> <span class="nc">BeaconMessage</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A beacon message.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    guid : 12 bytes</span>
<span class="sd">        Server GUID (Globally Unique Identifier). MUST change every restart.</span>

<span class="sd">    flags :</span>
<span class="sd">        Reserved (unused).</span>

<span class="sd">    sequence_id :</span>
<span class="sd">        Beacon sequence ID (counter with rollover). Can be used to detect UDP</span>
<span class="sd">        routing problems.</span>

<span class="sd">    change_count :</span>
<span class="sd">        Count (with rollover) that changes every time server&#39;s list of channels</span>
<span class="sd">        changes.</span>

<span class="sd">    server_address :</span>
<span class="sd">        Server address. For IP transports IPv6 or IPv6 encoded IPv4 address.</span>

<span class="sd">    server_port : int</span>
<span class="sd">        Server port. For IP transport socket port where server is listening.</span>

<span class="sd">    protocol : str</span>
<span class="sd">        Protocol/transport name. &quot;tcp&quot; for standard pvAccess TCP/IP</span>
<span class="sd">        communication.</span>

<span class="sd">    server_status : FieldDescAndData</span>
<span class="sd">        Optional server status Field description, ``NULL_TYPE_CODE`` MUST be used</span>
<span class="sd">        indicate absence of data.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Servers MUST broadcast or multicast beacons over UDP. Beacons are be used</span>
<span class="sd">    to announce the appearance and continued presense of servers. Clients may</span>
<span class="sd">    use Beacons to detect when new servers appear, and may use this information</span>
<span class="sd">    to more quickly retry unanswered CMD_SEARCH messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">BEACON</span>
    <span class="n">guid</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">change_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">server_address</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">server_port</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;_guid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">12</span><span class="p">),</span>   <span class="c1"># see property below</span>
        <span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sequence_id&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;change_count&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint16</span><span class="p">),</span>  <span class="c1"># TODO_DOCS</span>
        <span class="p">(</span><span class="s1">&#39;_server_address&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">16</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_port&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">),</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;server_status&#39;</span><span class="p">,</span> <span class="n">FieldDescAndData</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">guid</span> <span class="o">=</span> <span class="n">_array_property</span><span class="p">(</span><span class="s1">&#39;_guid&#39;</span><span class="p">,</span> <span class="s1">&#39;GUID for server&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ubyte_array_to_ip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>

    <span class="nd">@server_address</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">server_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">ip_to_ubyte_array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">guid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">server_address</span><span class="p">:</span> <span class="n">AddressTuple</span><span class="p">,</span>
                 <span class="n">server_status</span><span class="p">:</span> <span class="n">FieldDescAndData</span><span class="p">,</span>
                 <span class="o">*</span><span class="p">,</span>
                 <span class="n">change_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                         <span class="n">sequence_id</span><span class="o">=</span><span class="n">sequence_id</span><span class="p">,</span>
                         <span class="n">change_count</span><span class="o">=</span><span class="n">change_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">guid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_address</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">server_status</span></div>



<div class="viewcode-block" id="MessageHeaderLE"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.MessageHeaderLE">[docs]</a><span class="k">class</span> <span class="nc">MessageHeaderLE</span><span class="p">(</span><span class="n">MessageHeader</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">MessageHeader</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa  E305</span></div>
<div class="viewcode-block" id="MessageHeaderBE"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.MessageHeaderBE">[docs]</a><span class="k">class</span> <span class="nc">MessageHeaderBE</span><span class="p">(</span><span class="n">MessageHeader</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">MessageHeader</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa  E305</span></div>


<span class="n">_MessageHeaderSize</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">sizeof</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">)</span>


<span class="c1"># NOTE: the following control messages do not have any elements which require</span>
<span class="c1"># an endian setting. They are arbitrarily set to little-endian here for all</span>
<span class="c1"># platforms.</span>
<div class="viewcode-block" id="SetMarker"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.SetMarker">[docs]</a><span class="k">class</span> <span class="nc">SetMarker</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A control command which sets a marker for total bytes sent.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    (from pva documentation)</span>
<span class="sd">    Note that this message type has so far not been used.</span>

<span class="sd">    The payload size field holds the value of the total bytes sent. The client</span>
<span class="sd">    SHOULD respond with an acknowledgment control message (0x01) as soon as</span>
<span class="sd">    possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="o">.</span><span class="n">SET_MARKER</span></div>


<div class="viewcode-block" id="AcknowledgeMarker"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.AcknowledgeMarker">[docs]</a><span class="k">class</span> <span class="nc">AcknowledgeMarker</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A control command to acknowledge the total bytes received.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    (from pva documentation)</span>
<span class="sd">    Note that this message type has so far not been used.</span>

<span class="sd">    The payload size field holds the acknowledge value of total bytes received.</span>
<span class="sd">    This must match the previously received marked value as described above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="o">.</span><span class="n">ACK_MARKER</span></div>


<div class="viewcode-block" id="SetByteOrder"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.SetByteOrder">[docs]</a><span class="k">class</span> <span class="nc">SetByteOrder</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An indicator to set the byte order of future messages.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The 7-th bit of a header flags field indicates the server&#39;s selected byte</span>
<span class="sd">    order for the connection on which this message was received. Client MUST</span>
<span class="sd">    encode all the messages sent via this connection using this byte order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="o">.</span><span class="n">SET_ENDIANESS</span>
    <span class="c1"># uses EndianSetting in header payload size</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endian_setting</span><span class="p">:</span> <span class="n">EndianSetting</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">flags</span><span class="p">:</span> <span class="n">MessageFlags</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">endian_setting</span> <span class="ow">in</span> <span class="p">(</span><span class="n">EndianSetting</span><span class="o">.</span><span class="n">use_message_byte_order</span><span class="p">,</span>
                                  <span class="n">EndianSetting</span><span class="o">.</span><span class="n">use_server_byte_order</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                         <span class="n">payload_size</span><span class="o">=</span><span class="n">endian_setting</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">byte_order_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EndianSetting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="EchoRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.EchoRequest">[docs]</a><span class="k">class</span> <span class="nc">EchoRequest</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A request to echo the payload.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Diagnostic/test echo message. The receiver should respond with an Echo</span>
<span class="sd">    response (0x04) message with the same payload size field value.</span>

<span class="sd">    In protocol version v1:</span>
<span class="sd">    * v1 servers reply to &#39;Echo&#39; with empty payload.</span>
<span class="sd">    * v1 clients never send &#39;Echo&#39;.</span>
<span class="sd">    * v1 peers never timeout inactive TCP connections.</span>

<span class="sd">    In protocol version v2:</span>
<span class="sd">    * v2 clients must send &#39;Echo&#39; more often than $EPICS_PVA_CONN_TMO seconds.</span>
<span class="sd">    The recommended interval is half of $EPICS_PVA_CONN_TMO (default 15 sec.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="o">.</span><span class="n">ECHO_REQUEST</span></div>


<div class="viewcode-block" id="EchoResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.EchoResponse">[docs]</a><span class="k">class</span> <span class="nc">EchoResponse</span><span class="p">(</span><span class="n">MessageHeaderLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to an echo request.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The payload size field contains the same value as in the request message.</span>

<span class="sd">    In protocol version v2:</span>
<span class="sd">    * v2 server&#39;s &#39;Echo&#39; reply must include the request payload.</span>
<span class="sd">    * v2 peers must close TCP connections when no data has been received in</span>
<span class="sd">    $EPICS_PVA_CONN_TMO seconds (default 30 sec.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ControlCommand</span><span class="o">.</span><span class="n">ECHO_REQUEST</span></div>


<div class="viewcode-block" id="ConnectionValidationRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ConnectionValidationRequest">[docs]</a><span class="k">class</span> <span class="nc">ConnectionValidationRequest</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A validation request from the server.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A ConnectionValidationRequest message MUST be the first application message</span>
<span class="sd">    sent from the server to a client when a TCP/IP connection is established</span>
<span class="sd">    (after a Set byte order Control message). The client MUST NOT send any</span>
<span class="sd">    messages on the connection until it has received a connection validation</span>
<span class="sd">    message from the server.</span>

<span class="sd">    The server lists the support authentication methods. Currently supported</span>
<span class="sd">    are &quot;anonymous&quot; and &quot;ca&quot;. In the ConnectionValidationResponse, the client</span>
<span class="sd">    selects one of these. For &quot;anonymous&quot;, no further detail is required. For</span>
<span class="sd">    &quot;ca&quot;, a structure with string elements &quot;user&quot; and &quot;host&quot; needs to follow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span>

    <span class="n">server_buffer_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">server_registry_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_buffer_size&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_registry_size&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;auth_nz&#39;</span><span class="p">,</span> <span class="n">array_of</span><span class="p">(</span><span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">)),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ConnectionValidationResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ConnectionValidationResponse">[docs]</a><span class="k">class</span> <span class="nc">ConnectionValidationResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A client&#39;s connection validation response message.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Each Quality of Service (QoS) parameter value REQUIRES a separate TCP/IP</span>
<span class="sd">    connection. If the Low-latency priority bit is set, this indicates clients</span>
<span class="sd">    should attempt to minimize latency if they have the capacity to do so. If</span>
<span class="sd">    the Throughput priority bit is set, this indicates a client similarly</span>
<span class="sd">    should attempt to maximize throughput. How this is achieved is</span>
<span class="sd">    implementation defined. The Compression bit enables compression for the</span>
<span class="sd">    connection (Which compression? From which support layer?). A matter for a</span>
<span class="sd">    future version of the specification should be whether a streaming mode</span>
<span class="sd">    algorithm should be specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span>

    <span class="n">client_buffer_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">client_registry_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">connection_qos</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">auth_nz</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">FieldDescAndData</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;client_buffer_size&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;client_registry_size&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int16</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;connection_qos&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;auth_nz&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">),</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">FieldDescAndData</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="Echo"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.Echo">[docs]</a><span class="k">class</span> <span class="nc">Echo</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A TCP Echo request/response.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    An Echo diagnostic message is usually sent to check if TCP/IP connection is</span>
<span class="sd">    still valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ECHO</span>
    <span class="n">_fields_</span><span class="p">:</span> <span class="n">CtypesFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">,</span> <span class="n">array_of</span><span class="p">(</span><span class="n">FieldType</span><span class="o">.</span><span class="n">int8</span><span class="p">)),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ConnectionValidatedResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ConnectionValidatedResponse">[docs]</a><span class="k">class</span> <span class="nc">ConnectionValidatedResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validation results - success depends on the status.&quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATED</span>
    <span class="n">_fields_</span><span class="p">:</span> <span class="n">CtypesFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span></div>


<div class="viewcode-block" id="SearchRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.SearchRequest">[docs]</a><span class="k">class</span> <span class="nc">SearchRequest</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A search request for PVs by name.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A channel &quot;search request&quot; message SHOULD be sent over UDP/IP, however UDP</span>
<span class="sd">    congestion control SHOULD be implemented in this case. A server MUST accept</span>
<span class="sd">    this message also over TCP/IP.</span>

<span class="sd">    Note that the element count for protocol uses the normal size encoding,</span>
<span class="sd">    i.e. unsigned 8-bit integer 1 for one supported protocol. The element count</span>
<span class="sd">    for the channels array, however, always uses an unsigned 16 bit integer.</span>
<span class="sd">    This choice is based on the reference implementations which append channel</span>
<span class="sd">    names to the network buffer and update the count. With normal size</span>
<span class="sd">    encoding, an increment to 254 would change the count from requiring 1 byte</span>
<span class="sd">    to 3 bytes, shifting already added channel names.</span>

<span class="sd">    In caproto-pva, this becomes the :class:`NonstandardArrayField`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_REQUEST</span>

    <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">reserved</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">_response_address</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">response_port</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;sequence_id&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;_response_address&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">16</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;response_port&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;protocols&#39;</span><span class="p">,</span> <span class="n">array_of</span><span class="p">(</span><span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">)),</span>
        <span class="c1"># TODO custom handling as this expects a SHORT count before the number</span>
        <span class="c1"># of arrays. (unsigned/signed?)</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;channel_count&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span>
        <span class="n">NonstandardArrayField</span><span class="p">(</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">ChannelWithID</span><span class="p">,</span>
                              <span class="n">count_attr</span><span class="o">=</span><span class="s1">&#39;channel_count&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">response_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ubyte_array_to_ip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_response_address</span><span class="p">)</span>

    <span class="nd">@response_address</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">response_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_response_address</span> <span class="o">=</span> <span class="n">ip_to_ubyte_array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="SearchRequest.serialize"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.SearchRequest.serialize">[docs]</a>    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">response_address</span><span class="p">:</span> <span class="n">AddressTuple</span><span class="p">,</span>
                 <span class="n">channels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ChannelWithID</span><span class="p">],</span>
                 <span class="o">*</span><span class="p">,</span>
                 <span class="n">protocols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">flags</span><span class="p">:</span> <span class="n">SearchFlags</span> <span class="o">=</span> <span class="n">SearchFlags</span><span class="o">.</span><span class="n">broadcast</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sequence_id</span><span class="o">=</span><span class="n">sequence_id</span><span class="p">,</span>
                         <span class="n">response_address</span><span class="o">=</span><span class="n">response_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">response_port</span><span class="o">=</span><span class="n">response_address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                         <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span> <span class="o">=</span> <span class="n">protocols</span> <span class="k">if</span> <span class="n">protocols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;tcp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span></div>


<div class="viewcode-block" id="SearchResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.SearchResponse">[docs]</a><span class="k">class</span> <span class="nc">SearchResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a SearchRequest.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    guid : str</span>
<span class="sd">        The server&#39;s globally unique identifier.</span>

<span class="sd">    sequence_id : int</span>
<span class="sd">        The sequence id, which should correspond to the request.</span>

<span class="sd">    server_address : AddressTuple</span>
<span class="sd">        The server that hosts the data.</span>

<span class="sd">    search_instance_ids : list of integers</span>
<span class="sd">        The search IDs that have been found (or not).</span>

<span class="sd">    found : bool, optional</span>
<span class="sd">        Whether the given IDs were found on the server or not.  Defaults to</span>
<span class="sd">        `True`.</span>

<span class="sd">    protocol : str = &#39;tcp&#39;</span>
<span class="sd">        The protocol where the search results can be retrieved from. ``tcp``</span>
<span class="sd">        is the only supported option here.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A client MUST examine the protocol member field to verify it supports the</span>
<span class="sd">    given exchange protocol; if not, the search response is ignored.</span>

<span class="sd">    The count for the number of searchInstanceIDs elements is always sent as an</span>
<span class="sd">    unsigned 16 bit integer, not using the default size encoding.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_RESPONSE</span>

    <span class="n">_guid</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_server_address</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">server_port</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;_guid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;sequence_id&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;_server_address&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ubyte</span> <span class="o">*</span> <span class="mi">16</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_port&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">),</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;found&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">boolean</span><span class="p">),</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;search_count&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span>
        <span class="n">NonstandardArrayField</span><span class="p">(</span><span class="s1">&#39;search_instance_ids&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                              <span class="n">count_attr</span><span class="o">=</span><span class="s1">&#39;search_count&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">guid</span> <span class="o">=</span> <span class="n">_array_property</span><span class="p">(</span><span class="s1">&#39;_guid&#39;</span><span class="p">,</span> <span class="s1">&#39;GUID for server&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ubyte_array_to_ip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span><span class="p">)</span>

    <span class="nd">@server_address</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">server_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_address</span> <span class="o">=</span> <span class="n">ip_to_ubyte_array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">guid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">sequence_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">server_address</span><span class="p">:</span> <span class="n">AddressTuple</span><span class="p">,</span>
                 <span class="n">search_instance_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
                 <span class="o">*</span><span class="p">,</span>
                 <span class="n">found</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tcp&#39;</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">guid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence_id</span> <span class="o">=</span> <span class="n">sequence_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_address</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_instance_ids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_instance_ids</span> <span class="o">=</span> <span class="n">search_instance_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="n">found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span></div>


<div class="viewcode-block" id="CreateChannelRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.CreateChannelRequest">[docs]</a><span class="k">class</span> <span class="nc">CreateChannelRequest</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A client&#39;s request to create a channel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A channel provides a communication path between a client and a server</span>
<span class="sd">    hosted &quot;process variable.&quot;  Each channel instance MUST be bound only to one</span>
<span class="sd">    connection.</span>

<span class="sd">    The CreateChannelRequest.channels array starts with a short count, not</span>
<span class="sd">    using the normal size encoding. Current PVA server implementations only</span>
<span class="sd">    support requests for creating a single channel, i.e. the count must be 1.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span>

    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">channels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ChannelWithID</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]]</span>  <span class="c1"># TODO: consistent types</span>

    <span class="n">_fields_</span><span class="p">:</span> <span class="n">CtypesFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span>
        <span class="n">NonstandardArrayField</span><span class="p">(</span><span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="n">ChannelWithID</span><span class="p">,</span> <span class="n">count_attr</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="CreateChannelResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.CreateChannelResponse">[docs]</a><span class="k">class</span> <span class="nc">CreateChannelResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A server&#39;s response to a CreateChannelRequest.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A server MUST store the client ChannelID and respond with its value in a</span>
<span class="sd">    ChannelDestroyRequest, see below.</span>

<span class="sd">    A client uses the serverChannelID value for all subsequent requests on the</span>
<span class="sd">    channel. Agents SHOULD NOT make any assumptions about how given IDs are</span>
<span class="sd">    generated. IDs MUST be unique within a connection and MAY be recycled after</span>
<span class="sd">    a channel is disconnected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span>

    <span class="n">client_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;client_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
        <span class="c1"># TODO access rights aren&#39;t sent, even if status is OK</span>
        <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;access_rights&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int16</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_chid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">access_rights</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_chid</span> <span class="o">=</span> <span class="n">client_chid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_chid</span> <span class="o">=</span> <span class="n">server_chid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_rights</span> <span class="o">=</span> <span class="n">access_rights</span></div>


<div class="viewcode-block" id="ChannelDestroyRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelDestroyRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelDestroyRequest</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request to destroy a previously-created channel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A &quot;destroy channel&quot; message is sent by a client to a server to destroy a</span>
<span class="sd">    channel that was previously created (with a create channel message).</span>

<span class="sd">    A server may also send this message to the client when the channel is no</span>
<span class="sd">    longer available. Examples include a PVA gateway that sends this message</span>
<span class="sd">    from its server side when it lost a channel on its client side.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: caproto-pva does not allow for a server to send this at the moment</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span>
    <span class="n">client_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;client_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ChannelDestroyResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelDestroyResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelDestroyResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a destroy request.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If the request (clientChannelID, serverChannelID) pair does not match, the</span>
<span class="sd">    server MUST respond with an error status. The server MAY break its response</span>
<span class="sd">    into several messages.</span>

<span class="sd">    A server MUST send this message to a client to notify the client about</span>
<span class="sd">    server-side initiated channel destruction. Subsequently, a client MUST mark</span>
<span class="sd">    such channels as disconnected. If the client&#39;s interest in the process</span>
<span class="sd">    variable continues, it MUST start sending search request messages for the</span>
<span class="sd">    channel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span>

    <span class="n">client_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;client_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_chid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">client_chid</span><span class="o">=</span><span class="n">client_chid</span><span class="p">,</span> <span class="n">server_chid</span><span class="o">=</span><span class="n">server_chid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span></div>


<div class="viewcode-block" id="ChannelGetRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelGetRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;channel get&quot; set of messages are used to retrieve (get) data from the channel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">pv_request</span><span class="p">:</span> <span class="n">PVRequest</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelGetRequest.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetRequest.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
              <span class="p">[</span><span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">)])</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_request</span><span class="p">:</span> <span class="n">PVRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelGetRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_request</span> <span class="o">=</span> <span class="n">pv_request</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelGetRequest.to_get"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetRequest.to_get">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">def</span> <span class="nf">to_get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelGetRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelGetResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelGetResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a ChannelGetRequest.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">pv_structure_if</span><span class="p">:</span> <span class="n">FieldDesc</span>
    <span class="n">pv_data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioid</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ioid</span><span class="o">=</span><span class="n">ioid</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="n">subcommand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

<div class="viewcode-block" id="ChannelGetResponse.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetResponse.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
        <span class="p">[</span><span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;pv_structure_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_structure_if</span><span class="p">:</span> <span class="n">FieldDesc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelGetResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the get response.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pv_structure_if : FieldDesc</span>
<span class="sd">            The field description of the data that can be retrieved with a</span>
<span class="sd">            GET/DEFAULT subcommand.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_structure_if</span> <span class="o">=</span> <span class="n">pv_structure_if</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelGetResponse.to_get"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetResponse.to_get">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span>
        <span class="p">[</span><span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;pv_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_data</span><span class="p">:</span> <span class="n">DataWithBitSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelGetResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the get response, including data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pv_data : DataWithBitSet</span>
<span class="sd">            The data to respond with.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`to_default`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_data</span> <span class="o">=</span> <span class="n">pv_data</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelGetResponse.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelGetResponse.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
        <span class="p">[</span><span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;pv_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_data</span><span class="p">:</span> <span class="n">DataWithBitSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelGetResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the get response, including data.  A synonym for &quot;get&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pv_data : DataWithBitSet</span>
<span class="sd">            The data to respond with.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :meth:`to_get`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_data</span> <span class="o">=</span> <span class="n">pv_data</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelFieldInfoRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelFieldInfoRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelFieldInfoRequest</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to retrieve a channel&#39;s type introspection data, i.e., a :class:`FieldDesc`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;sub_field_name&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">string</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ChannelFieldInfoResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelFieldInfoResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelFieldInfoResponse</span><span class="p">(</span><span class="n">AdditionalFieldsMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelFieldInfoRequest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
        <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;field_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioid</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ioid</span><span class="o">=</span><span class="n">ioid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_if</span> <span class="o">=</span> <span class="n">interface</span></div>


<div class="viewcode-block" id="ChannelPutRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelPutRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;channel put&quot; message is used to set (put) data to the channel.</span>

<span class="sd">    After a put request is successfully initialized, the client can issue</span>
<span class="sd">    actual put request(s) on the channel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A &quot;GET_PUT&quot; subcommand here retrieves the remote put structure. This MAY be</span>
<span class="sd">    used by user applications to show data that was set the last time by the</span>
<span class="sd">    application.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelPutRequest.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutRequest.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
        <span class="p">[</span><span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_request</span><span class="p">:</span> <span class="n">PVRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutRequest&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the request.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pv_request : PVRequest</span>
<span class="sd">            The PVRequest for used when requesting to read back the data (not</span>
<span class="sd">            the data to write).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_request</span> <span class="o">=</span> <span class="n">pv_request</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelPutRequest.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutRequest.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;put_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">put_data</span><span class="p">:</span> <span class="n">DataWithBitSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutRequest&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the put.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        put_data : DataWithBitSet</span>
<span class="sd">            The data to write.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_data</span> <span class="o">=</span> <span class="n">put_data</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelPutRequest.to_get"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutRequest.to_get">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_get</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutRequest&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Query the data, according to the INIT PVRequest.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelPutResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelPutResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelPutRequest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">put_structure_if</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FieldDesc</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Status</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioid</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">_StatusOK</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ioid</span><span class="o">=</span><span class="n">ioid</span><span class="p">,</span> <span class="n">subcommand</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">subcommand</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

<div class="viewcode-block" id="ChannelPutResponse.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutResponse.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
        <span class="p">[</span><span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;put_structure_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">put_structure_if</span><span class="p">:</span> <span class="n">FieldDesc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the request.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        put_structure_if : FieldDesc</span>
<span class="sd">            The structure of the data, so the client knows how to write it</span>
<span class="sd">            appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_structure_if</span> <span class="o">=</span> <span class="n">put_structure_if</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelPutResponse.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutResponse.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Respond to the put request.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelPutResponse.to_get"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutResponse.to_get">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;put_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataWithBitSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelPutResponse&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Query the data, according to the client&#39;s INIT PVRequest.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelPutGetRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutGetRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelPutGetRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;channel put-get&quot; set of messages are used to set (put) data to the</span>
<span class="sd">    channel and then immediately retrieve data from the channel. Channels are</span>
<span class="sd">    usually &quot;processed&quot; or &quot;updated&quot; by their host between put and get, so that</span>
<span class="sd">    the get reflects changes in the process variable&#39;s state.</span>

<span class="sd">    After a put-get request is successfully initialized, the client can issue</span>
<span class="sd">    actual put-get request(s) on the channel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A &quot;GET_PUT&quot; request retrieves the remote put structure. This MAY be used by</span>
<span class="sd">    user applications to show data that was set the last time by the</span>
<span class="sd">    application.</span>

<span class="sd">    This is not yet implemented in caproto-pva.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;put_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Get the remote &quot;put request&quot;</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET_PUT</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Get the remote &quot;get request&quot;</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="ChannelPutGetResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelPutGetResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelPutGetResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelPutGetRequest`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is not yet implemented in caproto-pva.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">get_structure_if</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FieldDesc</span><span class="p">]</span>
    <span class="n">put_structure_if</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FieldDesc</span><span class="p">]</span>
    <span class="n">get_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">put_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
    <span class="n">pv_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;put_structure_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">),</span>
            <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;get_structure_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># SuccessField(&#39;pv_data&#39;, Data),  # TODO</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># SuccessField(&#39;get_data&#39;, Data),  # TODO</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">GET_PUT</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># SuccessField(&#39;put_data&#39;, Data),  # TODO</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="ChannelArrayRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelArrayRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelArrayRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;channel array&quot; set of messages are used to handle remote array values.</span>
<span class="sd">    Requests allow a client agent to: retrieve (get) and set (put) data from/to</span>
<span class="sd">    the array, and to change the array&#39;s length (number of valid elements in</span>
<span class="sd">    the array).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is not yet implemented in caproto-pva.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ARRAY</span>
    <span class="c1"># TODO</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="ChannelArrayResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelArrayResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelArrayResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelArrayRequest`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is not yet implemented in caproto-pva.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ARRAY</span>
    <span class="c1"># TODO</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="ChannelRequestDestroy"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRequestDestroy">[docs]</a><span class="k">class</span> <span class="nc">ChannelRequestDestroy</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;destroy request&quot; messages is used destroy any request instance, i.e. an</span>
<span class="sd">    instance with requestID.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    There is no ChannelRequestDestroyResponse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_REQUEST</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ChannelRequestCancel"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRequestCancel">[docs]</a><span class="k">class</span> <span class="nc">ChannelRequestCancel</span><span class="p">(</span><span class="n">Message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;cancel request&quot; messages is used cancel any pending request, i.e. an</span>
<span class="sd">    instance with a requestID.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is not yet implemented in caproto-pva.</span>

<span class="sd">    ** There is no response message defined in the protocol. **</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CANCEL_REQUEST</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="ChannelMonitorRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelMonitorRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &quot;channel monitor&quot; set of messages are used by client agents to indicate</span>
<span class="sd">    that they wish to be asynchronously informed of changes in the state or</span>
<span class="sd">    values of the process variable of a channel.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is currently partially supported by caproto-pva.</span>

<span class="sd">    More details on the</span>
<span class="sd">    `wiki &lt;https://github.com/epics-base/pvAccessCPP/wiki/Protocol-Operation-Monitor&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span>
    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelMonitorRequest.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorRequest.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">),</span>
            <span class="n">OptionalField</span><span class="p">(</span><span class="s1">&#39;queue_size&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
                          <span class="n">stop</span><span class="o">=</span><span class="n">OptionalStopMarker</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span>
                          <span class="n">condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">msg</span><span class="p">,</span> <span class="n">buf</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">&amp;</span>
                                                          <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">PIPELINE</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_request</span><span class="p">:</span> <span class="n">PVRequest</span><span class="p">,</span>
                <span class="n">queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelMonitorRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_request</span> <span class="o">=</span> <span class="n">pv_request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_size</span> <span class="o">=</span> <span class="n">queue_size</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelMonitorRequest.to_start"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorRequest.to_start">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">START</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">START</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelMonitorRequest.to_stop"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorRequest.to_stop">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">STOP</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">STOP</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelMonitorRequest.to_pipeline"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorRequest.to_pipeline">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">PIPELINE</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;nfree&#39;</span><span class="p">,</span> <span class="n">FieldType</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nfree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelMonitorRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">PIPELINE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfree</span> <span class="o">=</span> <span class="n">nfree</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelMonitorResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelMonitorResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelMonitorRequest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">pv_structure_if</span><span class="p">:</span> <span class="n">FieldDesc</span>
    <span class="n">pv_data</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span>
    <span class="n">overrun_bitset</span><span class="p">:</span> <span class="n">BitSet</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Status</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelMonitorResponse.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorResponse.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
            <span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;pv_structure_if&#39;</span><span class="p">,</span> <span class="n">FieldDesc</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span>
                <span class="n">pv_structure_if</span><span class="p">:</span> <span class="n">FieldDesc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelMonitorResponse&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_structure_if</span> <span class="o">=</span> <span class="n">pv_structure_if</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelMonitorResponse.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorResponse.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span>
        <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_data&#39;</span><span class="p">,</span> <span class="n">DataWithBitSet</span><span class="p">),</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;overrun_bitset&#39;</span><span class="p">,</span> <span class="n">BitSet</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_data</span><span class="p">:</span> <span class="n">DataWithBitSet</span><span class="p">,</span>
                   <span class="n">overrun_bitset</span><span class="p">:</span> <span class="n">BitSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelMonitorResponse&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_data</span> <span class="o">=</span> <span class="n">pv_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overrun_bitset</span> <span class="o">=</span> <span class="n">overrun_bitset</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelMonitorResponse.to_pipeline"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelMonitorResponse.to_pipeline">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">PIPELINE</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nfree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelMonitorResponse&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">MonitorSubcommand</span><span class="o">.</span><span class="n">PIPELINE</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelProcessRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelProcessRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelProcessRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &quot;channel process&quot; set of messages are used to indicate to the server that</span>
<span class="sd">    the computation actions associated with a channel should be executed.</span>

<span class="sd">    In EPICS terminology, this means that the channel should be &quot;processed&quot;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    After a process request is successfully initialized, the client can issue</span>
<span class="sd">    the actual process request(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">),</span>
            <span class="c1"># TODO_DOCS typo serverStatusIF -&gt; PVRequestIF</span>
        <span class="p">],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># TODO: not PROCESS?</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="ChannelProcessResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelProcessResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelProcessResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A response to a :class:`ChannelProcessRequest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span> <span class="p">[],</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># TODO: not PROCESS?</span>
        <span class="n">Subcommand</span><span class="o">.</span><span class="n">DESTROY</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="ChannelRpcRequest"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcRequest">[docs]</a><span class="k">class</span> <span class="nc">ChannelRpcRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A remote procedure call request.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The &quot;channel RPC&quot; set of messages are used to provide remote procedure call</span>
<span class="sd">    (RPC) support over pvAccess. After a RPC request is successfully</span>
<span class="sd">    initialized, the client can issue actual RPC request(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span>

    <span class="n">server_chid</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;server_chid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelRpcRequest.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcRequest.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">,</span>
              <span class="p">[</span><span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_request&#39;</span><span class="p">,</span> <span class="n">PVRequest</span><span class="p">)])</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_request</span><span class="p">:</span> <span class="n">PVRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelRpcRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_request</span> <span class="o">=</span> <span class="n">pv_request</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelRpcRequest.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcRequest.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
              <span class="p">[</span><span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;pv_data&#39;</span><span class="p">,</span> <span class="n">FieldDescAndData</span><span class="p">)])</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv_data</span><span class="p">:</span> <span class="n">FieldDescAndData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelRpcRequest&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_data</span> <span class="o">=</span> <span class="n">pv_data</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<div class="viewcode-block" id="ChannelRpcResponse"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcResponse">[docs]</a><span class="k">class</span> <span class="nc">ChannelRpcResponse</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A remote procedure call response.&quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span>

    <span class="n">ioid</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ioid&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int32</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;subcommand&#39;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_byte</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequiredField</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="n">Status</span><span class="p">),</span>
    <span class="p">]</span>

<div class="viewcode-block" id="ChannelRpcResponse.to_init"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcResponse.to_init">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelRpcResponse&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ChannelRpcResponse.to_default"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.ChannelRpcResponse.to_default">[docs]</a>    <span class="nd">@_handles</span><span class="p">(</span><span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span><span class="p">,</span>
              <span class="p">[</span><span class="n">SuccessField</span><span class="p">(</span><span class="s1">&#39;pv_response&#39;</span><span class="p">,</span> <span class="n">FieldDescAndData</span><span class="p">)])</span>
    <span class="k">def</span> <span class="nf">to_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span>
                   <span class="n">pv_response</span><span class="p">:</span> <span class="n">FieldDescAndData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ChannelRpcResponse&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subcommand</span> <span class="o">=</span> <span class="n">Subcommand</span><span class="o">.</span><span class="n">DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pv_response</span> <span class="o">=</span> <span class="n">pv_response</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>


<span class="k">class</span> <span class="nc">OriginTagRequest</span><span class="p">(</span><span class="n">SubcommandMessage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When a client or server receives a packet containing a Search message with</span>
<span class="sd">    flagged &quot;sent as unicast&quot; it may resend this as a multicast to</span>
<span class="sd">    &quot;224.0.0.128&quot; through the loopback interface (&quot;127.0.0.1&quot;).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is not yet implemented in caproto-pva.</span>

<span class="sd">    More details on the `wiki</span>
<span class="sd">    &lt;https://github.com/epics-base/pvAccessCPP/wiki/Protocol-Messages#cmd_origin_tag-0x16&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ID</span> <span class="o">=</span> <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ORIGIN_TAG</span>
    <span class="n">_additional_fields_</span><span class="p">:</span> <span class="n">AdditionalFields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_subcommand_fields_</span><span class="p">:</span> <span class="n">SubcommandFields</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">class</span> <span class="nc">BeaconMessageBE</span><span class="p">(</span><span class="n">BeaconMessage</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">BeaconMessage</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">BeaconMessageLE</span><span class="p">(</span><span class="n">BeaconMessage</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">BeaconMessage</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">EchoBE</span><span class="p">(</span><span class="n">Echo</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">Echo</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">EchoLE</span><span class="p">(</span><span class="n">Echo</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">Echo</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>

<span class="k">class</span> <span class="nc">ChannelDestroyRequestBE</span><span class="p">(</span><span class="n">ChannelDestroyRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelDestroyRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelDestroyRequestLE</span><span class="p">(</span><span class="n">ChannelDestroyRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelDestroyRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelDestroyResponseBE</span><span class="p">(</span><span class="n">ChannelDestroyResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelDestroyResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelDestroyResponseLE</span><span class="p">(</span><span class="n">ChannelDestroyResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelDestroyResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelFieldInfoRequestBE</span><span class="p">(</span><span class="n">ChannelFieldInfoRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelFieldInfoRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelFieldInfoRequestLE</span><span class="p">(</span><span class="n">ChannelFieldInfoRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelFieldInfoRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelFieldInfoResponseBE</span><span class="p">(</span><span class="n">ChannelFieldInfoResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelFieldInfoResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelFieldInfoResponseLE</span><span class="p">(</span><span class="n">ChannelFieldInfoResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelFieldInfoResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelGetRequestBE</span><span class="p">(</span><span class="n">ChannelGetRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelGetRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelGetRequestLE</span><span class="p">(</span><span class="n">ChannelGetRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelGetRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelGetResponseBE</span><span class="p">(</span><span class="n">ChannelGetResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelGetResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelGetResponseLE</span><span class="p">(</span><span class="n">ChannelGetResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelGetResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelMonitorRequestBE</span><span class="p">(</span><span class="n">ChannelMonitorRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelMonitorRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelMonitorRequestLE</span><span class="p">(</span><span class="n">ChannelMonitorRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelMonitorRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelMonitorResponseBE</span><span class="p">(</span><span class="n">ChannelMonitorResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelMonitorResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelMonitorResponseLE</span><span class="p">(</span><span class="n">ChannelMonitorResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelMonitorResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelProcessRequestBE</span><span class="p">(</span><span class="n">ChannelProcessRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelProcessRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelProcessRequestLE</span><span class="p">(</span><span class="n">ChannelProcessRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelProcessRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelProcessResponseBE</span><span class="p">(</span><span class="n">ChannelProcessResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelProcessResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelProcessResponseLE</span><span class="p">(</span><span class="n">ChannelProcessResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelProcessResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutGetRequestBE</span><span class="p">(</span><span class="n">ChannelPutGetRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutGetRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutGetRequestLE</span><span class="p">(</span><span class="n">ChannelPutGetRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutGetRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutGetResponseBE</span><span class="p">(</span><span class="n">ChannelPutGetResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutGetResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutGetResponseLE</span><span class="p">(</span><span class="n">ChannelPutGetResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutGetResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutRequestBE</span><span class="p">(</span><span class="n">ChannelPutRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutRequestLE</span><span class="p">(</span><span class="n">ChannelPutRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutResponseBE</span><span class="p">(</span><span class="n">ChannelPutResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelPutResponseLE</span><span class="p">(</span><span class="n">ChannelPutResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelPutResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRequestDestroyBE</span><span class="p">(</span><span class="n">ChannelRequestDestroy</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRequestDestroy</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRequestDestroyLE</span><span class="p">(</span><span class="n">ChannelRequestDestroy</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRequestDestroy</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRequestCancelBE</span><span class="p">(</span><span class="n">ChannelRequestCancel</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRequestCancel</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRequestCancelLE</span><span class="p">(</span><span class="n">ChannelRequestCancel</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRequestCancel</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRpcRequestBE</span><span class="p">(</span><span class="n">ChannelRpcRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRpcRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRpcRequestLE</span><span class="p">(</span><span class="n">ChannelRpcRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRpcRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRpcResponseBE</span><span class="p">(</span><span class="n">ChannelRpcResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRpcResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ChannelRpcResponseLE</span><span class="p">(</span><span class="n">ChannelRpcResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ChannelRpcResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidatedResponseBE</span><span class="p">(</span><span class="n">ConnectionValidatedResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidatedResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidatedResponseLE</span><span class="p">(</span><span class="n">ConnectionValidatedResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidatedResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidationRequestBE</span><span class="p">(</span><span class="n">ConnectionValidationRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidationRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidationRequestLE</span><span class="p">(</span><span class="n">ConnectionValidationRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidationRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidationResponseBE</span><span class="p">(</span><span class="n">ConnectionValidationResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidationResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">ConnectionValidationResponseLE</span><span class="p">(</span><span class="n">ConnectionValidationResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">ConnectionValidationResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">CreateChannelRequestBE</span><span class="p">(</span><span class="n">CreateChannelRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">CreateChannelRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">CreateChannelRequestLE</span><span class="p">(</span><span class="n">CreateChannelRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">CreateChannelRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">CreateChannelResponseBE</span><span class="p">(</span><span class="n">CreateChannelResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">CreateChannelResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">CreateChannelResponseLE</span><span class="p">(</span><span class="n">CreateChannelResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">CreateChannelResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">SearchRequestBE</span><span class="p">(</span><span class="n">SearchRequest</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">SearchRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">SearchRequestLE</span><span class="p">(</span><span class="n">SearchRequest</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">SearchRequest</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">SearchResponseBE</span><span class="p">(</span><span class="n">SearchResponse</span><span class="p">,</span> <span class="n">_BE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">SearchResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>
<span class="k">class</span> <span class="nc">SearchResponseLE</span><span class="p">(</span><span class="n">SearchResponse</span><span class="p">,</span> <span class="n">_LE</span><span class="p">):</span> <span class="n">_fields_</span> <span class="o">=</span> <span class="n">SearchResponse</span><span class="o">.</span><span class="n">_fields_</span>  <span class="c1"># noqa</span>


<span class="n">messages</span><span class="p">:</span> <span class="n">_MessagesDict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># LITTLE ENDIAN, CLIENT -&gt; SERVER</span>
    <span class="p">(</span><span class="n">LITTLE_ENDIAN</span><span class="p">,</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_CLIENT</span><span class="p">):</span> <span class="p">{</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">BEACON</span><span class="p">:</span> <span class="n">BeaconMessageLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span><span class="p">:</span> <span class="n">ConnectionValidationResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ECHO</span><span class="p">:</span> <span class="n">EchoLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_REQUEST</span><span class="p">:</span> <span class="n">SearchRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span><span class="p">:</span> <span class="n">CreateChannelRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="n">ChannelGetRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span><span class="p">:</span> <span class="n">ChannelFieldInfoRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span><span class="p">:</span> <span class="n">ChannelDestroyRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_REQUEST</span><span class="p">:</span> <span class="n">ChannelRequestDestroyLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span><span class="p">:</span> <span class="n">ChannelPutRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span><span class="p">:</span> <span class="n">ChannelPutGetRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span><span class="p">:</span> <span class="n">ChannelMonitorRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span><span class="p">:</span> <span class="n">ChannelProcessRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span><span class="p">:</span> <span class="n">ChannelRpcRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CANCEL_REQUEST</span><span class="p">:</span> <span class="n">ChannelRequestCancelLE</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># BIG ENDIAN, CLIENT -&gt; SERVER</span>
    <span class="p">(</span><span class="n">BIG_ENDIAN</span><span class="p">,</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_CLIENT</span><span class="p">):</span> <span class="p">{</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">BEACON</span><span class="p">:</span> <span class="n">BeaconMessageBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span><span class="p">:</span> <span class="n">ConnectionValidationResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ECHO</span><span class="p">:</span> <span class="n">EchoBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_REQUEST</span><span class="p">:</span> <span class="n">SearchRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span><span class="p">:</span> <span class="n">CreateChannelRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="n">ChannelGetRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span><span class="p">:</span> <span class="n">ChannelFieldInfoRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span><span class="p">:</span> <span class="n">ChannelDestroyRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_REQUEST</span><span class="p">:</span> <span class="n">ChannelRequestDestroyBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span><span class="p">:</span> <span class="n">ChannelPutRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span><span class="p">:</span> <span class="n">ChannelPutGetRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span><span class="p">:</span> <span class="n">ChannelMonitorRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span><span class="p">:</span> <span class="n">ChannelProcessRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span><span class="p">:</span> <span class="n">ChannelRpcRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CANCEL_REQUEST</span><span class="p">:</span> <span class="n">ChannelRequestCancelBE</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># LITTLE ENDIAN, SERVER -&gt; CLIENT</span>
    <span class="p">(</span><span class="n">LITTLE_ENDIAN</span><span class="p">,</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_SERVER</span><span class="p">):</span> <span class="p">{</span>
        <span class="n">ControlCommand</span><span class="o">.</span><span class="n">SET_ENDIANESS</span><span class="p">:</span> <span class="n">SetByteOrder</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">BEACON</span><span class="p">:</span> <span class="n">BeaconMessageLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span><span class="p">:</span> <span class="n">ConnectionValidationRequestLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ECHO</span><span class="p">:</span> <span class="n">EchoLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATED</span><span class="p">:</span> <span class="n">ConnectionValidatedResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_RESPONSE</span><span class="p">:</span> <span class="n">SearchResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span><span class="p">:</span> <span class="n">CreateChannelResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="n">ChannelGetResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span><span class="p">:</span> <span class="n">ChannelFieldInfoResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span><span class="p">:</span> <span class="n">ChannelDestroyResponseLE</span><span class="p">,</span>
        <span class="c1"># ApplicationCommand.DESTROY_REQUEST: ChannelRequestDestroyResponseLE,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span><span class="p">:</span> <span class="n">ChannelPutResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span><span class="p">:</span> <span class="n">ChannelPutGetResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span><span class="p">:</span> <span class="n">ChannelMonitorResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span><span class="p">:</span> <span class="n">ChannelProcessResponseLE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span><span class="p">:</span> <span class="n">ChannelRpcResponseLE</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="c1"># BIG ENDIAN, SERVER -&gt; CLIENT</span>
    <span class="p">(</span><span class="n">BIG_ENDIAN</span><span class="p">,</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_SERVER</span><span class="p">):</span> <span class="p">{</span>
        <span class="n">ControlCommand</span><span class="o">.</span><span class="n">SET_ENDIANESS</span><span class="p">:</span> <span class="n">SetByteOrder</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">BEACON</span><span class="p">:</span> <span class="n">BeaconMessageBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATION</span><span class="p">:</span> <span class="n">ConnectionValidationRequestBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">ECHO</span><span class="p">:</span> <span class="n">EchoBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CONNECTION_VALIDATED</span><span class="p">:</span> <span class="n">ConnectionValidatedResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">SEARCH_RESPONSE</span><span class="p">:</span> <span class="n">SearchResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">CREATE_CHANNEL</span><span class="p">:</span> <span class="n">CreateChannelResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span> <span class="n">ChannelGetResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">GET_FIELD</span><span class="p">:</span> <span class="n">ChannelFieldInfoResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">DESTROY_CHANNEL</span><span class="p">:</span> <span class="n">ChannelDestroyResponseBE</span><span class="p">,</span>
        <span class="c1"># ApplicationCommand.DESTROY_REQUEST: ChannelRequestDestroyResponseBE,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT</span><span class="p">:</span> <span class="n">ChannelPutResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PUT_GET</span><span class="p">:</span> <span class="n">ChannelPutGetResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">MONITOR</span><span class="p">:</span> <span class="n">ChannelMonitorResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">PROCESS</span><span class="p">:</span> <span class="n">ChannelProcessResponseBE</span><span class="p">,</span>
        <span class="n">ApplicationCommand</span><span class="o">.</span><span class="n">RPC</span><span class="p">:</span> <span class="n">ChannelRpcResponseBE</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>


<div class="viewcode-block" id="read_datagram"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.read_datagram">[docs]</a><span class="k">def</span> <span class="nf">read_datagram</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
                  <span class="n">address</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                  <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">,</span>
                  <span class="o">*</span><span class="p">,</span>
                  <span class="n">fixed_byte_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UserFacingEndian</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">cache</span><span class="p">:</span> <span class="n">CacheContext</span> <span class="o">=</span> <span class="kc">None</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Deserialized</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse bytes from one datagram into one or more commands.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : bytes</span>
<span class="sd">        The data to deserialize.</span>

<span class="sd">    address : (addr, port)</span>
<span class="sd">        The sender&#39;s address.</span>

<span class="sd">    role : Role</span>
<span class="sd">        The role of the sender.</span>

<span class="sd">    fixed_byte_order : UserFacingEndian, optional</span>
<span class="sd">        Use this specific byte order for deserialization.</span>

<span class="sd">    cache : CacheContext, optional</span>
<span class="sd">        The serialization cache.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">direction_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_SERVER</span>
                      <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">SERVER</span>
                      <span class="k">else</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_CLIENT</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">buf</span><span class="p">:</span>
        <span class="c1"># TODO: refactor around read_from_bytestream</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">header_from_wire</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">_MessageHeaderSize</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">_MessageHeaderSize</span><span class="p">:]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Not enough bytes for payload &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="si">}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">payload_size</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>

        <span class="n">msg_class</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span>
            <span class="n">direction_flag</span><span class="p">,</span> <span class="n">use_fixed_byte_order</span><span class="o">=</span><span class="n">fixed_byte_order</span><span class="p">)</span>

        <span class="n">msg</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="n">msg_class</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">off</span> <span class="o">!=</span> <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Payload not consumed in deserialization? &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">off</span><span class="si">}</span><span class="s1"> &lt; </span><span class="si">{</span><span class="n">header</span><span class="o">.</span><span class="n">payload_size</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>

        <span class="n">offset</span> <span class="o">+=</span> <span class="n">off</span>

        <span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">commands</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span></div>


<div class="viewcode-block" id="header_from_wire"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.header_from_wire">[docs]</a><span class="k">def</span> <span class="nf">header_from_wire</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
                     <span class="n">byte_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UserFacingEndian</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MessageHeader&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserialize a message header from the wire.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : bytes</span>
<span class="sd">        The data to deserialize.</span>

<span class="sd">    byte_order : LITTLE_ENDIAN or BIG_ENDIAN, optional</span>
<span class="sd">        Defaults to BIG_ENDIAN, falling back to LITTLE_ENDIAN if incorrect.</span>
<span class="sd">        If specified, the fallback is not attempted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">byte_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use a fixed byte order, ignoring header flags</span>
        <span class="n">header_cls</span> <span class="o">=</span> <span class="p">(</span><span class="n">MessageHeaderLE</span>
                      <span class="k">if</span> <span class="n">byte_order</span> <span class="o">==</span> <span class="n">LITTLE_ENDIAN</span>
                      <span class="k">else</span> <span class="n">MessageHeaderBE</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">header_cls</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">header</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="s1">&#39;invalid header&#39;</span>
        <span class="k">return</span> <span class="n">header</span>

    <span class="c1"># Guess little-endian, but fall back to big-endian if wrong.</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">MessageHeaderLE</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
        <span class="n">magic</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">magic</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;invalid header (magic == </span><span class="si">{</span><span class="n">magic</span><span class="si">}</span><span class="s1"> != 0xca)&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">byte_order</span> <span class="o">!=</span> <span class="n">LITTLE_ENDIAN</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">MessageHeaderBE</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">header</span></div>


<div class="viewcode-block" id="bytes_needed_for_command"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.bytes_needed_for_command">[docs]</a><span class="k">def</span> <span class="nf">bytes_needed_for_command</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">    direction</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (header, num_bytes_needed, segmented)</span>

<span class="sd">    If segmented, num_bytes_needed only applies to the current segment.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># We need at least one header&#39;s worth of bytes to interpret anything.</span>
    <span class="k">if</span> <span class="n">data_len</span> <span class="o">&lt;</span> <span class="n">_MessageHeaderSize</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_MessageHeaderSize</span> <span class="o">-</span> <span class="n">data_len</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">header</span> <span class="o">=</span> <span class="n">header_from_wire</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">byte_order</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                                 <span class="n">use_fixed_byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="p">(</span><span class="n">SetByteOrder</span><span class="p">,</span> <span class="p">)):</span>
        <span class="c1"># SetByteOrder uses the payload in a custom way</span>
        <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span>

    <span class="n">total_size</span> <span class="o">=</span> <span class="n">_MessageHeaderSize</span> <span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span>

    <span class="k">if</span> <span class="n">data_len</span> <span class="o">&lt;</span> <span class="n">total_size</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">total_size</span> <span class="o">-</span> <span class="n">data_len</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">is_segmented</span>
    <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">is_segmented</span></div>


<span class="k">def</span> <span class="nf">_deserialize_unsegmented_message</span><span class="p">(</span>
        <span class="n">msg_class</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="n">header</span><span class="p">:</span> <span class="n">MessageHeader</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">CacheContext</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">payload_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserialize a single, unsegmented message.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    msg_class : Message</span>
<span class="sd">        The message type to deserialize.</span>

<span class="sd">    data : bytes</span>
<span class="sd">        Sufficient data to deserialize the message.</span>

<span class="sd">    header : MessageHeader</span>
<span class="sd">        The associated message header.</span>

<span class="sd">    cache : CacheContext</span>
<span class="sd">        Serialization cache context.</span>

<span class="sd">    payload_size : int, optional</span>
<span class="sd">        The size of the message payload, if needed.  Generally, this can be</span>
<span class="sd">        determined from the header.  However, some messages use the header</span>
<span class="sd">        payload size in &quot;special&quot; ways, so allow overriding it as an argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">payload_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">payload_size</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span>

    <span class="n">cmd</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">off</span> <span class="o">=</span> <span class="n">msg_class</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>

    <span class="c1"># Attach the header for later reference</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>

    <span class="k">if</span> <span class="n">off</span> <span class="o">!=</span> <span class="n">payload_size</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">received_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">received_repr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s1"> repr failed: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s1">)&#39;</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Number of bytes used in deserialization (</span><span class="si">{</span><span class="n">off</span><span class="si">}</span><span class="s1">) did not match &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;full payload size: </span><span class="si">{</span><span class="n">payload_size</span><span class="si">}</span><span class="s1">.  Message: </span><span class="si">{</span><span class="n">received_repr</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">off</span>


<div class="viewcode-block" id="read_from_bytestream"><a class="viewcode-back" href="../../../pva/api.html#caproto.pva._messages.read_from_bytestream">[docs]</a><span class="k">def</span> <span class="nf">read_from_bytestream</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">,</span>
        <span class="n">segment_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">ChannelLifeCycle</span><span class="p">]],</span>
        <span class="n">cache</span><span class="p">:</span> <span class="n">CacheContext</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">byte_order</span><span class="o">=</span><span class="n">UserFacingEndian</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SegmentDeserialized</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Handles segmentation but requires the caller to track it for us.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : bytes</span>
<span class="sd">        The new data.</span>

<span class="sd">    role : Role</span>
<span class="sd">        Their role.</span>

<span class="sd">    segment_state : ChannelLifeCycle, byte, or None</span>
<span class="sd">        The state of segmentation, if available.</span>

<span class="sd">    cache : CacheContext</span>
<span class="sd">        Serialization cache context.</span>

<span class="sd">    byte_order : LITTLE_ENDIAN or BIG_ENDIAN, optional</span>
<span class="sd">        Fixed byte order if server message endianness is to be interpreted on a</span>
<span class="sd">        message-by-message basis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SegmentDeserialized</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_SERVER</span>
                 <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">SERVER</span>
                 <span class="k">else</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">FROM_CLIENT</span><span class="p">)</span>

    <span class="n">header</span><span class="p">,</span> <span class="n">num_bytes_needed</span><span class="p">,</span> <span class="n">segmented</span> <span class="o">=</span> <span class="n">bytes_needed_for_command</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span> <span class="n">byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_bytes_needed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SegmentDeserialized</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ChannelLifeCycle</span><span class="o">.</span><span class="n">NEED_DATA</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">bytes_needed</span><span class="o">=</span><span class="n">num_bytes_needed</span><span class="p">,</span>
            <span class="n">segment_state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">msg_class</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get_message</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                                   <span class="n">use_fixed_byte_order</span><span class="o">=</span><span class="n">byte_order</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">payload_start</span> <span class="o">=</span> <span class="n">_MessageHeaderSize</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">msg_class</span><span class="p">,</span> <span class="p">(</span><span class="n">SetByteOrder</span><span class="p">,</span> <span class="p">)):</span>
        <span class="n">message_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">payload_size</span> <span class="o">=</span> <span class="n">_MessageHeaderSize</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message_start</span> <span class="o">=</span> <span class="n">payload_start</span>
        <span class="n">payload_size</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span>

    <span class="n">message_end</span> <span class="o">=</span> <span class="n">message_start</span> <span class="o">+</span> <span class="n">payload_size</span>
    <span class="n">next_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">message_end</span><span class="p">:]</span>
    <span class="n">payload_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">message_start</span><span class="p">:</span><span class="n">message_end</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">is_segmented</span><span class="p">:</span>
        <span class="n">msg</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">_deserialize_unsegmented_message</span><span class="p">(</span>
            <span class="n">msg_class</span><span class="o">=</span><span class="n">msg_class</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">payload_data</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
            <span class="n">payload_size</span><span class="o">=</span><span class="n">payload_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">SegmentDeserialized</span><span class="p">(</span>
            <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">next_data</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">),</span>
            <span class="n">bytes_needed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">segment_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Otherwise, we&#39;re dealing with a segmented message - a large message</span>
    <span class="c1"># broken up over multiple segments.</span>

    <span class="c1"># TODO: docs indicate payloads should be aligned, but i can&#39;t confirm this</span>
    <span class="c1"># if len(segment_state):</span>
    <span class="c1">#     last_segment = segment_state[-1]</span>
    <span class="c1">#     start_padding = 8 - (len(last_segment) % 8)</span>
    <span class="c1">#     print(&#39;alignment padding&#39;, start_padding)</span>
    <span class="c1">#     message_start += start_padding</span>

    <span class="k">if</span> <span class="n">MessageFlags</span><span class="o">.</span><span class="n">LAST</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
        <span class="c1"># Not the last segment - just return it; need at least another header</span>
        <span class="k">return</span> <span class="n">SegmentDeserialized</span><span class="p">(</span>
            <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ChannelLifeCycle</span><span class="o">.</span><span class="n">NEED_DATA</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">next_data</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="n">message_end</span><span class="p">),</span>
            <span class="n">bytes_needed</span><span class="o">=</span><span class="n">_MessageHeaderSize</span><span class="p">,</span>
            <span class="n">segment_state</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(</span><span class="n">payload_data</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># This is the last segment, combine all and deserialize.</span>
    <span class="n">full_payload</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segment_state</span><span class="p">))</span>
    <span class="n">full_payload</span> <span class="o">+=</span> <span class="n">payload_data</span>

    <span class="n">header</span><span class="o">.</span><span class="n">payload_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_payload</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_deserialize_unsegmented_message</span><span class="p">(</span>
        <span class="n">msg_class</span><span class="o">=</span><span class="n">msg_class</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="nb">memoryview</span><span class="p">(</span><span class="n">full_payload</span><span class="p">),</span>
        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
        <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
        <span class="n">payload_size</span><span class="o">=</span><span class="n">header</span><span class="o">.</span><span class="n">payload_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">SegmentDeserialized</span><span class="p">(</span>
        <span class="n">Deserialized</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">next_data</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">message_end</span><span class="p">),</span>
        <span class="n">bytes_needed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">segment_state</span><span class="o">=</span><span class="n">ChannelLifeCycle</span><span class="o">.</span><span class="n">CLEAR_SEGMENTS</span><span class="p">,</span>
    <span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Daniel Allan

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
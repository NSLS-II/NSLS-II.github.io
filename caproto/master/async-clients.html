

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Asynchronous Clients &mdash; caproto 0.6.0+133.g67516c6b documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/doctr-versions-menu.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Input-Output Controllers (IOCs)" href="iocs.html" />
    <link rel="prev" title="Pyepics-Compatible Client" href="pyepics-compat-client.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> caproto
          

          
          </a>

          
            
            
              <div class="version">
                0.6.0+133.g67516c6b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">EPICS Clients and Servers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="clients.html">Clients</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="command-line-client.html">Command-Line Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="sync-client.html">Synchronous Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="threading-client.html">Threading Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyepics-compat-client.html">Pyepics-Compatible Client</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Asynchronous Clients</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#connect">Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read">Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write">Write</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subscribe-monitor">Subscribe (“Monitor”)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#go-idle">Go Idle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#canceling-searches">Canceling Searches</a></li>
<li class="toctree-l4"><a class="reference internal" href="#events-off-and-on">Events Off and On</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-health-check">Server Health Check</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logs-for-debugging">Logs for Debugging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookiecutter.html">IOC Template Cookiecutter</a></li>
<li class="toctree-l1"><a class="reference internal" href="own_docs.html">Writing Your Own Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">pvAccess</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pva/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="pva/clients.html">Synchronous Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="pva/iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="pva/api.html">PVAccess API</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Caproto-in-a-box</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="clients.html">Clients</a> &raquo;</li>
        
      <li>Asynchronous Clients</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/async-clients.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="asynchronous-clients">
<h1>Asynchronous Clients<a class="headerlink" href="#asynchronous-clients" title="Permalink to this headline">¶</a></h1>
<p>Developers interested in exploring the prototype asyncio client can poke around
the module <code class="xref py py-mod docutils literal notranslate"><span class="pre">caproto.asyncio.client</span></code>. The design is analogous to the
threading client but using asyncio.</p>
<p>While this asyncio client is full-featured as compared to the threading client,
it has had minimal testing, usage, or review.</p>
<p>With that in mind, please let us know if it works for you, or you have feedback
for us.</p>
<p>For those that are looking for information about curio or trio clients, their
prototype implementations have been removed.</p>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>In a separate shell, start one of caproto’s demo IOCs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.random_walk --list-pvs
<span class="o">[</span>I <span class="m">10</span>:37:48.827       server:  <span class="m">133</span><span class="o">]</span> Asyncio server starting up...
<span class="o">[</span>I <span class="m">10</span>:37:48.827       server:  <span class="m">146</span><span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:65442
<span class="o">[</span>I <span class="m">10</span>:37:48.829       server:  <span class="m">205</span><span class="o">]</span> Server startup complete.
<span class="o">[</span>I <span class="m">10</span>:37:48.829       server:  <span class="m">207</span><span class="o">]</span> PVs available:
    random_walk:dt
    random_walk:x
</pre></div>
</div>
<div class="section" id="connect">
<h3>Connect<a class="headerlink" href="#connect" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To do this interactively, you will need a newer version of IPython &gt;= 7
that supports <code class="docutils literal notranslate"><span class="pre">%autoawait</span></code>.</p>
</div>
<p>In Python we will talk to it using caproto’s asyncio client. Start by enabling
<code class="docutils literal notranslate"><span class="pre">%autoawait</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="o">%</span><span class="k">autoawait</span> on
</pre></div>
</div>
<p>Now, create a <a class="reference internal" href="#caproto.asyncio.client.Context" title="caproto.asyncio.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a>.  A requirement for the asyncio client is that
the context must be created within the asyncio loop that will be using it, thus
it must be created in a coroutine.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">caproto.asyncio.client</span> <span class="kn">import</span> <span class="n">Context</span>

<span class="gp">In [3]: </span><span class="k">async</span> <span class="k">def</span> <span class="nf">new_context</span><span class="p">():</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">Context</span><span class="p">()</span>
<span class="gp">   ...: </span>

<span class="gp">In [4]: </span><span class="n">ctx</span> <span class="o">=</span> <span class="k">await</span> <span class="n">new_context</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#caproto.asyncio.client.Context" title="caproto.asyncio.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> object caches connections, manages automatic
re-connection, and tracks the state of connections in progress.  We can use it
to request new connections. Formulating requests for many PVs in a large batch
is efficient. In this example we’ll just ask for two PVs.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">get_pvs</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">,</span> <span class="s1">&#39;random_walk:dt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#caproto.asyncio.client.Context.get_pvs" title="caproto.asyncio.client.Context.get_pvs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Context.get_pvs()</span></code></a>  accepts an arbitrary number of PV names and
immediately returns a collection of <a class="reference internal" href="#caproto.asyncio.client.PV" title="caproto.asyncio.client.PV"><code class="xref py py-class docutils literal notranslate"><span class="pre">PV</span></code></a> objects representing each name.
In a background task, the Context searches for an EPICS server that provides
that PV name and then connects to it. The PV object displays its connection
state:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">dt</span>
<span class="gh">Out[6]: </span><span class="go">&lt;PV name=&#39;random_walk:dt&#39; priority=0 (searching....)&gt;</span>
</pre></div>
</div>
<p>The Context displays aggregate information about the state of all connections.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">ctx</span>
<span class="gh">Out[7]: </span><span class="go">&lt;Context circuits=0 pvs=2 idle=0&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="read">
<h3>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h3>
<p>Now, to read a PV:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dt</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="gp">In [9]: </span><span class="n">res</span>
<span class="gh">Out[9]: </span><span class="go">ReadNotifyResponse(data=array([3.]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)</span>
</pre></div>
</div>
<p>This object is a human-friendly representation of the server’s response. The
raw bytes of that response are:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="nb">bytes</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="gh">Out[10]: </span><span class="go">b&#39;\x00\x0f\x00\x08\x00\x06\x00\x01\x00\x00\x00\x01\x00\x00\x00\x00@\x08\x00\x00\x00\x00\x00\x00&#39;</span>
</pre></div>
</div>
<p>Access particular fields in the response using attribute (“dot”) access on <code class="docutils literal notranslate"><span class="pre">res</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">res</span><span class="o">.</span><span class="n">data</span>
<span class="gh">Out[11]: </span><span class="go">array([3.])</span>
</pre></div>
</div>
<p>By default, the client does not request any metadata</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">res</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter to request a richer data type.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">richer_res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dt</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span>
<span class="gh">Out[14]: </span><span class="go">DBR_TIME_DOUBLE(status=&lt;AlarmStatus.NO_ALARM: 0&gt;, severity=&lt;AlarmSeverity.NO_ALARM: 0&gt;, timestamp=1607449663.740316)</span>

<span class="gp">In [15]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">timestamp</span>
<span class="gh">Out[15]: </span><span class="go">1607449663.740316</span>

<span class="gp">In [16]: </span><span class="n">richer_res</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">as_datetime</span><span class="p">()</span>  <span class="c1"># a convenience method</span>
<span class="gh">Out[16]: </span><span class="go">datetime.datetime(2020, 12, 8, 17, 47, 43, 740316)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#caproto.asyncio.client.PV.read" title="caproto.asyncio.client.PV.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.read()</span></code></a> for more information on the values accepted by the
<code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Performance Note</strong></p>
<p>The underlying metadata and data are stored in efficient, contiguous-memory
data structures.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">res</span><span class="o">.</span><span class="n">header</span>  <span class="c1"># a ctypes.BigEndianStructure</span>
<span class="gh">Out[17]: </span><span class="go">MessageHeader(command=15, payload_size=8, data_type=6, data_count=1, parameter1=1, parameter2=0)</span>

<span class="gp">In [18]: </span><span class="n">res</span><span class="o">.</span><span class="n">buffers</span>  <span class="c1"># a collection of one or more buffers</span>
<span class="gh">Out[18]: </span><span class="go">(b&#39;&#39;, &lt;memory at 0x7fdbfb7651f0&gt;)</span>
</pre></div>
</div>
<p>They were received directly from the socket into these structure with no
intermediate copies. Accessing the <code class="docutils literal notranslate"><span class="pre">res.data</span></code> — which returns a
<code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="docutils literal notranslate"><span class="pre">array.array</span></code> — provides a view onto that same
memory with no copying (if the data was received from the socket all at
once) or one copy (if the data bridged multiple receipts).</p>
</div>
</div>
<div class="section" id="write">
<h3>Write<a class="headerlink" href="#write" title="Permalink to this headline">¶</a></h3>
<p>Let us set the value to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="k">await</span> <span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[19]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=2)</span>
</pre></div>
</div>
<p>By default, we send <code class="docutils literal notranslate"><span class="pre">WriteNotifyResponse</span></code>, wait for a response, and return
it. There are a couple other ways we can handle writes:</p>
<ul>
<li><p>Return immediately, not asking for or waiting for a response.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Return immediately, not waiting for a response, but handing the response
(when it arrived) to some callback function, processed in the background.
Coroutines and regular functions are supported as callbacks.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;got a response:&#39;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<span class="k">await</span> <span class="n">dt</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>See the <a class="reference internal" href="#caproto.asyncio.client.PV.write" title="caproto.asyncio.client.PV.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.write()</span></code></a> for more.</p>
</div>
<div class="section" id="subscribe-monitor">
<h3>Subscribe (“Monitor”)<a class="headerlink" href="#subscribe-monitor" title="Permalink to this headline">¶</a></h3>
<p>Let us now monitor a channel. The server updates the <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> channel
periodically at some period set by <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>. We can subscribe to
updates and fan them out to one or more user-defined callback functions.
First, we define a <a class="reference internal" href="#caproto.asyncio.client.Subscription" title="caproto.asyncio.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">sub</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>
</pre></div>
</div>
<p>Next, we define a callback function, a function that will be called whenever
the server sends an update. It must accept two positional arguments.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [22]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received response from&#39;</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">pv</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>This user-defined function <code class="docutils literal notranslate"><span class="pre">f</span></code> has access to the full response from the
server, which includes data and any metadata. The server’s response does not
include the name of the PV involved (it identifies it indirectly via a
“subscription ID” code) so caproto provides the function with <code class="docutils literal notranslate"><span class="pre">sub</span></code> as well,
from which you can obtain the pertinent PV <code class="docutils literal notranslate"><span class="pre">sub.pv</span></code> and its name
<code class="docutils literal notranslate"><span class="pre">sub.pv.name</span></code> as illustrated above. This is useful for distinguishing
responses when the same function is added to multiple subscriptions.</p>
<p>We register this function with <code class="docutils literal notranslate"><span class="pre">sub</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">token</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">token</span></code> is just an integer which we can use to remove <code class="docutils literal notranslate"><span class="pre">f</span></code> later. We can
define a second callback:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [25]: </span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>and add it to the same subscription, putting no additional load on the network.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go">1</span>
</pre></div>
</div>
<p>After some time has passed, we will have accumulated some responses.  The only
caveat here is that asyncio tasks will not be running in the background until
we start interacting with it.  Let’s sleep for a few seconds - letting asyncio
take control - and see what we get.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [27]: </span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="gp">In [28]: </span><span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">Received response from random_walk:x</span>
<span class="go">Received response from random_walk:x</span>
<span class="go">Received response from random_walk:x</span>
<span class="go">Received response from random_walk:x</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="gh">Out[29]: </span><span class="go">4</span>

<span class="gp">In [30]: </span><span class="n">values</span>
<span class="gh">Out[30]: </span><span class="go"></span>
<span class="go">[-0.38430620650590175,</span>
<span class="go"> -0.6458260945322787,</span>
<span class="go"> -1.2964863293675157,</span>
<span class="go"> -2.103941025261247]</span>
</pre></div>
</div>
<p>An alternative syntax is a bit more convenient here:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="k">async</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sub</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Received value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="k">break</span>
<span class="gp">   ....: </span>
<span class="go">Received value EventAddResponse(data=array([-2.10394103]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), subscriptionid=0, metadata=None)</span>
</pre></div>
</div>
<p>At any point we can remove a specific callback function:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="k">await</span> <span class="n">sub</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<p>or clear all the callbacks on a subscription:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="k">await</span> <span class="n">sub</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to minimize load on the network, a <a class="reference internal" href="#caproto.asyncio.client.Subscription" title="caproto.asyncio.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> waits to
request updates from the server until the first user callback is added. Thus,
the first callback added by the user is guaranteed to get the first response
received from the server. If all user callbacks are later removed, either
explicitly (via <code class="docutils literal notranslate"><span class="pre">remove_callback</span></code> or <code class="docutils literal notranslate"><span class="pre">clear</span></code>) or implicitly via Python
garbage collection, the Subscription automatically cancels future updates from
the server.  If a callback is then later added, the Subscription silently
re-initiates updates. All of this is transparent to the user.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The callback registry in <a class="reference internal" href="#caproto.asyncio.client.Subscription" title="caproto.asyncio.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a>  only holds weak references
to the user callback functions. If there are no other references to the
function, it will be silently garbage collected and removed. Therefore,
constructions like this do not work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
<p>The lambda function will be promptly garbage collected by Python and
removed from <code class="docutils literal notranslate"><span class="pre">sub</span></code> by caproto. To avoid that, make a reference before
passing the function to <a class="reference internal" href="#caproto.asyncio.client.Subscription.add_callback" title="caproto.asyncio.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Subscription.add_callback()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be surprising, but it is a standard approach for avoiding the
accidental costly accumulation of abandoned callbacks.</p>
<p>This pitfall does not apply to callbacks passed to <a class="reference internal" href="#caproto.asyncio.client.PV.read" title="caproto.asyncio.client.PV.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.read()</span></code></a> and
<a class="reference internal" href="#caproto.asyncio.client.PV.write" title="caproto.asyncio.client.PV.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PV.write()</span></code></a> because those are single-shot callbacks that do not
persist beyond their first use.</p>
</div>
</div>
<div class="section" id="go-idle">
<h3>Go Idle<a class="headerlink" href="#go-idle" title="Permalink to this headline">¶</a></h3>
<p>Once created, PVs are cached for the lifetime of the <a class="reference internal" href="#caproto.asyncio.client.Context" title="caproto.asyncio.client.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> and
returned again to the user if a PV with the same name and priority is
requested. In order to reduce the load on the network, a PV can be temporarily
made “idle” (disconnected). It will silently, automatically reconnect the next
time it is used.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [34]: </span><span class="n">x</span>
<span class="gh">Out[34]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 address=(&#39;127.0.0.1&#39;, 5064), circuit_state=States.CONNECTED, channel_state=States.CONNECTED&gt;</span>

<span class="gp">In [35]: </span><span class="k">await</span> <span class="n">x</span><span class="o">.</span><span class="n">go_idle</span><span class="p">()</span>

<span class="gp">In [36]: </span><span class="n">x</span>
<span class="gh">Out[36]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 (idle)&gt;</span>

<span class="gp">In [37]: </span><span class="k">await</span> <span class="n">x</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[37]: </span><span class="go">ReadNotifyResponse(data=array([-2.10394103]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=3, metadata=None)</span>

<span class="gp">In [38]: </span><span class="n">x</span>
<span class="gh">Out[38]: </span><span class="go">&lt;PV name=&#39;random_walk:x&#39; priority=0 address=(&#39;127.0.0.1&#39;, 5064), circuit_state=States.CONNECTED, channel_state=States.CONNECTED&gt;</span>
</pre></div>
</div>
<p>Notice that when the PV was read it automatically reconnected, requiring no
action from the user.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go_idle()</span></code> method is merely a <em>request</em> and is not guaranteed to have
any effect. If a PV has active subscriptions, it will ignore the request: it
must stay active to continue servicing user callbacks. Therefore, it is safe
call <code class="docutils literal notranslate"><span class="pre">go_idle()</span></code> on any PV at any time, knowing that the PV will decline to
disconnect if it is being actively used and that, if it is currently unused, it
will transparently reconnect the next time it is used.</p>
</div>
<div class="section" id="canceling-searches">
<h3>Canceling Searches<a class="headerlink" href="#canceling-searches" title="Permalink to this headline">¶</a></h3>
<p>All unanswered searches are retried repeatedly, with decreasing frequency,
forever. Each new call to <a class="reference internal" href="#caproto.asyncio.client.Context.get_pvs" title="caproto.asyncio.client.Context.get_pvs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_pvs()</span></code></a> causes all unanswered
searches to be retried at least once immediately. This can generate unwanted
network traffic. To fully cancel a search that is never expected to complete,
access the method <code class="xref py py-class docutils literal notranslate"><span class="pre">SharedBroadcaster.cancel</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span><span class="o">.</span><span class="n">broadcaster</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s1">&#39;some typo-ed PV name, for example&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As the name suggests, it is possible to construct multiple Contexts that
share one SharedBroadcaster. In that scenario, notice that canceling the
search will affect all contexts using the SharedBroadcaster.</p>
</div>
<div class="section" id="events-off-and-on">
<h3>Events Off and On<a class="headerlink" href="#events-off-and-on" title="Permalink to this headline">¶</a></h3>
<p>If a given circuit produces updates faster than a client can process them, the
client can suspend subscriptions on that circuit. This will causes the server
to discard all backlogged updates and all new updates during the period of
supsension. When the client reactives subscriptions, it will immediate receive
the most recent update and then any future updates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">await</span> <span class="n">x</span><span class="o">.</span><span class="n">circuit_manager</span><span class="o">.</span><span class="n">events_off</span><span class="p">()</span>
<span class="o">...</span>
<span class="k">await</span> <span class="n">x</span><span class="o">.</span><span class="n">circuit_manager</span><span class="o">.</span><span class="n">events_on</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="server-health-check">
<h3>Server Health Check<a class="headerlink" href="#server-health-check" title="Permalink to this headline">¶</a></h3>
<p>To check how much time has passed (in seconds) since each known server was last
heard from, use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctx</span><span class="o">.</span><span class="n">broadcaster</span><span class="o">.</span><span class="n">time_since_last_heard</span><span class="p">()</span>
</pre></div>
</div>
<p>As a convenience, check on the server connected to a specific PV using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">time_since_last_heard</span><span class="p">()</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="#caproto.asyncio.client.SharedBroadcaster.time_since_last_heard" title="caproto.asyncio.client.SharedBroadcaster.time_since_last_heard"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SharedBroadcaster.time_since_last_heard()</span></code></a> API documentation below
for details.</p>
</div>
<div class="section" id="logs-for-debugging">
<span id="asyncio-client-loggers"></span><h3>Logs for Debugging<a class="headerlink" href="#logs-for-debugging" title="Permalink to this headline">¶</a></h3>
<p>Caproto uses Python’s logging framework, which enables sophisticated log
management. For more information and copy/paste-able examples, see
<a class="reference internal" href="loggers.html#loggers"><span class="std std-ref">Logging</span></a>.</p>
</div>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="caproto.asyncio.client.Context">
<em class="property">class </em><code class="sig-prename descclassname">caproto.asyncio.client.</code><code class="sig-name descname">Context</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">broadcaster</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">host_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">client_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">max_workers</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Context"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Context" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates the state and connections of a client.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>broadcaster</strong><span class="classifier">SharedBroadcaster, optional</span></dt><dd><p>If None is specified, a fresh one is instantiated.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Number of seconds before a CaprotoTimeoutError is raised. This default
can be overridden at the PV level or for any given operation. If unset,
the default is 2 seconds. If None, never timeout. A global timeout can
be specified via an environment variable <code class="docutils literal notranslate"><span class="pre">CAPROTO_DEFAULT_TIMEOUT</span></code>.</p>
</dd>
<dt><strong>host_name</strong><span class="classifier">string, optional</span></dt><dd><p>uses value of <code class="docutils literal notranslate"><span class="pre">socket.gethostname()</span></code> by default</p>
</dd>
<dt><strong>client_name</strong><span class="classifier">string, optional</span></dt><dd><p>uses value of <code class="docutils literal notranslate"><span class="pre">getpass.getuser()</span></code> by default</p>
</dd>
<dt><strong>max_workers</strong><span class="classifier">integer, optional</span></dt><dd><p>Number of worker threaders <em>per VirtualCircuit</em> for executing user
callbacks. Default is 1. For any number of workers, workers will
receive updates in the order which they are received from the server.
That is, work on each update will <em>begin</em> in sequential order.
Work-scheduling internal to the user callback is outside caproto’s
control. If the number of workers is set to greater than 1, the work on
each update may not <em>finish</em> in a deterministic order. For example, if
workers are writing lines into a file, the only way to guarantee that
the lines are ordered properly is to use only one worker. If ordering
matters for your application, think carefully before increasing this
value from 1.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt id="caproto.asyncio.client.Context.get_pvs">
<em class="property">async </em><code class="sig-name descname">get_pvs</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">names</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">connection_state_callback</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">access_rights_callback</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">CONTEXT_DEFAULT_TIMEOUT</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Context.get_pvs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Context.get_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of PV objects.</p>
<p>These objects may not be connected at first. Channel creation occurs on
a background thread.</p>
<p>PVs are uniquely defined by their name and priority. If a PV with the
same name and priority is requested twice, the same (cached) object is
returned. Any callbacks included here are added to added alongside any
existing ones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>*names</strong><span class="classifier">strings</span></dt><dd><p>any number of PV names</p>
</dd>
<dt><strong>priority</strong><span class="classifier">integer</span></dt><dd><p>Used by the server to triage subscription responses when under high
load. 0 is lowest; 99 is highest.</p>
</dd>
<dt><strong>connection_state_callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(pv,</span> <span class="pre">state)</span></code> where <code class="docutils literal notranslate"><span class="pre">pv</span></code> is the instance
of <code class="docutils literal notranslate"><span class="pre">PV</span></code> whose state has changed and <code class="docutils literal notranslate"><span class="pre">state</span></code> is a string</p>
</dd>
<dt><strong>access_rights_callback</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">f(pv,</span> <span class="pre">access_rights)</span></code> where <code class="docutils literal notranslate"><span class="pre">pv</span></code> is the
instance of <code class="docutils literal notranslate"><span class="pre">PV</span></code> whose state has changed and <code class="docutils literal notranslate"><span class="pre">access_rights</span></code> is
a member of the caproto <code class="docutils literal notranslate"><span class="pre">AccessRights</span></code> enum</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Number of seconds before a CaprotoTimeoutError is raised. This
default can be overridden for any specific operation. By default,
fall back to the default timeout set by the Context. If None, never
timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="caproto.asyncio.client.PV">
<em class="property">class </em><code class="sig-prename descclassname">caproto.asyncio.client.</code><code class="sig-name descname">PV</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span></em>, <em class="sig-param"><span class="n">priority</span></em>, <em class="sig-param"><span class="n">context</span></em>, <em class="sig-param"><span class="n">connection_state_callback</span></em>, <em class="sig-param"><span class="n">access_rights_callback</span></em>, <em class="sig-param"><span class="n">timeout</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV" title="Permalink to this definition">¶</a></dt>
<dd><p>These must be instantiated by a Context, never directly.</p>
<dl class="py method">
<dt id="caproto.asyncio.client.PV.timeout">
<em class="property">property </em><code class="sig-name descname">timeout</code><a class="headerlink" href="#caproto.asyncio.client.PV.timeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Effective default timeout.</p>
<p>Valid values are:
* CONTEXT_DEFAULT_TIMEOUT (fall back to Context.timeout)
* a floating-point number
* None (never timeout)</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.circuit_manager">
<em class="property">property </em><code class="sig-name descname">circuit_manager</code><a class="headerlink" href="#caproto.asyncio.client.PV.circuit_manager" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.channel">
<em class="property">property </em><code class="sig-name descname">channel</code><a class="headerlink" href="#caproto.asyncio.client.PV.channel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.access_rights_changed">
<code class="sig-name descname">access_rights_changed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">rights</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.access_rights_changed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.access_rights_changed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.connection_state_changed">
<code class="sig-name descname">connection_state_changed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">state</span></em>, <em class="sig-param"><span class="n">channel</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.connection_state_changed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.connection_state_changed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.connected">
<em class="property">property </em><code class="sig-name descname">connected</code><a class="headerlink" href="#caproto.asyncio.client.PV.connected" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.wait_for_search">
<em class="property">async </em><code class="sig-name descname">wait_for_search</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">PV_DEFAULT_TIMEOUT</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.wait_for_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.wait_for_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for this PV to be found.</p>
<p>This does not wait for the PV’s Channel to be created; it merely waits
for an address (and a VirtualCircuit) to be assigned.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to Context.timeout if not set. If
None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.wait_for_connection">
<em class="property">async </em><code class="sig-name descname">wait_for_connection</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">PV_DEFAULT_TIMEOUT</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.wait_for_connection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.wait_for_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for this PV to be connected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.go_idle">
<em class="property">async </em><code class="sig-name descname">go_idle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.go_idle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.go_idle" title="Permalink to this definition">¶</a></dt>
<dd><p>Request to clear this Channel to reduce load on client and server.</p>
<p>A new Channel will be automatically, silently created the next time any
method requiring a connection is called. Thus, this saves some memory
in exchange for making the next request a bit slower, as it has to
redo the handshake with the server first.</p>
<p>If there are any subscriptions with callbacks, this request will be
ignored. If the PV is in the process of connecting, this request will
be ignored.  If there are any actions in progress (read, write) this
request will be processed when they are complete.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.read">
<em class="property">async </em><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">wait</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">callback</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">PV_DEFAULT_TIMEOUT</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_count</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">notify</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Request a fresh reading.</p>
<p>Can do one or both of:
- Block while waiting for the response, and return it.
- Pass the response to callback, with or without blocking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>wait</strong><span class="classifier">boolean</span></dt><dd><p>If True (default) block until a matching response is
received from the server. Raises CaprotoTimeoutError if that
response is not received within the time specified by the <cite>timeout</cite>
parameter.</p>
</dd>
<dt><strong>callback</strong><span class="classifier">callable or None</span></dt><dd><p>Called with the response as its argument when received.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
<dt><strong>notify: boolean, optional</strong></dt><dd><p>Send a <code class="docutils literal notranslate"><span class="pre">ReadNotifyRequest</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">ReadRequest</span></code>. True by
default.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.write">
<em class="property">async </em><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">wait</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">callback</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">PV_DEFAULT_TIMEOUT</span></em>, <em class="sig-param"><span class="n">notify</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_count</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a new value. Optionally, request confirmation from the server.</p>
<p>Can do one or both of:
- Block while waiting for the response, and return it.
- Pass the response to callback, with or without blocking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data</strong><span class="classifier">str, int, or float or any Iterable of these</span></dt><dd><p>Value(s) to write.</p>
</dd>
<dt><strong>wait</strong><span class="classifier">boolean</span></dt><dd><p>If True (default) block until a matching WriteNotifyResponse is
received from the server. Raises CaprotoTimeoutError if that
response is not received within the time specified by the <cite>timeout</cite>
parameter.</p>
</dd>
<dt><strong>callback</strong><span class="classifier">callable or None</span></dt><dd><p>Called with the WriteNotifyResponse as its argument when received.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
<dt><strong>notify</strong><span class="classifier">boolean or None</span></dt><dd><p>If None (default), set to True if wait=True or callback is set.
Can be manually set to True or False. Will raise ValueError if set
to False while wait=True or callback is set.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Write specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.subscribe">
<code class="sig-name descname">subscribe</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_count</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">low</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">high</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">to</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.subscribe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Start a new subscription to which user callback may be added.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count.</p>
</dd>
<dt><strong>low, high, to</strong><span class="classifier">float, optional</span></dt><dd><p>deprecated by Channel Access, not yet implemented by caproto</p>
</dd>
<dt><strong>mask</strong><span class="classifier">SubscriptionType, optional</span></dt><dd><p>Subscribe to selective updates.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>subscription</strong><span class="classifier">Subscription</span></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Define a subscription.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">subscribe</span><span class="p">()</span>
</pre></div>
</div>
<p>Add a user callback. The subscription will be transparently activated
(i.e. an <code class="docutils literal notranslate"><span class="pre">EventAddRequest</span></code> will be sent) when the first user callback
is added.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">my_func</span><span class="p">)</span>
</pre></div>
</div>
<p>Multiple callbacks may be added to the same subscription.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">another_func</span><span class="p">)</span>
</pre></div>
</div>
<p>See the docstring for <a class="reference internal" href="#caproto.asyncio.client.Subscription" title="caproto.asyncio.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> for more.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.unsubscribe_all">
<em class="property">async </em><code class="sig-name descname">unsubscribe_all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.unsubscribe_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.unsubscribe_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear all subscriptions. (Remove all user callbacks from them.)</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.PV.time_since_last_heard">
<code class="sig-name descname">time_since_last_heard</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">PV_DEFAULT_TIMEOUT</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#PV.time_since_last_heard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.PV.time_since_last_heard" title="Permalink to this definition">¶</a></dt>
<dd><p>Seconds since last message from the server that provides this channel.</p>
<p>The time is reset to 0 whenever we receive a TCP message related to
user activity <em>or</em> a Beacon. Servers are expected to send Beacons at
regular intervals. If we do not receive either a Beacon or TCP message,
we initiate an Echo over TCP, to which the server is expected to
promptly respond.</p>
<p>Therefore, the time reported here should not much exceed
<code class="docutils literal notranslate"><span class="pre">EPICS_CA_CONN_TMO</span></code> (default 30 seconds unless overriden by that
environment variable) if the server is healthy.</p>
<p>If the server fails to send a Beacon on schedule <em>and</em> fails to reply to
an Echo, the server is assumed dead. A warning is issued, and all PVs
are disconnected to initiate a reconnection attempt.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>timeout</strong><span class="classifier">number or None, optional</span></dt><dd><p>Seconds to wait before a CaprotoTimeoutError is raised. Default is
<code class="docutils literal notranslate"><span class="pre">PV.timeout</span></code>, which falls back to <code class="docutils literal notranslate"><span class="pre">PV.context.timeout</span></code> if not
set. If None, never timeout.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="caproto.asyncio.client.Subscription">
<em class="property">class </em><code class="sig-prename descclassname">caproto.asyncio.client.</code><code class="sig-name descname">Subscription</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv</span></em>, <em class="sig-param"><span class="n">data_type</span></em>, <em class="sig-param"><span class="n">data_count</span></em>, <em class="sig-param"><span class="n">low</span></em>, <em class="sig-param"><span class="n">high</span></em>, <em class="sig-param"><span class="n">to</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Subscription"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Subscription" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents one subscription, specified by a PV and configurational parameters</p>
<p>It may fan out to zero, one, or multiple user-registered callback
functions.</p>
<p>This object should never be instantiated directly by user code; rather
it should be made by calling the <code class="docutils literal notranslate"><span class="pre">subscribe()</span></code> method on a <code class="docutils literal notranslate"><span class="pre">PV</span></code> object.</p>
<dl class="py method">
<dt id="caproto.asyncio.client.Subscription.add_callback">
<code class="sig-name descname">add_callback</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Subscription.add_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Subscription.add_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a callback to receive responses.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>func</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
<p>The signature <code class="docutils literal notranslate"><span class="pre">func(response)</span></code> is also supported for
backward-compatibility but will issue warnings. Support will be
removed in a future release of caproto.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>token</strong><span class="classifier">int</span></dt><dd><p>Integer token that can be passed to <a class="reference internal" href="#caproto.asyncio.client.Subscription.remove_callback" title="caproto.asyncio.client.Subscription.remove_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_callback()</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Changed the expected signature of <code class="docutils literal notranslate"><span class="pre">func</span></code> from <code class="docutils literal notranslate"><span class="pre">func(response)</span></code>
to <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.Subscription.clear">
<em class="property">async </em><code class="sig-name descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Subscription.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Subscription.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all callbacks.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.Subscription.remove_callback">
<em class="property">async </em><code class="sig-name descname">remove_callback</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#Subscription.remove_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.Subscription.remove_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove callback using token that was returned by <a class="reference internal" href="#caproto.asyncio.client.Subscription.add_callback" title="caproto.asyncio.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_callback()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>token</strong><span class="classifier">integer</span></dt><dd><p>Token returned by <a class="reference internal" href="#caproto.asyncio.client.Subscription.add_callback" title="caproto.asyncio.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_callback()</span></code></a>.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>The following are internal components. There API may change in the future.</p>
<dl class="py class">
<dt id="caproto.asyncio.client.VirtualCircuitManager">
<em class="property">class </em><code class="sig-prename descclassname">caproto.asyncio.client.</code><code class="sig-name descname">VirtualCircuitManager</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">context</span></em>, <em class="sig-param"><span class="n">circuit</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#VirtualCircuitManager"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates a VirtualCircuit, a TCP socket, and additional state</p>
<p># This object should never be instantiated directly by user code. It is used
# internally by the Context. Its methods may be touched by user code, but
# this is rarely necessary.
#</p>
<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.server_protocol_version">
<em class="property">property </em><code class="sig-name descname">server_protocol_version</code><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.server_protocol_version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.connected">
<em class="property">property </em><code class="sig-name descname">connected</code><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.connected" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.send">
<em class="property">async </em><code class="sig-name descname">send</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">commands</span></em>, <em class="sig-param"><span class="n">extra</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#VirtualCircuitManager.send"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.send" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.events_off">
<em class="property">async </em><code class="sig-name descname">events_off</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#VirtualCircuitManager.events_off"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.events_off" title="Permalink to this definition">¶</a></dt>
<dd><p>Suspend updates to all subscriptions on this circuit.</p>
<p>This may be useful if the server produces updates faster than the
client can processs them.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.events_on">
<em class="property">async </em><code class="sig-name descname">events_on</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#VirtualCircuitManager.events_on"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.events_on" title="Permalink to this definition">¶</a></dt>
<dd><p>Reactive updates to all subscriptions on this circuit.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.VirtualCircuitManager.disconnect">
<em class="property">async </em><code class="sig-name descname">disconnect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#VirtualCircuitManager.disconnect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.VirtualCircuitManager.disconnect" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="caproto.asyncio.client.SharedBroadcaster">
<em class="property">class </em><code class="sig-prename descclassname">caproto.asyncio.client.</code><code class="sig-name descname">SharedBroadcaster</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">registration_retry_time</span><span class="o">=</span><span class="default_value">10.0</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster" title="Permalink to this definition">¶</a></dt>
<dd><p>A broadcaster client which can be shared among multiple Contexts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>registration_retry_time</strong><span class="classifier">float, optional</span></dt><dd><p>The time, in seconds, between attempts made to register with the
repeater. Default is 10.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.add_listener">
<code class="sig-name descname">add_listener</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">listener</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.add_listener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.add_listener" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.remove_listener">
<em class="property">async </em><code class="sig-name descname">remove_listener</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">listener</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.remove_listener"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.remove_listener" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.send">
<em class="property">async </em><code class="sig-name descname">send</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">commands</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.send"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Process a command and tranport it over the UDP socket.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.disconnect">
<em class="property">async </em><code class="sig-name descname">disconnect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.disconnect"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect the broadcaster and stop listening</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.register">
<em class="property">async </em><code class="sig-name descname">register</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.register"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register this client with the CA Repeater.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.search">
<em class="property">async </em><code class="sig-name descname">search</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">results_queue</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">names</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate, process, and transport search request(s)</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.asyncio.client.SharedBroadcaster.time_since_last_heard">
<code class="sig-name descname">time_since_last_heard</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/asyncio/client.html#SharedBroadcaster.time_since_last_heard"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.asyncio.client.SharedBroadcaster.time_since_last_heard" title="Permalink to this definition">¶</a></dt>
<dd><p>Map each known server address to seconds since its last message.</p>
<p>The time is reset to 0 whenever we receive a TCP message related to
user activity <em>or</em> a Beacon. Servers are expected to send Beacons at
regular intervals. If we do not receive either a Beacon or TCP message,
we initiate an Echo over TCP, to which the server is expected to
promptly respond.</p>
<p>Therefore, the time reported here should not much exceed
<code class="docutils literal notranslate"><span class="pre">EPICS_CA_CONN_TMO</span></code> (default 30 seconds unless overriden by that
environment variable) if the server is healthy.</p>
<p>If the server fails to send a Beacon on schedule <em>and</em> fails to reply
to an Echo, the server is assumed dead. A warning is issued, and all
PVs are disconnected to initiate a reconnection attempt.</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="iocs.html" class="btn btn-neutral float-right" title="Input-Output Controllers (IOCs)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pyepics-compat-client.html" class="btn btn-neutral float-left" title="Pyepics-Compatible Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Daniel Allan

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Synchronous Client &mdash; caproto 0.5.2+0.g65eb636.dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Threading Client" href="threading-client.html" />
    <link rel="prev" title="Command-Line Client" href="command-line-client.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> caproto
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2+0.g65eb636.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install Caproto</a></li>
</ul>
<p class="caption"><span class="caption-text">EPICS Clients and Servers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="clients.html">Clients</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="command-line-client.html">Command-Line Client</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Synchronous Client</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#read">Read</a></li>
<li class="toctree-l4"><a class="reference internal" href="#write">Write</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subscribe-monitor">Subscribe (“Monitor”)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stateless-connection-handling">Stateless Connection Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="threading-client.html">Threading Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="pyepics-compat-client.html">Pyepics-Compatible Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="async-clients.html">Asynchronous Clients</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="iocs.html">Input-Output Controllers (IOCs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="records.html">Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="servers.html">Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="shark.html">Shark (pcap/tcpdump parsing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Logging</a></li>
</ul>
<p class="caption"><span class="caption-text">Channel Access Sans I/O</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Writing Your Own Channel Access Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Core API Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://nsls-ii.github.io/caproto/bench/#/">Performance Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocol-compliance.html">Details of our Protocol Compliance for CA Nerds</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Caproto-in-a-box</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caproto</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="clients.html">Clients</a> &raquo;</li>
        
      <li>Synchronous Client</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sync-client.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="synchronous-client">
<h1>Synchronous Client<a class="headerlink" href="#synchronous-client" title="Permalink to this headline">¶</a></h1>
<p>The synchronous client optimizes for simplicity of implementation over
performance. This has its uses, as described below. But for high-performance
applications, use one of caproto’s other clients such as the
<a class="reference internal" href="threading-client.html"><span class="doc">Threading Client</span></a>.</p>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>In a separate shell, start one of caproto’s demo IOCs.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python3 -m caproto.ioc_examples.random_walk
PVs: <span class="o">[</span><span class="s1">&#39;random_walk:dt&#39;</span>, <span class="s1">&#39;random_walk:x&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Now, in Python we will talk to it using caproto’s synchronous client.</p>
<div class="section" id="read">
<h3>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">caproto.sync.client</span> <span class="kn">import</span> <span class="n">read</span>

<span class="gp">In [2]: </span><span class="n">res</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s1">&#39;random_walk:dt&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">res</span>
<span class="gh">Out[3]: </span><span class="go">ReadNotifyResponse(data=array([1.]), data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0, metadata=None)</span>
</pre></div>
</div>
<p>This object is a human-friendly representation of the server’s response. The
raw bytes of that response are:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="nb">bytes</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="gh">Out[4]: </span><span class="go">b&#39;\x00\x0f\x00\x08\x00\x06\x00\x01\x00\x00\x00\x01\x00\x00\x00\x00?\xf0\x00\x00\x00\x00\x00\x00&#39;</span>
</pre></div>
</div>
<p>Access particular fields in the response using attribute (“dot”) access on
<code class="docutils literal notranslate"><span class="pre">res</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">res</span><span class="o">.</span><span class="n">data</span>
<span class="gh">Out[5]: </span><span class="go">array([1.])</span>
</pre></div>
</div>
<p>By default, the client does not request any metadata</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">res</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter to request a richer data type.</p>
<pre class="literal-block">In [7]: richer_res = read('random_walk:dt', data_type='time')

In [8]: richer_res.metadata
Out[8]: DBR_TIME_DOUBLE(status=&lt;AlarmStatus.NO_ALARM: 0&gt;, severity=&lt;AlarmSeverity.NO_ALARM: 0&gt;, timestamp=1595781186.808217)

In [9]: richer_res.metadata.timestamp
Out[9]: 1595781186.808217

In [10]: richer_res.metadata.stamp.as_datetime()  # a convenience method
Out[10]: datetime.datetime(2020, 7, 26, 16, 33, 6, 808217)</pre>
<p>See <a class="reference internal" href="#caproto.sync.client.read" title="caproto.sync.client.read"><code class="xref py py-func docutils literal notranslate"><span class="pre">read()</span></code></a> for more information on the values accepted by the
<code class="docutils literal notranslate"><span class="pre">data_type</span></code> parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Performance Note</strong></p>
<p>The underlying metadata and data are stored in efficient, contiguous-memory
data structures.</p>
<pre class="literal-block">In [11]: res.header  # a ctypes.BigEndianStructure
Out[11]: MessageHeader(command=15, payload_size=8, data_type=6, data_count=1, parameter1=1, parameter2=0)

In [12]: res.buffers  # a collection of one or more buffers
Out[12]: (b'', &lt;memory at 0x7f854d043288&gt;)</pre>
<p>They were received directly from the socket into these structure with no
intermediate copies. Accessing the <code class="docutils literal notranslate"><span class="pre">res.data</span></code> — which returns a
<code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> or <code class="docutils literal notranslate"><span class="pre">array.array</span></code> — provides a view onto that same
memory with no copying (if the data was received from the socket all at
once) or one copy (if the data bridged multiple receipts).</p>
</div>
</div>
<div class="section" id="write">
<h3>Write<a class="headerlink" href="#write" title="Permalink to this headline">¶</a></h3>
<p>Let us set the value to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="kn">from</span> <span class="nn">caproto.sync.client</span> <span class="kn">import</span> <span class="n">write</span>

<span class="gp">In [14]: </span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;random_walk:dt&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The function returns <code class="docutils literal notranslate"><span class="pre">None</span></code> immediately. To wait for confirmation that the
write has been successfully processed by the server, use the <code class="docutils literal notranslate"><span class="pre">notify</span></code> keyword
argument. (This is not guaranteed to be supported by an EPICS server; it may
result in an <code class="docutils literal notranslate"><span class="pre">ErrorResponse</span></code>.)</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="kn">from</span> <span class="nn">caproto.sync.client</span> <span class="kn">import</span> <span class="n">write</span>

<span class="gp">In [16]: </span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;random_walk:dt&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[16]: </span><span class="go">WriteNotifyResponse(data_type=&lt;ChannelType.DOUBLE: 6&gt;, data_count=1, status=CAStatusCode(name=&#39;ECA_NORMAL&#39;, code=0, code_with_severity=1, severity=&lt;CASeverity.SUCCESS: 1&gt;, success=1, defunct=False, description=&#39;Normal successful completion&#39;), ioid=0)</span>
</pre></div>
</div>
</div>
<div class="section" id="subscribe-monitor">
<h3>Subscribe (“Monitor”)<a class="headerlink" href="#subscribe-monitor" title="Permalink to this headline">¶</a></h3>
<p>Let us now monitor a channel. The server updates the <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> channel
periodically at some period set by <code class="docutils literal notranslate"><span class="pre">random_walk:dt</span></code>. We can subscribe
to updates and fan them out to one or more user-defined callback functions.
First, we define a <a class="reference internal" href="#caproto.sync.client.Subscription" title="caproto.sync.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="kn">from</span> <span class="nn">caproto.sync.client</span> <span class="kn">import</span> <span class="n">subscribe</span>

<span class="gp">In [18]: </span><span class="n">sub</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we define a callback function, a function that will be called whenever
the server sends an update. It must accept one positional argument.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [20]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="sd">    On each update, print the PV name and data</span>
<span class="gp">   ....: </span><span class="sd">    Cache the full response in a list.</span>
<span class="gp">   ....: </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">   ....: </span>    <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">pv_name</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>We register this function with <code class="docutils literal notranslate"><span class="pre">sub</span></code>. We can register multiple such functions
is we wish.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">token</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">token</span></code> is just an integer which we can use to remove <code class="docutils literal notranslate"><span class="pre">f</span></code> later.</p>
<p>Because this is a <em>synchronous</em> client, processing subscriptions is a blocking
operation,. (See the <a class="reference internal" href="threading-client.html"><span class="doc">Threading Client</span></a> to process subscriptions on a
separate, background thread.) To activate the subscription, call
<code class="docutils literal notranslate"><span class="pre">sub.block()</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">sub</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>
<span class="go">random_walk:x [14.14272394]</span>
<span class="go">random_walk:x [14.94322537]</span>
<span class="go">random_walk:x [15.35695388]</span>
<span class="go">random_walk:x [15.74301991]</span>
<span class="go">^C</span>
</pre></div>
</div>
<p>This call to <code class="docutils literal notranslate"><span class="pre">sub.block()</span></code> blocks indefinitely, sending a message to the
server to request future updates and then passing its responses to <code class="docutils literal notranslate"><span class="pre">f</span></code> as
they arrive. The server always sends at least one response immediately. When we
are satisfied, we can interrupt it with Ctrl+C (or by calling
<code class="docutils literal notranslate"><span class="pre">sub.interrupt()</span></code> from another thread). The subscription may later be
reactivated by calling <code class="docutils literal notranslate"><span class="pre">sub.block()</span></code> again.</p>
<p>Recall that the user-defined function <code class="docutils literal notranslate"><span class="pre">f</span></code> printed the data from each response
and accumulated the response objects in a list. Indeed, we have captured four
responses.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
<span class="gh">Out[23]: </span><span class="go">4</span>
</pre></div>
</div>
<p>At any point we can remove a specific callback function:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">sub</span><span class="o">.</span><span class="n">remove_callback</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<p>or clear all the callbacks on a subscription:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">sub</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>To activate multiple subscriptions concurrently, use the top-level function
<a class="reference internal" href="#caproto.sync.client.block" title="caproto.sync.client.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block()</span></code></a>, which accepts any number of <a class="reference internal" href="#caproto.sync.client.Subscription" title="caproto.sync.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> objects as
arguments. Again, use Ctrl+C to interrupt (or call <a class="reference internal" href="#caproto.sync.client.interrupt" title="caproto.sync.client.interrupt"><code class="xref py py-func docutils literal notranslate"><span class="pre">interrupt()</span></code></a> from
another thread).</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="kn">from</span> <span class="nn">caproto.sync.client</span> <span class="kn">import</span> <span class="n">block</span>

<span class="gp">In [27]: </span><span class="n">sub_dt</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;random_walk:dt&#39;</span><span class="p">)</span>

<span class="gp">In [28]: </span><span class="n">sub_x</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">)</span>

<span class="gp">In [29]: </span><span class="n">sub_dt</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gh">Out[29]: </span><span class="go">0</span>

<span class="gp">In [30]: </span><span class="n">sub_x</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gh">Out[30]: </span><span class="go">0</span>

<span class="gp">In [31]: </span><span class="n">block</span><span class="p">(</span><span class="n">sub_x</span><span class="p">,</span> <span class="n">sub_dt</span><span class="p">)</span>
<span class="go">random_walk:x [63.34866867]</span>
<span class="go">random_walk:dt [1.]</span>
<span class="go">random_walk:x [63.53448681]</span>
<span class="go">random_walk:x [64.30532391]</span>
<span class="go">^C</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>The expected signature of the callback function was changed from
<code class="docutils literal notranslate"><span class="pre">f(response)</span></code> to <code class="docutils literal notranslate"><span class="pre">f(sub,</span> <span class="pre">response)</span></code>. For backward compatibility,
functions with signature <code class="docutils literal notranslate"><span class="pre">f(response)</span></code> are still accepted, but caproto
will issue a warning that a future release may require the new signature,
<code class="docutils literal notranslate"><span class="pre">f(sub,</span> <span class="pre">response)</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The callback registry in <a class="reference internal" href="#caproto.sync.client.Subscription" title="caproto.sync.client.Subscription"><code class="xref py py-class docutils literal notranslate"><span class="pre">Subscription</span></code></a> only holds weak references
to the user callback functions. If there are no other references to the
function, it will be silently garbage collected and removed. Therefore,
constructions like this do not work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
<p>The lambda function will be promptly garbage collected by Python and
removed from <code class="docutils literal notranslate"><span class="pre">sub</span></code> by caproto. To avoid that, make a reference before
passing the function to <a class="reference internal" href="#caproto.sync.client.Subscription.add_callback" title="caproto.sync.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Subscription.add_callback()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cb</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be surprising, but it is a standard approach for avoiding the
accidental costly accumulation of abandoned callbacks.</p>
</div>
</div>
<div class="section" id="stateless-connection-handling">
<h3>Stateless Connection Handling<a class="headerlink" href="#stateless-connection-handling" title="Permalink to this headline">¶</a></h3>
<p>As noted at the top, the synchronous client is optimized for simplicity of
implementation. While the other caproto clients use the notion of a <em>context</em>
to cache connections, the synchronous client creates a fresh connection for
each function call. This stateless design is sufficient to support the
<a class="reference internal" href="command-line-client.html"><span class="doc">command-line interface</span></a> and it can be useful for
debugging, but it is very inefficient for performing multiple operations on the
same channel.</p>
<p>For the common use case “read / write a new value / read again,” the
synchronous client provides <a class="reference internal" href="#caproto.sync.client.read_write_read" title="caproto.sync.client.read_write_read"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_write_read()</span></code></a>, which uses one connection
for all three operations. For anything more complicated than that, upgrade to
one of the other clients.</p>
</div>
</div>
<div class="section" id="api-documentation">
<h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="caproto.sync.client.read">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv_name</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">notify</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">force_int_enums</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">repeater</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a Channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>pv_name</strong><span class="classifier">str</span></dt><dd><p>The PV name to read from</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">float, optional</span></dt><dd><p>Default is 1 second.</p>
</dd>
<dt><strong>priority</strong><span class="classifier">0, optional</span></dt><dd><p>Virtual Circuit priority. Default is 0, lowest. Highest is 99.</p>
</dd>
<dt><strong>notify</strong><span class="classifier">boolean, optional</span></dt><dd><p>Send a ReadNotifyRequest instead of a ReadRequest. True by default.</p>
</dd>
<dt><strong>force_int_enums</strong><span class="classifier">boolean, optional</span></dt><dd><p>Retrieve enums as integers. (Default is strings.)</p>
</dd>
<dt><strong>repeater</strong><span class="classifier">boolean, optional</span></dt><dd><p>Spawn a Channel Access Repeater process if the port is available.
True default, as the Channel Access spec stipulates that well-behaved
clients should do this.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>response</strong><span class="classifier">ReadResponse or ReadNotifyResponse</span></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Get the value of a Channel named ‘simple:A’.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;simple:A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([1], dtype=int32)</span>
</pre></div>
</div>
<p>Request a richer Channel Access data type that includes the timestamp, and
access the timestamp.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">timestmap</span>
<span class="go">1570622339.042392</span>
</pre></div>
</div>
<p>A convenience method is provided for access the timestamp as a Python
datetime object.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">as_datetime</span><span class="p">()</span>
<span class="go">datetime.datetime(2019, 10, 9, 11, 58, 59, 42392)</span>
</pre></div>
</div>
<p>The requested data type may also been given as a specific Channel Access
type</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">caproto</span> <span class="kn">import</span> <span class="n">ChannelType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="n">ChannelType</span><span class="o">.</span><span class="n">CTRL_FLOAT</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span>
<span class="go">DBR_CTRL_FLOAT(</span>
<span class="go">    status=&lt;AlarmStatus.NO_ALARM: 0&gt;,</span>
<span class="go">    severity=&lt;AlarmSeverity.NO_ALARM: 0&gt;,</span>
<span class="go">    upper_disp_limit=0.0,</span>
<span class="go">    lower_disp_limit=0.0,</span>
<span class="go">    upper_alarm_limit=0.0,</span>
<span class="go">    upper_warning_limit=0.0,</span>
<span class="go">    lower_warning_limit=0.0,</span>
<span class="go">    lower_alarm_limit=0.0,</span>
<span class="go">    upper_ctrl_limit=0.0,</span>
<span class="go">    lower_ctrl_limit=0.0,</span>
<span class="go">    precision=0,</span>
<span class="go">    units=b&#39;&#39;)</span>
</pre></div>
</div>
<p>or the corresponding integer identifer</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span>
<span class="go">DBR_CTRL_FLOAT(</span>
<span class="go">status=&lt;AlarmStatus.NO_ALARM: 0&gt;,</span>
<span class="go">severity=&lt;AlarmSeverity.NO_ALARM: 0&gt;,</span>
<span class="go">upper_disp_limit=0.0,</span>
<span class="go">lower_disp_limit=0.0,</span>
<span class="go">upper_alarm_limit=0.0,</span>
<span class="go">upper_warning_limit=0.0,</span>
<span class="go">lower_warning_limit=0.0,</span>
<span class="go">lower_alarm_limit=0.0,</span>
<span class="go">upper_ctrl_limit=0.0,</span>
<span class="go">lower_ctrl_limit=0.0,</span>
<span class="go">precision=0,</span>
<span class="go">units=b&#39;&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="caproto.sync.client.write">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv_name</span></em>, <em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">notify</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">metadata</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">repeater</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write to a Channel.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>pv_name</strong><span class="classifier">str</span></dt><dd><p>The PV name to write to</p>
</dd>
<dt><strong>data</strong><span class="classifier">str, bytes, int, or float or any Iterable of these</span></dt><dd><p>Value(s) to write.</p>
</dd>
<dt><strong>notify</strong><span class="classifier">boolean, optional</span></dt><dd><p>Request notification of completion and wait for it. False by default.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Write as specific data type. Default is inferred from input.</p>
</dd>
<dt><strong>metadata</strong><span class="classifier"><code class="docutils literal notranslate"><span class="pre">ctypes.BigEndianStructure</span></code> or tuple</span></dt><dd><p>Status and control metadata for the values</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">float, optional</span></dt><dd><p>Default is 1 second.</p>
</dd>
<dt><strong>priority</strong><span class="classifier">0, optional</span></dt><dd><p>Virtual Circuit priority. Default is 0, lowest. Highest is 99.</p>
</dd>
<dt><strong>repeater</strong><span class="classifier">boolean, optional</span></dt><dd><p>Spawn a Channel Access Repeater process if the port is available.
True default, as the Channel Access spec stipulates that well-behaved
clients should do this.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>initial, final</strong><span class="classifier">tuple of ReadNotifyResponse objects</span></dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Write the value 5 to a Channel named ‘simple:A’.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;simple:A&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># returns None</span>
</pre></div>
</div>
<p>Request notification of completion (“put completion”) and wait for it.
&gt;&gt;&gt; write(‘cat’, 5, notify=True)  # blocks until complete, then returns:
WriteNotifyResponse(
data_type=&lt;ChannelType.LONG: 5&gt;,
data_count=1,
status=CAStatusCode(
name=’ECA_NORMAL’, code=0, code_with_severity=1,
severity=&lt;CASeverity.SUCCESS: 1&gt;,
success=1, defunct=False,
description=’Normal successful completion’),
ioid=0)</p>
</dd></dl>

<dl class="py function">
<dt id="caproto.sync.client.subscribe">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">subscribe</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv_name</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_count</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">low</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">high</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">to</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#subscribe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a subscription.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>pv_name</strong><span class="classifier">string</span></dt><dd><p>The PV name to subscribe to</p>
</dd>
<dt><strong>priority</strong><span class="classifier">integer, optional</span></dt><dd><p>Used by the server to triage subscription responses when under high
load. 0 is lowest; 99 is highest.</p>
</dd>
<dt><strong>data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type or a class of data types, matched to the
channel’s native data type. Default is Channel’s native data type.</p>
</dd>
<dt><strong>data_count</strong><span class="classifier">integer, optional</span></dt><dd><p>Requested number of values. Default is the channel’s native data
count, which can be checked in the Channel’s attribute
<code class="xref py py-attr docutils literal notranslate"><span class="pre">native_data_count</span></code>.</p>
</dd>
<dt><strong>low, high, to</strong><span class="classifier">float, optional</span></dt><dd><p>deprecated by Channel Access, not yet implemented by caproto</p>
</dd>
<dt><strong>mask</strong><span class="classifier">SubscriptionType, optional</span></dt><dd><p>Subscribe to selective updates.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Define a subscription on the <code class="docutils literal notranslate"><span class="pre">random_walk:x</span></code> PV.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;random_walk:x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Add one or more user-defined callbacks to process responses.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">repsonse</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">add_callback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Activate the subscription and process incoming responses.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>
</pre></div>
</div>
<p>This is a blocking operation in the sync client. (To do this on a
background thread, use the threading client.) Interrupt using Ctrl+C or
by calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">sub.interrupt()</span></code> from another thread.</p>
<p>The subscription may be reactivated by calling <code class="docutils literal notranslate"><span class="pre">sub.block()</span></code> again.</p>
<p>To process multiple subscriptions at once, use the <em>function</em>
<a class="reference internal" href="#caproto.sync.client.block" title="caproto.sync.client.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block()</span></code></a>, which takes one or more Subscriptions as arguments.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">block</span><span class="p">(</span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">)</span>
</pre></div>
</div>
<p>There is also an <a class="reference internal" href="#caproto.sync.client.interrupt" title="caproto.sync.client.interrupt"><code class="xref py py-func docutils literal notranslate"><span class="pre">interrupt()</span></code></a> function, which is merely an alias to
the method.</p>
</dd></dl>

<dl class="py function">
<dt id="caproto.sync.client.block">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">block</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">subscriptions</span></em>, <em class="sig-param"><span class="n">duration</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">force_int_enums</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">repeater</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#block"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.block" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate one or more subscriptions and process incoming responses.</p>
<p>Use Ctrl+C (SIGINT) to escape, or from another thread, call
<a class="reference internal" href="#caproto.sync.client.interrupt" title="caproto.sync.client.interrupt"><code class="xref py py-func docutils literal notranslate"><span class="pre">interrupt()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>*subscriptions</strong><span class="classifier">Subscriptions</span></dt><dd><p>The list of subscriptions.</p>
</dd>
<dt><strong>duration</strong><span class="classifier">float, optional</span></dt><dd><p>How many seconds to run for. Run forever (None) by default.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">float, optional</span></dt><dd><p>Default is 1 second. This is not the same as <cite>for</cite>; this is the timeout
for failure in the event of no connection.</p>
</dd>
<dt><strong>force_int_enums</strong><span class="classifier">boolean, optional</span></dt><dd><p>Retrieve enums as integers. (Default is strings.)</p>
</dd>
<dt><strong>repeater</strong><span class="classifier">boolean, optional</span></dt><dd><p>Spawn a Channel Access Repeater process if the port is available.
True default, as the Channel Access spec stipulates that well-behaved
clients should do this.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Activate subscription(s) and block while they process updates.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sub1</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub1</span> <span class="o">=</span> <span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;dog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">block</span><span class="p">(</span><span class="n">sub1</span><span class="p">,</span> <span class="n">sub2</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="caproto.sync.client.interrupt">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">interrupt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#interrupt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><p>Signal to <a class="reference internal" href="#caproto.sync.client.block" title="caproto.sync.client.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block()</span></code></a> to stop blocking. Idempotent.</p>
<p>This obviously cannot be called interactively while blocked;
it is intended to be called from another thread.</p>
</dd></dl>

<dl class="py function">
<dt id="caproto.sync.client.read_write_read">
<code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">read_write_read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv_name</span></em>, <em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">notify</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">read_data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">write_data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">metadata</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">force_int_enums</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">repeater</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#read_write_read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.read_write_read" title="Permalink to this definition">¶</a></dt>
<dd><p>Write to a Channel, but sandwich the write between to reads.</p>
<p>This is what the command-line utilities <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code> and <code class="docutils literal notranslate"><span class="pre">caput</span></code> do.
Notice that if you want the second reading to reflect the written value,
you should pass the parameter <code class="docutils literal notranslate"><span class="pre">notify=True</span></code>. (This is also true of
<code class="docutils literal notranslate"><span class="pre">caproto-put</span></code>/<code class="docutils literal notranslate"><span class="pre">caput</span></code>, which needs the <code class="docutils literal notranslate"><span class="pre">-c</span></code> argument to behave the
way you might expect it to behave.)</p>
<p>This is provided as a separate function in order to support <code class="docutils literal notranslate"><span class="pre">caproto-put</span></code>
efficiently. Making separate calls to <a class="reference internal" href="#caproto.sync.client.read" title="caproto.sync.client.read"><code class="xref py py-func docutils literal notranslate"><span class="pre">read()</span></code></a> and <a class="reference internal" href="#caproto.sync.client.write" title="caproto.sync.client.write"><code class="xref py py-func docutils literal notranslate"><span class="pre">write()</span></code></a> would
re-create a connection redundantly.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>pv_name</strong><span class="classifier">str</span></dt><dd><p>The PV name to write/read/write</p>
</dd>
<dt><strong>data</strong><span class="classifier">str, bytes, int, or float or any Iterable of these</span></dt><dd><p>Value to write.</p>
</dd>
<dt><strong>notify</strong><span class="classifier">boolean, optional</span></dt><dd><p>Request notification of completion and wait for it. False by default.</p>
</dd>
<dt><strong>read_data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Request specific data type.</p>
</dd>
<dt><strong>write_data_type</strong><span class="classifier">{‘native’, ‘status’, ‘time’, ‘graphic’, ‘control’} or ChannelType or int ID, optional</span></dt><dd><p>Write as specific data type. Default is inferred from input.</p>
</dd>
<dt><strong>metadata</strong><span class="classifier"><code class="docutils literal notranslate"><span class="pre">ctypes.BigEndianStructure</span></code> or tuple</span></dt><dd><p>Status and control metadata for the values</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">float, optional</span></dt><dd><p>Default is 1 second.</p>
</dd>
<dt><strong>priority</strong><span class="classifier">0, optional</span></dt><dd><p>Virtual Circuit priority. Default is 0, lowest. Highest is 99.</p>
</dd>
<dt><strong>force_int_enums</strong><span class="classifier">boolean, optional</span></dt><dd><p>Retrieve enums as integers. (Default is strings.)</p>
</dd>
<dt><strong>repeater</strong><span class="classifier">boolean, optional</span></dt><dd><p>Spawn a Channel Access Repeater process if the port is available.
True default, as the Channel Access spec stipulates that well-behaved
clients should do this.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>initial, write_response, final</strong><span class="classifier">tuple of response</span></dt><dd></dd>
<dt>The middle response comes from the write, and it will be <code class="docutils literal notranslate"><span class="pre">None</span></code> unless</dt><dd></dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify=True</span></code>.</dt><dd></dd>
</dl>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Write the value 5 to a Channel named ‘simple:A’.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read_write_read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># returns initial, None, final</span>
</pre></div>
</div>
<p>Request notification of completion (“put completion”) and wait for it.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">read_write_read</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># initial, WriteNotifyResponse, final</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt id="caproto.sync.client.Subscription">
<em class="property">class </em><code class="sig-prename descclassname">caproto.sync.client.</code><code class="sig-name descname">Subscription</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pv_name</span></em>, <em class="sig-param"><span class="n">priority</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">data_type</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">data_count</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">low</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">high</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">to</span><span class="o">=</span><span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription" title="Permalink to this definition">¶</a></dt>
<dd><p>This object encapsulates state related to a Subscription.</p>
<p>See the <a class="reference internal" href="#caproto.sync.client.subscribe" title="caproto.sync.client.subscribe"><code class="xref py py-func docutils literal notranslate"><span class="pre">subscribe()</span></code></a> function.</p>
<dl class="py method">
<dt id="caproto.sync.client.Subscription.add_callback">
<code class="sig-name descname">add_callback</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">func</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.add_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.add_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a callback to receive responses.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>func</strong><span class="classifier">callable</span></dt><dd><p>Expected signature: <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
<p>The signature <code class="docutils literal notranslate"><span class="pre">func(response)</span></code> is also supported for
backward-compatibility but will issue warnings. Support will be
removed in a future release of caproto.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>token</strong><span class="classifier">int</span></dt><dd><p>Integer token that can be passed to <a class="reference internal" href="#caproto.sync.client.Subscription.remove_callback" title="caproto.sync.client.Subscription.remove_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove_callback()</span></code></a>.</p>
</dd>
</dl>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.5.0: </span>Changed the expected signature of <code class="docutils literal notranslate"><span class="pre">func</span></code> from <code class="docutils literal notranslate"><span class="pre">func(response)</span></code>
to <code class="docutils literal notranslate"><span class="pre">func(sub,</span> <span class="pre">response)</span></code>.</p>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.sync.client.Subscription.block">
<code class="sig-name descname">block</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">duration</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">timeout</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">force_int_enums</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">repeater</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.block"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.block" title="Permalink to this definition">¶</a></dt>
<dd><p>Activate one or more subscriptions and process incoming responses.</p>
<p>Use Ctrl+C (SIGINT) to escape, or from another thread, call
<a class="reference internal" href="#caproto.sync.client.interrupt" title="caproto.sync.client.interrupt"><code class="xref py py-meth docutils literal notranslate"><span class="pre">interrupt()</span></code></a>.</p>
<p>Convenience alias for the top-level function <a class="reference internal" href="#caproto.sync.client.block" title="caproto.sync.client.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block()</span></code></a>, which may
be used to process multiple Subscriptions concurrently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>duration</strong><span class="classifier">float, optional</span></dt><dd><p>How many seconds to run for. Run forever (None) by default.</p>
</dd>
<dt><strong>timeout</strong><span class="classifier">float, optional</span></dt><dd><p>Default is 1 second. This is not the same as <cite>for</cite>; this is the
timeout for failure in the event of no connection.</p>
</dd>
<dt><strong>force_int_enums</strong><span class="classifier">boolean, optional</span></dt><dd><p>Retrieve enums as integers. (Default is strings.)</p>
</dd>
<dt><strong>repeater</strong><span class="classifier">boolean, optional</span></dt><dd><p>Spawn a Channel Access Repeater process if the port is available.
True default, as the Channel Access spec stipulates that
well-behaved clients should do this.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="caproto.sync.client.Subscription.clear">
<code class="sig-name descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all callbacks. If currently blocking, interrupt.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.sync.client.Subscription.interrupt">
<code class="sig-name descname">interrupt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.interrupt"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><p>Signal to block() to stop blocking. Idempotent.</p>
<p>This obviously cannot be called interactively while blocked;
it is intended to be called from another thread.
This method is a convenience alias for the top-level function
<a class="reference internal" href="#caproto.sync.client.interrupt" title="caproto.sync.client.interrupt"><code class="xref py py-func docutils literal notranslate"><span class="pre">interrupt()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.sync.client.Subscription.process">
<code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">response</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.process"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the callbacks on a response.</p>
<p>This is used internally by <a class="reference internal" href="#caproto.sync.client.block" title="caproto.sync.client.block"><code class="xref py py-func docutils literal notranslate"><span class="pre">block()</span></code></a>, generally not called by the
user.</p>
</dd></dl>

<dl class="py method">
<dt id="caproto.sync.client.Subscription.remove_callback">
<code class="sig-name descname">remove_callback</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cb_id</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/caproto/sync/client.html#Subscription.remove_callback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#caproto.sync.client.Subscription.remove_callback" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove callback using token that was returned by <a class="reference internal" href="#caproto.sync.client.Subscription.add_callback" title="caproto.sync.client.Subscription.add_callback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_callback()</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="threading-client.html" class="btn btn-neutral float-right" title="Threading Client" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="command-line-client.html" class="btn btn-neutral float-left" title="Command-Line Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017, Daniel Allan

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
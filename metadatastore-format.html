<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Format of Metadatastore Entries &mdash; NSLS-II Standards 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="NSLS-II Standards 0.0.1 documentation" href="index.html" />
    <link rel="prev" title="Welcome to NSLS-II Standards’s documentation!" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          NSLS-II Standards</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Format of Metadatastore Entries</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Format of Metadatastore Entries</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#time">Time</a></li>
<li><a class="reference internal" href="#event-type">Event Type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#events">Events</a><ul>
<li><a class="reference internal" href="#start-and-end-run-events">Start and End Run Events</a></li>
<li><a class="reference internal" href="#trigger-events-and-event-descriptors">Trigger Events and Event Descriptors</a></li>
<li><a class="reference internal" href="#measure-events-and-event-descriptors">Measure Events and Event Descriptors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Welcome to NSLS-II Standards’s documentation!"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Welcome to NSLS-...</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/metadatastore-format.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="format-of-metadatastore-entries">
<h1>Format of Metadatastore Entries<a class="headerlink" href="#format-of-metadatastore-entries" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The metadatastore is based on the concept of documents which are either
events, or descriptions of events.  An <tt class="docutils literal"><span class="pre">event</span></tt> is a quantum of data
stored in the metadata store and represents an <em>action</em> at a given time. For
example: &#8220;<em>measurement of 8 scaler chanels</em>&#8221;, &#8220;<em>trigger detectors</em>&#8221; or
&#8220;<em>start run</em>&#8221;.</p>
<p>Expanding the notion of <strong>events</strong>, these can also be used for derived data.
For example, an event could be the result of a data analysis or reduction
routine which was run at a certain time.</p>
<div class="section" id="time">
<h3>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h3>
<p>One of the cornerstones of this data acquisition and analysis method is the use
of <em>time</em> as the method by which data can be aligned and correlated. A single
<tt class="docutils literal"><span class="pre">event</span></tt> should have happened at a certain quantum of time with the
determination of what a time <em>quantum</em> is left to the details of the
experiment. Time however, can be horrendously messy. Throughout this
section we use two terms, <tt class="docutils literal"><span class="pre">timestamp</span></tt> and <tt class="docutils literal"><span class="pre">time</span></tt>. These mean:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">time</span></tt> : The date/time as found at the client side when an <tt class="docutils literal"><span class="pre">event</span></tt> is
created. This could be a date-time format as determined by the underlying
storage method (for example a database)</li>
<li><tt class="docutils literal"><span class="pre">timestamp</span></tt> : A (usually <em>float</em>) representation of the hardware time when a
certain value was obtained. Wherever possible this should be read from
hardware. For example, this could be the <em>EPICS</em> timestamp from when the
record processed which provides the value.</li>
</ul>
<p>We use the literal <tt class="docutils literal"><span class="pre">&lt;time&gt;</span></tt> to indicate a client side date/time and
<tt class="docutils literal"><span class="pre">&lt;timestamp&gt;</span></tt> to represent the numerical timestamp.</p>
</div>
<div class="section" id="event-type">
<h3>Event Type<a class="headerlink" href="#event-type" title="Permalink to this headline">¶</a></h3>
<p>In order to allow the <strong>event</strong> concept to be applied to many different events,
events must have a <em>type</em>.
These event types are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">measure</span></tt> : A measurement of data from external sources. For example,
reading a scaler or taking a CCD image.</li>
<li><tt class="docutils literal"><span class="pre">trigger</span></tt> : An event which occurred because data sources were triggered.
For example, starting a scaler or CCD acquisition.</li>
<li><tt class="docutils literal"><span class="pre">reduce</span></tt> : The result of a data reduction routine, such as background
subtraction and suppression.</li>
<li><tt class="docutils literal"><span class="pre">analyze</span></tt> : The result of a data analysis output.</li>
<li><tt class="docutils literal"><span class="pre">start_run</span></tt> : An event which is created when a data collection run starts.</li>
<li><tt class="docutils literal"><span class="pre">end_run</span></tt> : An event which is created when a data collection run ends.</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Add dictionary of reserved keys such as <tt class="docutils literal"><span class="pre">timestamp</span></tt>, <tt class="docutils literal"><span class="pre">id</span></tt>
Expand for data collection, using event model</p>
</div>
</div>
</div>
<div class="section" id="events">
<h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>Events are the smallest quantum of data stored in the metadatastore. They group
values which are associated with temporally identical data. The definition of
&#8220;temporally identical&#8221; is determined by the DAQ system. For example, the 32
channels in a scaler can be considered to be temporally identical because they
are hardware synchronized. Inclusion of a CCD image (with a reference to the
file store) can be included if this event is triggered at the same time, either
by software or hardware.  Each <tt class="docutils literal"><span class="pre">event</span></tt> contains the data values and a client
side timestamp of when the even was created. The same logic is applied to
<tt class="docutils literal"><span class="pre">trigger</span> <span class="pre">events</span></tt>. These are grouped with temporally identical triggers (again
determined by the DAQ philosophy).</p>
<div class="section" id="start-and-end-run-events">
<h3>Start and End Run Events<a class="headerlink" href="#start-and-end-run-events" title="Permalink to this headline">¶</a></h3>
<p>The beginning of a data collection run creates an event which contains
sufficient metadata and information to describe the data collection. For
example, this is where beamline config information is located. The start run
event also serves as a searchable entity which links all data associated by an
event. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>start_event_b : {
    &quot;uid&quot; : &lt;uid&gt;,
    &quot;scan_id&quot; : &lt;non-unique-id&gt;,
    &quot;beamline_id: : &lt;string&gt;,
    &quot;sample&quot; : {
        &quot;uid&quot; : &lt;uid&gt;
        &quot;id&quot; : &lt;number&gt;,
        &quot;description&quot; : &lt;string&gt;
    }
    &quot;project&quot; : &lt;string&gt;,
    &quot;beamline_config&quot; : {
        &quot;diffractometer&quot; : {
            &quot;geometry&quot; : &lt;string&gt;,
            &quot;xtal_lattice&quot; : {
                &quot;a&quot; : &lt;float&gt;,
                &quot;b&quot; : &lt;float&gt;,
                &quot;c&quot; : &lt;float&gt;,
                &quot;alpha&quot; : &lt;float&gt;,
                &quot;beta&quot; : &lt;float&gt;,
                &quot;gamma&quot; : &lt;float&gt;
            }
            &quot;UB&quot; : [...]
        }
    },
    &quot;time&quot; : &lt;time&gt;
}
</pre></div>
</div>
<p>With the corresponding end run event as:</p>
<div class="highlight-python"><div class="highlight"><pre>end_run_event_c : {
    &quot;uid&quot; : &lt;id&gt;,
    &quot;run_hdr&quot; : &lt;id&gt;,
    &quot;reason&quot; : &lt;string&gt;,
    &quot;time&quot; : &lt;time&gt;
}
</pre></div>
</div>
<p>The field <tt class="docutils literal"><span class="pre">reason</span></tt> can be used to describe why a run ended e.g. was it aborted or
was there an exception during data collection. The field <tt class="docutils literal"><span class="pre">start_id</span></tt> is a
pointer to the start event.</p>
</div>
<div class="section" id="trigger-events-and-event-descriptors">
<span id="trigger-events"></span><h3>Trigger Events and Event Descriptors<a class="headerlink" href="#trigger-events-and-event-descriptors" title="Permalink to this headline">¶</a></h3>
<p>Trigger events follow the same format as <a class="reference internal" href="#measure-events"><em>Measure Events and Event Descriptors</em></a>
with the exception that there is usually no data associated with the trigger.</p>
<p>For example a trigger of a scaler and a CCD frame would be:</p>
<div class="highlight-python"><div class="highlight"><pre>event_trigger_a : {
    &quot;uid&quot; : &lt;uid&gt;,
    &quot;data&quot; : {
        &quot;sclr&quot; : {&quot;timestamp&quot; : &lt;ts&gt; }
        &quot;ccd&quot; : {&quot;timestamp&quot; : &lt;ts&gt; }
    }
    &quot;seq_num&quot; : &lt;integer&gt;,
    &quot;time&quot; : &lt;time&gt;
}

event_trigger_descriptor_a : {
    &quot;uid&quot; : &lt;uid&gt;,
    &quot;type&quot; : &quot;trigger&quot;,
    &quot;keys&quot; : {
        &quot;sclr&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.CNT&quot;, &quot;value&quot; : 1 }
        &quot;ccd&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Dif-Cam:PIMTE}cam1:Acquire&quot;,
                 &quot;value&quot;, 1 }
    }
    &quot;run_hdr&quot; : &lt;uid&gt;,
    &quot;time&quot; : &lt;time&gt;
}
</pre></div>
</div>
<p>Where as before <tt class="docutils literal"><span class="pre">run</span></tt> is a pointer to the start run event. The field
<tt class="docutils literal"><span class="pre">seq_num</span></tt> is used for stepwise, <em>&#8220;scanning&#8221;</em> type acquisition.</p>
</div>
<div class="section" id="measure-events-and-event-descriptors">
<span id="measure-events"></span><h3>Measure Events and Event Descriptors<a class="headerlink" href="#measure-events-and-event-descriptors" title="Permalink to this headline">¶</a></h3>
<p>Measure events contain the data measured at a certain instance in time or
explicit point in a sequence. Unlike <a class="reference internal" href="#trigger-events"><em>Trigger Events and Event Descriptors</em></a> they contain actual
data. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>measure_event_a : {
    &quot;uid&quot; : &lt;uid&gt;,
    &quot;seq_num&quot; : &lt;integer&gt;,
    &quot;ev_desc&quot; : &lt;uid&gt;,
    &quot;data&quot; : {
        &quot;chan1&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan2&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan3&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan4&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan5&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan6&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan7&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;chan8&quot; : {&quot;value&quot; : &lt;value&gt;, &quot;timestamp&quot; : &lt;ts&gt;},
        &quot;pimte&quot; : {&quot;value&quot; : &lt;uid&gt;, &quot;timestamp&quot; : &lt;ts&gt;}
    }
    &quot;time&quot; : &lt;time&gt;
}
</pre></div>
</div>
<p>Where the keys <tt class="docutils literal"><span class="pre">uid</span></tt>, <tt class="docutils literal"><span class="pre">ev_desc</span></tt> and <tt class="docutils literal"><span class="pre">timestamp</span></tt> refer to the unique id, a
link to the event descriptor and the EPICS timestamp respectively.</p>
<p>The field <tt class="docutils literal"><span class="pre">seq_num</span></tt> can be used by step-wise data collection to determine the
order of the events in a run, as in <a class="reference internal" href="#trigger-events"><em>Trigger Events and Event Descriptors</em></a>.</p>
<p>Event descriptors are used to describe an array of events which can form an
event stream of a collection of events. For example a run forms
event_descriptors at run start to define the data collected. For the example
above <tt class="docutils literal"><span class="pre">event</span></tt> is described by the <tt class="docutils literal"><span class="pre">event_descriptor</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>event_desc_a : {
    &quot;uid&quot; : &lt;uid&gt;,
    &quot;type&quot; : &quot;measure&quot;,
    &quot;keys&quot; : {
        &quot;chan1&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S1&quot;},
        &quot;chan2&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S2&quot;},
        &quot;chan3&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S3&quot;},
        &quot;chan4&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S4&quot;},
        &quot;chan5&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S5&quot;},
        &quot;chan6&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S6&quot;},
        &quot;chan7&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S7&quot;},
        &quot;chan8&quot; : {&quot;source&quot; : &quot;PV:XF:23ID1-ES{Sclr:1}.S8&quot;},
        &quot;pimte: : {&quot;source&quot; : &quot;FILESTORE:&lt;...&gt;&quot;}
    },
    &quot;run_hdr&quot; : &lt;uid&gt;,
    &quot;time&quot; : &lt;time&gt;
}
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Stuart B. Wilkins.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>
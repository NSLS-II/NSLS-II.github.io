

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Intake Bluesky 0.1.0a9 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API and Design Documentation" href="api.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Intake Bluesky
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0a9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#read-data-as-xarray">Read Data as Xarray</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-data-as-bluesky-documents">Read Data as Bluesky “Documents”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#search">Search</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API and Design Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Intake Bluesky</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://mybinder.org/v2/gh/NSLS-II/intake-bluesky-demos/master">Launch Binder</a>
to explore some interactive examples.</p>
<p><em>This is a quick example to give a feel for how it would work to acquire
data using bluesky and access it using intake.</em></p>
<p>Acquire data. In this case we’ll serialize the stream of “documents” generated
by bluesky to simple text files. See the Binder link above for an example with
a live MongoDB.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">bluesky</span> <span class="kn">import</span> <span class="n">RunEngine</span>

<span class="gp">In [2]: </span><span class="n">RE</span> <span class="o">=</span> <span class="n">RunEngine</span><span class="p">()</span>

<span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">bluesky.plans</span> <span class="kn">import</span> <span class="n">scan</span>

<span class="gp">In [4]: </span><span class="kn">from</span> <span class="nn">ophyd.sim</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">motor</span>

<span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">suitcase.jsonl</span> <span class="kn">import</span> <span class="n">Serializer</span>

<span class="gp">In [6]: </span><span class="n">serializer</span> <span class="o">=</span> <span class="n">Serializer</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">uid</span><span class="p">,</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">scan</span><span class="p">([</span><span class="n">det</span><span class="p">],</span> <span class="n">motor</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">serializer</span><span class="p">)</span>

<span class="gp">In [8]: </span><span class="n">serializer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>We’ll access the data using intake locally. See the Binder link above for an
example using a HTTP server, where the user may not have direct access to the
file system where the data files are stored.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="kn">from</span> <span class="nn">intake_bluesky.jsonl</span> <span class="kn">import</span> <span class="n">BlueskyJSONLCatalog</span>

<span class="gp">In [10]: </span><span class="kn">import</span> <span class="nn">glob</span>

<span class="gp">In [11]: </span><span class="n">catalog</span> <span class="o">=</span> <span class="n">BlueskyJSONLCatalog</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/*.jsonl&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="read-data-as-xarray">
<h2>Read Data as Xarray<a class="headerlink" href="#read-data-as-xarray" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="gh">Out[12]: </span><span class="go">name: cae9b429-c827-4cd5-9ac0-437780412729</span>
<span class="go">container: bluesky-run</span>
<span class="go">plugin: [&#39;catalog&#39;]</span>
<span class="go">description: </span>
<span class="go">direct_access: forbid</span>
<span class="go">user_parameters: []</span>
<span class="go">metadata: </span>
<span class="go">  start: </span>
<span class="go">    uid: cae9b429-c827-4cd5-9ac0-437780412729</span>
<span class="go">    time: 1561579680.054365</span>
<span class="go">    plan_type: generator</span>
<span class="go">    motors: [&#39;motor&#39;]</span>
<span class="go">    scan_id: 1</span>
<span class="go">    plan_name: scan</span>
<span class="go">    plan_pattern_module: bluesky.plan_patterns</span>
<span class="go">    hints: </span>
<span class="go">      dimensions: [[[&#39;motor&#39;], &#39;primary&#39;]]</span>
<span class="go">    detectors: [&#39;det&#39;]</span>
<span class="go">    plan_pattern_args: </span>
<span class="go">      num: 3</span>
<span class="go">      args: [&quot;SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])&quot;, -1, 1]</span>
<span class="go">    plan_pattern: inner_product</span>
<span class="go">    num_intervals: 2</span>
<span class="go">    plan_args: </span>
<span class="go">      detectors: [&quot;SynGauss(name=&#39;det&#39;, value=1.0, timestamp=1561579680.036896)&quot;]</span>
<span class="go">      num: 3</span>
<span class="go">      args: [&quot;SynAxis(prefix=&#39;&#39;, name=&#39;motor&#39;, read_attrs=[&#39;readback&#39;, &#39;setpoint&#39;], configuration_attrs=[&#39;velocity&#39;, &#39;acceleration&#39;])&quot;, -1, 1]</span>
<span class="go">      per_step: None</span>
<span class="go">    num_points: 3</span>
<span class="go">  stop: None</span>
<span class="go">args: </span>
<span class="go">  gen_func: &lt;function BlueskyJSONLCatalog._load.&lt;locals&gt;.gen at 0x7f12ecd0df28&gt;</span>
<span class="go">  gen_args: ()</span>
<span class="go">  gen_kwargs: </span>
<span class="go">  filler: &lt;Filler&gt;</span>

<span class="gp">In [13]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Out[13]: </span>
<span class="go">Run Catalog</span>
<span class="go">  uid=&#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;</span>
<span class="go">  exit_status=&#39;success&#39;</span>
<span class="go">  2019-06-26 20:08:00.054 -- 2019-06-26 20:08:00.062</span>
<span class="go">  Streams:</span>
<span class="go">    * primary</span>

<span class="gp">In [14]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()[</span><span class="s1">&#39;primary&#39;</span><span class="p">]</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Out[14]: name: primary</span>
<span class="go">container: xarray</span>
<span class="go">plugin: [&#39;bluesky-event-stream&#39;]</span>
<span class="go">description: </span>
<span class="go">direct_access: forbid</span>
<span class="go">user_parameters: []</span>
<span class="go">metadata: </span>
<span class="go">  descriptors: [{&#39;run_start&#39;: &#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;, &#39;time&#39;: 1561579680.057906, &#39;data_keys&#39;: {&#39;motor&#39;: {&#39;source&#39;: &#39;SIM:motor&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;motor&#39;}, &#39;motor_setpoint&#39;: {&#39;source&#39;: &#39;SIM:motor_setpoint&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;motor&#39;}, &#39;det&#39;: {&#39;source&#39;: &#39;SIM:det&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;det&#39;}}, &#39;uid&#39;: &#39;4f5dbf81-3e93-477c-93d4-29cb4eeca81a&#39;, &#39;configuration&#39;: {&#39;motor&#39;: {&#39;data&#39;: {&#39;motor_velocity&#39;: 1, &#39;motor_acceleration&#39;: 1}, &#39;timestamps&#39;: {&#39;motor_velocity&#39;: 1561579680.0342448, &#39;motor_acceleration&#39;: 1561579680.0343082}, &#39;data_keys&#39;: {&#39;motor_velocity&#39;: {&#39;source&#39;: &#39;SIM:motor_velocity&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}, &#39;motor_acceleration&#39;: {&#39;source&#39;: &#39;SIM:motor_acceleration&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}}}, &#39;det&#39;: {&#39;data&#39;: {&#39;det&#39;: 0.6065306597126334}, &#39;timestamps&#39;: {&#39;det&#39;: 1561579680.0571737}, &#39;data_keys&#39;: {&#39;det&#39;: {&#39;source&#39;: &#39;SIM:det&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3}}}}, &#39;name&#39;: &#39;primary&#39;, &#39;hints&#39;: {&#39;motor&#39;: {&#39;fields&#39;: [&#39;motor&#39;]}, &#39;det&#39;: {&#39;fields&#39;: []}}, &#39;object_keys&#39;: {&#39;motor&#39;: [&#39;motor&#39;, &#39;motor_setpoint&#39;], &#39;det&#39;: [&#39;det&#39;]}}]</span>
<span class="go">args: </span>
<span class="go">  get_run_start: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_run_start at 0x7f12ea518bf8&gt;</span>
<span class="go">  stream_name: primary</span>
<span class="go">  get_run_stop: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_run_stop at 0x7f12ea518c80&gt;</span>
<span class="go">  get_event_descriptors: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_event_descriptors at 0x7f12ea518d90&gt;</span>
<span class="go">  get_event_pages: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_event_pages at 0x7f12ea4e0488&gt;</span>
<span class="go">  get_event_count: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_event_count at 0x7f12ea4e0a60&gt;</span>
<span class="go">  get_resource: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_resource at 0x7f12ea4e0ae8&gt;</span>
<span class="go">  lookup_resource_for_datum: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.lookup_resource_for_datum at 0x7f12ea4e0b70&gt;</span>
<span class="go">  get_datum_pages: &lt;function BlueskyRunFromGenerator.__init__.&lt;locals&gt;.get_datum_pages at 0x7f12ea4e0bf8&gt;</span>
<span class="go">  filler: &lt;Filler&gt;</span>
<span class="go">  metadata: </span>
<span class="go">    descriptors: [{&#39;run_start&#39;: &#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;, &#39;time&#39;: 1561579680.057906, &#39;data_keys&#39;: {&#39;motor&#39;: {&#39;source&#39;: &#39;SIM:motor&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;motor&#39;}, &#39;motor_setpoint&#39;: {&#39;source&#39;: &#39;SIM:motor_setpoint&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;motor&#39;}, &#39;det&#39;: {&#39;source&#39;: &#39;SIM:det&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3, &#39;object_name&#39;: &#39;det&#39;}}, &#39;uid&#39;: &#39;4f5dbf81-3e93-477c-93d4-29cb4eeca81a&#39;, &#39;configuration&#39;: {&#39;motor&#39;: {&#39;data&#39;: {&#39;motor_velocity&#39;: 1, &#39;motor_acceleration&#39;: 1}, &#39;timestamps&#39;: {&#39;motor_velocity&#39;: 1561579680.0342448, &#39;motor_acceleration&#39;: 1561579680.0343082}, &#39;data_keys&#39;: {&#39;motor_velocity&#39;: {&#39;source&#39;: &#39;SIM:motor_velocity&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}, &#39;motor_acceleration&#39;: {&#39;source&#39;: &#39;SIM:motor_acceleration&#39;, &#39;dtype&#39;: &#39;integer&#39;, &#39;shape&#39;: []}}}, &#39;det&#39;: {&#39;data&#39;: {&#39;det&#39;: 0.6065306597126334}, &#39;timestamps&#39;: {&#39;det&#39;: 1561579680.0571737}, &#39;data_keys&#39;: {&#39;det&#39;: {&#39;source&#39;: &#39;SIM:det&#39;, &#39;dtype&#39;: &#39;number&#39;, &#39;shape&#39;: [], &#39;precision&#39;: 3}}}}, &#39;name&#39;: &#39;primary&#39;, &#39;hints&#39;: {&#39;motor&#39;: {&#39;fields&#39;: [&#39;motor&#39;]}, &#39;det&#39;: {&#39;fields&#39;: []}}, &#39;object_keys&#39;: {&#39;motor&#39;: [&#39;motor&#39;, &#39;motor_setpoint&#39;], &#39;det&#39;: [&#39;det&#39;]}}]</span>

<span class="gp">In [15]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()[</span><span class="s1">&#39;primary&#39;</span><span class="p">]()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Out[15]: &lt;Intake catalog: Stream &#39;primary&#39; from Run cae9b429...&gt;</span>

<span class="gp">In [16]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()[</span><span class="s1">&#39;primary&#39;</span><span class="p">]()</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Out[16]: </span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   (time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time                      (time) float64 1.562e+09 1.562e+09 1.562e+09</span>
<span class="go">Data variables:</span>
<span class="go">    motor                     (time) float64 -1.0 0.0 1.0</span>
<span class="go">    motor_setpoint            (time) float64 -1.0 0.0 1.0</span>
<span class="go">    det                       (time) float64 0.6065 1.0 0.6065</span>
<span class="go">    motor:motor_velocity      (time) int64 1 1 1</span>
<span class="go">    motor:motor_acceleration  (time) int64 1 1 1</span>
<span class="go">    det:det                   (time) float64 0.6065 0.6065 0.6065</span>
<span class="go">    seq_num                   (time) int64 1 2 3</span>
<span class="go">    uid                       (time) &lt;U36 &#39;d7e5a0c3-0b77-4511-9262-8941d7ed08ba&#39; ... &#39;fdb9d186-63d7-4328-b7c2-c617ad70f6c3&#39;</span>
</pre></div>
</div>
<p>The calls accept optional arguments. For example, we can filter by field name
to avoid reading data that we do not need.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()</span><span class="o">.</span><span class="n">primary</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;det&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[17]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:  (time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time     (time) float64 1.562e+09 1.562e+09 1.562e+09</span>
<span class="go">Data variables:</span>
<span class="go">    det      (time) float64 0.6065 1.0 0.6065</span>
<span class="go">    seq_num  (time) int64 1 2 3</span>
<span class="go">    uid      (time) &lt;U36 &#39;d7e5a0c3-0b77-4511-9262-8941d7ed08ba&#39; ... &#39;fdb9d186-63d7-4328-b7c2-c617ad70f6c3&#39;</span>
</pre></div>
</div>
<p>If the defaults suffice, intake allows the user to elide the calls, supporting
this more succinct expression:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">primary</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gh">Out[18]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   (time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time                      (time) float64 1.562e+09 1.562e+09 1.562e+09</span>
<span class="go">Data variables:</span>
<span class="go">    motor                     (time) float64 -1.0 0.0 1.0</span>
<span class="go">    motor_setpoint            (time) float64 -1.0 0.0 1.0</span>
<span class="go">    det                       (time) float64 0.6065 1.0 0.6065</span>
<span class="go">    motor:motor_velocity      (time) int64 1 1 1</span>
<span class="go">    motor:motor_acceleration  (time) int64 1 1 1</span>
<span class="go">    det:det                   (time) float64 0.6065 0.6065 0.6065</span>
<span class="go">    seq_num                   (time) int64 1 2 3</span>
<span class="go">    uid                       (time) &lt;U36 &#39;d7e5a0c3-0b77-4511-9262-8941d7ed08ba&#39; ... &#39;fdb9d186-63d7-4328-b7c2-c617ad70f6c3&#39;</span>
</pre></div>
</div>
<p>Our simple scan produced one logical table (“event stream”) named ‘primary’. In
general experiments can produce multiple tables with different time-bases. They
can be merged into one xarray Dataset like so:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">run</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]()</span>

<span class="gp">In [20]: </span><span class="n">run</span>
<span class="gh">Out[20]: </span><span class="go"></span>
<span class="go">Run Catalog</span>
<span class="go">  uid=&#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;</span>
<span class="go">  exit_status=&#39;success&#39;</span>
<span class="go">  2019-06-26 20:08:00.054 -- 2019-06-26 20:08:00.062</span>
<span class="go">  Streams:</span>
<span class="go">    * primary</span>

<span class="gp">In [21]: </span><span class="kn">import</span> <span class="nn">xarray</span>

<span class="gp">In [22]: </span><span class="n">xarray</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">run</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">run</span><span class="p">)</span>
<span class="gh">Out[22]: </span><span class="go"></span>
<span class="go">&lt;xarray.Dataset&gt;</span>
<span class="go">Dimensions:                   (time: 3)</span>
<span class="go">Coordinates:</span>
<span class="go">  * time                      (time) float64 1.562e+09 1.562e+09 1.562e+09</span>
<span class="go">Data variables:</span>
<span class="go">    motor                     (time) float64 -1.0 0.0 1.0</span>
<span class="go">    motor_setpoint            (time) float64 -1.0 0.0 1.0</span>
<span class="go">    det                       (time) float64 0.6065 1.0 0.6065</span>
<span class="go">    motor:motor_velocity      (time) int64 1 1 1</span>
<span class="go">    motor:motor_acceleration  (time) int64 1 1 1</span>
<span class="go">    det:det                   (time) float64 0.6065 0.6065 0.6065</span>
<span class="go">    seq_num                   (time) int64 1 2 3</span>
<span class="go">    uid                       (time) &lt;U36 &#39;d7e5a0c3-0b77-4511-9262-8941d7ed08ba&#39; ... &#39;fdb9d186-63d7-4328-b7c2-c617ad70f6c3&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="read-data-as-bluesky-documents">
<h2>Read Data as Bluesky “Documents”<a class="headerlink" href="#read-data-as-bluesky-documents" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">catalog</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">read_canonical</span><span class="p">()</span>
<span class="gh">Out[23]: </span><span class="go">&lt;generator object BlueskyRun.read_canonical at 0x7f12ea459308&gt;</span>
</pre></div>
</div>
<p>This generator yields <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">doc)</span></code> pairs and can be fed into streaming
visualization, processing, and serialization tools that consume this
representation, such as those provided by bluesky. This is the same
representation that was emitted when the data was first acquired, so the user
can apply the same streaming pipelines to data while it is being acquired and
after it is saved.</p>
</div>
<div class="section" id="search">
<h2>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Catalog.search()</span></code> method returns another Catalog with a subset of the
original Catalog’s entries. The search results can be searched in turn. Here we
search for data acquired using the ‘scan’ experiment plan, and then narrow that
to results from the last 60 seconds.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">catalog2</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s1">&#39;plan_name&#39;</span><span class="p">:</span> <span class="s1">&#39;scan&#39;</span><span class="p">})</span>

<span class="gp">In [25]: </span><span class="nb">list</span><span class="p">(</span><span class="n">catalog2</span><span class="p">)</span>
<span class="gh">Out[25]: </span><span class="go">[&#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;]</span>

<span class="gp">In [26]: </span><span class="kn">import</span> <span class="nn">time</span>

<span class="gp">In [27]: </span><span class="n">catalog3</span> <span class="o">=</span> <span class="n">catalog2</span><span class="o">.</span><span class="n">search</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$gt&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span><span class="p">}})</span>

<span class="gp">In [28]: </span><span class="nb">list</span><span class="p">(</span><span class="n">catalog3</span><span class="p">)</span>
<span class="gh">Out[28]: </span><span class="go">[&#39;cae9b429-c827-4cd5-9ac0-437780412729&#39;]</span>
</pre></div>
</div>
<p>This is accomplished using <a class="reference external" href="https://pypi.org/project/mongoquery/">mongoquery</a>,
which provides a MongoDB-like query language for querying Python collections.
For Catalogs backed by a real MongoDB instance, as in the Binder example linked
above, the full MongoDB query language is supported.</p>
<p>The Catalogs carry the composite search query as internal state.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">catalog</span><span class="o">.</span><span class="n">_query</span>
<span class="gh">Out[29]: </span><span class="go">{}</span>

<span class="gp">In [30]: </span><span class="n">catalog2</span><span class="o">.</span><span class="n">_query</span>
<span class="go">            Out[30]: {&#39;plan_name&#39;: &#39;scan&#39;}</span>

<span class="gp">In [31]: </span><span class="n">catalog3</span><span class="o">.</span><span class="n">_query</span>
<span class="go">                                           Out[31]: {&#39;$and&#39;: [{&#39;plan_name&#39;: &#39;scan&#39;}, {&#39;time&#39;: {&#39;$gt&#39;: 1561579620.4819422}}]}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API and Design Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Brookhaven National Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Shadow Simulations" href="shadow.html" /><link rel="prev" title="Examples" href="../examples.html" />

    <!-- Generated with Sphinx 7.1.1 and Furo 2023.07.26 -->
        <title>SRW Simulations - sirepo-bluesky 0.6.2.post71+g2579bed documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">sirepo-bluesky 0.6.2.post71+g2579bed documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">sirepo-bluesky 0.6.2.post71+g2579bed documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">SRW Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="shadow.html">Shadow Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="madx.html">MAD-X Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulations.html">List of predefined simulations in Sirepo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="SRW-Simulations">
<h1>SRW Simulations<a class="headerlink" href="#SRW-Simulations" title="Permalink to this heading">#</a></h1>
<p>This section is based on the <strong>TES</strong> and <strong>ARI</strong> beamline examples.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<section id="Run-%22Beamline%22-SRW-simulations">
<h2>Run “Beamline” SRW simulations<a class="headerlink" href="#Run-%22Beamline%22-SRW-simulations" title="Permalink to this heading">#</a></h2>
<p>In this example, we scan the horizontal size of the aperture and collect the resulting averaged intensities and corresponding 2D intensity distributions from the “Watchpoint” report on the “Beamline” page of Sirepo/SRW app.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">ipython</span></code> and run the following where <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> is the UID for the simulation we are working with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-07-28 18:00:24
Persistent Unique Scan ID: &#39;d6280d7e-da58-4ded-a926-e5aae21a29b3&#39;
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_flux |
+-----------+------------+-------------------------+-------------+------------+
|         1 | 18:00:50.8 |                   0.000 |      26.255 |      0.000 |
|         2 | 18:01:16.2 |                   0.400 |      25.298 | 18526387871043232.000 |
|         3 | 18:01:41.7 |                   0.800 |      25.297 | 875181953563727616.000 |
|         4 | 18:02:07.2 |                   1.200 |      25.304 | 2835218466968361984.000 |
|         5 | 18:02:31.7 |                   1.600 |      24.288 | 6790626356543558656.000 |
|         6 | 18:02:57.2 |                   2.000 |      25.299 | 13986029273592827904.000 |
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;d6280d7e&#39;] (scan num: 1)



                                 time  aperture_horizontalSize  \
seq_num
1       2023-07-28 18:00:50.807867050                      0.0
2       2023-07-28 18:01:16.297991514                      0.4
3       2023-07-28 18:01:41.780310869                      0.8
4       2023-07-28 18:02:07.258997917                      1.2
5       2023-07-28 18:02:31.737359047                      1.6
6       2023-07-28 18:02:57.223885775                      2.0

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
2        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
3        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
4        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
5        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
6        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        ee5c2f45f82ba4e350a3ddf189925440ec0ff7fe773a6f...    26.255292
2        e5ed642016253938983a459b082c5489612696bc05e96b...    25.297872
3        7d53f66f70a6438f729457c7d644371a4a3ade219652b9...    25.297063
4        fd4f8906a5d926d07d528068a9254a6840c3077b3220c3...    25.303777
5        8fb9d1100dd453089f1bc719232d66061d5925b9c2cb23...    24.288452
6        5244afa1dce5a215956fedf3b79529dd794acac9dac326...    25.299468

                                                  w9_image   w9_shape  \
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [42, 960]
2        [[89.48760223388672, 90.53831481933594, 90.827...  [42, 960]
3        [[259485.828125, 261822.359375, 264502.4375, 2...  [42, 960]
4        [[9231006.0, 9837807.0, 9560670.0, 9298954.0, ...  [42, 960]
5        [[68404136.0, 69001112.0, 69616448.0, 70282936...  [42, 960]
6        [[980582272.0, 1007160704.0, 1032941312.0, 103...  [42, 960]

              w9_flux       w9_mean          w9_x          w9_y  w9_fwhm_x  \
seq_num
1        0.000000e+00  0.000000e+00           NaN           NaN        NaN
2        1.852639e+16  4.594838e+11 -9.046413e-07  2.967015e-07   0.000001
3        8.751820e+17  2.170590e+13 -2.024554e-07  2.583469e-07   0.000001
4        2.835218e+18  7.031792e+13  1.189527e-08  2.134383e-07   0.000002
5        6.790626e+18  1.684183e+14  2.282297e-08  1.655072e-07   0.000002
6        1.398603e+19  3.468757e+14  1.569340e-08  1.041245e-07   0.000002

         w9_fwhm_y  w9_photon_energy  \
seq_num
1              NaN            2500.0
2         0.000010            2500.0
3         0.000010            2500.0
4         0.000009            2500.0
5         0.000008            2500.0
6         0.000008            2500.0

                                      w9_horizontal_extent  \
seq_num
1        [-2.1254114436366436e-06, -9.098470371627117e-07]
2         [-0.0003455044889645429, 0.00034048111155643006]
3          [-9.497909541585611e-05, 9.223270411427916e-05]
4           [-4.719082396347529e-05, 4.42548462284932e-05]
5        [-2.8159877207427783e-05, 2.5145910127955907e-05]
6         [-1.880166551489609e-05, 1.5761422719808468e-05]

                                        w9_vertical_extent  w9_id w9_title  \
seq_num
1           [-6.735306985152392e-07, 6.90416995865796e-07]   15.0       W9
2         [-1.789826993692091e-05, 1.7460512016671038e-05]   15.0       W9
3        [-1.7882633350325042e-05, 1.7445257871487232e-05]   15.0       W9
4         [-1.7370988769071537e-05, 1.694612715155033e-05]   15.0       W9
5         [-1.6659549338292866e-05, 1.625208818722446e-05]   15.0       W9
6         [-1.556056188360331e-05, 1.5179979892601324e-05]   15.0       W9

        w9_type  w9_element_position
seq_num
1         watch               57.142
2         watch               57.142
3         watch               57.142
4         watch               57.142
5         watch               57.142
6         watch               57.142
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_3_1.png" src="../_images/notebooks_srw_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
    <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
    <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 42, 960)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_4_1.png" src="../_images/notebooks_srw_4_1.png" />
</div>
</div>
</section>
<section id="SRW-Propagation-as-Ophyd-Objects">
<h2>SRW Propagation as Ophyd Objects<a class="headerlink" href="#SRW-Propagation-as-Ophyd-Objects" title="Permalink to this heading">#</a></h2>
<p>This example repeats the above simulation in “Optical Elements as Ophyd Objects”, but instead scans the horizontal and vertical resolution modification factors of the “Final Post Propagation” on the “Beamline” page of Sirepo/SRW app.</p>
<p><strong>Hint</strong>: See the <a class="reference external" href="https://github.com/radiasoft/sirepo/wiki/SRW-Propagation-Parameters">“SRW Propagation Parameters” wiki page</a> for a list of available propagation parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">post_propagation</span><span class="o">.</span><span class="n">hres_mod</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">post_propagation</span><span class="o">.</span><span class="n">vres_mod</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span>
    <span class="n">bp</span><span class="o">.</span><span class="n">list_scan</span><span class="p">(</span>
        <span class="p">[</span><span class="n">w9</span><span class="p">],</span>
        <span class="n">post_propagation</span><span class="o">.</span><span class="n">hres_mod</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="n">post_propagation</span><span class="o">.</span><span class="n">vres_mod</span><span class="p">,</span>
        <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)):</span>
    <span class="n">w9_image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-07-28 18:03:00
Persistent Unique Scan ID: &#39;a12553e5-a506-4087-a458-9a15b74f4499&#39;
New stream: &#39;primary&#39;
+-----------+------------+---------------------------+---------------------------+-------------+------------+
|   seq_num |       time | post_propagation_hres_mod | post_propagation_vres_mod | w9_duration |    w9_flux |
+-----------+------------+---------------------------+---------------------------+-------------+------------+
|         1 | 18:03:24.4 |                     0.100 |                     0.100 |      24.286 | 1073588027764959232.000 |
|         2 | 18:03:48.9 |                     0.250 |                     0.250 |      24.284 | 9175285143383783424.000 |
|         3 | 18:04:13.3 |                     0.500 |                     0.500 |      24.298 | 34882217519084883968.000 |
|         4 | 18:04:38.9 |                     1.000 |                     1.000 |      25.352 | 135695678192118038528.000 |
|         5 | 18:05:04.8 |                     2.000 |                     2.000 |      25.539 | 548122645927189348352.000 |
|         6 | 18:05:34.8 |                     5.000 |                     5.000 |      28.634 | 3411483271823718088704.000 |
+-----------+------------+---------------------------+---------------------------+-------------+------------+
generator list_scan [&#39;a12553e5&#39;] (scan num: 1)



                                 time  \
seq_num
1       2023-07-28 18:03:24.491739035
2       2023-07-28 18:03:48.921835184
3       2023-07-28 18:04:13.391771078
4       2023-07-28 18:04:38.939577579
5       2023-07-28 18:05:04.818264008
6       2023-07-28 18:05:34.834204674

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
2        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
3        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
4        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
5        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
6        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        a59720c5bba367c2e9d568f2222e0f8b445e207174bb7b...    24.285528
2        8e3774028384389bf2ff67e37cbc93342ee590a53194f1...    24.284330
3        587c24218ec86df49677e6112b17c3ab64ce4a07c13864...    24.297861
4        10d1137cd9b31f6348e42e4b6c0e1d41d8158d21aa7149...    25.352146
5        c1771871f2b79554d2c17c79e7d7ec2c82f0e114f1f698...    25.538574
6        cf113e30368cb8754e574bf36717952138841ce01b315f...    28.633565

                                                  w9_image     w9_shape  \
seq_num
1        [[1721587456.0, 2557412352.0, 4199480576.0, 76...      [4, 96]
2        [[1721587456.0, 2017206400.0, 2350037760.0, 28...    [12, 240]
3        [[1721587456.0, 1859788160.0, 2016864896.0, 21...    [22, 480]
4        [[1730436608.0, 1829556096.0, 1847066240.0, 19...    [42, 960]
5        [[1721587456.0, 1753671936.0, 1798936704.0, 18...   [84, 1920]
6        [[1721587456.0, 1733777920.0, 1746994560.0, 17...  [210, 4752]

              w9_flux       w9_mean          w9_x          w9_y  ...  \
seq_num                                                          ...
1        1.073588e+18  2.795802e+15  1.000968e-08  1.216330e-06  ...
2        9.175285e+18  3.185863e+15  3.416625e-08  9.122926e-07  ...
3        3.488222e+19  3.303240e+15  3.608676e-08  8.955651e-07  ...
4        1.356957e+20  3.365468e+15  3.642248e-08  8.798183e-07  ...
5        5.481226e+20  3.398578e+15  3.638441e-08  8.797064e-07  ...
6        3.411483e+21  3.418594e+15  3.638518e-08  8.763119e-07  ...

         w9_fwhm_y  w9_photon_energy  \
seq_num
1         0.000002            2500.0
2         0.000003            2500.0
3         0.000002            2500.0
4         0.000002            2500.0
5         0.000002            2500.0
6         0.000002            2500.0

                                      w9_horizontal_extent  \
seq_num
1        [-1.5397359802536857e-05, 1.2266423755240344e-05]
2        [-1.5397359802536857e-05, 1.2266423755240347e-05]
3        [-1.5397359802536857e-05, 1.2266423755240347e-05]
4         [-1.5526929149797263e-05, 1.239599310250075e-05]
5        [-1.5397359802536857e-05, 1.2266423755240347e-05]
6        [-1.5397359802536857e-05, 1.2266423755240347e-05]

                                       w9_vertical_extent w9_id  w9_title  \
seq_num
1         [-3.123338687538863e-06, 3.200689751316548e-06]  15.0        W9
2         [-3.123338687538863e-06, 3.200689751316548e-06]  15.0        W9
3         [-3.123338687538863e-06, 3.200689751316547e-06]  15.0        W9
4        [-3.085242130678288e-06, 3.1625931944559723e-06]  15.0        W9
5         [-3.123338687538863e-06, 3.200689751316547e-06]  15.0        W9
6         [-3.123338687538863e-06, 3.200689751316548e-06]  15.0        W9

        w9_type w9_element_position  post_propagation_vres_mod  \
seq_num
1         watch              57.142                       0.10
2         watch              57.142                       0.25
3         watch              57.142                       0.50
4         watch              57.142                       1.00
5         watch              57.142                       2.00
6         watch              57.142                       5.00

         post_propagation_hres_mod
seq_num
1                             0.10
2                             0.25
3                             0.50
4                             1.00
5                             2.00
6                             5.00

[6 rows x 21 columns]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_6_1.png" src="../_images/notebooks_srw_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="n">num_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">w9_image</span><span class="p">)</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
    <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
    <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">):</span>
    <span class="n">h_dims</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">w9</span><span class="o">.</span><span class="n">horizontal_extent</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">v_dims</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">w9</span><span class="o">.</span><span class="n">vertical_extent</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">im</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">h_dims</span><span class="p">[:],</span> <span class="o">*</span><span class="n">v_dims</span><span class="p">[:])</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_7_0.png" src="../_images/notebooks_srw_7_0.png" />
</div>
</div>
</section>
<section id="Using-Run-Engine-to-Generate-Spectrum-Reports">
<h2>Using Run Engine to Generate Spectrum Reports<a class="headerlink" href="#Using-Run-Engine-to-Generate-Spectrum-Reports" title="Permalink to this heading">#</a></h2>
<p>In this example, we scan the vertical amplitude of the undulator and collect the “Single Electron Spectrum” report from the “Beamline” page of the Sirepo/SRW app. Afterwards, we plot the peaks of the spectra. This section is based on the <strong>ARI</strong> beamline example.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000003&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span>
    <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">extra_model_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;undulator&quot;</span><span class="p">,</span> <span class="s2">&quot;intensityReport&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">undulator</span><span class="o">.</span><span class="n">verticalAmplitude</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">single_electron_spectrum</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">single_electron_spectrum</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="n">single_electron_spectrum</span><span class="o">.</span><span class="n">initialEnergy</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="n">single_electron_spectrum</span><span class="o">.</span><span class="n">initialEnergy</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">single_electron_spectrum</span><span class="o">.</span><span class="n">finalEnergy</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">1100</span><span class="p">)</span>

<span class="n">num_steps</span> <span class="o">=</span> <span class="mi">6</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span>
    <span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
        <span class="p">[</span><span class="n">single_electron_spectrum</span><span class="p">],</span>
        <span class="n">undulator</span><span class="o">.</span><span class="n">verticalAmplitude</span><span class="p">,</span>
        <span class="mf">0.2</span><span class="p">,</span>
        <span class="mf">1.2</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">ses_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;single_electron_spectrum_image&quot;</span><span class="p">)))</span>
<span class="n">ampl_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;undulator_verticalAmplitude&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-07-28 18:05:39
Persistent Unique Scan ID: &#39;23d53ed4-64b5-45a0-aea4-13f5079ee851&#39;
New stream: &#39;primary&#39;
+-----------+------------+-----------------------------+-----------------------------------+-------------------------------+
|   seq_num |       time | undulator_verticalAmplitude | single_electron_spectrum_duration | single_electron_spectrum_flux |
+-----------+------------+-----------------------------+-----------------------------------+-------------------------------+
|         1 | 18:05:43.7 |                       0.200 |                             4.069 |         11582410813310422.000 |
|         2 | 18:05:47.9 |                       0.400 |                             4.068 |          7511914020931007.000 |
|         3 | 18:05:52.2 |                       0.600 |                             4.070 |          6133644985399308.000 |
|         4 | 18:05:56.4 |                       0.800 |                             4.073 |          5528586337089524.000 |
|         5 | 18:06:00.6 |                       1.000 |                             4.067 |          4389188523218694.000 |
|         6 | 18:06:04.8 |                       1.200 |                             4.068 |          3839228997372156.500 |
+-----------+------------+-----------------------------+-----------------------------------+-------------------------------+
generator scan [&#39;23d53ed4&#39;] (scan num: 1)



                                 time  \
seq_num
1       2023-07-28 18:05:43.769651175
2       2023-07-28 18:05:47.979930878
3       2023-07-28 18:05:52.203298807
4       2023-07-28 18:05:56.427370548
5       2023-07-28 18:06:00.647011518
6       2023-07-28 18:06:04.867648840

        single_electron_spectrum_sirepo_data_json  \
seq_num
1
2
3
4
5
6

        single_electron_spectrum_sirepo_data_hash  \
seq_num
1
2
3
4
5
6

         single_electron_spectrum_duration  \
seq_num
1                                 4.069007
2                                 4.068076
3                                 4.069942
4                                 4.073139
5                                 4.066596
6                                 4.067782

                 single_electron_spectrum_image  \
seq_num
1        328bd7d5-84e2-4c28-9e66-8f003376cb18/0
2        d3d8a559-25ce-4e72-bed1-16e9d73edd31/0
3        2b079432-59f9-466c-b20b-345684acb01e/0
4        d1878fb4-b694-48d0-b3b3-06b741cf63fb/0
5        0a597eb0-40e0-485b-a829-fbe9aa1af178/0
6        d4197644-fde7-40ce-9447-0e9af5a7f864/0

        single_electron_spectrum_shape  single_electron_spectrum_flux  \
seq_num
1                               [2000]                   1.158241e+16
2                               [2000]                   7.511914e+15
3                               [2000]                   6.133645e+15
4                               [2000]                   5.528586e+15
5                               [2000]                   4.389189e+15
6                               [2000]                   3.839229e+15

         single_electron_spectrum_mean  single_electron_spectrum_x  \
seq_num
1                         5.791205e+12                         NaN
2                         3.755957e+12                         NaN
3                         3.066822e+12                         NaN
4                         2.764293e+12                         NaN
5                         2.194594e+12                         NaN
6                         1.919614e+12                         NaN

         single_electron_spectrum_y  ...  single_electron_spectrum_method  \
seq_num                              ...
1                               NaN  ...                                1
2                               NaN  ...                                1
3                               NaN  ...                                1
4                               NaN  ...                                1
5                               NaN  ...                                1
6                               NaN  ...                                1

         single_electron_spectrum_notes  \
seq_num
1
2
3
4
5
6

        single_electron_spectrum_photonEnergyPointCount  \
seq_num
1                                                2000.0
2                                                2000.0
3                                                2000.0
4                                                2000.0
5                                                2000.0
6                                                2000.0

        single_electron_spectrum_plotScale  \
seq_num
1                                   linear
2                                   linear
3                                   linear
4                                   linear
5                                   linear
6                                   linear

        single_electron_spectrum_polarization  \
seq_num
1                                         6.0
2                                         6.0
3                                         6.0
4                                         6.0
5                                         6.0
6                                         6.0

         single_electron_spectrum_precision  \
seq_num
1                                      0.01
2                                      0.01
3                                      0.01
4                                      0.01
5                                      0.01
6                                      0.01

        single_electron_spectrum_verticalPosition  \
seq_num
1                                             0.0
2                                             0.0
3                                             0.0
4                                             0.0
5                                             0.0
6                                             0.0

         single_electron_spectrum_title single_electron_spectrum_type  \
seq_num
1                SingleElectronSpectrum               intensityReport
2                SingleElectronSpectrum               intensityReport
3                SingleElectronSpectrum               intensityReport
4                SingleElectronSpectrum               intensityReport
5                SingleElectronSpectrum               intensityReport
6                SingleElectronSpectrum               intensityReport

         undulator_verticalAmplitude
seq_num
1                                0.2
2                                0.4
3                                0.6
4                                0.8
5                                1.0
6                                1.2

[6 rows x 31 columns]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_9_1.png" src="../_images/notebooks_srw_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">peakutils</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">num_steps</span><span class="p">)</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
    <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
    <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ses_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;vert. magn. fld. </span><span class="si">{</span><span class="n">ampl_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">T&quot;</span><span class="p">)</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="n">peakutils</span><span class="o">.</span><span class="n">indexes</span><span class="p">(</span><span class="n">ses_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">thres</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">ses_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">peak</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Single-Electron Spectrum vs. Vertical Magnetic Field&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7fb2fdde0bb0&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_10_1.png" src="../_images/notebooks_srw_10_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_10_2.png" src="../_images/notebooks_srw_10_2.png" />
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="shadow.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Shadow Simulations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../examples.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Examples</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020, Brookhaven National Laboratory
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">SRW Simulations</a><ul>
<li><a class="reference internal" href="#Run-%22Beamline%22-SRW-simulations">Run “Beamline” SRW simulations</a></li>
<li><a class="reference internal" href="#SRW-Propagation-as-Ophyd-Objects">SRW Propagation as Ophyd Objects</a></li>
<li><a class="reference internal" href="#Using-Run-Engine-to-Generate-Spectrum-Reports">Using Run Engine to Generate Spectrum Reports</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=464d04df"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>
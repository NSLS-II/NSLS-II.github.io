<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Run Sirepo/Shadow simulations with Bluesky" href="shadow.html" /><link rel="prev" title="Notebooks (old API)" href="../notebooks-old-api.html" />

    <!-- Generated with Sphinx 7.0.1 and Furo 2023.05.20 -->
        <title>Run Sirepo/SRW simulations with Bluesky - sirepo-bluesky 0.6.1.post4+g3400619 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">sirepo-bluesky 0.6.1.post4+g3400619 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">sirepo-bluesky 0.6.1.post4+g3400619 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../notebooks-old-api.html">Notebooks (old API)</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Notebooks (old API)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Run Sirepo/SRW simulations with Bluesky</a></li>
<li class="toctree-l2"><a class="reference internal" href="shadow.html">Run Sirepo/Shadow simulations with Bluesky</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../notebooks-new-api.html">Notebooks (new API)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Notebooks (new API)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="elements.html">Optical Elements as Ophyd Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="madx.html">MAD-X Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulations.html">List of predefined simulations in Sirepo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Run-Sirepo/SRW-simulations-with-Bluesky">
<h1>Run Sirepo/SRW simulations with Bluesky<a class="headerlink" href="#Run-Sirepo/SRW-simulations-with-Bluesky" title="Permalink to this heading">#</a></h1>
<p>This section is based on the <strong>Young’s Double Slit Experiment</strong> Sirepo example that can be found in the wavefront propagation folder on the SRW simulations section.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<section id="Run-%22Source%22-SRW-simulations">
<h2>Run “Source” SRW simulations<a class="headerlink" href="#Run-%22Source%22-SRW-simulations" title="Permalink to this heading">#</a></h2>
<p>In this example, we run a simulation using the “Single-Electron Spectrum” report on the “Source” page of Sirepo/SRW app.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">import</span> <span class="nn">sirepo_bluesky.srw_detector</span> <span class="k">as</span> <span class="nn">sd</span>
<span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>

<span class="n">srw_det</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">SirepoSRWDetector</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000000&quot;</span><span class="p">,</span> <span class="n">sim_type</span><span class="o">=</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span>
                               <span class="n">source_simulation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">sirepo_server</span><span class="o">=</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span>
                               <span class="n">root_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/sirepo-bluesky-data&quot;</span><span class="p">)</span>

<span class="n">srw_det</span><span class="o">.</span><span class="n">configuration_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;photon_energy&quot;</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">]</span>
<span class="n">srw_det</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;hinted&#39;</span>

<span class="n">uid</span><span class="p">,</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">count</span><span class="p">([</span><span class="n">srw_det</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No module named &#39;xraylib&#39;


Transient Scan ID: 1     Time: 2023-06-07 19:37:41
Persistent Unique Scan ID: &#39;2e8e9846-0853-45a4-aae5-a1370c937a34&#39;
New stream: &#39;primary&#39;
+-----------+------------+--------------+------------------+
|   seq_num |       time | srw_det_mean | srw_det_duration |
+-----------+------------+--------------+------------------+
|         1 | 19:37:49.1 | 9721365919945.510 |            7.176 |
+-----------+------------+--------------+------------------+
generator count [&#39;2e8e9846&#39;] (scan num: 1)



</pre></div></div>
</div>
<p>We can observe the produced spectrum as:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;primary&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_photon_energy&quot;</span><span class="p">]</span>
<span class="n">spectrum</span><span class="p">,</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_image&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7fcecd107f40&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_4_1.png" src="../_images/notebooks_srw_4_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beamline%22-SRW-simulations-sequentially">
<h2>Run “Beamline” SRW simulations sequentially<a class="headerlink" href="#Run-%22Beamline%22-SRW-simulations-sequentially" title="Permalink to this heading">#</a></h2>
<p>In this example, we scan the horizontal size of the aperture and collect the resulting averaged intensities and corresponding 2D intensity distributions from the “Watchpoint” report on the “Beamline” page of Sirepo/SRW app.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">ipython</span></code> and run the code in the following cell. Note that <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> may be replaced by the identifier for any supported Sirepo simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">import</span> <span class="nn">sirepo_bluesky.srw_detector</span> <span class="k">as</span> <span class="nn">sd</span>
<span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>

<span class="n">srw_det</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">SirepoSRWDetector</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000000&quot;</span><span class="p">,</span> <span class="n">sim_type</span><span class="o">=</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span>
                               <span class="n">sirepo_server</span><span class="o">=</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span>
                               <span class="n">root_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/sirepo-bluesky-data&quot;</span><span class="p">)</span>

<span class="n">srw_det</span><span class="o">.</span><span class="n">select_optic</span><span class="p">(</span><span class="s2">&quot;Aperture&quot;</span><span class="p">)</span>
<span class="n">param1</span> <span class="o">=</span> <span class="n">srw_det</span><span class="o">.</span><span class="n">create_parameter</span><span class="p">(</span><span class="s2">&quot;horizontalSize&quot;</span><span class="p">)</span>
<span class="n">param2</span> <span class="o">=</span> <span class="n">srw_det</span><span class="o">.</span><span class="n">create_parameter</span><span class="p">(</span><span class="s2">&quot;verticalSize&quot;</span><span class="p">)</span>
<span class="n">srw_det</span><span class="o">.</span><span class="n">configuration_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;horizontal_extent&quot;</span><span class="p">,</span> <span class="s2">&quot;vertical_extent&quot;</span><span class="p">,</span> <span class="s2">&quot;shape&quot;</span><span class="p">]</span>
<span class="n">srw_det</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;hinted&#39;</span>

<span class="n">uid</span><span class="p">,</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">srw_det</span><span class="p">],</span> <span class="n">param1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-06-07 19:37:49
Persistent Unique Scan ID: &#39;5c61fe0f-4a3e-45d3-9de0-302bdcc1841f&#39;
New stream: &#39;primary&#39;
+-----------+------------+--------------------------------+--------------+------------------+
|   seq_num |       time | Aperture_sirepo_horizontalSize | srw_det_mean | srw_det_duration |
+-----------+------------+--------------------------------+--------------+------------------+
|         1 | 19:37:57.1 |                          0.000 |        0.000 |            7.180 |
|         2 | 19:38:04.7 |                          0.025 | 1555207921769.845 |            7.261 |
|         3 | 19:38:12.3 |                          0.050 | 4662310199493.528 |            7.277 |
|         4 | 19:38:19.8 |                          0.075 | 6655467645389.955 |            7.239 |
|         5 | 19:38:27.3 |                          0.100 | 8312082100422.471 |            7.245 |
|         6 | 19:38:34.9 |                          0.125 | 10838241530711.086 |            7.259 |
|         7 | 19:38:42.4 |                          0.150 | 12368326246643.777 |            7.268 |
|         8 | 19:38:50.0 |                          0.175 | 17773014235199.816 |            7.257 |
|         9 | 19:38:57.5 |                          0.200 | 19506043410022.797 |            7.230 |
|        10 | 19:39:05.0 |                          0.225 | 22993350158054.234 |            7.227 |
|        11 | 19:39:12.5 |                          0.250 | 26660776646668.676 |            7.275 |
+-----------+------------+--------------------------------+--------------+------------------+
generator scan [&#39;5c61fe0f&#39;] (scan num: 1)



</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_7_1.png" src="../_images/notebooks_srw_7_1.png" />
</div>
</div>
<p>We can access the data as the last item in the database (<code class="docutils literal notranslate"><span class="pre">db[-1]</span></code>) or directly via the returned <code class="docutils literal notranslate"><span class="pre">uid</span></code>, which when plotted as an image will look like:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>srw_det_image</th>
      <th>srw_det_shape</th>
      <th>srw_det_mean</th>
      <th>srw_det_duration</th>
      <th>srw_det_photon_energy</th>
      <th>srw_det_horizontal_extent</th>
      <th>srw_det_vertical_extent</th>
      <th>srw_det_sirepo_json</th>
      <th>Aperture_sirepo_horizontalSize</th>
      <th>Aperture_sirepo_horizontalSize_setpoint</th>
    </tr>
    <tr>
      <th>seq_num</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2023-06-07 19:37:57.170224905</td>
      <td>c99b87cd-30bb-44fd-8076-292134710cc3/0</td>
      <td>[168, 88]</td>
      <td>0.000000e+00</td>
      <td>7.179614</td>
      <td>4240.0</td>
      <td>[-0.0004, 0.0004]</td>
      <td>[-0.0005, 0.0005000000000000002]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.000</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-06-07 19:38:04.732240677</td>
      <td>34202678-c012-4e81-a01d-38f1072aacf5/0</td>
      <td>[294, 120]</td>
      <td>1.555208e+12</td>
      <td>7.261159</td>
      <td>4240.0</td>
      <td>[-0.0005471264367816092, 0.0005471264367816092]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.025</td>
      <td>0.025</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-06-07 19:38:12.304091215</td>
      <td>3b770b41-9789-43c0-830d-8de38782742b/0</td>
      <td>[294, 120]</td>
      <td>4.662310e+12</td>
      <td>7.276632</td>
      <td>4240.0</td>
      <td>[-0.0005471264367816092, 0.0005471264367816092]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.050</td>
      <td>0.050</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-06-07 19:38:19.826282024</td>
      <td>1ab9952d-3942-4cf8-9edc-fa9b4025493f/0</td>
      <td>[294, 112]</td>
      <td>6.655468e+12</td>
      <td>7.239443</td>
      <td>4240.0</td>
      <td>[-0.000510344827586207, 0.000510344827586207]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.075</td>
      <td>0.075</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2023-06-07 19:38:27.368759632</td>
      <td>568064a1-60be-469c-801e-b309f6a61fb0/0</td>
      <td>[294, 112]</td>
      <td>8.312082e+12</td>
      <td>7.244582</td>
      <td>4240.0</td>
      <td>[-0.000510344827586207, 0.000510344827586207]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.100</td>
      <td>0.100</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2023-06-07 19:38:34.923361778</td>
      <td>5d7701ff-8e14-4885-a27b-b4704f5a07e7/0</td>
      <td>[294, 120]</td>
      <td>1.083824e+13</td>
      <td>7.259290</td>
      <td>4240.0</td>
      <td>[-0.0005471264367816092, 0.0005471264367816092]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.125</td>
      <td>0.125</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2023-06-07 19:38:42.488453388</td>
      <td>3f513872-8f1e-4fdc-a9bd-e79bbedad204/0</td>
      <td>[294, 120]</td>
      <td>1.236833e+13</td>
      <td>7.267819</td>
      <td>4240.0</td>
      <td>[-0.0005471264367816092, 0.0005471264367816092]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.150</td>
      <td>0.150</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2023-06-07 19:38:50.019788265</td>
      <td>66a90b65-5b64-4b96-bb0d-620692f18841/0</td>
      <td>[294, 104]</td>
      <td>1.777301e+13</td>
      <td>7.257268</td>
      <td>4240.0</td>
      <td>[-0.0004735632183908046, 0.0004735632183908046]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.175</td>
      <td>0.175</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2023-06-07 19:38:57.569463968</td>
      <td>1b41b0a5-8251-43eb-a1e4-577b93d8665a/0</td>
      <td>[294, 104]</td>
      <td>1.950604e+13</td>
      <td>7.230161</td>
      <td>4240.0</td>
      <td>[-0.0004735632183908046, 0.0004735632183908046]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.200</td>
      <td>0.200</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2023-06-07 19:39:05.061263084</td>
      <td>ad6eab48-c0f2-40ba-846f-1596d5531950/0</td>
      <td>[294, 96]</td>
      <td>2.299335e+13</td>
      <td>7.226783</td>
      <td>4240.0</td>
      <td>[-0.0004367816091954023, 0.0004367816091954023]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.225</td>
      <td>0.225</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2023-06-07 19:39:12.595361710</td>
      <td>d998ff28-3528-4805-881a-318fccea3322/0</td>
      <td>[294, 96]</td>
      <td>2.666078e+13</td>
      <td>7.274589</td>
      <td>4240.0</td>
      <td>[-0.0004367816091954023, 0.0004367816091954023]</td>
      <td>[-0.000877245508982036, 0.0008772455089820358]</td>
      <td>{"models": {"arbitraryMagField": {"interpolati...</td>
      <td>0.250</td>
      <td>0.250</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imgs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_image&quot;</span><span class="p">))</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">config_data</span><span class="p">(</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;primary&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">hor_ext</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_horizontal_extent&quot;</span><span class="p">]</span>
<span class="n">vert_ext</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">srw_det</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_vertical_extent&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">hor_ext</span><span class="p">,</span> <span class="o">*</span><span class="n">vert_ext</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.image.AxesImage at 0x7fcecc8a1760&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_srw_10_1.png" src="../_images/notebooks_srw_10_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beamline%22-SRW-simulations-in-parallel">
<h2>Run “Beamline” SRW simulations in parallel<a class="headerlink" href="#Run-%22Beamline%22-SRW-simulations-in-parallel" title="Permalink to this heading">#</a></h2>
<p>In this example, we are using <a class="reference external" href="https://blueskyproject.io/bluesky/async.html#flying">Bluesky’s fly scans</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_flyer_env.py

<span class="kn">import</span> <span class="nn">bluesky.plans</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">sirepo_bluesky.sirepo_flyer</span> <span class="k">as</span> <span class="nn">sf</span>
</pre></div>
</div>
</div>
<p>We can create 3 different simulations that change 4 parameters at a time:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_to_change</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">key1</span> <span class="o">=</span> <span class="s2">&quot;Aperture&quot;</span>
<span class="n">key2</span> <span class="o">=</span> <span class="s2">&quot;Lens&quot;</span>
<span class="n">key3</span> <span class="o">=</span> <span class="s2">&quot;Obstacle&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">parameters_update1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;horizontalSize&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;verticalSize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">}</span>
    <span class="n">parameters_update2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;horizontalFocalLength&quot;</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">}</span>
    <span class="n">parameters_update3</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;horizontalSize&quot;</span><span class="p">:</span> <span class="mi">6</span> <span class="o">-</span> <span class="n">i</span><span class="p">}</span>
    <span class="n">params_to_change</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">key1</span><span class="p">:</span> <span class="n">parameters_update1</span><span class="p">,</span>
                             <span class="n">key2</span><span class="p">:</span> <span class="n">parameters_update2</span><span class="p">,</span>
                             <span class="n">key3</span><span class="p">:</span> <span class="n">parameters_update3</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>To create the flyer and run a fly scan, where <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> is the UID of this simulation, we run:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sirepo_flyer</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">SirepoFlyer</span><span class="p">(</span><span class="n">sim_id</span><span class="o">=</span><span class="s2">&quot;00000000&quot;</span><span class="p">,</span>
                              <span class="n">server_name</span><span class="o">=</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">,</span>
                              <span class="n">root_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/sirepo-bluesky-data&quot;</span><span class="p">,</span>
                              <span class="n">params_to_change</span><span class="o">=</span><span class="n">params_to_change</span><span class="p">,</span>
                              <span class="n">watch_name</span><span class="o">=</span><span class="s2">&quot;W60&quot;</span><span class="p">)</span>

<span class="n">uid</span><span class="p">,</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">fly</span><span class="p">([</span><span class="n">sirepo_flyer</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-06-07 19:39:14
Persistent Unique Scan ID: &#39;7a6a0861-479e-4666-8c33-901ed2419c53&#39;
copy 00000000 -&gt; lGXADNHj, Youngs Double Slit Experiment Bluesky
copy 00000000 -&gt; Dcdax1kx, Youngs Double Slit Experiment Bluesky 2
copy 00000000 -&gt; w007fEKj, Youngs Double Slit Experiment Bluesky 3
running sim lGXADNHj
running sim w007fEKj
running sim Dcdax1kx
Status of sim lGXADNHj: completed in 16.2 seconds
Status of sim w007fEKj: completed in 24.1 seconds
Status of sim Dcdax1kx: completed in 24.3 seconds
New stream: &#39;sirepo_flyer&#39;
copy lGXADNHj data hash: d5d6628d50bd65a329717e8ffb942224
copy Dcdax1kx data hash: d6f8b77048fe6ad48e007cfb776528ad
copy w007fEKj data hash: e5f914471d873f156c31815ab705575f



</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/share/miniconda3/envs/sirepo-bluesky-py3.9/lib/python3.9/site-packages/event_model/__init__.py:224: UserWarning: The document type &#39;bulk_events&#39; has been deprecated in favor of &#39;event_page&#39;, whose structure is a transpose of &#39;bulk_events&#39;.
  warnings.warn(
</pre></div></div>
</div>
<p>We access the data in the same manner as before:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">stream_name</span><span class="o">=</span><span class="s2">&quot;sirepo_flyer&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>sirepo_flyer_image</th>
      <th>sirepo_flyer_shape</th>
      <th>sirepo_flyer_mean</th>
      <th>sirepo_flyer_photon_energy</th>
      <th>sirepo_flyer_horizontal_extent</th>
      <th>sirepo_flyer_vertical_extent</th>
      <th>sirepo_flyer_hash_value</th>
      <th>sirepo_flyer_status</th>
      <th>sirepo_flyer_duration</th>
      <th>sirepo_flyer_Aperture_horizontalSize</th>
      <th>sirepo_flyer_Aperture_verticalSize</th>
      <th>sirepo_flyer_Lens_horizontalFocalLength</th>
      <th>sirepo_flyer_Obstacle_horizontalSize</th>
    </tr>
    <tr>
      <th>seq_num</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2023-06-07 19:39:40.120308399</td>
      <td>c2c89491-ef9d-4369-b06c-8d780b6d4821</td>
      <td>[250, 896]</td>
      <td>3.677965e+13</td>
      <td>4240.0</td>
      <td>[-0.0013627376425855513, 0.0013596958174904943]</td>
      <td>[-0.000249500998003992, 0.00024750499001996017]</td>
      <td>d5d6628d50bd65a329717e8ffb942224</td>
      <td>completed</td>
      <td>16.176235</td>
      <td>0.1</td>
      <td>1.5</td>
      <td>8</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-06-07 19:39:40.120308399</td>
      <td>69c231a7-1c10-4c74-84b7-f22085ee4232</td>
      <td>[250, 546]</td>
      <td>9.944933e+13</td>
      <td>4240.0</td>
      <td>[-0.001015813953488372, 0.0010120930232558139]</td>
      <td>[-0.000249500998003992, 0.00024750499001996017]</td>
      <td>d6f8b77048fe6ad48e007cfb776528ad</td>
      <td>completed</td>
      <td>24.050266</td>
      <td>0.2</td>
      <td>1.4</td>
      <td>9</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-06-07 19:39:40.120308399</td>
      <td>4029593a-8d37-43b8-9326-b767d06f80d3</td>
      <td>[250, 440]</td>
      <td>1.492891e+14</td>
      <td>4240.0</td>
      <td>[-0.0009701657458563539, 0.0009701657458563542]</td>
      <td>[-0.00024650698602794426, 0.0002504990019960079]</td>
      <td>e5f914471d873f156c31815ab705575f</td>
      <td>completed</td>
      <td>24.272412</td>
      <td>0.3</td>
      <td>1.3</td>
      <td>10</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="shadow.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Run Sirepo/Shadow simulations with Bluesky</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../notebooks-old-api.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Notebooks (old API)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020, Brookhaven National Laboratory
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Run Sirepo/SRW simulations with Bluesky</a><ul>
<li><a class="reference internal" href="#Run-%22Source%22-SRW-simulations">Run “Source” SRW simulations</a></li>
<li><a class="reference internal" href="#Run-%22Beamline%22-SRW-simulations-sequentially">Run “Beamline” SRW simulations sequentially</a></li>
<li><a class="reference internal" href="#Run-%22Beamline%22-SRW-simulations-in-parallel">Run “Beamline” SRW simulations in parallel</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>
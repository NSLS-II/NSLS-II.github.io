<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="MAD-X Simulations" href="madx.html" /><link rel="prev" title="Examples" href="../examples.html" />

    <!-- Generated with Sphinx 7.0.1 and Furo 2023.05.20 -->
        <title>Optical Elements as Ophyd Objects - sirepo-bluesky 0.6.2.post40+g76d11b9 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">sirepo-bluesky 0.6.2.post40+g76d11b9 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">sirepo-bluesky 0.6.2.post40+g76d11b9 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../examples.html">Examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Optical Elements as Ophyd Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="madx.html">MAD-X Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulations.html">List of predefined simulations in Sirepo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="Optical-Elements-as-Ophyd-Objects">
<h1>Optical Elements as Ophyd Objects<a class="headerlink" href="#Optical-Elements-as-Ophyd-Objects" title="Permalink to this heading">#</a></h1>
<p>This section is based on the <strong>TES</strong> beamline example.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<section id="Run-%22Beamline%22-SRW-simulations">
<h2>Run “Beamline” SRW simulations<a class="headerlink" href="#Run-%22Beamline%22-SRW-simulations" title="Permalink to this heading">#</a></h2>
<p>In this example, we scan the horizontal size of the aperture and collect the resulting averaged intensities and corresponding 2D intensity distributions from the “Watchpoint” report on the “Beamline” page of Sirepo/SRW app.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">ipython</span></code> and run the following where <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> is the UID for the simulation we are working with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-07-18 16:31:26
Persistent Unique Scan ID: &#39;5ea54a17-1c5b-4fb2-ba0f-c68cf390f063&#39;
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;5ea54a17&#39;] (scan num: 1)



                                 time  \
seq_num
1       2023-07-18 16:31:55.360644817
2       2023-07-18 16:32:20.832318544
3       2023-07-18 16:32:46.302859545
4       2023-07-18 16:33:11.762577772
5       2023-07-18 16:33:37.242903471
6       2023-07-18 16:34:02.724879503

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
2        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
3        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
4        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
5        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
6        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        eb50805515b1c39bda3702ebd7bf90f9600735c74b5f6f...    28.340093
2        eebc982332b8f128cfcdc4bb1c811032b2f2da93cf85a9...    25.284040
3        f3150467384cb8afc246e1f45a3ff02c312db089a186c5...    25.293838
4        b14f415a5fe5d43b2e3e896c599eb36a6bef45ad706f88...    25.287728
5        f44ff779575788384aadb33690b8c52f1234e88a01a088...    25.295838
6        37f77ed022b8ebd7e4fca752f78252ba9f8bab57ec5b38...    25.294875

                                                  w9_image   w9_shape  \
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [42, 960]
2        [[89.48760223388672, 90.53831481933594, 90.827...  [42, 960]
3        [[259485.828125, 261822.359375, 264502.4375, 2...  [42, 960]
4        [[9231006.0, 9837807.0, 9560670.0, 9298954.0, ...  [42, 960]
5        [[68404136.0, 69001112.0, 69616448.0, 70282936...  [42, 960]
6        [[980582272.0, 1007160704.0, 1032941312.0, 103...  [42, 960]

              w9_mean  w9_photon_energy  \
seq_num
1        0.000000e+00            2500.0
2        4.594838e+11            2500.0
3        2.170590e+13            2500.0
4        7.031792e+13            2500.0
5        1.684183e+14            2500.0
6        3.468757e+14            2500.0

                                      w9_horizontal_extent  \
seq_num
1        [-2.1254114436366436e-06, -9.098470371627117e-07]
2         [-0.0003455044889645429, 0.00034048111155643006]
3          [-9.497909541585611e-05, 9.223270411427916e-05]
4           [-4.719082396347529e-05, 4.42548462284932e-05]
5        [-2.8159877207427783e-05, 2.5145910127955907e-05]
6         [-1.880166551489609e-05, 1.5761422719808468e-05]

                                        w9_vertical_extent  w9_id w9_title  \
seq_num
1           [-6.735306985152392e-07, 6.90416995865796e-07]     15       W9
2         [-1.789826993692091e-05, 1.7460512016671038e-05]     15       W9
3        [-1.7882633350325042e-05, 1.7445257871487232e-05]     15       W9
4         [-1.7370988769071537e-05, 1.694612715155033e-05]     15       W9
5         [-1.6659549338292866e-05, 1.625208818722446e-05]     15       W9
6         [-1.556056188360331e-05, 1.5179979892601324e-05]     15       W9

        w9_type  w9_element_position  aperture_horizontalSize
seq_num
1         watch               57.142                      0.0
2         watch               57.142                      0.4
3         watch               57.142                      0.8
4         watch               57.142                      1.2
5         watch               57.142                      1.6
6         watch               57.142                      2.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_3_1.png" src="../_images/notebooks_elements_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
    <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
    <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 42, 960)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_4_1.png" src="../_images/notebooks_elements_4_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beamline%22-Shadow3-simulations">
<h2>Run “Beamline” Shadow3 simulations<a class="headerlink" href="#Run-%22Beamline%22-Shadow3-simulations" title="Permalink to this heading">#</a></h2>
<p>This example repeats the above simulation, but instead uses Shadow3 to run the simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points before change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;models&quot;</span><span class="p">][</span><span class="s2">&quot;simulation&quot;</span><span class="p">][</span><span class="s2">&quot;npoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points after change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of points before change: 100000
Number of points after change: 1000000


Transient Scan ID: 1     Time: 2023-07-18 16:34:05
Persistent Unique Scan ID: &#39;af085431-0e84-440e-a451-ef263ef78349&#39;
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;af085431&#39;] (scan num: 1)



getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
                                 time  aperture_horizontalSize  \
seq_num
1       2023-07-18 16:34:24.769607306                      0.0
2       2023-07-18 16:34:42.991798639                      0.4
3       2023-07-18 16:35:01.199768305                      0.8
4       2023-07-18 16:35:19.410548449                      1.2
5       2023-07-18 16:35:37.682294607                      1.6
6       2023-07-18 16:35:55.940442562                      2.0

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        540ce63f26dded01216e9343240195969c0bade7783ace...    17.246957
2        2915e0650a5581e662b2413c7c69188790799d4ef11ba8...    16.240826
3        dba022c18d23e1154bffb627ead865990a9adb9e2dd355...    16.230186
4        c88f93cb325bf44cae3e1ea9d98746c406a75108712155...    16.235311
5        47373acd0bfd578e1ce2316347308acc8d27fe3596cb1e...    16.230831
6        2f92137494803aabfd1dca3814bce9fdc6660db535b311...    16.232784

                                                  w9_image    w9_shape  \
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
2        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
3        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
4        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
5        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
6        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]

          w9_mean  w9_photon_energy  \
seq_num
1        0.000000        2500.00041
2        0.513852        2500.00041
3        1.025116        2500.00041
4        1.540654        2500.00041
5        2.061967        2500.00041
6        2.581952        2500.00041

                                    w9_horizontal_extent  \
seq_num
1                                                [-1, 1]
2         [-0.0012336298496814044, 0.001405929122101391]
3        [-0.0013001551718158006, 0.0014759384530988694]
4        [-0.0013684114360191873, 0.0015466178480457952]
5        [-0.0014309472940233553, 0.0016109566331651013]
6        [-0.0015036858677506283, 0.0016955922719878388]

                                       w9_vertical_extent  w9_id w9_title  \
seq_num
1                                                 [-1, 1]     12       W9
2         [-0.0007103102913794072, 0.0004591117629407924]     12       W9
3        [-0.0007162298148739807, 0.00047877690974846177]     12       W9
4         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
5         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
6         [-0.0007162298148739807, 0.0005058855096921268]     12       W9

        w9_type  w9_element_position
seq_num
1         watch               57.142
2         watch               57.142
3         watch               57.142
4         watch               57.142
5         watch               57.142
6         watch               57.142
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_6_1.png" src="../_images/notebooks_elements_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
    <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
    <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 100, 100)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_7_1.png" src="../_images/notebooks_elements_7_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations">
<h2>Run “Beam Statistics” Sirepo/Shadow app simulations<a class="headerlink" href="#Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations" title="Permalink to this heading">#</a></h2>
<p>In this example, we scan the toroidal mirror’s radius and collect the results of the “Beam Statistics” report on the “Beamline” page of Sirepo/Shadow app. At the end of the execution, we provide the timing report for these simulations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>

<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">bsr</span> <span class="o">=</span> <span class="n">BeamStatisticsReport</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bsr&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>

<span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">bsr</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="n">scan_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">bsr</span><span class="p">],</span> <span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="p">,</span> <span class="o">*</span><span class="n">scan_range</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-07-18 16:36:06
Persistent Unique Scan ID: &#39;e4e1314d-4e6f-43d4-a681-3db25b4d0b36&#39;
New stream: &#39;primary&#39;
+-----------+------------+--------------+--------------+
|   seq_num |       time | toroid_r_maj | bsr_duration |
+-----------+------------+--------------+--------------+
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
 failed to format row
+-----------+------------+--------------+--------------+
generator scan [&#39;e4e1314d&#39;] (scan num: 1)



                                 time  \
seq_num
1       2023-07-18 16:36:09.979602098
2       2023-07-18 16:36:13.111551046
3       2023-07-18 16:36:16.243079901
4       2023-07-18 16:36:19.372517586
5       2023-07-18 16:36:22.503771066
6       2023-07-18 16:36:25.631004810
7       2023-07-18 16:36:28.768329382
8       2023-07-18 16:36:31.895383835
9       2023-07-18 16:36:35.027786255
10      2023-07-18 16:36:38.161113501
11      2023-07-18 16:36:41.293785810
12      2023-07-18 16:36:44.419981480
13      2023-07-18 16:36:47.546058893
14      2023-07-18 16:36:50.678554535
15      2023-07-18 16:36:53.808656693
16      2023-07-18 16:36:56.936452150
17      2023-07-18 16:37:00.067637682
18      2023-07-18 16:37:03.196928501
19      2023-07-18 16:37:06.324376106
20      2023-07-18 16:37:09.452412844
21      2023-07-18 16:37:12.580856562

                                      bsr_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
7        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
8        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
9        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
10       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
11       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
12       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
13       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
14       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
15       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
16       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
17       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
18       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
19       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
20       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
21       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                      bsr_sirepo_data_hash  bsr_duration  \
seq_num
1        04854ee660d863ec9019251c7578d47ae62fcf032a105d...      3.065320
2        8b084ef765e8f55ac486c0ef2372a0c8a9f823bb166796...      3.058593
3        9ee42435d702e9df6b0d6416fa6190e2df09bf638dfe54...      3.059920
4        2af614057cbb6ac159fd407b321d55cb472ee6f6c3398d...      3.060372
5        abcacf89fb5d298af086d5aa71c1d785e01d4c7cf0a257...      3.059038
6        5aa28fea061ca950990678eac0cc4b680bf698d59a717a...      3.059434
7        a86161614f505ae305d58e03e14d8d5a3a24ae5e82775f...      3.067523
8        eb28dc4dd91910f307a7429d5e535483fd9ed3e256f009...      3.058184
9        b9928b0fc9ac6a05a7bd99c64e7a17281e98ce791a080a...      3.059391
10       6c93cb5a04180a16015b99c8b429d370526e22587cf011...      3.062530
11       8483b6a0ed81a1b913ae115347eb8c01e163f377ecb5ee...      3.063228
12       7ecee00657854a44cae7572f7765651d4d190a3eda4752...      3.058692
13       af1823921de44532fd5725d3d05e7ccf8677c92c056433...      3.059635
14       b4774042d6813ef01568127bf4ca39ff0068d638b847dc...      3.064573
15       a12a981b9f9d85952c523dba24bedc3cf1e0773de66fa1...      3.062564
16       c971535b161db3752b140a3657bfe72654a20187792fbf...      3.059201
17       3e12f5f47b7c9c9d740189dd22f18aedead3214f8d6cfb...      3.060663
18       aae8b62d1332ed8189894a2ea2c651d2fb65daf5f128d8...      3.059826
19       eb311b0468d9e7f1ed03c02069362e2a5866491a125b3a...      3.057650
20       3f80152330312731ad64eced07137e8770c95e1f152a05...      3.059474
21       0dccd1dba5092142d470dc7b9143a130a8cd50bd73577d...      3.061618

                                                bsr_report  toroid_r_maj
seq_num
1        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       10000.0
2        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       12000.0
3        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       14000.0
4        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       16000.0
5        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       18000.0
6        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       20000.0
7        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       22000.0
8        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       24000.0
9        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       26000.0
10       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       28000.0
11       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       30000.0
12       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       32000.0
13       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       34000.0
14       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       36000.0
15       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       38000.0
16       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       40000.0
17       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       42000.0
18       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       44000.0
19       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       46000.0
20       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       48000.0
21       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       50000.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_9_1.png" src="../_images/notebooks_elements_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;toroid_r_maj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;bsr_report&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmax&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Horizonal RMS Beam Size [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmaz&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vertical RMS Beam Size [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Distance Along Beamline [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toroid_r_maj = </span><span class="si">{</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;toroid_r_maj&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_5354/2351232241.py:6: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  plt.figure(figsize=(16, 4))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_1.png" src="../_images/notebooks_elements_10_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_2.png" src="../_images/notebooks_elements_10_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_3.png" src="../_images/notebooks_elements_10_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_4.png" src="../_images/notebooks_elements_10_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_5.png" src="../_images/notebooks_elements_10_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_6.png" src="../_images/notebooks_elements_10_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_7.png" src="../_images/notebooks_elements_10_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_8.png" src="../_images/notebooks_elements_10_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_9.png" src="../_images/notebooks_elements_10_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_10.png" src="../_images/notebooks_elements_10_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_11.png" src="../_images/notebooks_elements_10_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_12.png" src="../_images/notebooks_elements_10_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_13.png" src="../_images/notebooks_elements_10_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_14.png" src="../_images/notebooks_elements_10_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_15.png" src="../_images/notebooks_elements_10_15.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_16.png" src="../_images/notebooks_elements_10_16.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_17.png" src="../_images/notebooks_elements_10_17.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_18.png" src="../_images/notebooks_elements_10_18.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_19.png" src="../_images/notebooks_elements_10_19.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_20.png" src="../_images/notebooks_elements_10_20.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_21.png" src="../_images/notebooks_elements_10_21.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="mf">1e9</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">scan_range</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Duration of simulations&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration of simulations [s]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Torus Major Radius [m]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Averaged duration&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Shadow TES simulation</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;RE(bp.scan([bsr], toroid.r_maj, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_range</span><span class="p">])</span><span class="si">}</span><span class="s2">))&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_11_0.png" src="../_images/notebooks_elements_11_0.png" />
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="madx.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">MAD-X Simulations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../examples.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Examples</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020, Brookhaven National Laboratory
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Optical Elements as Ophyd Objects</a><ul>
<li><a class="reference internal" href="#Run-%22Beamline%22-SRW-simulations">Run “Beamline” SRW simulations</a></li>
<li><a class="reference internal" href="#Run-%22Beamline%22-Shadow3-simulations">Run “Beamline” Shadow3 simulations</a></li>
<li><a class="reference internal" href="#Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations">Run “Beam Statistics” Sirepo/Shadow app simulations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>
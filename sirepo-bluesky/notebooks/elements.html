


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Optical Elements as Ophyd Objects &#8212; sirepo-bluesky 0.4.3.post108+gc5fd663 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MAD-X Simulations" href="madx.html" />
    <link rel="prev" title="Notebooks (new API)" href="../notebooks-new-api.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="madx.html" title="MAD-X Simulations"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../notebooks-new-api.html" title="Notebooks (new API)"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">sirepo-bluesky 0.4.3.post108+gc5fd663 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../notebooks-new-api.html" accesskey="U">Notebooks (new API)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Optical Elements as Ophyd Objects</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for cloud theme */

/* nicer titles and more space for info and warning logos */

div.admonition p.admonition-title {
    background: rgba(0, 0, 0, .05);
    margin: .5em -1em;
    margin-top: -.5em !important;
    padding: .5em .5em .5em 2.65em;
}

/* indent single paragraph */
div.admonition {
    text-indent: 20px;
}
/* don't indent multiple paragraphs */
div.admonition > p {
    text-indent: 0;
}
/* remove excessive padding */
div.admonition.inline-title p.admonition-title {
    padding-left: .2em;
}
</style>
<section id="Optical-Elements-as-Ophyd-Objects">
<h1>Optical Elements as Ophyd Objects<a class="headerlink" href="#Optical-Elements-as-Ophyd-Objects" title="Permalink to this heading">¶</a></h1>
<p>This section is based on the <strong>TES</strong> beamline example.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<section id="Run-“Beamline”-SRW-simulations">
<h2>Run “Beamline” SRW simulations<a class="headerlink" href="#Run-“Beamline”-SRW-simulations" title="Permalink to this heading">¶</a></h2>
<p>In this example, we scan the horizontal size of the aperture and collect the resulting averaged intensities and corresponding 2D intensity distributions from the “Watchpoint” report on the “Beamline” page of Sirepo/SRW app.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">ipython</span></code> and run the following where <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> is the UID for the simulation we are working with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2022-10-28 15:49:00
Persistent Unique Scan ID: &#39;638852dc-a7cf-441b-97c7-066474369855&#39;
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
|         1 | 15:49:22.7 |                   0.000 |      22.242 |      0.000 |
|         2 | 15:49:42.2 |                   0.400 |      19.342 | 459483826166.747 |
|         3 | 15:50:01.7 |                   0.800 |      19.350 | 21705901626084.516 |
|         4 | 15:50:21.1 |                   1.200 |      19.339 | 70317918327588.344 |
|         5 | 15:50:40.6 |                   1.600 |      19.342 | 168418312414274.781 |
|         6 | 15:51:00.1 |                   2.000 |      19.358 | 346875726031568.125 |
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;638852dc&#39;] (scan num: 1)



                                 time  \
seq_num
1       2022-10-28 15:49:22.755138636
2       2022-10-28 15:49:42.228121996
3       2022-10-28 15:50:01.703445435
4       2022-10-28 15:50:21.163632393
5       2022-10-28 15:50:40.633266211
6       2022-10-28 15:51:00.123753071

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
2        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
3        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
4        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
5        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
6        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        91ab78488428bf3fcb0a2cbeb79334bc95850323194253...    22.242282
2        c8525335f3bc6b67c6aeca5eb7600071dd612876c5fb8e...    19.341817
3        68c11868a0cec4485e7ff3f65d9177f1c24bf71f1be973...    19.350250
4        d3966e4cefcd6642111305bde55ae4959aa4d20a50a7f1...    19.338759
5        d047c5fcb1ecb64a5c557d9678f77bf7118cf2771092d9...    19.342006
6        07bdd6cc2add2b103dcb87ce5c4765ac94d262e0de5252...    19.357741

                                                  w9_image   w9_shape  \
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [42, 960]
2        [[89.48760223388672, 90.53831481933594, 90.827...  [42, 960]
3        [[259485.828125, 261822.359375, 264502.4375, 2...  [42, 960]
4        [[9231006.0, 9837807.0, 9560670.0, 9298954.0, ...  [42, 960]
5        [[68404136.0, 69001112.0, 69616448.0, 70282936...  [42, 960]
6        [[980582272.0, 1007160704.0, 1032941312.0, 103...  [42, 960]

              w9_mean  w9_photon_energy  \
seq_num
1        0.000000e+00            2500.0
2        4.594838e+11            2500.0
3        2.170590e+13            2500.0
4        7.031792e+13            2500.0
5        1.684183e+14            2500.0
6        3.468757e+14            2500.0

                                      w9_horizontal_extent  \
seq_num
1        [-2.1254114436366436e-06, -9.098470371627117e-07]
2         [-0.0003455044889645429, 0.00034048111155643006]
3          [-9.497909541585611e-05, 9.223270411427916e-05]
4           [-4.719082396347529e-05, 4.42548462284932e-05]
5        [-2.8159877207427783e-05, 2.5145910127955907e-05]
6         [-1.880166551489609e-05, 1.5761422719808468e-05]

                                        w9_vertical_extent  w9_id w9_title  \
seq_num
1           [-6.735306985152392e-07, 6.90416995865796e-07]     15       W9
2         [-1.789826993692091e-05, 1.7460512016671038e-05]     15       W9
3        [-1.7882633350325042e-05, 1.7445257871487232e-05]     15       W9
4         [-1.7370988769071537e-05, 1.694612715155033e-05]     15       W9
5         [-1.6659549338292866e-05, 1.625208818722446e-05]     15       W9
6         [-1.556056188360331e-05, 1.5179979892601324e-05]     15       W9

        w9_type  w9_element_position  aperture_horizontalSize
seq_num
1         watch               57.142                      0.0
2         watch               57.142                      0.4
3         watch               57.142                      0.8
4         watch               57.142                      1.2
5         watch               57.142                      1.6
6         watch               57.142                      2.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_3_1.png" src="../_images/notebooks_elements_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 42, 960)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_4_1.png" src="../_images/notebooks_elements_4_1.png" />
</div>
</div>
</section>
<section id="Run-“Beamline”-Shadow3-simulations">
<h2>Run “Beamline” Shadow3 simulations<a class="headerlink" href="#Run-“Beamline”-Shadow3-simulations" title="Permalink to this heading">¶</a></h2>
<p>This example repeats the above simulation, but instead uses Shadow3 to run the simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points before change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points after change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of points before change: 100000
Number of points after change: 1000000


Transient Scan ID: 1     Time: 2022-10-28 15:51:01
Persistent Unique Scan ID: &#39;d4c5437e-5b11-4e85-ae3d-bb56273d549f&#39;
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
|         1 | 15:51:17.4 |                   0.000 |      14.265 |      0.000 |
|         2 | 15:51:31.9 |                   0.400 |      13.267 |      0.514 |
|         3 | 15:51:46.4 |                   0.800 |      13.272 |      1.025 |
|         4 | 15:52:01.0 |                   1.200 |      13.272 |      1.541 |
|         5 | 15:52:15.6 |                   1.600 |      13.276 |      2.062 |
|         6 | 15:52:30.1 |                   2.000 |      13.278 |      2.582 |
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;d4c5437e&#39;] (scan num: 1)



getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
                                 time  \
seq_num
1       2022-10-28 15:51:17.430473804
2       2022-10-28 15:51:31.935786486
3       2022-10-28 15:51:46.455705404
4       2022-10-28 15:52:01.016648293
5       2022-10-28 15:52:15.624091387
6       2022-10-28 15:52:30.177404881

                                       w9_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                       w9_sirepo_data_hash  w9_duration  \
seq_num
1        788975aca8ceaa73c996b4393f025714a63d30dfd7583f...    14.265376
2        639bd00476a07278cd358d984256e4c77b7a51d9584c80...    13.267233
3        b967aa309441cea792e84393e51f4bf4141cc1f9281981...    13.272426
4        dfd9d6069afe51c3dbeb6a2c0bac605cb9fae515bc13dc...    13.271524
5        45750d2d88a504a95a85f301192cc985c147a05ed262c1...    13.276347
6        7cc4a3b90974be7d6f607ddc137f7b692c798713604709...    13.278056

                                                  w9_image    w9_shape  \
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
2        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
3        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
4        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
5        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
6        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]

          w9_mean  w9_photon_energy  \
seq_num
1        0.000000        2500.00041
2        0.513852        2500.00041
3        1.025116        2500.00041
4        1.540654        2500.00041
5        2.061967        2500.00041
6        2.581952        2500.00041

                                    w9_horizontal_extent  \
seq_num
1                                                [-1, 1]
2         [-0.0012336298496814044, 0.001405929122101391]
3        [-0.0013001551718158006, 0.0014759384530988694]
4        [-0.0013684114360191873, 0.0015466178480457952]
5        [-0.0014309472940233553, 0.0016109566331651013]
6        [-0.0015036858677506283, 0.0016955922719878388]

                                       w9_vertical_extent  w9_id w9_title  \
seq_num
1                                                 [-1, 1]     12       W9
2         [-0.0007103102913794072, 0.0004591117629407924]     12       W9
3        [-0.0007162298148739807, 0.00047877690974846177]     12       W9
4         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
5         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
6         [-0.0007162298148739807, 0.0005058855096921268]     12       W9

        w9_type  w9_element_position  aperture_horizontalSize
seq_num
1         watch               57.142                      0.0
2         watch               57.142                      0.4
3         watch               57.142                      0.8
4         watch               57.142                      1.2
5         watch               57.142                      1.6
6         watch               57.142                      2.0
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_6_1.png" src="../_images/notebooks_elements_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 100, 100)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_7_1.png" src="../_images/notebooks_elements_7_1.png" />
</div>
</div>
</section>
<section id="Run-“Beam-Statistics”-Sirepo/Shadow-app-simulations">
<h2>Run “Beam Statistics” Sirepo/Shadow app simulations<a class="headerlink" href="#Run-“Beam-Statistics”-Sirepo/Shadow-app-simulations" title="Permalink to this heading">¶</a></h2>
<p>In this example, we scan the toroidal mirror’s radius and collect the results of the “Beam Statistics” report on the “Beamline” page of Sirepo/Shadow app. At the end of the execution, we provide the timing report for these simulations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>

<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">bsr</span> <span class="o">=</span> <span class="n">BeamStatisticsReport</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bsr&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>

<span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">bsr</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="n">scan_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">bsr</span><span class="p">],</span> <span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="p">,</span> <span class="o">*</span><span class="n">scan_range</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2022-10-28 15:52:37
Persistent Unique Scan ID: &#39;8071458a-576d-4e0e-acd0-57f2fcae5e94&#39;
New stream: &#39;primary&#39;
+-----------+------------+--------------+--------------+
|   seq_num |       time | toroid_r_maj | bsr_duration |
+-----------+------------+--------------+--------------+
|         1 | 15:52:40.7 |    10000.000 |        3.079 |
|         2 | 15:52:43.9 |    12000.000 |        3.080 |
|         3 | 15:52:47.0 |    14000.000 |        3.076 |
|         4 | 15:52:50.1 |    16000.000 |        3.076 |
|         5 | 15:52:53.3 |    18000.000 |        3.086 |
|         6 | 15:52:56.4 |    20000.000 |        3.075 |
|         7 | 15:52:59.5 |    22000.000 |        3.123 |
|         8 | 15:53:03.0 |    24000.000 |        3.401 |
|         9 | 15:53:06.1 |    26000.000 |        3.076 |
|        10 | 15:53:09.3 |    28000.000 |        3.086 |
|        11 | 15:53:12.4 |    30000.000 |        3.082 |
|        12 | 15:53:15.5 |    32000.000 |        3.078 |
|        13 | 15:53:18.7 |    34000.000 |        3.076 |
|        14 | 15:53:21.8 |    36000.000 |        3.092 |
|        15 | 15:53:24.9 |    38000.000 |        3.077 |
|        16 | 15:53:28.1 |    40000.000 |        3.083 |
|        17 | 15:53:31.2 |    42000.000 |        3.078 |
|        18 | 15:53:34.3 |    44000.000 |        3.078 |
|        19 | 15:53:37.5 |    46000.000 |        3.079 |
|        20 | 15:53:40.6 |    48000.000 |        3.106 |
|        21 | 15:53:43.7 |    50000.000 |        3.083 |
+-----------+------------+--------------+--------------+
generator scan [&#39;8071458a&#39;] (scan num: 1)



                                 time  toroid_r_maj  \
seq_num
1       2022-10-28 15:52:40.782800198       10000.0
2       2022-10-28 15:52:43.914544344       12000.0
3       2022-10-28 15:52:47.040907860       14000.0
4       2022-10-28 15:52:50.165774345       16000.0
5       2022-10-28 15:52:53.301506281       18000.0
6       2022-10-28 15:52:56.426301718       20000.0
7       2022-10-28 15:52:59.597451448       22000.0
8       2022-10-28 15:53:03.055836678       24000.0
9       2022-10-28 15:53:06.185678005       26000.0
10      2022-10-28 15:53:09.324449539       28000.0
11      2022-10-28 15:53:12.456156969       30000.0
12      2022-10-28 15:53:15.583541870       32000.0
13      2022-10-28 15:53:18.709380388       34000.0
14      2022-10-28 15:53:21.850872517       36000.0
15      2022-10-28 15:53:24.979115486       38000.0
16      2022-10-28 15:53:28.113321304       40000.0
17      2022-10-28 15:53:31.247680187       42000.0
18      2022-10-28 15:53:34.378405094       44000.0
19      2022-10-28 15:53:37.506289244       46000.0
20      2022-10-28 15:53:40.668272734       48000.0
21      2022-10-28 15:53:43.799909592       50000.0

                                      bsr_sirepo_data_json  \
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
7        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
8        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
9        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
10       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
11       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
12       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
13       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
14       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
15       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
16       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
17       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
18       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
19       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
20       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
21       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                      bsr_sirepo_data_hash  bsr_duration  \
seq_num
1        b0225d321922694c43136ee84ed15b410edeb85187589e...      3.079059
2        1b46d56fdd269fbba326882dc5bc41a34e8d26e69fa503...      3.079966
3        226ed4caeefddfaa49fc4435b3891b50e771b3f68ba923...      3.076029
4        d57f37361964d9d7b13f584fac4c3dbc5c6dd7fe3b0a10...      3.075606
5        d69bf8ca16f7c5f7967b515a33931f966649b48db1cb3d...      3.086351
6        a1a7e0e1163c478985be86521017762ba807ae8d75cc72...      3.075159
7        db6978b2bbeb021f468a9382d628cf673885b6739c886b...      3.123180
8        559a7b21a164c350e2487c4aaf49324781315886db3930...      3.400876
9        65e183429b8191593a31cb4d2ca5e847547bc876a3af47...      3.076375
10       a01c131048a77a93a446ceea2bf14ee1cdcf6a19005a26...      3.085775
11       6d899594db95fb2592bcc08c919fb65677af7546c1aa01...      3.082409
12       646af5eb58fa611d2582cad259a5c036c3cdb91f2d253e...      3.077573
13       87e70ccd4eab15fcd0d3737b6c8a7620c306be09a4c127...      3.075909
14       c9e698f0bc5bdac5e82c12dcb77b5c54ba3f68d397287d...      3.091915
15       35f811b120164d66f227ccd1390bb036a4bbfd91f2d1cb...      3.076820
16       e357ee01bbc62c8fbd1537e399fd540662a36e715011d0...      3.083146
17       4985edbc55a36b24ca59d97ef8f9bf8908ed48046df721...      3.077832
18       9c5ae6eb6e901c2cd7ef7c33460b8d1009a6d4e413e996...      3.077550
19       7c78839baac446294583d5d5ee6bf0620b533ff56a7248...      3.078839
20       06e87153dec50f7fc66e4852eaeae443cdc0779e361790...      3.106373
21       942a38834dc08a31dd8978e80fab11e26d86a79d5597ce...      3.082972

                                                bsr_report
seq_num
1        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
2        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
3        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
4        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
5        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
6        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
7        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
8        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
9        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
10       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
11       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
12       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
13       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
14       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
15       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
16       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
17       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
18       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
19       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
20       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
21       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_9_1.png" src="../_images/notebooks_elements_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;toroid_r_maj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;bsr_report&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmax&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmaz&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toroid_r_maj = </span><span class="si">{</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;toroid_r_maj&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_5770/1375322784.py:6: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  plt.figure(figsize=(16, 4))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_1.png" src="../_images/notebooks_elements_10_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_2.png" src="../_images/notebooks_elements_10_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_3.png" src="../_images/notebooks_elements_10_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_4.png" src="../_images/notebooks_elements_10_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_5.png" src="../_images/notebooks_elements_10_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_6.png" src="../_images/notebooks_elements_10_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_7.png" src="../_images/notebooks_elements_10_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_8.png" src="../_images/notebooks_elements_10_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_9.png" src="../_images/notebooks_elements_10_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_10.png" src="../_images/notebooks_elements_10_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_11.png" src="../_images/notebooks_elements_10_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_12.png" src="../_images/notebooks_elements_10_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_13.png" src="../_images/notebooks_elements_10_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_14.png" src="../_images/notebooks_elements_10_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_15.png" src="../_images/notebooks_elements_10_15.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_16.png" src="../_images/notebooks_elements_10_16.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_17.png" src="../_images/notebooks_elements_10_17.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_18.png" src="../_images/notebooks_elements_10_18.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_19.png" src="../_images/notebooks_elements_10_19.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_20.png" src="../_images/notebooks_elements_10_20.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_21.png" src="../_images/notebooks_elements_10_21.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="mf">1e9</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">scan_range</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Duration of simulations&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration of simulations [s]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Torus Major Radius [m]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Averaged duration&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Shadow TES simulation</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;RE(bp.scan([bsr], toroid.r_maj, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scan_range</span><span class="p">])</span><span class="si">}</span><span class="s2">))&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_11_0.png" src="../_images/notebooks_elements_11_0.png" />
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks-old-api.html">Notebooks (old API)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks-new-api.html">Notebooks (new API)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optical Elements as Ophyd Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Run-“Beamline”-SRW-simulations">Run “Beamline” SRW simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-“Beamline”-Shadow3-simulations">Run “Beamline” Shadow3 simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-“Beam-Statistics”-Sirepo/Shadow-app-simulations">Run “Beam Statistics” Sirepo/Shadow app simulations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="madx.html">MAD-X Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulations.html">List of predefined simulations in Sirepo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="madx.html" title="MAD-X Simulations"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../notebooks-new-api.html" title="Notebooks (new API)"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">sirepo-bluesky 0.4.3.post108+gc5fd663 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../notebooks-new-api.html" >Notebooks (new API)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Optical Elements as Ophyd Objects</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Brookhaven National Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Optical Elements as Ophyd Objects &#8212; sirepo-bluesky 0.6.0.post26+g557ac2b documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MAD-X Simulations" href="madx.html" />
    <link rel="prev" title="Notebooks (new API)" href="../notebooks-new-api.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="madx.html" title="MAD-X Simulations"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../notebooks-new-api.html" title="Notebooks (new API)"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">sirepo-bluesky 0.6.0.post26+g557ac2b documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../notebooks-new-api.html" accesskey="U">Notebooks (new API)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Optical Elements as Ophyd Objects</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="Optical-Elements-as-Ophyd-Objects">
<h1>Optical Elements as Ophyd Objects<a class="headerlink" href="#Optical-Elements-as-Ophyd-Objects" title="Permalink to this heading">¶</a></h1>
<p>This section is based on the <strong>TES</strong> beamline example.</p>
<p><strong>Hint</strong>: See the <a class="reference internal" href="../simulations.html"><span class="doc">List of predefined simulations in Sirepo</span></a> for examples of identifiers for different beamlines.</p>
<section id="Run-%22Beamline%22-SRW-simulations">
<h2>Run “Beamline” SRW simulations<a class="headerlink" href="#Run-%22Beamline%22-SRW-simulations" title="Permalink to this heading">¶</a></h2>
<p>In this example, we scan the horizontal size of the aperture and collect the resulting averaged intensities and corresponding 2D intensity distributions from the “Watchpoint” report on the “Beamline” page of Sirepo/SRW app.</p>
<p>Start <code class="docutils literal notranslate"><span class="pre">ipython</span></code> and run the following where <code class="docutils literal notranslate"><span class="pre">sim_id</span></code> is the UID for the simulation we are working with:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;srw&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-05-25 16:33:02
Persistent Unique Scan ID: &#39;df18a50f-707b-4d6c-8539-bd2951f80922&#39;
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
|         1 | 16:33:33.7 |                   0.000 |      30.825 |      0.000 |
|         2 | 16:34:00.3 |                   0.400 |      26.345 | 459483826166.747 |
|         3 | 16:34:26.8 |                   0.800 |      26.374 | 21705901626084.516 |
|         4 | 16:34:53.3 |                   1.200 |      26.354 | 70317918327588.344 |
|         5 | 16:35:19.9 |                   1.600 |      26.371 | 168418312414274.781 |
|         6 | 16:35:46.4 |                   2.000 |      26.344 | 346875726031568.125 |
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;df18a50f&#39;] (scan num: 1)



                                 time
seq_num
1       2023-05-25 16:33:33.771647453  \
2       2023-05-25 16:34:00.304883242
3       2023-05-25 16:34:26.851459503
4       2023-05-25 16:34:53.372998238
5       2023-05-25 16:35:19.927242041
6       2023-05-25 16:35:46.455481529

                                       w9_sirepo_data_json
seq_num
1        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...  \
2        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
3        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
4        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
5        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...
6        {&#34;models&#34;: {&#34;arbitraryMagField&#34;: {&#34;interpolati...

                                       w9_sirepo_data_hash  w9_duration
seq_num
1        06dc6b1e82f86b73e96efe4fc4ad2c43b9f7beb40af1bd...    30.824592  \
2        c3f039c88c6e522a810d00168752034dbecbce4520a9cb...    26.344662
3        a6192f11c2afa3da5a2503abb4cf84c2874c3d03c44b10...    26.373883
4        9ed633a83a60cbe9689077bb9f618e83285849d596ac88...    26.354145
5        45eae8c85aaddb4457041f7cc241e14b2e24b0902e2e25...    26.370808
6        2f400e21aa5e43c8684a8c8cee181563d2ee8e3e64c3b7...    26.344144

                                                  w9_image   w9_shape
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [42, 960]  \
2        [[89.48760223388672, 90.53831481933594, 90.827...  [42, 960]
3        [[259485.828125, 261822.359375, 264502.4375, 2...  [42, 960]
4        [[9231006.0, 9837807.0, 9560670.0, 9298954.0, ...  [42, 960]
5        [[68404136.0, 69001112.0, 69616448.0, 70282936...  [42, 960]
6        [[980582272.0, 1007160704.0, 1032941312.0, 103...  [42, 960]

              w9_mean  w9_photon_energy
seq_num
1        0.000000e+00            2500.0  \
2        4.594838e+11            2500.0
3        2.170590e+13            2500.0
4        7.031792e+13            2500.0
5        1.684183e+14            2500.0
6        3.468757e+14            2500.0

                                      w9_horizontal_extent
seq_num
1        [-2.1254114436366436e-06, -9.098470371627117e-07]  \
2         [-0.0003455044889645429, 0.00034048111155643006]
3          [-9.497909541585611e-05, 9.223270411427916e-05]
4           [-4.719082396347529e-05, 4.42548462284932e-05]
5        [-2.8159877207427783e-05, 2.5145910127955907e-05]
6         [-1.880166551489609e-05, 1.5761422719808468e-05]

                                        w9_vertical_extent  w9_id w9_title
seq_num
1           [-6.735306985152392e-07, 6.90416995865796e-07]     15       W9  \
2         [-1.789826993692091e-05, 1.7460512016671038e-05]     15       W9
3        [-1.7882633350325042e-05, 1.7445257871487232e-05]     15       W9
4         [-1.7370988769071537e-05, 1.694612715155033e-05]     15       W9
5         [-1.6659549338292866e-05, 1.625208818722446e-05]     15       W9
6         [-1.556056188360331e-05, 1.5179979892601324e-05]     15       W9

        w9_type  w9_element_position  aperture_horizontalSize
seq_num
1         watch               57.142                      0.0
2         watch               57.142                      0.4
3         watch               57.142                      0.8
4         watch               57.142                      1.2
5         watch               57.142                      1.6
6         watch               57.142                      2.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_3_1.png" src="../_images/notebooks_elements_3_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 42, 960)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_4_1.png" src="../_images/notebooks_elements_4_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beamline%22-Shadow3-simulations">
<h2>Run “Beamline” Shadow3 simulations<a class="headerlink" href="#Run-%22Beamline%22-Shadow3-simulations" title="Permalink to this heading">¶</a></h2>
<p>This example repeats the above simulation, but instead uses Shadow3 to run the simulation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>
<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points before change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of points after change: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="s1">&#39;simulation&#39;</span><span class="p">][</span><span class="s1">&#39;npoint&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">w9</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">w9</span><span class="p">],</span> <span class="n">aperture</span><span class="o">.</span><span class="n">horizontalSize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>

<span class="n">w9_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;w9_image&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of points before change: 100000
Number of points after change: 1000000


Transient Scan ID: 1     Time: 2023-05-25 16:35:49
Persistent Unique Scan ID: &#39;320e1b43-b398-44f2-a1a2-c656195b7b6e&#39;
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
New stream: &#39;primary&#39;
+-----------+------------+-------------------------+-------------+------------+
|   seq_num |       time | aperture_horizontalSize | w9_duration |    w9_mean |
+-----------+------------+-------------------------+-------------+------------+
|         1 | 16:36:08.0 |                   0.000 |      17.278 |      0.000 |
|         2 | 16:36:25.0 |                   0.400 |      15.245 |      0.514 |
|         3 | 16:36:43.0 |                   0.800 |      16.283 |      1.025 |
|         4 | 16:37:01.0 |                   1.200 |      16.271 |      1.541 |
|         5 | 16:37:19.0 |                   1.600 |      16.255 |      2.062 |
|         6 | 16:37:36.9 |                   2.000 |      16.259 |      2.582 |
+-----------+------------+-------------------------+-------------+------------+
generator scan [&#39;320e1b43&#39;] (scan num: 1)



getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
                                 time  aperture_horizontalSize
seq_num
1       2023-05-25 16:36:08.093176126                      0.0  \
2       2023-05-25 16:36:25.057180643                      0.4
3       2023-05-25 16:36:43.056741238                      0.8
4       2023-05-25 16:37:01.011010885                      1.2
5       2023-05-25 16:37:19.003261805                      1.6
6       2023-05-25 16:37:36.942462921                      2.0

                                       w9_sirepo_data_json
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...  \
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                       w9_sirepo_data_hash  w9_duration
seq_num
1        7e863ae70d210081ff0978159d87c393b7e0c6d07177e8...    17.278466  \
2        377ea96c97d655cb96ec843b2210ac874549661ac2d354...    15.245019
3        1bf58602e8dd2c1c6cb7692fbe98cefc3b6107891a7d2f...    16.283133
4        4e489283b075eaeb88c1a79085f1180e53b55c18a7ae65...    16.271116
5        1fe03191c1ebcaab2a57d186eaeb0fa629fcad7e3a897a...    16.255296
6        e7f7d6b39b1b781da0445e3cd128cf157990b1374d2ae4...    16.259380

                                                  w9_image    w9_shape
seq_num
1        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]  \
2        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
3        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
4        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
5        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]
6        [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,...  [100, 100]

          w9_mean  w9_photon_energy
seq_num
1        0.000000        2500.00041  \
2        0.513852        2500.00041
3        1.025116        2500.00041
4        1.540654        2500.00041
5        2.061967        2500.00041
6        2.581952        2500.00041

                                    w9_horizontal_extent
seq_num
1                                                [-1, 1]  \
2         [-0.0012336298496814044, 0.001405929122101391]
3        [-0.0013001551718158006, 0.0014759384530988694]
4        [-0.0013684114360191873, 0.0015466178480457952]
5        [-0.0014309472940233553, 0.0016109566331651013]
6        [-0.0015036858677506283, 0.0016955922719878388]

                                       w9_vertical_extent  w9_id w9_title
seq_num
1                                                 [-1, 1]     12       W9  \
2         [-0.0007103102913794072, 0.0004591117629407924]     12       W9
3        [-0.0007162298148739807, 0.00047877690974846177]     12       W9
4         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
5         [-0.0007162298148739807, 0.0004933171836138536]     12       W9
6         [-0.0007162298148739807, 0.0005058855096921268]     12       W9

        w9_type  w9_element_position
seq_num
1         watch               57.142
2         watch               57.142
3         watch               57.142
4         watch               57.142
5         watch               57.142
6         watch               57.142
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
getshonecol: no GOOD rays, returning empty array
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_6_1.png" src="../_images/notebooks_elements_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">ImageGrid</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data shape: </span><span class="si">{</span><span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">num_frames</span> <span class="o">=</span> <span class="n">w9_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">),</span>
                 <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span>
                 <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">aspect</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">w9_image</span><span class="p">[:,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data shape: (6, 100, 100)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_7_1.png" src="../_images/notebooks_elements_7_1.png" />
</div>
</div>
</section>
<section id="Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations">
<h2>Run “Beam Statistics” Sirepo/Shadow app simulations<a class="headerlink" href="#Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations" title="Permalink to this heading">¶</a></h2>
<p>In this example, we scan the toroidal mirror’s radius and collect the results of the “Beam Statistics” report on the “Beamline” page of Sirepo/Shadow app. At the end of the execution, we provide the timing report for these simulations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> -i ../../../examples/prepare_det_env.py

<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_bluesky</span> <span class="kn">import</span> <span class="n">SirepoBluesky</span>
<span class="kn">from</span> <span class="nn">sirepo_bluesky.sirepo_ophyd</span> <span class="kn">import</span> <span class="n">BeamStatisticsReport</span><span class="p">,</span> <span class="n">create_classes</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SirepoBluesky</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

<span class="n">data</span><span class="p">,</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="s2">&quot;shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;00000002&quot;</span><span class="p">)</span>

<span class="n">classes</span><span class="p">,</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">create_classes</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">objects</span><span class="p">)</span>

<span class="n">bsr</span> <span class="o">=</span> <span class="n">BeamStatisticsReport</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bsr&quot;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>

<span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>
<span class="n">bsr</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="s2">&quot;hinted&quot;</span>

<span class="n">scan_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>

<span class="p">(</span><span class="n">uid</span><span class="p">,)</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">scan</span><span class="p">([</span><span class="n">bsr</span><span class="p">],</span> <span class="n">toroid</span><span class="o">.</span><span class="n">r_maj</span><span class="p">,</span> <span class="o">*</span><span class="n">scan_range</span><span class="p">))</span>

<span class="n">hdr</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tbl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Transient Scan ID: 1     Time: 2023-05-25 16:37:46
Persistent Unique Scan ID: &#39;f31cfe0f-6cca-4f6c-bfe4-0540d7d18b7f&#39;
New stream: &#39;primary&#39;
+-----------+------------+--------------+--------------+
|   seq_num |       time | toroid_r_maj | bsr_duration |
+-----------+------------+--------------+--------------+
|         1 | 16:37:49.9 |    10000.000 |        3.077 |
|         2 | 16:37:53.0 |    12000.000 |        3.083 |
|         3 | 16:37:56.2 |    14000.000 |        3.080 |
|         4 | 16:37:59.3 |    16000.000 |        3.084 |
|         5 | 16:38:02.5 |    18000.000 |        3.079 |
|         6 | 16:38:05.6 |    20000.000 |        3.080 |
|         7 | 16:38:08.8 |    22000.000 |        3.084 |
|         8 | 16:38:11.9 |    24000.000 |        3.070 |
|         9 | 16:38:15.1 |    26000.000 |        3.073 |
|        10 | 16:38:18.2 |    28000.000 |        3.078 |
|        11 | 16:38:21.4 |    30000.000 |        3.087 |
|        12 | 16:38:24.5 |    32000.000 |        3.088 |
|        13 | 16:38:27.7 |    34000.000 |        3.078 |
|        14 | 16:38:30.8 |    36000.000 |        3.072 |
|        15 | 16:38:34.0 |    38000.000 |        3.085 |
|        16 | 16:38:37.1 |    40000.000 |        3.077 |
|        17 | 16:38:40.3 |    42000.000 |        3.082 |
|        18 | 16:38:43.4 |    44000.000 |        3.075 |
|        19 | 16:38:46.6 |    46000.000 |        3.086 |
|        20 | 16:38:49.7 |    48000.000 |        3.075 |
|        21 | 16:38:52.9 |    50000.000 |        3.075 |
+-----------+------------+--------------+--------------+
generator scan [&#39;f31cfe0f&#39;] (scan num: 1)



                                 time
seq_num
1       2023-05-25 16:37:49.919442892  \
2       2023-05-25 16:37:53.079394102
3       2023-05-25 16:37:56.228990793
4       2023-05-25 16:37:59.383225203
5       2023-05-25 16:38:02.534847498
6       2023-05-25 16:38:05.681966782
7       2023-05-25 16:38:08.835600138
8       2023-05-25 16:38:11.975175619
9       2023-05-25 16:38:15.123186111
10      2023-05-25 16:38:18.273072720
11      2023-05-25 16:38:21.431757212
12      2023-05-25 16:38:24.591506720
13      2023-05-25 16:38:27.739592075
14      2023-05-25 16:38:30.882230043
15      2023-05-25 16:38:34.038137436
16      2023-05-25 16:38:37.188462496
17      2023-05-25 16:38:40.342676878
18      2023-05-25 16:38:43.491630554
19      2023-05-25 16:38:46.651262760
20      2023-05-25 16:38:49.798204422
21      2023-05-25 16:38:52.943988323

                                      bsr_sirepo_data_json
seq_num
1        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...  \
2        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
3        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
4        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
5        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
6        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
7        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
8        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
9        {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
10       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
11       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
12       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
13       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
14       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
15       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
16       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
17       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
18       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
19       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
20       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...
21       {&#34;models&#34;: {&#34;beamStatisticsReport&#34;: {&#34;driftDiv...

                                      bsr_sirepo_data_hash  bsr_duration
seq_num
1        a97fd4957501d0872208db4400ddbdbc9df04b40c41218...      3.076623  \
2        9277f7e7fab4b4c5e0ae8579eeae4f2d2dca29f6caa171...      3.082673
3        29c3b286aa43db7a28d76863b261cbb52d9e49a3c67de5...      3.080193
4        60fef2017240ea6dde7279e42e6b21d4dc63dce30421b8...      3.084386
5        d8d5acd0e290eb4a60a14d6a1086ebe1308e8fb9d4075c...      3.078544
6        9ec64b25ce96ca4467d15f1abc6b3694243e6b6e8e6248...      3.080120
7        78984efd8ff130a335e8bfeb734b5b410ece5ed7f6892e...      3.084352
8        8e0aabc8b13502f77d7f16b7c2710ea6dc494f74bef7c0...      3.070245
9        de7873094b94eb66435664d545ed15952096b1c688970e...      3.073101
10       0b2d60790abb79b69fbc0730c0201e46c08caabc7e43ef...      3.077582
11       4e7936b9968ca7b6df0f4837ad4d65d1927d8522e3c4a0...      3.086941
12       cfb7f14e7c001a1ba9c9cadb70c449da256385110e3c69...      3.087877
13       c8eb3d46d2731ea312e64dd48b3697b5aa867cc81cc20c...      3.077734
14       007da4c890b65ffe6d0c78f8971fe5666f4c6fcf305564...      3.072110
15       21426d2e1b7056db4db44a4fff48d525ecafba77151ed1...      3.084913
16       bbddfef87775319f080809ea8140a23ff7efe4e87f3881...      3.077389
17       c84a06429300b030f2f0d0628f16ec662499ca9361425e...      3.082447
18       2c5dd9cec6ec0cbf060091006a2ef33739369ec0598173...      3.074971
19       a287c6df26169c5ce1a4bd2f943e5592de6781d3cdd0e7...      3.086429
20       9e3320deac357165b428b8dd0e1ce93ca8bf7d6b7c42ab...      3.074661
21       2a52126c5507df4fa29652bb4518b944142dcfa4bb30d5...      3.074640

                                                bsr_report  toroid_r_maj
seq_num
1        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       10000.0
2        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       12000.0
3        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       14000.0
4        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       16000.0
5        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       18000.0
6        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       20000.0
7        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       22000.0
8        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       24000.0
9        {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       26000.0
10       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       28000.0
11       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       30000.0
12       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       32000.0
13       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       34000.0
14       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       36000.0
15       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       38000.0
16       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       40000.0
17       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       42000.0
18       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       44000.0
19       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       46000.0
20       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       48000.0
21       {&#34;angxpzp&#34;: [0.0, -1.7793448589854113e-20, -3....       50000.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_9_1.png" src="../_images/notebooks_elements_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;toroid_r_maj&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;bsr_report&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmax&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Horizonal RMS Beam Size [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sigmaz&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vertical RMS Beam Size [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Distance Along Beamline [m]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toroid_r_maj = </span><span class="si">{</span><span class="n">tbl</span><span class="p">[</span><span class="s1">&#39;toroid_r_maj&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/tmp/ipykernel_5509/2351232241.py:6: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`). Consider using `matplotlib.pyplot.close()`.
  plt.figure(figsize=(16, 4))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_1.png" src="../_images/notebooks_elements_10_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_2.png" src="../_images/notebooks_elements_10_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_3.png" src="../_images/notebooks_elements_10_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_4.png" src="../_images/notebooks_elements_10_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_5.png" src="../_images/notebooks_elements_10_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_6.png" src="../_images/notebooks_elements_10_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_7.png" src="../_images/notebooks_elements_10_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_8.png" src="../_images/notebooks_elements_10_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_9.png" src="../_images/notebooks_elements_10_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_10.png" src="../_images/notebooks_elements_10_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_11.png" src="../_images/notebooks_elements_10_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_12.png" src="../_images/notebooks_elements_10_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_13.png" src="../_images/notebooks_elements_10_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_14.png" src="../_images/notebooks_elements_10_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_15.png" src="../_images/notebooks_elements_10_15.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_16.png" src="../_images/notebooks_elements_10_16.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_17.png" src="../_images/notebooks_elements_10_17.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_18.png" src="../_images/notebooks_elements_10_18.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_19.png" src="../_images/notebooks_elements_10_19.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_20.png" src="../_images/notebooks_elements_10_20.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_10_21.png" src="../_images/notebooks_elements_10_21.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="mf">1e9</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">scan_range</span><span class="p">)[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Duration of simulations&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration of simulations [s]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Torus Major Radius [m]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Averaged duration&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Shadow TES simulation</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;RE(bp.scan([bsr], toroid.r_maj, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">scan_range</span><span class="p">])</span><span class="si">}</span><span class="s2">))&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_elements_11_0.png" src="../_images/notebooks_elements_11_0.png" />
</div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks-old-api.html">Notebooks (old API)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks-new-api.html">Notebooks (new API)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Optical Elements as Ophyd Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Run-%22Beamline%22-SRW-simulations">Run “Beamline” SRW simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-%22Beamline%22-Shadow3-simulations">Run “Beamline” Shadow3 simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-%22Beam-Statistics%22-Sirepo/Shadow-app-simulations">Run “Beam Statistics” Sirepo/Shadow app simulations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="madx.html">MAD-X Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulations.html">List of predefined simulations in Sirepo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="madx.html" title="MAD-X Simulations"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../notebooks-new-api.html" title="Notebooks (new API)"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">sirepo-bluesky 0.6.0.post26+g557ac2b documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../notebooks-new-api.html" >Notebooks (new API)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Optical Elements as Ophyd Objects</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Brookhaven National Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>
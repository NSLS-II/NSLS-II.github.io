

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Amostra 1.0.1.post38+g7c6bbb3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/clipboard.min.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script type="text/javascript">var copybuttonSkipText = '>>> ';</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Model" href="data-model.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Amostra
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1.post38+g7c6bbb3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#direct-connection-to-mongodb">Direct Connection to MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http-server-and-client">HTTP Server and Client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-client">Using the Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data-model.html">Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-history.html">Release History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Amostra</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Users can connect directly to a MongoDB (suitable for personal use or testing)
or connect to an HTTP server with a RESTful API. Amostra provides a Python
client for each of these modes that present identical interfaces to the user.</p>
<div class="section" id="direct-connection-to-mongodb">
<h3>Direct Connection to MongoDB<a class="headerlink" href="#direct-connection-to-mongodb" title="Permalink to this headline">¶</a></h3>
<p>For direct connection to MongoDB without an HTTP server in the middle, use
<a class="reference internal" href="reference.html#amostra.mongo_client.Client" title="amostra.mongo_client.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">amostra.mongo_client.Client</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">amostra.mongo_client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">amostra</span><span class="o">.</span><span class="n">mongo_client</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s1">&#39;mongodb://localhost:27017/amostra_demo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="http-server-and-client">
<h3>HTTP Server and Client<a class="headerlink" href="#http-server-and-client" title="Permalink to this headline">¶</a></h3>
<p>On a machine with access to the MongoDB server, start amostra’s HTTP server.
There is only one required option: the URI for a MongoDB database. Note that a
database name must be included in the URI, as in <code class="docutils literal notranslate"><span class="pre">test_amostra</span></code> below. Any
database name may be used, and it will be created if it does not yet exist.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python -m amostra.server --mongo_uri<span class="o">=</span><span class="s1">&#39;mongodb://localhost:27017/test_amostra&#39;</span>
<span class="o">[</span>I <span class="m">190802</span> <span class="m">15</span>:24:41 server:62<span class="o">]</span> Listening on <span class="m">0</span>.0.0.0:5000, path None
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">amostra.server</span> <span class="pre">--help</span></code> for more options, including SSL support
and a custom base URL.</p>
<p>On any machine that can see that server, use
<a class="reference internal" href="reference.html#amostra.http_client.Client" title="amostra.http_client.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">amostra.http_client.Client</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">amostra.mongo_client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">amostra</span><span class="o">.</span><span class="n">http_client</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s1">&#39;http://localhost:5000&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-the-client">
<h2>Using the Client<a class="headerlink" href="#using-the-client" title="Permalink to this headline">¶</a></h2>
<p>Create a new Sample.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;peanut butter&#39;</span><span class="p">)</span>

<span class="gp">In [2]: </span><span class="n">s</span>
<span class="gh">Out[2]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;peanut butter&#39;, projects=[], tags=[])</span>

<span class="gp">In [3]: </span><span class="n">s</span><span class="o">.</span><span class="n">name</span>
<span class="gh">Out[3]: </span><span class="go">&#39;peanut butter&#39;</span>
</pre></div>
</div>
<p>Update a trait of the sample.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;jelly&#39;</span>

<span class="gp">In [5]: </span><span class="n">s</span>
<span class="gh">Out[5]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;jelly&#39;, projects=[], tags=[])</span>
</pre></div>
</div>
<p>And again.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;grape jelly&#39;</span>

<span class="gp">In [7]: </span><span class="n">s</span>
<span class="gh">Out[7]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;grape jelly&#39;, projects=[], tags=[])</span>
</pre></div>
</div>
<p>All revisions are automatically persisted in the database and can be accessed.
The most recent revisions are given first.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">revisions</span><span class="p">())</span>
<span class="gh">Out[8]: </span><span class="go"></span>
<span class="go">[Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;jelly&#39;, projects=[], tags=[]),</span>
<span class="go"> Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;peanut butter&#39;, projects=[], tags=[])]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Sample has two read-only traits that are used internally:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">s</span><span class="o">.</span><span class="n">uuid</span>
<span class="gh">Out[9]: </span><span class="go">&#39;8ae15640-3fe1-4f3e-834c-3f81e7357acb&#39;</span>

<span class="gp">In [10]: </span><span class="n">s</span><span class="o">.</span><span class="n">revision</span>
<span class="gh">Out[10]: </span><span class="go">2</span>
</pre></div>
</div>
<p>A Sample is automatically given a uuid when it is created. All revisions of
that Sample share that same uuid, but the combination of uuid and revision
number is globally unique. The revision is incremented on each update.</p>
</div>
<p>Create several more samples, and then search to find one.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;coffee&#39;</span><span class="p">)</span>
<span class="gh">Out[11]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;coffee&#39;, projects=[], tags=[])</span>

<span class="gp">In [12]: </span><span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tea&#39;</span><span class="p">)</span>
<span class="gh">Out[12]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;tea&#39;, projects=[], tags=[])</span>

<span class="gp">In [13]: </span><span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;water&#39;</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;water&#39;, projects=[], tags=[])</span>

<span class="gp">In [14]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tea&#39;</span><span class="p">})</span>

<span class="gp">In [15]: </span><span class="n">s</span>
<span class="gh">Out[15]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;tea&#39;, projects=[], tags=[])</span>
</pre></div>
</div>
<p>Searches that are expected to return potentially more than one result, such as
a search for <em>all</em> samples, look like this.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">find</span><span class="p">({})</span>

<span class="gp">In [17]: </span><span class="n">results</span>
<span class="gh">Out[17]: </span><span class="go">&lt;generator object CollectionAccessor.find at 0x7f5f1f5a9048&gt;</span>
</pre></div>
</div>
<p>The search results are given as a <em>generator</em>, a lazy object that pulls data on
demand, to avoid clobbering the system if the set of results is large. To pull
just one result we can use <code class="docutils literal notranslate"><span class="pre">next</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">s</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="gp">In [19]: </span><span class="n">s</span>
<span class="gh">Out[19]: </span><span class="go">Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;grape jelly&#39;, projects=[], tags=[])</span>
</pre></div>
</div>
<p>To pull them all we can use <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">find</span><span class="p">({})</span>

<span class="gp">In [21]: </span><span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="gh">Out[21]: </span><span class="go"></span>
<span class="go">[Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;grape jelly&#39;, projects=[], tags=[]),</span>
<span class="go"> Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;coffee&#39;, projects=[], tags=[]),</span>
<span class="go"> Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;tea&#39;, projects=[], tags=[]),</span>
<span class="go"> Sample(composition=&#39;&#39;, description=&#39;&#39;, name=&#39;water&#39;, projects=[], tags=[])]</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">revisions</span></code> result above worked in the same way.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="data-model.html" class="btn btn-neutral float-right" title="Data Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Amostra Contributors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>